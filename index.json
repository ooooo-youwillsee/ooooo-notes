[{"categories":["è®¡åˆ’"],"content":"0ã€æŒç»­å­¦ä¹ è€… Talk is cheap. Show me the code. è‹±è¯­æ¯”ç¼–ç¨‹ç®€å•ã€‚ å­¦ä¹ å’Œå®è·µè¦å¹³è¡¡ã€‚ å­¦ä¼šå’Œæ—¶é—´åšæœ‹å‹ã€‚ å­¦ä¼šæŠ•èµ„ï¼Œå­¦ä¼šç†è´¢ã€‚ å­¦ä¼šå…ˆåšå‡æ³•ï¼Œå†åšåŠ æ³•ã€‚ å­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ã€‚ è¯´æ˜ï¼š â­• è¿›è¡Œä¸­ âœ… å·²å®Œæˆ âŒ å·²åºŸå¼ƒ â“ æœ‰å¿…è¦ â— é‡è¦æ€§ ğŸ“ è®°ç¬”è®° ğŸ–Š å†™ä»£ç  ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:1:0","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€å…³äºè‹±è¯­ ã€Šæ–°æ¦‚å¿µäºŒã€‹ â­• ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:2:0","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€å…³äºæŠ€æœ¯ è®¡åˆ’ ğŸ‰ï¼š åªè®°å½•è‡ªå·±è®¤ä¸ºæœ‰ç”¨çš„ç¬”è®°ã€‚ ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:3:0","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€ä¹¦ç± 0ï¸âƒ£1ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Kafkaï¼šæ ¸å¿ƒè®¾è®¡ä¸å®è·µåŸç†ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šåˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•å¼€å‘å®æˆ˜ã€‹ 0ï¸âƒ£3ï¸âƒ£. ã€ŠGo Web ç¼–ç¨‹ã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€ŠEffective C++ã€‹ 0ï¸âƒ£5ï¸âƒ£. ã€ŠMore Effective C++ã€‹ 0ï¸âƒ£6ï¸âƒ£. ã€Šæ·±åº¦æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€ŠGoè¯­è¨€è®¾è®¡ä¸å®ç°ã€‹ 0ï¸âƒ£8ï¸âƒ£. ã€ŠVimå®ç”¨æŠ€å·§ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹ â­• 0ï¸âƒ£9ï¸âƒ£. ã€ŠRocketMQæŠ€æœ¯å†…å¹• ç¬¬äºŒç‰ˆã€‹ 1ï¸âƒ£0ï¸âƒ£. ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹ 1ï¸âƒ£1ï¸âƒ£. ã€ŠMySQLæŠ€æœ¯å†…å¹•ã€‹ 1ï¸âƒ£2ï¸âƒ£. ã€Šæ·±å…¥è§£æJavaè™šæ‹ŸæœºHotSpotã€‹ 1ï¸âƒ£3ï¸âƒ£. ã€ŠRustæƒå¨æŒ‡å—ã€‹ â­• 1ï¸âƒ£4ï¸âƒ£. ã€Šæ·±å…¥å‰–æKubernetesã€‹ 1ï¸âƒ£5ï¸âƒ£. ã€ŠKubernetesç¼–ç¨‹ã€‹ â­• 1ï¸âƒ£6ï¸âƒ£. ã€ŠKubernetesè®¾è®¡æ¨¡å¼ã€‹ 1ï¸âƒ£7ï¸âƒ£. ã€Šæ·±å…¥å‰–æJavaè™šæ‹Ÿæœºã€‹ 1ï¸âƒ£8ï¸âƒ£. ã€Šç®—æ³•è®­ç»ƒè¥ï¼šæµ·é‡å›¾è§£+ç«èµ›åˆ·é¢˜ï¼ˆå…¥é—¨ç¯‡ã€‹ 1ï¸âƒ£9ï¸âƒ£. ã€Šç®—æ³•è®­ç»ƒè¥ï¼šæµ·é‡å›¾è§£+ç«èµ›åˆ·é¢˜ï¼ˆè¿›é˜¶ç¯‡ï¼‰ã€‹ 2ï¸âƒ£0ï¸âƒ£. ã€ŠTCP/IPè¯¦è§£ å·1ï¼šåè®®ã€‹ 2ï¸âƒ£1ï¸âƒ£. ã€Šè‡ªå·±åŠ¨æ‰‹å†™Dockerã€‹ â­• 2ï¸âƒ£2ï¸âƒ£. ã€ŠUNIXç½‘ç»œç¼–ç¨‹ å·1ï¼šå¥—æ¥å­—è”ç½‘APIï¼ˆç¬¬3ç‰ˆï¼‰ã€‹ ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:3:1","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€æ–‡æ¡£ 0ï¸âƒ£1ï¸âƒ£. ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹ 0ï¸âƒ£2ï¸âƒ£. ä» 0 å¼€å§‹å¸¦ä½ æˆä¸ºJVMå®æˆ˜é«˜æ‰‹ â­• 0ï¸âƒ£3ï¸âƒ£. Go è¯­è¨€é¡¹ç›®å¼€å‘å®æˆ˜ â­• 0ï¸âƒ£4ï¸âƒ£. Redis æºç å‰–æä¸å®æˆ˜ â­• 0ï¸âƒ£5ï¸âƒ£. æ·±å…¥ C è¯­è¨€å’Œç¨‹åºè¿è¡ŒåŸç† ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:3:2","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"3. æºç  0ï¸âƒ£1ï¸âƒ£. ã€Šrocketmq æºç ã€‹ â­• 0ï¸âƒ£2ï¸âƒ£. ã€Škubernetes æºç ã€‹ â­• 0ï¸âƒ£3ï¸âƒ£. ã€Šistio æºç ã€‹ 0ï¸âƒ£4ï¸âƒ£. ã€Šetcd æºç ã€‹ 0ï¸âƒ£5ï¸âƒ£. ã€Šdubbo æºç ã€‹ â­• 0ï¸âƒ£6ï¸âƒ£. ã€Šarthasã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€Šnsq æºç ã€‹ 0ï¸âƒ£8ï¸âƒ£. ã€Ševenting æºç ã€‹ 0ï¸âƒ£9ï¸âƒ£. ã€Šserving æºç ã€‹ 1ï¸âƒ£0ï¸âƒ£. ã€Šgrpc-go æºç ã€‹ â­• ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:3:3","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€è§†é¢‘ 0ï¸âƒ£1ï¸âƒ£. ã€Šç©è½¬ç®—æ³•ç³»åˆ—â€“å›¾è®ºç²¾è®²ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šç©è½¬ç®—æ³•é¢è¯•ã€‹ â­• ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:3:4","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€å…³äºå…¶ä»– ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:4:0","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€ä¹¦ç± ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€Šå“æœ‰æˆæ•ˆçš„å·¥ç¨‹å¸ˆã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€Šéæš´åŠ›æ²Ÿé€šã€‹ â­• 0ï¸âƒ£3ï¸âƒ£. ã€ŠåŸåˆ™ã€‹ 0ï¸âƒ£4ï¸âƒ£. ã€Šåˆ»æ„ç»ƒä¹ ã€‹ â­• 0ï¸âƒ£5ï¸âƒ£. ã€Šå…³é”®å¯¹è¯ã€‹ 0ï¸âƒ£6ï¸âƒ£. ã€Šå½“ä¸‹çš„å¯è’™ã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€Šäº²å¯†å…³ç³»ï¼šé€šå¾€çµé­‚çš„æ¡¥æ¢ã€‹ â­• 0ï¸âƒ£8ï¸âƒ£. ã€Šäººæ€§çš„å¼±ç‚¹ã€‹ 0ï¸âƒ£9ï¸âƒ£. ã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹ 1ï¸âƒ£0ï¸âƒ£. ã€Šå½“æˆ‘è°ˆè·‘æ­¥æ—¶ï¼Œæˆ‘è°ˆäº›ä»€ä¹ˆã€‹ ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:4:1","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€å°è¯• ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. å­¦ä¼šä½¿ç”¨å°¤å…‹é‡Œé‡Œå¼¹å¥ ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:4:2","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"3ã€äº†è§£ ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. æš‚æ—  ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:4:3","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€å¨±ä¹ 0ï¸âƒ£1ï¸âƒ£. ã€Šå¥‡é‡äººç”Ÿ ç¬¬ä¸€å­£ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šä¸€æœ¬å¥½ä¹¦ 1ã€‹ 0ï¸âƒ£3ï¸âƒ£. ã€Šä¸€æœ¬å¥½ä¹¦ 2ã€‹ ","date":"2023-01-01 09:00:00","objectID":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/:4:4","tags":["learning"],"title":"2023å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2023%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["éšç¬”"],"content":"1. å‰ç½®æ¡ä»¶ å®‰è£… dockerï¼Œå¿…é¡»é…ç½® docker ä»£ç†ï¼Œå¦åˆ™ build å¤±è´¥ã€‚ å‚è€ƒ ä¸‹è½½ istio æºç ã€‚ å®‰è£… go å’Œ dlv å·¥å…·ã€‚å‚è€ƒ ","date":"2022-12-19 09:00:00","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:0","tags":["istio","cloud native"],"title":"æ­å»º istio æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"2. è®¾ç½®ç¯å¢ƒå˜é‡ # docker åœ°å€ export HUB=\"docker.io/youwillsee\" # istio çš„æºç ç›®å½• export ISTIO=/root/code/istio # docker çš„ tag export TAG=1.16.0-debug ","date":"2022-12-19 09:00:00","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:0","tags":["istio","cloud native"],"title":"æ­å»º istio æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"3. build istio # æ„å»º debug çš„ç‰ˆæœ¬ï¼Œä¼šè¾“å‡ºåœ¨ out ç›®å½•ä¸‹ make DEBUG=1 build # æ„å»º debug çš„ç‰ˆæœ¬ï¼Œæ¨åˆ°æœ¬åœ°çš„ docker ä¸­ make DEBUG=1 docker # æ¨é€åˆ°è¿œç«¯çš„ docker ä¸­ make docker.push # æ¸…ç† make clean å‚è€ƒ istio-devlopment istio-code-base ","date":"2022-12-19 09:00:00","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:3:0","tags":["istio","cloud native"],"title":"æ­å»º istio æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"4. dlv è¿æ¥ # æ‰¾åˆ° pid ps -ef | grep pilot-discovery # attach pid dlv --listen=:2345 --headless=true --api-version=2 --accept-multiclient attach 172965 # ä½¿ç”¨ IDE è¿œç¨‹è¿æ¥ GOland -\u003e go remote ","date":"2022-12-19 09:00:00","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:4:0","tags":["istio","cloud native"],"title":"æ­å»º istio æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-istio-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"1. é…ç½® docker ä»£ç† # åˆ›å»ºé…ç½®ç›®å½• mkdir -p /etc/systemd/system/docker.service.d # åˆ›å»ºé…ç½®æ–‡ä»¶ vim /etc/systemd/system/docker.service.d/http-proxy.conf # é…ç½®æ–‡ä»¶å†…å®¹ [Service] Environment=\"HTTP_PROXY=http://ooooo:10800\" Environment=\"HTTPS_PROXY=http://ooooo:10800\" # é‡å¯ docker systemctl daemon-reload \u0026\u0026 systemctl restart docker # æŸ¥çœ‹é…ç½®æ˜¯å¦ç”Ÿæ•ˆ systemctl show --property=Environment docker ","date":"2022-12-18 09:00:00","objectID":"/ooooo-notes/%E8%AE%BE%E7%BD%AE-docker-%E4%BB%A3%E7%90%86/:1:0","tags":["docker","cloud native"],"title":"è®¾ç½® docker ä»£ç†","uri":"/ooooo-notes/%E8%AE%BE%E7%BD%AE-docker-%E4%BB%A3%E7%90%86/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. å®ç°é˜Ÿåˆ— ä»£ç ï¼š ä½¿ç”¨ head å’Œ tail æ¥å®ç°å•é“¾è¡¨ å•é“¾è¡¨æ¶‰åŠåˆ°ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œæ¯æ¬¡éƒ½è¦åˆ¤æ–­ä¸­é—´çŠ¶æ€ è¿™é‡Œä½¿ç”¨çš„æ˜¯ AtomicReference æ¥å®ç°çš„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ unsafe æ¥å®ç°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥å°è¯•ä¸‹ è¿™é‡Œä½¿ç”¨ curTail.next è¿›è¡Œ CAS æ¥æŒ‡å®šä¸‹ä¸€ä¸ªèŠ‚ç‚¹, å¾ˆå°‘è¿™ä¹ˆä½¿ç”¨ï¼Œåé¢å†è¯¦ç»†è¯´è¯´ public class LinkedQueue\u003cE\u003e { private final Node\u003cE\u003e dummy = new Node\u003c\u003e(null, null); private final AtomicReference\u003cNode\u003cE\u003e\u003e head = new AtomicReference\u003c\u003e(dummy); private final AtomicReference\u003cNode\u003cE\u003e\u003e tail = new AtomicReference\u003c\u003e(dummy); public boolean put(E item) { Node\u003cE\u003e newNode = new Node\u003c\u003e(item, null); while (true) { Node\u003cE\u003e curTail = tail.get(); Node\u003cE\u003e tailNext = curTail.next.get(); if (curTail == tail.get()) { if (tailNext != null) { // é˜Ÿåˆ—å¤„äºä¸­é—´çŠ¶æ€ï¼Œæ¨è¿›å°¾èŠ‚ç‚¹ tail.compareAndSet(curTail, tailNext); } else { // å¤„äºç¨³å®šçŠ¶æ€ï¼Œå°è¯•æ’å…¥æ–°èŠ‚ç‚¹ if (curTail.next.compareAndSet(null, newNode)) { // æ’å…¥æ“ä½œæˆåŠŸï¼Œå°è¯•æ¨è¿›å°¾èŠ‚ç‚¹ tail.compareAndSet(curTail, newNode); return true; } } } } } public E take() { while (true) { if (head.get() == tail.get()) { return null; } Node\u003cE\u003e oldHead = head.get(); Node\u003cE\u003e newHead = oldHead.next.get(); // é˜Ÿåˆ—å¤„äºä¸­é—´çŠ¶æ€ï¼Œå¯èƒ½å¦å¤–ä¸€ä¸ªçº¿ç¨‹å·²ç» CAS æˆåŠŸï¼Œ åªå‰©ä¸‹ä¸€ä¸ªå…ƒç´  dummy äº† if (newHead == null) { return null; } if (head.compareAndSet(oldHead, newHead)) { oldHead.next = null; return oldHead.item; } } } private static class Node\u003cE\u003e { private final E item; private AtomicReference\u003cNode\u003cE\u003e\u003e next; public Node(E item, Node\u003cE\u003e next) { this.item = item; this.next = new AtomicReference\u003c\u003e(next); } } } ","date":"2022-11-16 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/:1:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°é˜Ÿåˆ—","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-11-16 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/:2:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°é˜Ÿåˆ—","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E9%98%9F%E5%88%97/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. ä½¿ç”¨ Lock æ¥å®ç° Semaphore ä»£ç ï¼š Semaphore çš„åŠŸèƒ½å°±æ˜¯å…è®¸åŒæ—¶æœ‰å‡ ä¸ªçº¿ç¨‹æ“ä½œ acquire æ–¹æ³•ï¼Œpermit ä¼šå‡ä¸€ï¼Œå¦‚æœä¸º 0ï¼Œåˆ™çº¿ç¨‹éœ€è¦ç­‰å¾… release æ–¹æ³•ï¼Œpermit ä¼šåŠ ä¸€ï¼Œå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ public class SemaphoreOnLock { private final ReentrantLock lock = new ReentrantLock(); private final Condition condition = lock.newCondition(); private int permit; public SemaphoreOnLock(int permit) { this.permit = permit; } /** * è·å–é” */ public void acquire() { lock.lock(); try { while (permit \u003c= 0) { condition.await(); } permit--; } catch (InterruptedException ignored) { } finally { lock.unlock(); } } public void release() { lock.lock(); try { permit++; condition.signal(); } finally { lock.unlock(); } } } ","date":"2022-11-14 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-lock-%E6%9D%A5%E5%AE%9E%E7%8E%B0-semaphore/:1:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ Lock æ¥å®ç° Semaphore","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-lock-%E6%9D%A5%E5%AE%9E%E7%8E%B0-semaphore/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-11-14 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-lock-%E6%9D%A5%E5%AE%9E%E7%8E%B0-semaphore/:2:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ Lock æ¥å®ç° Semaphore","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-lock-%E6%9D%A5%E5%AE%9E%E7%8E%B0-semaphore/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. ä½¿ç”¨æ•°ç»„æ¥å®ç°æ ˆ ä»£ç ï¼š ç”¨æ•°ç»„æ¥å®ç° ç”¨ CTL æ¥æ§åˆ¶ æµ‹è¯•ç±»ï¼Œå‚è€ƒ ConcurrentStackUsingArrayTest public class ConcurrentStackUsingArray\u003cE\u003e { private final AtomicInteger CTL = new AtomicInteger(0); private final AtomicReference\u003cE[]\u003e arr = new AtomicReference\u003c\u003e((E[]) new Object[10]); private final AtomicInteger index = new AtomicInteger(0); public void push(E e) { while (!CTL.compareAndSet(0, 1)) { Thread.yield(); } while (index.get() \u003e= arr.get().length) { E[] oldArr = arr.get(); E[] newArr = (E[]) new Object[oldArr.length * 2]; System.arraycopy(oldArr, 0, newArr, 0, oldArr.length); if (arr.compareAndSet(oldArr, newArr)) { break; } } arr.get()[index.getAndIncrement()] = e; CTL.lazySet(0); } public E pop() { while (!CTL.compareAndSet(0, 1)) { Thread.yield(); } E e = arr.get()[index.decrementAndGet()]; CTL.lazySet(0); return e; } } ","date":"2022-11-13 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%882/:1:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°æ ˆ2","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%882/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-11-13 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%882/:2:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°æ ˆ2","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%882/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. java å¤šçº¿ç¨‹æµ‹è¯• åœ¨ä»»ä½•è¯­è¨€ä¸­ï¼Œå¤šçº¿ç¨‹æµ‹è¯•éƒ½æ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œåœ¨è¿™é‡Œæˆ‘ä»‹ç»ä¸‹ java çš„å¤šçº¿ç¨‹æµ‹è¯• jcstress. jcstress æ˜¯ OpenJDK æä¾›çš„ä¸€ä¸ªæµ‹è¯•å¤šçº¿ç¨‹çš„æ¡†æ¶ ä¸»è¦ç”±å¤šä¸ª Actor æ¥æ„æˆï¼Œæ¯ä¸ª Actor å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ã€‚ é€šè¿‡åŒ¹é… Outcome çš„ç»“æœæ¥æŠ¥å‘Šæµ‹è¯• è¿è¡Œä¹‹åçš„ç»“æœä¸º html æ–‡ä»¶ï¼Œéœ€è¦ä½ è‡ªå·±æŸ¥çœ‹ã€‚ ç¤ºä¾‹ä»£ç : æµ‹è¯•è‡ªæ—‹é”ï¼Œå…¶å®ä¹Ÿå‘Šè¯‰ä½ è¯¥æ€ä¹ˆç¼–å†™ CAS æ‰§è¡Œå‘½ä»¤ gradle jcstressï¼Œä¼šç”Ÿæˆç›®å½• build/reports/jcstress @JCStressTest @Outcome(id = {\"1, 2\", \"2, 1\"}, expect = Expect.ACCEPTABLE, desc = \"Mutex works\") @Outcome(id = \"1, 1\", expect = Expect.FORBIDDEN, desc = \"Mutex failure\") @State public class Mutex_03_SpinLock { private final AtomicBoolean taken = new AtomicBoolean(false); private int v; @Actor public void actor1(II_Result r) { while (taken.get() || !taken.compareAndSet(false, true)) ; // wait { // critical section r.r1 = ++v; } taken.set(false); } @Actor public void actor2(II_Result r) { while (taken.get() || !taken.compareAndSet(false, true)) ; // wait { // critical section r.r2 = ++v; } taken.set(false); } } ","date":"2022-11-12 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%8B%E8%AF%95/:1:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è¿›è¡Œå¤šçº¿ç¨‹æµ‹è¯•","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%8B%E8%AF%95/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-11-12 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%8B%E8%AF%95/:2:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è¿›è¡Œå¤šçº¿ç¨‹æµ‹è¯•","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%8B%E8%AF%95/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. å‚è€ƒ å¼ºçƒˆå»ºè®®å¤§å®¶çœ‹å®˜æ–¹ä»£ç , åœ°å€: https://github.com/openjdk/jcstress ","date":"2022-11-12 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%8B%E8%AF%95/:3:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è¿›è¡Œå¤šçº¿ç¨‹æµ‹è¯•","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%A4%9A%E7%BA%BF%E7%A8%8B%E6%B5%8B%E8%AF%95/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. å®ç°ç®€å•çš„ CAS ä¾‹å­ CAS ç›¸ä¿¡å¤§å®¶éƒ½å¬è¿‡ï¼Œå°±æ˜¯ compareAndSet(V expectedValue, V newValue), çœŸæ­£ä¼šç”¨çš„äººå¾ˆå°‘ï¼Œè¿™é‡Œçš„éš¾ç‚¹ä¸»è¦æ˜¯æ— é˜»å¡ç®—æ³•ã€‚ å…ˆå®ç°ä¸€ä¸ªç®€å• CAS ä¾‹å­ï¼Œåªå…·æœ‰å­¦ä¹ çš„æ„ä¹‰ã€‚ getValue: è·å–å€¼ compareAndSet: æ¯”è¾ƒæ—§å€¼ï¼Œè®¾ç½®æ–°å€¼ public class SimulatedCAS { private int value; public SimulatedCAS(int value) { this.value = value; } public synchronized int getValue() { return value; } public synchronized boolean compareAndSet(int expectedValue, int newValue) { if (expectedValue == value) { this.value = newValue; return true; } return false; } } é‡ç‚¹ï¼šçœŸæ­£ç”¨ CAS çš„æ—¶å€™ï¼Œéƒ½æ˜¯ while å¾ªç¯ ","date":"2022-11-09 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88/:1:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°æ ˆ","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ç”¨ CAS æ¥å®ç°ä¸€ä¸ªæ ˆ ä»£ç ï¼š ç”¨é“¾è¡¨æ¥å®ç°ï¼Œå½“ç„¶ç”¨æ•°ç»„å®ç°ä¹Ÿå¯ä»¥ï¼Œæ¯”è¾ƒéº»çƒ¦ä¸€ç‚¹ï¼Œåé¢æˆ‘å†å†™ä¸€ä¸ªç¤ºä¾‹ æ¯æ¬¡æ“ä½œéƒ½æ˜¯å…ˆ get æ¥è·å– top å¯¹è±¡ï¼Œç„¶åå† compareAndSet top public class ConcurrentStack\u003cE\u003e { private final AtomicReference\u003cNode\u003cE\u003e\u003e top = new AtomicReference\u003c\u003e(); public void push(E e) { Node\u003cE\u003e newHead = new Node\u003c\u003e(e); Node\u003cE\u003e oldHead; do { oldHead = top.get(); newHead.next = oldHead; } while (!top.compareAndSet(oldHead, newHead)); } public E pop() { Node\u003cE\u003e oldHead; Node\u003cE\u003e newHead; do { oldHead = top.get(); if (oldHead == null) { return null; } newHead = oldHead.next; } while (!top.compareAndSet(oldHead, newHead)); oldHead.next = null; return oldHead.e; } private static class Node\u003cE\u003e { private final E e; private Node\u003cE\u003e next; public Node(E e) { this.e = e; } } } ","date":"2022-11-09 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88/:2:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°æ ˆ","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-11-09 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88/:3:0","tags":["java"],"title":"åœ¨ java ä¸­ä½¿ç”¨ CAS æ¥å®ç°æ ˆ","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E4%BD%BF%E7%94%A8-cas-%E6%9D%A5%E5%AE%9E%E7%8E%B0%E6%A0%88/"},{"categories":["english"],"content":"lesson 1, 2022.11.1 Last Week I Went to the theatre, I had a very good seat, the play was very interesting.I did not enjoy it. The young man and young woman was sitting behind me.They were talking loudly. I got very angry. I could not hear actors. I turned round. I looked at the young man and young woman angrily. They did not pay any attention. In the end. I could not bear it. I turned round again. â€œI canâ€™t hear a wordâ€ I said angrily. â€œitâ€™s none of your business.â€ the young man said rudely. â€œThis is a private conversationâ€. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:1:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 2, 2022.11.5 It was Sunday, I never get up early on the Sundays. I sometimes stay in bed until lunchtime. Last Sunday. I got up very late. I looked out of the window, It was dark outside. â€œWhat a dayâ€, I thought. â€œItâ€™s raining again.â€ Just then, the telephone rang. It was my Aunt Lucy. â€œIâ€™ve just arrived by trainâ€, she said. â€œIâ€™m coming to see youâ€. â€œBut Iâ€™m still having breakfastâ€ I said. â€œWhat are you doing?â€ she asked. â€œIâ€™m having breakfastâ€. I repeated. â€œDear meâ€ she said. â€œDo you always get up so lateâ€, â€œItâ€™s one oâ€™clock.â€. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:2:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 3, 2028.11.7 Postcards always spoil my holidays. Last Summer, I went to go Italy. I visited the museums and sat in public gardens. The friendly waiter taught me a few words of Italian, then he lent me a book. I read a few lines, but I did not understand a word. Every day I thought about postcards. My holidays passed quickly. I did not send cards to my friends. On the last day I made a big decision. I got up early and bought thirty-seven cards. I spent the whole day in my room. but I did not write a single card. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:3:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 4, 2022.11.7 Iâ€™ve just received a letter from my brother. Tim. He is in Australia.He has been there for six months. He is an engineer. He is working for a big firm and has already visited a great number of different places in Australia. he has just bought an Australian car and has gone to Alice Springs, a small town in the centre of Australia. He will soon visit Darwin, From there, He will fly to Perth, My brother has never been aboard before. so he is finding this trip very exciting. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:4:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 5, 2022.11.8 Mr. James Scott has a garage in Silbury and now he has just bought another garage in Pinhurst, Pinhurst is only five miles from Silbury, but Mr. Scott cannot get a telephone for his new garage. so he has just bought twelve pigeons. Yesterday, A pigeon carried the first message from Silbury to Pinhurst, the bird covered the distance in three minutes. Up to now, Mr. scott has sent a great many requests for spare parts and other urgent messages from one garage to the other, In this way, he has begun his own private â€™telephoneâ€™ service. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:5:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 6, 2022.11.9 I have just moved to a house in Bridge street. Yesterday, a beggar knocked at my door, he asked me for a meal and a glass of beer. In return for this, the beggar stood on his head and sang songs. I gave him a meal, he ate the food and drank the beer. Then he put a piece of cheese in his pocket and went away. Later a neighbour told me about him, Everybody knows him, his name is Percy Buttons. he calls at every house in the street once a month and always asks for a meal and a glass of beer. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:6:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 7, 2022.11.10 The plane was late and detectives were waiting at the airport all morning. They were expecting a valuable parcel of diamonds from South Africa. A few hours earlier, someone had told the police that thieves would try to steal the diamonds. When the plane arrived, some of the detectives were waiting inside the main building while others were waiting on the airfield. Two men took the parcel off plane and carried it into Customs House. When two detectives were keeping guard at the door, two others opened the parcel. to their surprise, the precious parcel was full of stones and sand. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:7:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 8, 2022.11.12 Joe has the most beautiful garden in our town. Nearly everybody enters for â€œthe nicest garden competitionâ€ each year, but Joe wins every time. Billâ€™s garden is larger than Joeâ€™s. Bill works harder than Joe and grows more flowers and vegetables, but Joeâ€™s garden is more interesting. He has made neat paths and has built a wooden bridge over a pool. I like gardens too, but I do not like hard work. Every year I enter for the garden competition too, and I always win a little prize for the worst garden in the town. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:8:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 9, 2022.11.14 On Wednesday evening, we went to the Town Hall. It was the last day of the year and a large crowd of people had gathered under the Town Hall clock. It would strike twelve in twenty minutesâ€™ time. Fifteen minutes passed and then, at five to twelve, the clock stopped. The big minute hand did not move. We waited and waited, but nothing happened. Suddenly someone shouted, â€œItâ€™s two minutes past twelve, the clock has stopped.â€ I looked at my watch, it was true. The big clock refused to welcome the New Year. At that moment, everyone began to laugh and sing. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:9:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 10, 2022.11.16 We have an old musical instrument, it is called a clavichord. It was made in Germany in 1681. Our clavichord is kept in the living room. It has belonged to our family for a long time. The instrument was bought by my grandfather many years ago. Recently it was damaged by a visitor. She tried to play jazz on it. She struck the keys too hard and two of the strings were broken. My father was shocked. Now we are not allowed to touch it. It is being repaired by a friend of my fatherâ€™s. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:10:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 11, 2022.11.18 I was having dinner in a restaurant when Tony came in. Tony worked in a lawyerâ€™s office years ago, but he is now working at a bank. He gets a good salary, but he always borrows money from his friends and never pays it back. Tony saw me and came and sat at the same table. He has never borrowed money from me. While he was eating, I asked him to lend me twenty pounds. To my surprise, he gave me the money immediately. â€œI have never borrowed any money from youâ€, Tony said, â€œso now you can pay for my dinner.â€ ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:11:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 12, 2022.11.20 Our neighbour, Captain Charles Alison, will sail from Portsmouth tomorrow. Weâ€™ll meet him at the harbour early in the morning. He will be in his small boat, Topsail. Topsail is a famous little boat. It has sailed across the Atlantic many times. Captain Alison will set out at eight oâ€™clock, so weâ€™ll have plenty of time. Weâ€™ll see his boat and then weâ€™ll say goodbye to him. He will be away for two months. We are very proud of him. He will take part in an important race across the Atlantic. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:12:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 13, 2022.11.21 The Greenwood boys are a group of pop singers. At present, they are visiting all parts of the country. They will be arriving here tomorrow. They will be coming by train and most of the young people in the town will be meeting them at the station. Tomorrow evening they will be singing at the workersâ€™ club. The Greenwood boys will be staying for five days. During this time, they will give five performances. As usual, the police will have a difficult time. They will be trying to keep order. It is always same on these occasions. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:13:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 14, 2022.11.22 I had an amusing experience last year. After I had left a small village in the south of French, I drove on to the next town. On the way, the young man waved to me. I stopped and he asked me for a lift. As soon as he had got into the car, I said good morning to him in French and he replied in the same language. Apart from a few words, I do not know any French at all. Neither of us spoke during the journey. I had nearly reached the town, when the young man suddenly said, very slowly, â€˜Do you speck English ?â€™. As I soon learnt, he was English himself. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:14:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 15, 2022.11.23 The secretary told me that Mr.xxx would see me. I felt very nervous when I went info his office. He did not look up from his desk when I entered. After I had sat down, he said that business was very bad. He told me that the firm could not afford to pay such large salaries. Twenty people had already left. I knew that my turn had come. â€˜Mr. xxxâ€™ I said in a weak voice. â€˜Donâ€™t interruptâ€™, he said. Then he smiled and he told me I would receive an extra thousand pounds a year. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:15:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 16, 2022.11.27 If you park your car in the wrong place, the traffic policeman will soon find it. You will be very lucky if he lets you go without a ticket. However, this does not always happen. Traffic police are sometimes very polite. During a holidays in Sweden. I found this note on my car, â€˜Sir, We welcome you to our city, This is a â€˜No Parkingâ€™ area. You will enjoy your stay here if you pay attention to our street signs. This note is only a reminderâ€™. If you receive a request like this, you cannot fail to obey it. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:16:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 17, 2022.11.28 My aunt Jennifer is an actress. She must be at least thirty-five years old. In spite of this, she often appears on the stage as a young girl. Jennifer will have to take part in a new play soon. This time, she will be a girl of seventeen. In the play, she must appear in a bright red dress and long black stockings. Last year in another play, she had to wear short socks, and a bright orange-colored dress. If anyone ever asks her how old she is, she always answers, â€˜Darling, it must be terrible to be grown upâ€™. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:17:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 18, 2022.11.30 After I had had lunch in a village pub, I looked for my bag. I had left it on a chair beside the door and now it wasnâ€™t there. As I was looking for it, the landlord came in. â€˜Did you have a good meal?â€™ he asked. â€˜Yes, thank youâ€™ I answered, â€˜but I canâ€™t pay the bill, I havenâ€™t got my bagâ€™. The landlord smiled and immediately went out. In a few minutes he returned with my bag and gave it back to me. â€˜Iâ€™m very sorryâ€™ he said, â€˜My dog had taken it into gardenâ€™, He often does this. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:18:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 19, 2022.12.3 â€˜The play may begin at any momentâ€™ I said. â€˜It may have begun alreadyâ€™ Susan answered. I hurried to the ticket office, â€˜May I have two tickets please?â€™ I asked. â€˜Iâ€™m sorry, Weâ€™ve sold outâ€™ the girl said. â€˜What a pity!â€™ Susan exclaimed. Just then, a man hurried to the ticket office, â€˜Can I returned these two ticket?â€™ he asked. â€˜Certainly.â€™ the girl said. I went back to the ticket office at once. â€˜Could I have those two tickets please?â€™ â€˜Certainly, but theyâ€™re for next Wednesdayâ€™s performance. Do you still want them?â€™. â€˜I might as well have themâ€™ I said sadly. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:19:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 20, 2022.12.5 Fishing is my favorite sport. I often fish for hours without catching anything. But this does not worry me. Some fishermen are unlucky. Instead of catching, they catch old boots and rubbish. I am even less unlucky. I never catch anything, not even old boots. After having spent whole mornings on the river, I always go home with an empty bag. â€˜You must give up fishing.â€™ My friends say. â€˜Itâ€™s a waste of time.â€™ But they donâ€™t realize one important thing. I am not really interested in fishing. I am only interested in sitting in a boat and doing nothing at all. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:20:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 21, 2022.12.8 Aeroplanes are slowly driving me mad. I live near an airport and passing planes can be heard night and day. The airport was built years ago, but for some seasons it could not be used then. Last year, however, it came into use. Over a hundred people must have been driven away from their homes by the noise. I am one of the few people left. Sometimes I think this house will be knocked down by a passing plane. I have been offered a large sum of money to go away. but I am determined to stay here. Everyone says I must be mad and they are probably right. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:21:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 22, 2022.12.12 My daughter, Jane, never dreamed of receiving a letter from a girl of her own age in Holland. Last year, we were traveling across the Channel and Jane put a piece of paper with her name and address on it into a bottle. She threw the bottle into the sea. Jane never thought of it again, but ten months later, she received a letter from a girl in Holland. Both girls write to each other regularly now. However, they have decided to use the post office. Letters will cost a little more, but they will certainly travel faster. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:22:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 23, 2022.12.13 I had a letter from my sister yesterday. She lives in Nigeria. In her letter, she said me that she would come to England next year. If she comes, she will get a surprise. We are now living in a beautiful new house in the country. Work on it had begun before my sister left. The house was completed five months ago. In my letter, I told her that she could stay with us. The house has many larger rooms and there is a lovely garden. It is a very modern house, so it looks strange to some people. It must be the only modern house in the district. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:23:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 24, 2022.12.15 I entered a hotel managerâ€™s office and sat down. I had just lost 50 and I felt very upset. â€œI left the money in my roomâ€. I said, â€œand itâ€™s not there nowâ€. The manager was sympathetic, but he could do nothing. â€œEveryoneâ€™s losing money these daysâ€ he said. He started to complain about this wicked world, but was interrupted by a knock at the door. A girl came in and put an envelope on his desk. It contained $50. â€œI found this outside this gentlemanâ€™s room.â€ she said. â€œWellâ€, I said to the manager. â€œthere is still some honesty in this worldâ€. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:24:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 25, 2022.12.16 I arrived in London at last. The railway station was big, black and dark. I didnâ€™t know the way to my hotel, so I asked a porter. I not only spoke English very carefully, but very clearly as well. The porter, however, could not understand me. I repeated my question several times and at last he understood. He answered me, but he spoke neither slowly nor clearly. â€œI am a foreigner.â€ I said. Then he spoke slowly, but I could not understand him. My teacher never spoke English like that. The porter and I looked at each other and smiled. Then he said something and I understood it. â€œYouâ€™ll soon learn englishâ€ he said. I wonder. In England, each person speaks a different language. The English understand each other, but I donâ€™t understand them. Do they speak English? ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:25:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 26, 2022.12.20 I am an art student and paint a lot of pictures. Many people pretend that they understand modern art. They always tell you what a picture is about. Of course, Many pictures are not about anything. They are just pretty patterns. We like them in the same way that we like pretty curtain material. I think that young children often appreciate modern pictures better than anyone else. The notice more. My sister is only sevenï¼Œbut she always tells me whether my pictures are good or not. She came into my room yesterday. â€œWhat are you doing?â€ she asked. â€œIâ€™m hanging this picture on the wallâ€ I answered. â€œItâ€™s a new no, Do you like it?â€. She looked at it critically for a moment. â€œItâ€™s all right.â€ she said. â€œBut isnâ€™t it upside down?â€ I looked at it again. She was rightï¼It was. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:26:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 27, 2022.12.24 Late in the afternoon. The boys put up their tent in the middle of a field. As soon as this was done, they cooked a meal over an open fire. They were all hungry and the food smelled good. After a wonderful meal, they told stories and sang songs by the campfire. But some time later it began to rain. The boys felt tired, so they put out the fire and crept into their tent. Their sleeping bags were warm and comfortable, so they all slept soundly. In the middle of the night. two boys woke up and began shouting. The tent was full of water. They leapt out of their sleeping bags and hurried outside. It was raining heavily and they found that a stream had formed in the field. The stream wound its way across the field and then flowed right under their tent. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:27:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 28, 2022.12.24 Jasper White is one of those rare people who believes in ancient myths. he has just bought a new house in the city. But ever since he moved in, he has had trouble with cars and their owners. When he returns home at night, he always finds that someone has parked a car outside his gate. Because of this, he has not been able to get his own car into his garage even once. Jasper has put up â€œNo parkingâ€ signs outside his gate, but these have not had any effect. Now he has put an ugly stone head over the gate. It is one of the ugliest faces I have ever seen. I asked him what it was, he told me that it was Medusa, the Gorgon, Jasper hopes that she will turn cars and their owners to stone. But none of them has been turned to stone yet. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:28:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 29, 2023.1.4 Captain Ben Fawcett has bought an unusual taxi and has begun a new service. The â€œtaxiâ€ is a small Swiss aeroplane called a â€œPilatus Porterâ€. This wonderful plane can carry seven passengers. The most surprising thing about it, however, is that it can land anywhere, on snow, water or even on a ploughed field. Captain Fawcettâ€™s first passenger was a doctor who flew from Birmingham to a lonely village in the Welsh mountains. Since then, Captain Fawcett has flown passengers to many unusual places. Once he landed on the roof of a block of flats and on another occasion he landed in a deserted car park. Captain Fawcett has just refused a strange request from a businessman. The man wanted to fly Rockall, a lonely island in the Atlantic Ocean, but Captain Fawcett did not take him, because the trip was too dangerous. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:29:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 30. 2023.1.4 The Wayle is a small river that cuts across the park near my home. I like sitting by the Wayle on fine afternoons. It was warm last Sunday, so I went and sat on the river bank as usual. Some children were playing games on the bank and there were some people rowing on the river. Suddenly, one of the children kicked a ball very hard and it went towards a passing boat. Some people on the bank called out to the man in the boat, but he did not hear him. The ball struck him so hard that he nearly fell into the water. I turned to look at the children, but there werenâ€™t any in sight. They had all run away. The man laughed when he realized what had happened, he called out to the children and threw the ball back to the bank. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:30:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 31, 2023.1.6 Yesterday afternoon Frank was telling me about his experiences as a young man. Before he retired, he was the head of a large business company, but as a boy he used to work in a small shop. It is his job to repair bicycles and at that time he used to work fourteen hours a day. He saved money for years and in 1958 he bought a small workshop of his own. In his twenties Frank used to make spare parts for aeroplanes. At that time he had two helpers. In a few years the small workshop had become a large factory which employed seven hundred and twenty-eight people. Frank smiled when he remembered his hard early years and a long road to success. Frank was still smiling when the door opened and his wife came in. She wanted him to repair their grandsonâ€™s bicycle. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:31:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 32, 2023.1.6 People are not so honest as they once were. The temptation to steal is greater than ever before, especially in large shops. The detective recently watched a well-dressed woman who always went into a large store on Monday mornings. One Monday, there were fewer people in the shop than usual when the woman came in, so it was easier for the detective to watch him. The woman first bought a few small articles. After a little time, she chose one of the most expensive dresses in the shop and handed it to an assistant who wrapped it up for her as quick as possible. Then the woman simply took the parcel and walked out of the shop without paying. When she was arrested, the detective found out that the shop assistant was her daughter. The girl â€œgaveâ€ her mother a free dress once a week. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:32:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 33, 2023.1.10 Nearly a week passed before the girl was able to explain what had happened to her. One afternoon she set out from the coast in a small boat and was caught in a storm. Towards evening, the boat struck a rock and the girl jumped into the sea. Then she swam to the shore after spending the whole night in the water. During that time she covered a distance of eight miles. Early next morning, she saw a light ahead. She knew she was near the shore because the light was high up on the cliffs. On arriving at the shore, the girl struggled up the cliff towards the light she had seen. That was all she remembered. When she woke up a day later, she found herself in hospital. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:33:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 34, 2023.1.10 Dan Robinson has been worried all week. Last Tuesday he received a letter from the local police. In the letter, he was asked to call at the station. Dan wondered why he was wanted by the police. but he went into the station yesterday and now he is not worried anymore. At the station, he was told by a smiling policeman that his bicycle had been found. Five days ago, the policeman told him, the bicycle was picked up in a small village four hundred miles away. It is now being sent to his home by train. Dan was most surprised when he heard the news. He was amused too, because he never expected the bicycle to be found. It was stolen twenty years ago when Dan was a boy of fifteen. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:34:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["english"],"content":"lesson 35, 2023.1.12 Roy used to drive a taxi. A short while ago, however, he became to a bus driver and he has not regretted it. He is finding his new work far more exciting. When he was driving along Carford street recently, he saw two thieves rush out of a shop and run towards a waiting car. One of them was carrying a bag full of money. Roy acted quickly and drove his bus straight at two thieves. The one with the money got such a fright that he dropped the bag. As two thieves were trying to get away in their car, Roy drove his bus into the back of it. While the battered car was moving away, Roy stopped his bus and telephoned the police. The thievesâ€™ car was badly damaged and easy to recognize. Shortly afterwards, the police stopped the car and both men were arrested. ","date":"2022-11-01 08:00:00","objectID":"/ooooo-notes/english/02/:35:0","tags":["english"],"title":"æ–°æ¦‚å¿µè‹±è¯­äºŒ","uri":"/ooooo-notes/english/02/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"grpc ä½¿ç”¨æ–¹å¼ grpc ä½œä¸ºä¸€ä¸ªé€šä¿¡æ–¹å¼ï¼Œç°åœ¨å¯ä»¥è¯´æ˜¯éå¸¸æµè¡Œã€‚å¦‚æœä¸ä¼š grpcï¼Œä½ å¯èƒ½è·Ÿä¸ä¸Šæ—¶ä»£äº†, è¿™é‡Œæˆ‘åªæ˜¯åšä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­ï¼Œå¹¶è¯´ä¸‹å¦‚ä½•è¿›ä¸€æ­¥å­¦ä¹  grpcã€‚ grpc æ¥å£éœ€è¦ç¼–å†™ .proto æ–‡ä»¶ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­ï¼š æœ‰ä¸€ä¸ªæ¥å£ç±»ï¼šGreeter. æœ‰ä¸¤ä¸ªæ–¹æ³• SayHello, SayHi. syntax = \"proto3\"; option java_multiple_files = true; option java_package = \"com.ooooo.grpc.helloworld\"; option java_outer_classname = \"HelloWorldProto\"; package helloworld; // The greeting service definition. service Greeter { // Sends a greeting rpc SayHello (HelloRequest) returns (HelloReply) {} rpc SayHi (HelloRequest) returns (HelloReply) {} } // The request message containing the user's name. message HelloRequest { string name = 1; } // The response message containing the greetings message HelloReply { string message = 1; } åœ¨è¿™é‡Œï¼Œæˆ‘å¾ˆæ¨èå¤§å®¶çœ‹ä¸‹ï¼Œprotobuf æ˜¯æ€ä¹ˆç¼–ç çš„ã€‚ proto3, å®˜æ–¹åœ°å€ï¼š https://developers.google.com/protocol-buffers/docs/proto3 proto3 encoding, å®˜æ–¹åœ°å€ï¼š https://developers.google.com/protocol-buffers/docs/encoding ç¼–å†™å®Œ .proto æ–‡ä»¶ï¼Œæ‰§è¡Œ gradle çš„ generateProto ä»»åŠ¡, å°±ä¼šç”Ÿæˆç›¸åº”çš„ java ä»£ç ã€‚ ç„¶åç¼–å†™å…¥å£ç¨‹åº GrpcClient å’Œ GrpcServerã€‚ ","date":"2022-10-22 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-grpc/:1:0","tags":["java","grpc"],"title":"åœ¨ java ä¸­å¦‚ä½•ä½¿ç”¨ grpc","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-grpc/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"å¦‚ä½•è¿›ä¸€æ­¥å­¦ä¹  grpc å­¦ä¹  grpc å¦‚ä½•ä½¿ç”¨ï¼Œå¦‚ä½•æ‰©å±•ï¼Œå¯ä»¥çœ‹ https://github.com/grpc/grpc-java/tree/master/examples. åœ¨ spring-boot ä¸­å¦‚ä½•ä½¿ç”¨ï¼Œæœ‰å¼€æºçš„ starter. grpc æ˜¯åŸºäº http2 åè®®çš„ï¼Œä½ å¿…é¡»ç†Ÿæ‚‰ http2 åè®®ã€‚ æ›´æ·±å…¥çš„å­¦ä¹ ï¼Œä¹Ÿå°±æ˜¯å­¦ä¹ æºç ï¼Œæœ‰æ—¶é—´ç»™å¤§å®¶è¯´ä¸‹ grpc çš„æºç ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒç®€å•çš„ã€‚ ","date":"2022-10-22 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-grpc/:2:0","tags":["java","grpc"],"title":"åœ¨ java ä¸­å¦‚ä½•ä½¿ç”¨ grpc","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-grpc/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-10-22 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-grpc/:3:0","tags":["java","grpc"],"title":"åœ¨ java ä¸­å¦‚ä½•ä½¿ç”¨ grpc","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-grpc/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. æ·»åŠ æ‰“å° SQL çš„æ–¹å¼ æ‰“å° SQL çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚æœ‰ idea æ’ä»¶ï¼Œæœ‰ mybatis æ‹¦æˆªå™¨ï¼Œæœ‰ä»£ç† datasource, æœ‰ä»£ç† driver. æˆ‘æ¯”è¾ƒè®¤å¯çš„æ–¹å¼å°±æ˜¯ä»£ç† driver. è¿™ç§æ— ä»»ä½•ä¾µå…¥æ€§ã€‚ ä¸‹é¢æ¥ä»‹ç»å¦‚ä½•ä½¿ç”¨ p6spy Driverã€‚ ç¤ºä¾‹ä»£ç ï¼š ä½¿ç”¨ BeanPostProcessor æ¥åŠ¨æ€æ‰©å±• beanã€‚ åˆ¤æ–­ bean æ˜¯å¦ä¸º DataSource ç±»å‹ï¼Œå¹¶åˆ¤æ–­å¼€å‘é…ç½® dev.sql-log.enabledã€‚ æ ¹æ®ç°æœ‰çš„ driver é…ç½®æ¥åˆ›å»ºæ–°çš„ datasourceï¼Œå¹¶è®¾ç½® urlã€‚ å®é™…å¼€å¯ï¼Œè¿˜éœ€è¦ spy.properties é…ç½®æ–‡ä»¶ @Slf4j @Configuration public class DevDataSourceConfiguration implements BeanPostProcessor, EnvironmentAware { @Setter private Environment environment; @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException { if (bean instanceof DataSource \u0026\u0026 parseBoolean(environment.resolvePlaceholders(\"${dev.sql-log.enabled:false}\"))) { log.info(\"å·²å¼€å¯æ—¥å¿—æ‰“å°ï¼Œå°†ä½¿ç”¨[P6SpyDriver]\"); if (environment.acceptsProfiles(Profiles.of(\"run\"))) { log.warn(\"åœ¨ç”Ÿäº§ç¯å¢ƒä¸€å®šè¦å…³é—­é…ç½®[dev.sql-log.enabled]\"); } return proxyDataSource((DataSource) bean); } return bean; } public DataSource proxyDataSource(DataSource dataSource) { if (dataSource instanceof AbstractRoutingDataSource) { AbstractRoutingDataSource abstractRoutingDataSource = (AbstractRoutingDataSource) dataSource; // resolvedDataSources Field resolvedDataSourcesField = findField(AbstractRoutingDataSource.class, \"resolvedDataSources\"); makeAccessible(resolvedDataSourcesField); @SuppressWarnings(\"unchecked\") Map\u003cObject, DataSource\u003e resolvedDataSources = (Map\u003cObject, DataSource\u003e) getField(resolvedDataSourcesField, abstractRoutingDataSource); if (resolvedDataSources != null) { resolvedDataSources.forEach((k, v) -\u003e resolvedDataSources.put(k, convertToProxyDataSource(v))); } // resolvedDefaultDataSource Field resolvedDefaultDataSourceField = findField(AbstractRoutingDataSource.class, \"resolvedDefaultDataSource\"); makeAccessible(resolvedDefaultDataSourceField); DataSource resolvedDefaultDataSource = (DataSource) getField(resolvedDefaultDataSourceField, abstractRoutingDataSource); if (resolvedDefaultDataSource != null) { ReflectionUtils.setField(resolvedDefaultDataSourceField, abstractRoutingDataSource, convertToProxyDataSource(resolvedDefaultDataSource)); } return abstractRoutingDataSource; } return convertToProxyDataSource(dataSource); } public DataSource convertToProxyDataSource(DataSource dataSource) { if (dataSource instanceof HikariDataSource) { HikariConfig oldConfig = (HikariDataSource) dataSource; // jdbc:h2:mem:test to jdbc:p6spy:h2:mem:test String jdbcUrl = oldConfig.getJdbcUrl(); if (!jdbcUrl.contains(\"p6spy\")) { jdbcUrl = \"jdbc:p6spy\" + jdbcUrl.substring(4); } HikariConfig newConfig = new HikariConfig(); newConfig.setPoolName(\"proxy-P6SpyDriver\"); newConfig.setDriverClassName(\"com.p6spy.engine.spy.P6SpyDriver\"); newConfig.setJdbcUrl(jdbcUrl); newConfig.setUsername(oldConfig.getUsername()); newConfig.setPassword(oldConfig.getPassword()); return new HikariDataSource(newConfig); } return dataSource; } } ","date":"2022-10-22 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0-sql-%E6%97%A5%E5%BF%97/:1:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•æ·»åŠ  SQL æ—¥å¿—","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0-sql-%E6%97%A5%E5%BF%97/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-10-22 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0-sql-%E6%97%A5%E5%BF%97/:2:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•æ·»åŠ  SQL æ—¥å¿—","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%B7%BB%E5%8A%A0-sql-%E6%97%A5%E5%BF%97/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. è‡ªå®šä¹‰ classloader æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘çš„æ—¶å€™ï¼Œä¼šé‡åˆ°æ¯”è¾ƒæ¶å¿ƒçš„é—®é¢˜ï¼Œå­˜åœ¨ä¸¤ä¸ªä¸åŒ jar åŒ…ï¼Œä½†æ˜¯ç±»çš„å…¨é™å®šåæ˜¯ä¸€æ ·çš„ï¼Œè€Œè¿™ä¸¤ä¸ªåŒ…éƒ½ä¸èƒ½åˆ é™¤ï¼Œè¿™æ—¶å€™è°ƒç”¨å¯èƒ½å°±ä¼šå‡ºé—®é¢˜ã€‚ å¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Ÿ æˆ‘çš„ç­”æ¡ˆå°±æ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å™¨ã€‚ åœºæ™¯æ¨¡æ‹Ÿ module-a: è¡¨ç¤º a.jar module-b: è¡¨ç¤º b.jar module-main: è¡¨ç¤º ç¨‹åºå…¥å£ ç”±äºåœ¨ module-main é¡¹ç›®ä¸­åŒæ—¶å¼•å…¥äº† module-a å’Œ module-b è¿™ä¸¤ä¸ª jar åŒ…ï¼Œä½†æ˜¯å­˜åœ¨å†²çªç±» HelloService, æœ€ç»ˆå¯¼è‡´ç¨‹åºè¿è¡Œé”™è¯¯ã€‚ å¦‚ä½•è‡ªå®šä¹‰ classloaderï¼Œæ¥è§£å†³é—®é¢˜ï¼Ÿ é‡æ–°å®šä¹‰ loadClass æ–¹æ³•ï¼Œæ‰“ç ´çˆ¶ç±»å§”æ‰˜æœºåˆ¶ ä½¿ç”¨ getResources æ–¹æ³•æ¥è·å–æ‰€æœ‰çš„ class æ–‡ä»¶ï¼Œç„¶ååˆ¤æ–­ @SneakyThrows public String test1(String message) { // æŸ¥æ‰¾ç±» ClassLoader classLoader = new ModuleAClassLoader(); Class\u003c?\u003e clazz = classLoader.loadClass(\"com.ooooo.HelloService\"); // æ‰§è¡Œ Method test1 = ReflectionUtils.findMethod(clazz, \"test1\", String.class); Object result = test1.invoke(null, message); return (String) result; } @SneakyThrows public String test2(String message) { // æŸ¥æ‰¾ç±» ClassLoader classLoader = new ModuleBClassLoader(); Class\u003c?\u003e clazz = classLoader.loadClass(\"com.ooooo.HelloService\"); // æ‰§è¡Œ Method test2 = ReflectionUtils.findMethod(clazz, \"test2\", String.class); Object result = test2.invoke(null, message); return (String) result; } private static class ModuleAClassLoader extends ClassLoader { public ModuleAClassLoader() { super(ModuleAClassLoader.class.getClassLoader()); } @SneakyThrows @Override protected Class\u003c?\u003e loadClass(String name, boolean resolve) throws ClassNotFoundException { Class\u003c?\u003e c = findLoadedClass(name); if (c == null) { // å½“å‰è·¯å¾„ä¸‹å»æ‰¾ if (name.contains(\"com.ooooo\")) { String path = name.replace(\".\", \"/\") + \".class\"; Enumeration\u003cURL\u003e resources = getResources(path); URL targetUrl = null; while (resources.hasMoreElements()) { targetUrl = resources.nextElement(); if (targetUrl.toString().contains(\"module-a\")) { break; } } // è¯»å– class æ–‡ä»¶ InputStream in = targetUrl.openStream(); byte[] bytes = StreamUtils.copyToByteArray(in); in.close(); c = defineClass(name, bytes, 0, bytes.length); } } if (c == null) { c = getParent().loadClass(name); } if (resolve) { resolveClass(c); } return c; } } private static class ModuleBClassLoader extends ClassLoader { public ModuleBClassLoader() { super(ModuleAClassLoader.class.getClassLoader()); } @SneakyThrows @Override protected Class\u003c?\u003e loadClass(String name, boolean resolve) throws ClassNotFoundException { Class\u003c?\u003e c = findLoadedClass(name); if (c == null) { // å½“å‰è·¯å¾„ä¸‹å»æ‰¾ if (name.contains(\"com.ooooo\")) { String path = name.replace(\".\", \"/\") + \".class\"; Enumeration\u003cURL\u003e resources = getResources(path); URL targetUrl = null; while (resources.hasMoreElements()) { targetUrl = resources.nextElement(); if (targetUrl.toString().contains(\"module-b\")) { break; } } // è¯»å– class æ–‡ä»¶ InputStream in = targetUrl.openStream(); byte[] bytes = StreamUtils.copyToByteArray(in); in.close(); c = defineClass(name, bytes, 0, bytes.length); } } if (c == null) { c = getParent().loadClass(name); } if (resolve) { resolveClass(c); } return c; } } } ","date":"2022-10-18 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%B1%BB%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:1:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è§£å†³ç±»å†²çªé—®é¢˜","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%B1%BB%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-10-18 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%B1%BB%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/:2:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è§£å†³ç±»å†²çªé—®é¢˜","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%B1%BB%E5%86%B2%E7%AA%81%E9%97%AE%E9%A2%98/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. methodHandle è°ƒç”¨ åœ¨è¿‡å»ï¼Œæˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªç±»çš„æ–¹æ³•ï¼Œé™¤äº†ç›´æ¥è°ƒç”¨ï¼Œå†å°±æ˜¯ä½¿ç”¨åå°„æ¥è°ƒç”¨äº†ã€‚è€Œä»Šå¤©æˆ‘è¦è¯´è¯´ jdk æ–°å¼•å…¥çš„æ–¹å¼æ¥è°ƒç”¨ã€‚ æ¯”å¦‚æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ UserService ç±»ã€‚ public class UserService { public String getUsername(String id) { return \"username\" + id; } } ç›´æ¥è°ƒç”¨å’Œåå°„è°ƒç”¨çš„æ–¹å¼æ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸è¯´æ˜äº†ã€‚ ä¸‹é¢æ¥æ¼”ç¤º invoke åŒ…çš„ä½¿ç”¨ã€‚ ä½¿ç”¨ MethodHandles.lookup() æ¥æŸ¥æ‰¾å¯¹åº”çš„æ–¹æ³• ä½¿ç”¨ methodHandle æ¥è°ƒç”¨ï¼Œåˆ†ä¸ºå‡ ç§ä¸åŒçš„æ–¹å¼ public class UserServiceTest { private MethodType methodType; private Lookup lookup; private MethodHandle methodHandle; @SneakyThrows @BeforeEach public void beforeEach() { methodType = MethodType.methodType(String.class, String.class); lookup = MethodHandles.lookup(); methodHandle = lookup.findVirtual(UserService.class, \"getUsername\", methodType); } @SneakyThrows @Test public void invokeWithArguments() { UserService userService = new UserService(); Object obj = methodHandle.bindTo(userService).invokeWithArguments(\"1\"); assertEquals(\"username1\", obj); } @SneakyThrows @Test public void invoke() { UserService userService = new UserService(); Object obj = methodHandle.invoke(userService, \"1\"); assertEquals(\"username1\", obj); } /** * è¦æ±‚ç±»å‹å…¨åŒ¹é…, åŒ…æ‹¬è¿”å›å€¼ç±»å‹ */ @SneakyThrows @Test public void invokeExact() { UserService userService = new UserService(); String s = (String) methodHandle.invokeExact(userService, \"1\"); assertEquals(\"username1\", s); } } ","date":"2022-10-17 09:00:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-java-%E4%B8%AD-invoke-%E5%8C%85/:1:0","tags":["java"],"title":"å¦‚ä½•ä½¿ç”¨ java ä¸­ invoke åŒ…?","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-java-%E4%B8%AD-invoke-%E5%8C%85/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-10-17 09:00:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-java-%E4%B8%AD-invoke-%E5%8C%85/:2:0","tags":["java"],"title":"å¦‚ä½•ä½¿ç”¨ java ä¸­ invoke åŒ…?","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-java-%E4%B8%AD-invoke-%E5%8C%85/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. jmh å¾®åŸºå‡†æµ‹è¯• å®é™…ä¸Šï¼Œåœ¨ java ä¸­è¿›è¡Œå¾®åŸºæ¤æµ‹è¯•å¹¶ä¸å®¹æ˜“ï¼Œä¸»è¦åŸå› åœ¨äºè§£é‡Šæ‰§è¡Œï¼Œç¼–è¯‘æ‰§è¡Œï¼Œè€Œç¼–è¯‘æ‰§è¡Œåˆåˆ†ä¸º C1ç¼–è¯‘, C2ç¼–è¯‘ã€‚å³ä½¿æ˜¯å¯¹åŒä¸€ä¸ªä»£ç æ¥è¯´ï¼Œä¸åŒçš„ jvm å‚æ•°ä¹Ÿä¼šå¯¼è‡´æµ‹è¯•ä¸ä¸€æ ·ã€‚ é‚£æ˜¯å¦åº”è¯¥äº†è§£å¾®åŸºå‡†æµ‹è¯•ï¼Ÿ æˆ‘çš„ç­”æ¡ˆï¼Œæ˜¯å¿…é¡»æŒæ¡çš„ã€‚ jmh å°±æ˜¯æˆ‘ä»¬åº”è¯¥å­¦ä¹ çš„å¾®åŸºå‡†æµ‹è¯•çš„æ¡†æ¶ã€‚ ä¸‹é¢æˆ‘ä»¥ä¸€ä¸ªç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•å¿«é€Ÿä¸Šæ‰‹æµ‹è¯•ï¼Œæµ‹è¯• StringBuilderï¼Œ StringBufferï¼Œ String è¿æ¥å­—ç¬¦çš„æ€§èƒ½ã€‚ æ³¨æ„ç‚¹ï¼š Fork å‚æ•°å¯ä»¥æµ‹è¯•ä¸åŒçš„ Jvm å‚æ•°ã€‚ è¾“å‡ºç»“æœçš„æ—¶é—´å•ä½æœ€å¥½æ˜¯çº³ç§’ã€‚ æµ‹è¯•æ¨¡å¼å¯ä»¥è‡ªç”±é€‰æ‹©ï¼Œå¦‚æœæµ‹è¯•æ€§èƒ½ï¼Œæœ€å¥½é€‰æ‹©å¹³å‡æ—¶é—´ã€‚ å¦‚æœæ˜¯åœ¨ IDE ä¸­ï¼Œå»ºè®®å®‰è£… jmh æ’ä»¶æ¥æ‰§è¡Œã€‚ ä»£ç ç¤ºä¾‹ // é¢„çƒ­çš„å‚æ•° @Warmup(time = 1) // æµ‹è¯•çš„å‚æ•° @Measurement(time = 1) // å¯ä»¥æ·»åŠ  JVM å‚æ•°æ¥æµ‹è¯• @Fork(value = 1) @State(Scope.Thread) @OutputTimeUnit(TimeUnit.NANOSECONDS) @BenchmarkMode(Mode.AverageTime) public class TestStringBenchmark { @Benchmark public String stringBuilder() { StringBuilder sb = new StringBuilder(); sb.append(\"hello\"); sb.append(\"world\"); return sb.toString(); } @Benchmark public String stringBuffer() { StringBuffer sb = new StringBuffer(); sb.append(\"hello\"); sb.append(\"world\"); return sb.toString(); } @Benchmark public String stringConcat() { return \"hello\" + \"world\"; } } ","date":"2022-10-16 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/:1:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è¿›è¡Œå¾®åŸºå‡†æµ‹è¯• ?","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® github åœ°å€ ","date":"2022-10-16 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/:2:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è¿›è¡Œå¾®åŸºå‡†æµ‹è¯• ?","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. å‚è€ƒ å¼ºçƒˆå»ºè®®å¤§å®¶çœ‹å®˜æ–¹ä»£ç , åœ°å€: https://github.com/openjdk/jmh ","date":"2022-10-16 09:00:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/:3:0","tags":["java"],"title":"åœ¨ java ä¸­å¦‚ä½•è¿›è¡Œå¾®åŸºå‡†æµ‹è¯• ?","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E5%BE%AE%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"æˆ‘ä»¬åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨ lambda å‡½æ•°å¼ç¼–ç¨‹ï¼Œè¿™æ ·ä¼šæ›´åŠ ç®€å•ã€‚ ","date":"2022-10-11 22:25:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-lambda-%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0/:0:0","tags":["IDE"],"title":"åœ¨ java ä¸­å¦‚ä½•è·å– lambda çš„æ–¹æ³•åç§°?","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-lambda-%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. ä½¿ç”¨æ–¹å¼ æ¯”å¦‚ä¸‹é¢æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ User ç±»ã€‚å…¶ä¸­æœ‰ä¸€ä¸ªå±æ€§ username @Data public class User { private String username; public String getPassword(String password) { return password; } } // ä½¿ç”¨çš„æ–¹å¼ // user -\u003e user.getUsername() ç­‰ä»·äº User::getUsername Function\u003cUser, String\u003e getUsername1 = User::getUsername æ¯”å¦‚æˆ‘ç°åœ¨è¦ä½¿ç”¨ user -\u003e user.getUsername()ï¼Œ è¿™æ ·çš„ lambda è¡¨è¾¾å¼æ¥è·å–ä¸€ä¸ª User å¯¹è±¡çš„ username å±æ€§å€¼ã€‚ æˆ‘ç°åœ¨å¯ä»¥è¿™æ ·æ¥è·å– username è¿™ä¸ªæ–¹æ³•åç§°ã€‚ public class LambdaUtils { // æ­£å¸¸æƒ…å†µï¼Œè¦åšç¼“å­˜ public static \u003cT\u003e String resolveMethod(SFunction\u003cT, ?\u003e func) { SerializedLambda serializedLambda = resovle(func); String methodName = serializedLambda.getImplMethodName(); return methodName; } @SneakyThrows public static SerializedLambda resovle(SFunction\u003c?, ?\u003e func) { Method method = func.getClass().getDeclaredMethod(\"writeReplace\"); method.setAccessible(true); return (SerializedLambda) method.invoke(func); } } ","date":"2022-10-11 22:25:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-lambda-%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0/:1:0","tags":["IDE"],"title":"åœ¨ java ä¸­å¦‚ä½•è·å– lambda çš„æ–¹æ³•åç§°?","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-lambda-%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä»£ç å®ç°ä½ç½® æœ¬èŠ‚çš„å†…å®¹ï¼Œæˆ‘å™è¿°çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå¯èƒ½çœ‹çš„ä¸€è„¸æ‡µ, ä½¿ç”¨è¿‡ mybatis-plus çš„äººï¼Œå¯èƒ½ä¼šæœ‰ç‚¹å°è±¡ LambdaQueryWrapperï¼Œ æ¨èçœ‹ä¸‹è¿™ä¸ªæµ‹è¯•ç±» LambdaUtilsTests github åœ°å€ ","date":"2022-10-11 22:25:00","objectID":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-lambda-%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0/:2:0","tags":["IDE"],"title":"åœ¨ java ä¸­å¦‚ä½•è·å– lambda çš„æ–¹æ³•åç§°?","uri":"/ooooo-notes/%E5%9C%A8-java-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%8E%B7%E5%8F%96-lambda-%E7%9A%84%E6%96%B9%E6%B3%95%E5%90%8D%E7%A7%B0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¿æ¥æ±  ? ","date":"2022-09-13 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/:0:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¿æ¥æ± ","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. éœ€æ±‚ ","date":"2022-09-13 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/:1:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¿æ¥æ± ","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. å®ç°çš„å…³é”®ç‚¹ ","date":"2022-09-13 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/:2:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¿æ¥æ± ","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. druid datasource ","date":"2022-09-13 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/:3:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¿æ¥æ± ","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"4. common-pool2 ","date":"2022-09-13 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/:4:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªè¿æ¥æ± ","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%BF%9E%E6%8E%A5%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ±  ? ","date":"2022-09-12 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/:0:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ±  ?","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. éœ€æ±‚ ","date":"2022-09-12 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/:1:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ±  ?","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ç®€å•çš„å®ç° ","date":"2022-09-12 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/:2:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ±  ?","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. å®ç°åƒåœ¾å›æ”¶ è½¯å¼•ç”¨ï¼Œå¼±å¼•ç”¨ ","date":"2022-09-12 10:20:00","objectID":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/:3:0","tags":["java"],"title":"å¦‚ä½•è®¾è®¡ä¸€ä¸ªå¯¹è±¡æ±  ?","uri":"/ooooo-notes/%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E5%AF%B9%E8%B1%A1%E6%B1%A0/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"åœ¨ idea ä¸­å®é™…æœ‰ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„åŠŸèƒ½ï¼Œé‚£å°±æ˜¯è¿œç«¯æ„å»ºå’Œè¿œç«¯è¿è¡Œã€‚ åœ¨æˆ‘ä»¬å®é™…å¼€å‘é¡¹ç›®ä¸­ï¼Œè‡ªå·±çš„æœ¬åœ°ç¯å¢ƒå’ŒæœåŠ¡å™¨ç¯å¢ƒä¸å¤ªä¸€æ ·ï¼Œä¾‹å¦‚ go å¼€å‘ä¸­çš„ build-tags, è¿˜æœ‰ c/c++ å¼€å‘ä¸­çš„API è°ƒç”¨ä¸ä¸€æ ·ï¼Œæ— æ³•æ¨¡æ‹Ÿç›¸åŒçš„å¼€å‘ç¯å¢ƒã€‚ ","date":"2022-09-12 08:14:00","objectID":"/ooooo-notes/%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%AB%AF-build-%E5%92%8C-run/:0:0","tags":["IDE"],"title":"åœ¨ idea ä¸­ä½¿ç”¨è¿œç«¯ build å’Œ run","uri":"/ooooo-notes/%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%AB%AF-build-%E5%92%8C-run/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. é—®é¢˜è¯´æ˜ è¿™é‡Œæ‹¿ è¿è¡Œ kubernetes æ¥è¯´æ˜è¿™ä¸ªé—®é¢˜ã€‚ æˆ‘ä»¬éƒ½çŸ¥é“åœ¨ windows ç³»ç»Ÿ å’Œ mac ç³»ç»Ÿä¸­ï¼Œä½ æ˜¯å¾ˆéš¾åœ¨æœ¬åœ°è¿è¡Œ kubernetes çš„ï¼Œå› ä¸ºéœ€è¦æ¶‰åŠåˆ°å¾ˆå¤šçš„ç»„ä»¶ï¼Œå¾ˆå¤šåŠŸèƒ½ä¹Ÿåªæœ‰åœ¨ linux ç³»ç»Ÿä¸­æ‰ä¼šå¼€å¯ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œä»»ä½•ç¨‹åºéƒ½åº”è¯¥æ˜¯æœ‰è¿œç¨‹è°ƒè¯•è¿™ä¸ªåŠŸèƒ½çš„ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½åœ¨æœ¬åœ°å­¦ä¹ æºç æ—¶ä¼šæœ‰ç‚¹ä¸æ–¹ä¾¿ï¼Œä¸»è¦ä½“ç°åœ¨è‡ªå·±åœ¨æœ¬åœ°æ”¹äº†æºç ï¼Œéœ€è¦åŒæ­¥åˆ°ä½ è¿œç«¯çš„æœºå™¨ä¸Šï¼Œç„¶å build å’Œ runï¼Œ æ•´å¥—è¿‡ç¨‹ä¸æ˜¯è‡ªåŠ¨çš„ã€‚ ","date":"2022-09-12 08:14:00","objectID":"/ooooo-notes/%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%AB%AF-build-%E5%92%8C-run/:1:0","tags":["IDE"],"title":"åœ¨ idea ä¸­ä½¿ç”¨è¿œç«¯ build å’Œ run","uri":"/ooooo-notes/%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%AB%AF-build-%E5%92%8C-run/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. ä½¿ç”¨æ•™ç¨‹ é€‰æ‹©åœ¨è¿œç«¯æœºå™¨ä¸Šè¿è¡Œã€‚ é€‰æ‹©åœ¨è¿œç«¯æœºå™¨ä¸Šæ„å»ºå’Œç¼–è¯‘å®Œæˆåè¿è¡Œã€‚ æŒ‡å®šç¨‹åºå‚æ•°ã€‚ å¦‚ä¸‹å›¾ï¼š åœ¨è¿œç«¯æ„å»ºå’Œè¿è¡Œ æ–°å»ºä¸€ä¸ªtargeté…ç½®ã€‚ æ–°å»ºæˆ–é€‰æ‹©ä¸€ä¸ªsshé…ç½®, å¯¹äº rsync å¯ä»¥ä¸ç”¨å¼€å¯ã€‚ è®¾ç½®è¿œç«¯goçš„æ‰§è¡Œè·¯å¾„ï¼Œè¿™ä¸ªå¿…é¡»è¦æŒ‡å®šï¼Œå¦‚æœ GOPATH ä¸æŒ‡å®šï¼Œåˆ™ä½¿ç”¨è¿œç«¯é»˜è®¤é…ç½®*ã€‚ å»ºè®®æŒ‡å®šä¸€ä¸ªå…·ä½“çš„è·¯å¾„ï¼Œå¦åˆ™ï¼Œæ¯æ¬¡éƒ½ä¼šç”Ÿæˆæ–°çš„ç›®å½•ï¼Œæ„å»ºæ¯”è¾ƒç¼“æ…¢ã€‚ å¦‚ä¸‹å›¾ï¼š åœ¨è¿œç«¯æ„å»ºå’Œè¿è¡Œ ","date":"2022-09-12 08:14:00","objectID":"/ooooo-notes/%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%AB%AF-build-%E5%92%8C-run/:2:0","tags":["IDE"],"title":"åœ¨ idea ä¸­ä½¿ç”¨è¿œç«¯ build å’Œ run","uri":"/ooooo-notes/%E5%9C%A8-idea-%E4%B8%AD%E4%BD%BF%E7%94%A8%E8%BF%9C%E7%AB%AF-build-%E5%92%8C-run/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"åœ¨ spring ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šåŸºäºç°æœ‰çš„ä»£ç æ¥æ‰©å±•ä¹‹å‰çš„åŠŸèƒ½ï¼Œæˆ–è€…æ¢ä¸€ä¸ªå®ç°çš„æ–¹å¼ã€‚ åœ¨ä¸Šä¸€ç¯‡ä¸­ï¼Œæˆ‘ä½¿ç”¨ BeanPostProcessor æ¥è¿›è¡Œæ‰©å±•ã€‚ è€Œåœ¨è¿™ä¸€ç¯‡ä¸­ï¼Œæˆ‘ä½¿ç”¨ BeanDefinitionRegistryPostProcessor æ¥è¿›è¡Œæ‰©å±•ã€‚ ç”±äºå·²ç»å®ç°è¿‡ä¸€æ¬¡ï¼Œæˆ‘è¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚ ","date":"2022-09-05 21:09:01","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/:0:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½2 ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. å®ç°æ€è·¯ åˆ¤æ–­ beanName åˆ é™¤åŸæœ‰çš„ beanDefinition æ³¨å†Œæ–°çš„ beanDefinition æ³¨æ„ç‚¹ï¼š æ–°å®ç°çš„ç±»ï¼Œå¿…é¡»è¦æ˜¯ CompositePropertySources çš„å­ç±»ï¼Œå¦åˆ™æ³¨å…¥ä¼šæœ‰é—®é¢˜ æ‰€æœ‰æ–¹æ³•éƒ½å¿…é¡»é‡æ–°å®ç°ä¸€éï¼Œæ— æ³•å¤ç”¨çˆ¶ç±»çš„æ–¹æ³• @Component public class CompositePropertySourcesBeanDefinitionRegistry implements BeanDefinitionRegistryPostProcessor { public static final String COMPOSITE_PROPERTY_SOURCES_BEAN_NAME = \"compositePropertySources\"; @Override public void postProcessBeanDefinitionRegistry(BeanDefinitionRegistry registry) throws BeansException { if (registry.containsBeanDefinition(COMPOSITE_PROPERTY_SOURCES_BEAN_NAME)) { registry.removeBeanDefinition(COMPOSITE_PROPERTY_SOURCES_BEAN_NAME); RootBeanDefinition definition = new RootBeanDefinition(ProxyCompositePropertySources.class); definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_CONSTRUCTOR); registry.registerBeanDefinition(COMPOSITE_PROPERTY_SOURCES_BEAN_NAME, definition); } } @Override public void postProcessBeanFactory(ConfigurableListableBeanFactory beanFactory) throws BeansException { } } ","date":"2022-09-05 21:09:01","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/:1:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½2 ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. å¦‚ä½•é€‰æ‹© å¦‚æœæ˜¯æ”¹è¿›ä¹‹å‰çš„åŠŸèƒ½ï¼Œå°±ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼, BeanPostProcessor å¦‚æœæ˜¯é‡å†™ä¹‹å‰çš„åŠŸèƒ½ï¼Œå°±ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼, BeanDefinitionRegistryPostProcessor å¦‚æœä¸å¥½é€‰æ‹©ï¼Œå°±å•¥ç”¨ç¬¬äºŒç§æ–¹å¼ï¼Œä¹Ÿæ˜¯æœ€å¼ºå¤§çš„ã€‚ ","date":"2022-09-05 21:09:01","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/:2:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½2 ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. å®Œæ•´ä»£ç å®ç° github åœ°å€ ","date":"2022-09-05 21:09:01","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/:3:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½2 ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD2/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"åœ¨ spring ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šåŸºäºç°æœ‰çš„ä»£ç æ¥æ‰©å±•ä¹‹å‰çš„åŠŸèƒ½ï¼Œæˆ–è€…æ¢ä¸€ä¸ªå®ç°çš„æ–¹å¼ã€‚ ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/:0:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½ ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. åŸæœ‰çš„åŠŸèƒ½ åœ¨è¿™é‡ŒåŸºäºä¹‹å‰çš„åŠŸèƒ½è·å–å±æ€§æ¥ç»§ç»­æ·±å…¥ã€‚ å¤§è‡´ä»£ç å¦‚ä¸‹ @Slf4j @Order public class CompositePropertySources implements PropertySources { private final MutablePropertySources mutablePropertySources = new MutablePropertySources(); public CompositePropertySources(List\u003cAbstractSimplePropertySource\u003e sources) { if (sources == null) return; AnnotationAwareOrderComparator.sort(sources); for (AbstractSimplePropertySource source : sources) { mutablePropertySources.addLast(source); } } public boolean containsProperty(String name) { return stream().anyMatch(p -\u003e p.containsProperty(name)); } public String getProperty(String name) { return isBlank(name) ? name : getProperty(name, null); } public String getProperty(String propertyName, String defaultValue) { String value = null; for (PropertySource\u003c?\u003e ps : mutablePropertySources) { value = (String) ps.getProperty(propertyName); if (value != null) { return value; } } return defaultValue; } public Map\u003cString, String\u003e getProperties(String... propertyNames) { if (propertyNames != null) { Map\u003cString, String\u003e map = new HashMap\u003c\u003e(); for (String key : propertyNames) { map.put(key, getProperty(key, null)); } return map; } return null; } } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/:1:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½ ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. æ–°çš„éœ€æ±‚ ç”±äºä¹‹å‰çš„åŠŸèƒ½æ˜¯æ ¹æ® key æ¥è·å– valueçš„ï¼Œè€Œç°åœ¨éœ€è¦æ ¹æ®ä¸šåŠ¡ç¼–å·å’Œ key æ¥è·å– valueã€‚ å…ˆæ ¹æ® businType.key æ¥è·å– value å¦‚æœç»“æœä¸æ˜¯ nullï¼Œåˆ™è¿”å› å¦‚æœç»“æœæ˜¯ nullï¼Œ å†æ ¹æ® key æ¥è·å– value æ ¹æ®ä¸Šé¢çš„æè¿°ï¼Œä¹Ÿå°±æ˜¯ä¼˜å…ˆå–ä¸šåŠ¡ç±»å‹çš„é…ç½® å› ä¸ºæˆ‘ä»¬çš„åŠŸèƒ½å®é™…ä¸Šåœ¨ä¸Šä¸€ç¯‡å°±å·²ç»å®Œæˆäº†ï¼Œæ‰€ä»¥åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œåªéœ€è¦æ‰©å±•åŸæœ‰çš„åŠŸèƒ½å°±è¡Œäº†ã€‚ è¿™é‡Œæˆ‘ä½¿ç”¨ BeanPostProcessor æ¥è¿›è¡Œæ‰©å±•ï¼Œé€‰æ‹©è¿™ä¸ªç±»çš„åŸå› æ˜¯åŸæœ‰çš„ bean å·²ç»ç”Ÿæˆäº†ï¼Œæ— éœ€æ›´æ”¹ bean å®šä¹‰. å®ç°å¦‚ä¸‹ï¼š åˆ¤æ–­ bean æ˜¯å¦ä¸º CompositePropertySources çš„å®ä¾‹ ä½¿ç”¨ ProxyCompositePropertySources å¯¹è±¡æ¥ä»£æ›¿åŸæœ‰çš„ç±» ä½¿ç”¨ propertyNamesFunction æ¥åˆ†éš” propertyName @Component public class CompositePropertySourcesBeanPostProcessor implements BeanPostProcessor { @Override public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException { if (bean instanceof CompositePropertySources) { return new ProxyCompositePropertySources((CompositePropertySources) bean); } return bean; } protected static class ProxyCompositePropertySources extends CompositePropertySources { private final CompositePropertySources compositePropertySources; public ProxyCompositePropertySources(CompositePropertySources compositePropertySources) { super(null); this.compositePropertySources = compositePropertySources; } @Override public String getProperty(String propertyName, String defaultValue) { String[] propertyNames = propertyNamesFunction.apply(propertyName); for (String p : propertyNames) { String v = compositePropertySources.getProperty(p); if (v != null) { return v; } } return defaultValue; } @Override public boolean containsProperty(String propertyName) { String[] propertyNames = propertyNamesFunction.apply(propertyName); for (String p : propertyNames) { boolean contains = compositePropertySources.containsProperty(p); if (contains) { return true; } } return false; } } private static final Function\u003cString, String[]\u003e propertyNamesFunction = (propertyName) -\u003e { if (propertyName == null) { return new String[0]; } propertyName = propertyName.trim(); if (propertyName.contains(\".\")) { return new String[]{propertyName, propertyName.substring(propertyName.lastIndexOf(\".\") + 1)}; } return new String[]{propertyName}; }; } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/:2:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½ ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. å®Œæ•´ä»£ç å®ç° github åœ°å€ ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/:3:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•æ‰©å±•ç°æœ‰ç±»çš„åŠŸèƒ½ ?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E6%89%A9%E5%B1%95%E7%8E%B0%E6%9C%89%E7%B1%BB%E7%9A%84%E5%8A%9F%E8%83%BD/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"1. éœ€æ±‚ å¸Œæœ›æ ¹æ® propertyName æ¥è·å–ç›¸åº”çš„ propertyValue, è¿™ä¸ªæ¥å£éœ€è¦æ”¯æŒå¤šç§æ•°æ®æ¥æºã€‚ ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:1:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"2. è®¾è®¡æ¥å£ å¾ˆæ˜æ˜¾è¿™ä¸ªæ¥å£åº”è¯¥è®¾è®¡ä¸ºè¿™æ ·, æœ‰ä¸€ä¸ªæ–¹æ³•ä¸º Object getProperty(String name) æ¥è·å–å±æ€§ã€‚ å› ä¸ºæ˜¯åœ¨ spring ä¸­ï¼Œæ‰€ä»¥æˆ‘å°±ç›´æ¥å¤ç”¨äº† org.springframework.core.env.PropertySource, ä½†è¿™ä¸ªç±»éœ€è¦æ³›å‹ï¼Œæ‰€ä»¥æˆ‘å°±éšä¾¿å®ç°äº†ä¸€ä¸ª Map\u003cString, String\u003e çš„æ³›å‹ï¼Œä¹Ÿä¸ä¼šç”¨åˆ°è¿™ä¸ªã€‚ æŠ½è±¡ç±»çš„è®¾è®¡å¦‚ä¸‹ï¼š public abstract class AbstractSimplePropertySource extends PropertySource\u003cMap\u003cString, String\u003e\u003e implements EnvironmentAware { protected Environment environment; public AbstractSimplePropertySource(String name) { super(name, Collections.emptyMap()); } public void setEnvironment(@NonNull Environment environment) { this.environment = environment; } public Environment getEnvironment() { return environment; } } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:2:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3. å…·ä½“ç±»çš„å®ç° ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:3:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3.1 æ ¹æ®è¯·æ±‚å‚æ•°æ¥è·å–é…ç½® å…ˆä»è¯·æ±‚å‚æ•°ä¸­è·å– å†ä»è¯·æ±‚å¤´ä¸­è·å– ä»£ç é€»è¾‘æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘å°±ä¸è§£é‡Šäº†ã€‚ è¿™ç§å½¢å¼ï¼Œè§£å†³äº†å‰ç«¯å¯ä»¥ä¼ å…¥ç›¸åº”çš„é…ç½®ï¼Œæ¥æ”¹å˜åç«¯çš„æ‰§è¡Œé€»è¾‘ã€‚ @Order(0) public class RequestParamsPropertySource extends AbstractSimplePropertySource { public RequestParamsPropertySource() { super(ENV_PREFIX + \"request_params\"); } @Override public Object getProperty(String name) { String propertyKey = ENV_PREFIX + name.replace(\".\", \"_\"); String propertyValue = null; try { // å…ˆè¯·æ±‚å‚æ•°ä¸­è·å– ServletRequestAttributes attr = (ServletRequestAttributes) RequestContextHolder.currentRequestAttributes(); HttpServletRequest request = attr.getRequest(); propertyValue = request.getParameter(propertyKey); if (StringUtils.isBlank(propertyValue)) { // å†ä»è¯·æ±‚å¤´ä¸­è·å– propertyValue = request.getHeader(propertyKey); } } catch (Throwable ignored) { } // ç©ºå­—ç¬¦ä¹Ÿå½“åšnull propertyValue = defaultIfBlank(propertyValue, null); return propertyValue; } } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:3:1","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3.2 æ ¹æ®ç¯å¢ƒå˜é‡æ¥è·å–é…ç½® ä»£ç é€»è¾‘æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæˆ‘å°±ä¸è§£é‡Šäº†ã€‚ @Order(2) public class EnvironmentPropertySource extends AbstractSimplePropertySource { public EnvironmentPropertySource() { super(ENV_PREFIX + \"environment\"); } @Override public Object getProperty(String name) { String env_property_key = ENV_PREFIX + name.replace(\".\", \"_\"); return System.getenv(env_property_key.toUpperCase()); } } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:3:2","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3.3 æ ¹æ®æœ¬åœ°é…ç½®æ–‡ä»¶æ¥è·å–å‚æ•° åœ¨å®é™…å¼€å‘è¿‡ç¨‹ï¼Œå¤§å®¶å¯èƒ½æ˜¯å…±ç”¨ä¸€å¥—æ•°æ®åº“ç¯å¢ƒï¼Œåœ¨è¿™ä¸ªæƒ…å†µä¸‹ï¼Œå¦‚æœæŸä¸€ä¸ªäººæ”¹äº†æ•°æ®åº“é…ç½®ï¼Œè¿™æ ·ä¼šå¯¹å…¶ä»–äººé€ æˆå½±å“ï¼Œæ‰€ä»¥å¿…é¡»è¦è®¾è®¡å‡ºä¸€ä¸ªç”¨äºå¼€å‘çš„é…ç½®ç±»ã€‚ ä½¿ç”¨ apache çš„ configuration åŒ…ï¼Œæ¥å®ç°é…ç½®æ–‡ä»¶çš„åŠ¨æ€åˆ·æ–° ä» builder.getConfiguration() å¯¹è±¡ä¸­è·å–é…ç½® å¤§è‡´ä»£ç å¦‚ä¸‹ï¼š @Order(1) public class LocalPropertiesPropertySource extends AbstractSimplePropertySource implements InitializingBean { @Autowired private ApplicationEventPublisher publisher; private ReloadingFileBasedConfigurationBuilder\u003cPropertiesConfiguration\u003e builder; private static final String DEFAULT_LOCAL_PROPERTIES_PATH = \"sysoptions.properties\"; public LocalPropertiesPropertySource() { super(ENV_PREFIX + \"local_properties\"); log.debug(\"å¼€å‘ç¯å¢ƒï¼Œå¯ç”¨[{}]é…ç½®\", getClass()); } @Override public void afterPropertiesSet() { Integer sysOptionsLoadInterval = getEnvironment().getProperty(\"dev.localPropertiesLoadInterval\", Integer.class, 1); String sysOptionsPath = getEnvironment().getProperty(\"dev.localPropertiesPath\", DEFAULT_LOCAL_PROPERTIES_PATH); File propertiesFile = new File(sysOptionsPath); if (!propertiesFile.exists()) { return; } // server boot will publish event publisher.publishEvent(new LocalProperitesReReloadingEvent(new Object(), propertiesFile.getAbsolutePath())); builder = new ReloadingFileBasedConfigurationBuilder\u003c\u003e(PropertiesConfiguration.class).configure(new Parameters().fileBased().setFile(propertiesFile)); ReloadingController reloadingController = builder.getReloadingController(); reloadingController.addEventListener(ReloadingEvent.ANY, e -\u003e publisher.publishEvent(new LocalProperitesReReloadingEvent(e, propertiesFile.getAbsolutePath()))); PeriodicReloadingTrigger trigger = new PeriodicReloadingTrigger(reloadingController, null, sysOptionsLoadInterval, SECONDS); trigger.start(); } @Override public Object getProperty(@NonNull String name) { if (builder == null) return null; Configuration configuration = null; try { configuration = builder.getConfiguration(); String config_value = configuration.getString(name); if (config_value != null) { return config_value; } } catch (ConfigurationException e) { log.error(e.getMessage(), e); } return null; } } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:3:3","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"3.4 å…¶ä»–çš„æ‰©å±• åˆ°è¿™é‡Œï¼Œä½ å°±åº”è¯¥å¾ˆæ¸…æ¥šçš„çŸ¥é“æ€ä¹ˆå»æ‰©å±•å…¶ä»–çš„ç±»äº†ï¼Œæ¯”å¦‚æ•°æ®åº“çš„å®ç°ï¼Œ redis çš„å®ç° ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:3:4","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"4. ä½¿ç”¨çš„å…¥å£ ä¸Šé¢åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ¥å£å’Œå‡ ä¸ªå®ç°ç±»ï¼Œç»Ÿä¸€çš„å…¥å£ç±»ï¼Œå®é™…ä¸Šè¿˜æ²¡æœ‰ã€‚ ä½¿ç”¨æ„é€ å‡½æ•°çš„æ–¹å¼æ¥æ³¨å…¥æ‰€æœ‰çš„ AbstractSimplePropertySource ã€‚ å¯¹äºæ¯ä¸ªè·å–é…ç½®çš„ç±»ï¼Œè‚¯å®šæœ‰ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥è¦æ’åºã€‚ ä½¿ç”¨ MutablePropertySources è¿™ä¸ªç±»åšè¾…åŠ©ã€‚ å¤§è‡´ä»£ç å¦‚ä¸‹ï¼š @Slf4j @Order public class CompositePropertySources implements PropertySources { private final MutablePropertySources mutablePropertySources = new MutablePropertySources(); public CompositePropertySources(List\u003cAbstractSimplePropertySource\u003e sources) { if (sources == null) return; AnnotationAwareOrderComparator.sort(sources); for (AbstractSimplePropertySource source : sources) { mutablePropertySources.addLast(source); } } public boolean containsProperty(String name) { return stream().anyMatch(p -\u003e p.containsProperty(name)); } public String getProperty(String name) { return isBlank(name) ? name : getProperty(name, null); } public String getProperty(String propertyName, String defaultValue) { String value = null; for (PropertySource\u003c?\u003e ps : mutablePropertySources) { value = (String) ps.getProperty(propertyName); if (value != null) { return value; } } return defaultValue; } public Map\u003cString, String\u003e getProperties(String... propertyNames) { if (propertyNames != null) { Map\u003cString, String\u003e map = new HashMap\u003c\u003e(); for (String key : propertyNames) { map.put(key, getProperty(key, null)); } return map; } return null; } } ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:4:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"5. å®Œæ•´ä»£ç å®ç° github åœ°å€ ","date":"2022-09-05 21:09:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/:5:0","tags":["java","spring","spring-extension"],"title":"åœ¨ spring ä¸­å¦‚ä½•è®¾è®¡ä¸€ä¸ªè·å–é…ç½®çš„æ¥å£?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E5%A6%82%E4%BD%95%E8%AE%BE%E8%AE%A1%E4%B8%80%E4%B8%AA%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E6%8E%A5%E5%8F%A3/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"ä½œä¸ºä¸€ä¸ª Java å¼€å‘ï¼ŒSpring çš„æŠ€æœ¯å¯ä»¥è¯´æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼Œä¸ä»…ä»…æ˜¯ä¼šä½¿ç”¨ï¼Œè€Œä¸”è¦æŒæ¡åŸç†ï¼Œå­¦ä¼šæ‰©å±•ã€‚ ä»Šå¤©æˆ‘å°±è¯´è¯´ï¼Œå“ªäº›æ ¸å¿ƒç±»å’Œæ‰©å±•ç±»æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼ŒåŒæ—¶æˆ‘ä¹Ÿè¯´æ˜è¿™äº›æ‰©å±•å¯ä»¥å¹²ä»€ä¹ˆï¼Œåé¢ Spring æ–‡ç« ï¼Œæˆ‘ä¼šç”¨åˆ°è¿™äº›æ‰©å±•ç±»ï¼Œè®©ä½ å­¦æ‡‚è¿™äº›ç±»ã€‚ ","date":"2022-09-05 18:00:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/:0:0","tags":["java","spring"],"title":"åœ¨ spring ä¸­æœ‰å“ªäº›æ ¸å¿ƒç±»å’Œæ‰©å±•ç±»?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"æ ¸å¿ƒç±»ï¼š IOCå®¹å™¨: org.springframework.context.ApplicationContext é…ç½®ç±»: org.springframework.core.env.Environment Beanå·¥å‚ï¼šorg.springframework.beans.factory.BeanFactory äº‹ä»¶å‘å¸ƒå™¨ï¼š org.springframework.context.ApplicationEventPublisher èµ„æºåŠ è½½å™¨ï¼š org.springframework.core.io.ResourceLoader ä¸Šé¢è¿™å‡ ä¸ªç±»ï¼Œæ˜¯æˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°çš„ã€‚å®ƒä»¬éƒ½æœ‰ç›¸åº”çš„ Aware æ¥å£, å¦‚ org.springframework.context.ApplicationContextAware, å¯ä»¥è®¾ç½® applicationContext å¯¹è±¡åˆ°æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ bean å¯¹è±¡ä¸­. æ³¨æ„è¿™æ · setApplicationContext çš„æ–¹å¼æ¯” @Autowired æ³¨è§£æ³¨å…¥ applicationContext çš„æ–¹å¼çš„æ—¶æœºè¦æ—©å¾ˆå¤šï¼Œæ‰€ä»¥ä¸€èˆ¬æ¨èç”¨ setApplicationContext çš„æ–¹å¼ã€‚ ç›¸åº”çš„æºç  ApplicationContextAwareProcessor ","date":"2022-09-05 18:00:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/:1:0","tags":["java","spring"],"title":"åœ¨ spring ä¸­æœ‰å“ªäº›æ ¸å¿ƒç±»å’Œæ‰©å±•ç±»?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"æ‰©å±•ç±» beanFactoryçš„åç½®å¤„ç†å™¨ï¼š org.springframework.beans.factory.config.BeanFactoryPostProcessor beançš„åç½®å¤„ç†å™¨ï¼š org.springframework.beans.factory.config.BeanPostProcessor ä¸Šé¢çš„ä¸¤ä¸ªç±»éå¸¸é‡è¦ï¼Œå¦‚æœä½ ç°åœ¨è¿˜ä¸ä¼šç†Ÿç»ƒä½¿ç”¨å®ƒä»¬ï¼Œè¯´æ˜ spring æŒæ¡çš„å¾ˆä¸€èˆ¬ã€‚ ","date":"2022-09-05 18:00:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/:2:0","tags":["java","spring"],"title":"åœ¨ spring ä¸­æœ‰å“ªäº›æ ¸å¿ƒç±»å’Œæ‰©å±•ç±»?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/"},{"categories":["å¾®ä¿¡æ–‡ç« "],"content":"éå¸¸æœ‰ç”¨çš„ç±» ä»£ç†å·¥å‚ï¼š org.springframework.aop.framework.ProxyFactory beanå·¥å‚ï¼š org.springframework.beans.factory.ObjectFactory å±æ€§ç»‘å®šï¼š org.springframework.boot.context.properties.bind.Binder é€‰æ‹©æ€§å¯¼å…¥bean: org.springframework.context.annotation.ImportSelector ä¸Šé¢è¿™å‡ ä¸ªç±»ï¼Œä¸€èˆ¬åœ¨æ‰©å±•åŠŸèƒ½æ—¶ï¼Œéƒ½ä¼šç”¨åˆ°ã€‚ ","date":"2022-09-05 18:00:00","objectID":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/:3:0","tags":["java","spring"],"title":"åœ¨ spring ä¸­æœ‰å“ªäº›æ ¸å¿ƒç±»å’Œæ‰©å±•ç±»?","uri":"/ooooo-notes/%E5%9C%A8-spring-%E4%B8%AD%E6%9C%89%E5%93%AA%E4%BA%9B%E6%A0%B8%E5%BF%83%E7%B1%BB%E5%92%8C%E6%89%A9%E5%B1%95%E7%B1%BB/"},{"categories":["éšç¬”"],"content":"1. ä¸‹è½½ä»£ç  git clone git@github.com:apache/tomcat.git ","date":"2022-08-10 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:0","tags":["tomcat","source code"],"title":"æ­å»º tomcat æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"2. å®‰è£…ant æˆ‘æœ¬åœ°å®‰è£…çš„æ˜¯ 1.10.12 ç‰ˆæœ¬, ant ä¸‹è½½åœ°å€ é…ç½®ç¯å¢ƒå˜é‡ ANT_HOME, åŠ å…¥åˆ° PATH ç¯å¢ƒå˜é‡ä¸­ æ‰§è¡Œå‘½ä»¤éªŒè¯ ant -version ","date":"2022-08-10 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:0","tags":["tomcat","source code"],"title":"æ­å»º tomcat æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"3. å¯¼å…¥åˆ° idea ä¸­ # è¿›å…¥ tomcat æ ¹ç›®å‰ cd tomcat # å¤åˆ¶é…ç½®æ–‡ä»¶ build.properties cp build.properties.default build.properties # æ›´æ”¹ build.properties ä¸­çš„é…ç½® base.path=ç¬¬ä¸‰æ–¹jarçš„ä¸‹è½½ç›®å½• # è®¾ç½® idea ant ide-intellij # æ‰§è¡Œç¼–è¯‘å‘½ä»¤, ä¼šç”Ÿæˆ output ç›®å½• ant deploy ç„¶åç”¨ idea æ‰“å¼€é¡¹ç›®ï¼Œidea ä¼šå¼¹å‡ºè®©ä½ é…ç½®ä¸‹é¢çš„å˜é‡ ANT_HOME = ${ant.home} TOMCAT_BUILD_LIBS = ${base.path} ","date":"2022-08-10 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:3:0","tags":["tomcat","source code"],"title":"æ­å»º tomcat æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"4. idea ä¸­ é…ç½® æ£€æŸ¥ä½ çš„é¡¹ç›®ä¾èµ–æœ‰æ²¡æœ‰é—®é¢˜ é¡¹ç›®ä¾èµ–é…ç½® ä¸Šé¢çš„ä¸‰ä¸ªä¾èµ–ï¼Œå…¶å®å°±æ˜¯ ServletContainerInitializer çš„å®ç°, æ¯”å¦‚ res/META-INF/jasper.jar/services/jakarta.servlet.ServletContainerInitializer. æ›´æ”¹é…ç½®æ–‡ä»¶ conf/server.xml # æ”¹ä¸ºç¼–è¯‘è¾“å‡ºç›®å½• appBase=\"output/build/webapps\" è¿è¡Œç¨‹åº org.apache.catalina.startup.Bootstrap#main ","date":"2022-08-10 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:4:0","tags":["tomcat","source code"],"title":"æ­å»º tomcat æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-tomcat-%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":" deployment èµ„æºæ˜¯æˆ‘ä»¬ç»å¸¸éœ€è¦ä½¿ç”¨çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬æœ€åº”è¯¥ç†Ÿæ‚‰çš„æºç . å¯¹äºè°ƒè¯•æºç ï¼Œæˆ‘ä½¿ç”¨æ˜¯ deployment_controller_test.go æµ‹è¯•ç±»ï¼Œ TestSyncDeploymentCreatesReplicaSet æ–¹æ³•. ","date":"2022-07-15 18:32:22","objectID":"/ooooo-notes/%E8%B0%83%E8%AF%95-deployment-controller-%E7%9A%84%E6%BA%90%E7%A0%81/:0:0","tags":["k8s","cloud native","source code"],"title":"è°ƒè¯• deployment-controller çš„æºç ","uri":"/ooooo-notes/%E8%B0%83%E8%AF%95-deployment-controller-%E7%9A%84%E6%BA%90%E7%A0%81/"},{"categories":["éšç¬”"],"content":"TestSyncDeploymentCreatesReplicaSet æµ‹è¯•æ–¹æ³•çš„ç»“æ„ æºç è·¯å¾„ï¼škubernetes\\pkg\\controller\\deployment\\deployment_controller_test.go æµ‹è¯•é…ç½®å¯¹è±¡ f := newFixture(t) åˆ›å»ºä¸€ä¸ª fixture å¯¹è±¡ï¼Œ é‡Œé¢æœ‰ objects å±æ€§ï¼Œè¿™ä¸ªç”¨æ¥æ¨¡æ‹Ÿ clientSet, ä¹Ÿå°±æ˜¯è¯·æ±‚ etcd çš„æ¥å£ï¼Œåé¢å°†ä¼šè¯¦ç»†æè¿°ã€‚ åˆ›å»ºä¸€ä¸ª Deployment å¯¹è±¡ï¼Œ æ ‡ç­¾ä¸º â€œfooâ€: â€œbarâ€ d := newDeployment(\"foo\", 1, nil, nil, nil, map[string]string{\"foo\": \"bar\"}) æ·»åŠ ç¼“å­˜å¯¹è±¡ï¼Œç”¨äºåç»­çš„Listæ¥å£ f.dLister = append(f.dLister, d) f.objects = append(f.objects, d) åˆ›å»ºä¸€ä¸ª ReplicaSet å¯¹è±¡ rs := newReplicaSet(d, \"deploymentrs-4186632231\", 1) å¸Œæœ›çš„æµ‹è¯•ç»“æœ f.expectCreateRSAction(rs) f.expectUpdateDeploymentStatusAction(d) f.expectUpdateDeploymentStatusAction(d) ä»ä¸Šé¢çš„è¯­å¥å°±å¯ä»¥å‘ç°ï¼Œkubernetes çš„æµ‹è¯•ç±»ï¼Œæ„å›¾éå¸¸æ˜ç¡®ã€‚ ä¹Ÿå°±æ˜¯è¯´ æˆ‘åˆ›å»ºä¸€ä¸ª Deployment ** å¯¹è±¡ï¼Œè‚¯å®šä¼šäº§ç”Ÿä¸€ä¸ª ReplicaSet å¯¹è±¡ï¼Œå¹¶ä¸” DeploymentStatus ä¼šè¢«æ›´æ–°ä¸¤æ¬¡, æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯kuberneteså¦‚ä½•åšåˆ°çš„ã€‚ ","date":"2022-07-15 18:32:22","objectID":"/ooooo-notes/%E8%B0%83%E8%AF%95-deployment-controller-%E7%9A%84%E6%BA%90%E7%A0%81/:1:0","tags":["k8s","cloud native","source code"],"title":"è°ƒè¯• deployment-controller çš„æºç ","uri":"/ooooo-notes/%E8%B0%83%E8%AF%95-deployment-controller-%E7%9A%84%E6%BA%90%E7%A0%81/"},{"categories":["éšç¬”"],"content":"æµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œ f.run(testutil.GetKey(d, t)) è·å– Deployment çš„ key å±æ€§ ä»£ç  testutil.GetKey(d, t) func GetKey(obj interface{}, t *testing.T) string { // æ¯ä¸ªåˆ é™¤çš„å¯¹è±¡éƒ½æ˜¯è¿™ä¸ªç±»å‹, è¿™é‡Œå–å‡ºäº†çœŸå®çš„å¯¹è±¡ tombstone, ok := obj.(cache.DeletedFinalStateUnknown) if ok { // if tombstone , try getting the value from tombstone.Obj obj = tombstone.Obj } // å–å‡ºæŒ‡é’ˆç±»å‹ä¸­ valueï¼Œè·å– Name å±æ€§ val := reflect.ValueOf(obj).Elem() name := val.FieldByName(\"Name\").String() if len(name) == 0 { t.Errorf(\"Unexpected object %v\", obj) } // è·å–key, ç»“æœå°±æ˜¯ {namespace}/{name} key, err := keyFunc(obj) if err != nil { t.Errorf(\"Unexpected error getting key for %T %v: %v\", val.Interface(), name, err) return \"\" } return key } è°ƒç”¨ fixture.run_() æ–¹æ³• è¿™ä¸ªå‡½æ•°æœ‰ä¸‰ä¸ªå…¥å‚ï¼šrun_(deploymentName string, startInformers bool, expectError bool). å½“å‰çš„æµ‹è¯•æ–¹æ³• TestSyncDeploymentCreatesReplicaSet çš„ startInformers å‚æ•°ä¸º false, è¡¨ç¤ºä¸å¯åŠ¨ Informer, åç»­ä¼šç”¨å¦å¤–ä¸€ä¸ªæµ‹è¯•ç±»æ¥è¯´æ˜ Informer çš„å¯åŠ¨è¿‡ç¨‹. æ¥ä¸‹æ¥è¯¦ç»†çœ‹çœ‹ fixture.run_() æ–¹æ³•éƒ½å¹²äº†å•¥ã€‚ åˆ›å»ºä¸€ä¸ª controller c, informers, err := f.newController() func (f *fixture) newController() (*DeploymentController, informers.SharedInformerFactory, error) { // è¿™ä¸ªä¹Ÿå°±æ˜¯ä¹‹å‰è¯´çš„ï¼Œobjects ä¼šç”¨æ¥æ„å»º æ¨¡æ‹Ÿçš„ clientSet f.client = fake.NewSimpleClientset(f.objects...) // åˆ›å»ºäº† informer å’Œ deploymentController informers := informers.NewSharedInformerFactory(f.client, controller.NoResyncPeriodFunc()) c, err := NewDeploymentController(informers.Apps().V1().Deployments(), informers.Apps().V1().ReplicaSets(), informers.Core().V1().Pods(), f.client) if err != nil { return nil, nil, err } // æ¨¡æ‹Ÿä¸€ä¸ª recorder c.eventRecorder = \u0026record.FakeRecorder{} // æ‰€æœ‰çŠ¶æ€é»˜è®¤ä¸º synced c.dListerSynced = alwaysReady c.rsListerSynced = alwaysReady c.podListerSynced = alwaysReady // ä¸‹é¢è¿™ä¸ªä»£ç å¾ˆå…³é”® // å…ˆå‰åœ¨ fixture å¯¹è±¡ä¸­åŠ å…¥äº†ç›¸åº”çš„ Listerï¼Œåœ¨è¿™é‡Œéå†è¿™äº› Lister, å°±æ˜¯ä¸ºäº†æ¨¡æ‹Ÿ Informer çš„æœ¬åœ°ç¼“å­˜ // kube_controller_manager ç¨‹åºå¯åŠ¨ä¹‹åï¼Œä¼šè¯·æ±‚ kube_apiserver æ¥è·å–ç›¸åº”çš„èµ„æºï¼Œä»è€Œæ›´æ–°åˆ°è‡ªå·±çš„ç¼“å­˜ä¸­ for _, d := range f.dLister { informers.Apps().V1().Deployments().Informer().GetIndexer().Add(d) } for _, rs := range f.rsLister { informers.Apps().V1().ReplicaSets().Informer().GetIndexer().Add(rs) } for _, pod := range f.podLister { informers.Core().V1().Pods().Informer().GetIndexer().Add(pod) } return c, informers, nil } è¯¦ç»†åˆ†ææ˜¯æ€ä¹ˆæ¨¡æ‹Ÿ clientSet çš„ï¼Ÿ f.client = fake.NewSimpleClientset(f.objects...) func NewSimpleClientset(objects ...runtime.Object) *Clientset { // è¿™ä¸ªæ˜¯æ¨¡æ‹Ÿçš„æœ€ç»ˆå®ç°å¯¹è±¡ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯ä¾èµ–å®ƒæ¥å®Œæˆçš„ o := testing.NewObjectTracker(scheme, codecs.UniversalDecoder()) // éå†å¯¹è±¡ï¼Œä¾æ¬¡æ·»åŠ  for _, obj := range objects { if err := o.Add(obj); err != nil { panic(err) } } // åˆ›å»ºä¸€ä¸ª clientSet cs := \u0026Clientset{tracker: o} // ä¸‹é¢ä¸‰ä¸ªéƒ½æ˜¯ä¾èµ– tracker æ¥å®ç°çš„ï¼Œ é€šè¿‡ä¸åŒçš„ Action, æ¯”å¦‚ ListActionImplã€GetActionImpl ç­‰ cs.discovery = \u0026fakediscovery.FakeDiscovery{Fake: \u0026cs.Fake} cs.AddReactor(\"*\", \"*\", testing.ObjectReaction(o)) cs.AddWatchReactor(\"*\", func(action testing.Action) (handled bool, ret watch.Interface, err error) { gvr := action.GetResource() ns := action.GetNamespace() watch, err := o.Watch(gvr, ns) if err != nil { return false, nil, err } return true, watch, nil }) return cs } ObjectTracker å¦‚æœæ·»åŠ å¯¹è±¡çš„ï¼Ÿ testing.NewObjectTracker(scheme, codecs.UniversalDecoder()) func (t *tracker) Add(obj runtime.Object) error { // æ·»åŠ  List if meta.IsListType(obj) { return t.addList(obj, false) } // ç”¨æ¥è·å– namespace objMeta, err := meta.Accessor(obj) // è·å– gvk gvks, _, err := t.scheme.ObjectKinds(obj) for _, gvk := range gvks { // NOTE: UnsafeGuessKindToResource is a heuristic and default match. The // actual registration in apiserver can specify arbitrary route for a // gvk. If a test uses such objects, it cannot preset the tracker with // objects via Add(). Instead, it should trigger the Create() function // of the tracker, where an arbitrary gvr can be specified. gvr, _ := meta.UnsafeGuessKindToResource(gvk) // Resource doesn't have the concept of \"__internal\" version, just set it to \"\". if gvr.Version == runtime.APIVersionInternal { gvr.Version = \"\" } // æ·»åŠ è¿™ä¸ª err := t.add(gvr, obj, objMeta.GetNamespace(), false) if err != nil { return err } } return nil } func (t *tracker) add(gvr schema.GroupVersionResource, obj runtime.Object, ns st","date":"2022-07-15 18:32:22","objectID":"/ooooo-notes/%E8%B0%83%E8%AF%95-deployment-controller-%E7%9A%84%E6%BA%90%E7%A0%81/:2:0","tags":["k8s","cloud native","source code"],"title":"è°ƒè¯• deployment-controller çš„æºç ","uri":"/ooooo-notes/%E8%B0%83%E8%AF%95-deployment-controller-%E7%9A%84%E6%BA%90%E7%A0%81/"},{"categories":["éšç¬”"],"content":"1. GVK å®šä¹‰ GVK(group version kind): èµ„æºç»„ã€èµ„æºç‰ˆæœ¬ã€èµ„æºç±»å‹ è¡¨ç¤º apps ç»„ä¸‹ v1 ç‰ˆæœ¬ Deployment ç±»å‹çš„èµ„æºã€‚ apiVersion: apps/v1 kind: Deployment è¡¨ç¤º core ç»„ä¸‹ v1 ç‰ˆæœ¬ Pod ç±»å‹çš„èµ„æºã€‚(æ²¡æœ‰ç»„ä¿¡æ¯è¡¨ç¤ºæ ¸å¿ƒç»„) apiVersion: v1 kind: Pod ","date":"2022-07-02 18:32:22","objectID":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:1:0","tags":["k8s","cloud native","source code"],"title":"å­¦ä¹  k8s æºç çš„å‰ç½®çŸ¥è¯†","uri":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["éšç¬”"],"content":"2. kubernetes å¯¹è±¡ç»“æ„ æ¯ä¸ªå¯¹è±¡éƒ½å¯ä»¥åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ã€‚ ä¾‹å¦‚ Deployment èµ„æºï¼š TypeMeta: GVK ä¿¡æ¯ ObjectMeta: å¯¹è±¡å…ƒæ•°æ®ï¼Œæ¯”å¦‚æœ‰å±æ€§ nameã€namespace DeploymentSpec: å¯¹è±¡å®šä¹‰è§„èŒƒï¼Œæ¯”å¦‚æœ‰å±æ€§ replicas(æ§åˆ¶å‰¯æœ¬æ•°é‡)ã€template(å®šä¹‰ Pod çš„æ¨¡æ¿)ã€selector(æ ‡ç­¾é€‰æ‹©å™¨ï¼Œä¸ Pod æ ‡ç­¾ä¸€æ ·)ã€strategy(Pod å‡çº§ç­–ç•¥) DeploymentStatus: å¯¹è±¡è¿è¡Œæ—¶çŠ¶æ€ï¼Œ æ¯”å¦‚æœ‰å±æ€§ replicas(æ€»çš„å‰¯æœ¬æ•°) ä»£ç è·¯å¾„ï¼škubernetes\\vendor\\k8s.io\\api\\apps\\v1\\types.go type Deployment struct { metav1.TypeMeta `json:\",inline\"` // Standard object's metadata. // More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#metadata // +optional metav1.ObjectMeta `json:\"metadata,omitempty\" protobuf:\"bytes,1,opt,name=metadata\"` // Specification of the desired behavior of the Deployment. // +optional Spec DeploymentSpec `json:\"spec,omitempty\" protobuf:\"bytes,2,opt,name=spec\"` // Most recently observed status of the Deployment. // +optional Status DeploymentStatus `json:\"status,omitempty\" protobuf:\"bytes,3,opt,name=status\"` } ","date":"2022-07-02 18:32:22","objectID":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:2:0","tags":["k8s","cloud native","source code"],"title":"å­¦ä¹  k8s æºç çš„å‰ç½®çŸ¥è¯†","uri":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["éšç¬”"],"content":"3. kubernetes æºç ç›®å½•ç»“æ„ cmd: å¯æ‰§è¡Œç¨‹åºåŒ…ï¼Œ ä¾‹å¦‚ kubelet çš„å…¥å£ä¸º kubernetes\\cmd\\kubelet\\kubelet.go pkg: kubernetes åŒ…è·¯å¾„, æœ‰äº›å­ç›®å½•ä¸ cmd ç›®å½•ä¸€æ ·ï¼Œå°±æ˜¯å…¥å£æ–‡ä»¶ä¾èµ–çš„åŒ… vendor: ç¬¬ä¸‰æ–¹åŒ…ï¼Œå…¶ä¸­ä¹Ÿæœ‰ kubernetes çš„åŒ… plugin: å‡†å…¥æ’ä»¶å’Œè®¤è¯æ’ä»¶ hack: è„šæœ¬è·¯å¾„ï¼Œéå¸¸æœ‰ç”¨ api: OpenAPI å®šä¹‰ ä¸Šè¿°,åªæ˜¯ç®€å•çš„æè¿°äº†ï¼Œç›®å‰åªéœ€è¦çŸ¥é“ cmd, pkg, vendor æ˜¯éå¸¸é‡è¦çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬ç»å¸¸çœ‹çš„ã€‚ ","date":"2022-07-02 18:32:22","objectID":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:3:0","tags":["k8s","cloud native","source code"],"title":"å­¦ä¹  k8s æºç çš„å‰ç½®çŸ¥è¯†","uri":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["éšç¬”"],"content":"4. å¦‚ä½•å»é˜…è¯»æºç ï¼ŒçœŸçš„éœ€è¦æŠŠæ•´ä¸ªé¡¹ç›®éƒ½è¿è¡Œèµ·æ¥å—ï¼Ÿ æˆ‘ä¸ªäººè®¤ä¸ºæ˜¯å®Œå…¨ä¸éœ€è¦ã€‚ ä¸€èˆ¬æ¥è¯´çœ‹æºç ï¼Œåªéœ€è¦äº†è§£ä¸»çº¿ä»£ç ï¼ŒçŸ¥é“å“ªäº›ç±»æ˜¯æ€ä¹ˆé…åˆçš„ï¼Œä¸€èµ·å®Œæˆäº†ä»€ä¹ˆæ ·çš„åŠŸèƒ½ï¼Œå³ä½¿ä½ æŠŠæ•´ä¸ªç¨‹åºéƒ½è¿è¡Œèµ·æ¥äº†ï¼Œæœ‰äº›åˆ†æ”¯æ¡ä»¶çš„ä»£ç ï¼Œéœ€è¦ç‰¹æ®Šçš„è¾“å…¥æ•°æ®ï¼Œåœ¨ä½ ä¸ç†Ÿæ‚‰ä»£ç çš„æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¾ˆéš¾å»æ¨¡æ‹Ÿï¼Œè¿™æ—¶å€™æˆ‘ä»¬åªèƒ½çœ‹ä»£ç çš„æµ‹è¯•ç±» ï¼Œæ¥äº†è§£ä»£ç æ˜¯æ€æ ·å¤„ç†è¿™ä¸ªç‰¹æ®Šæ•°æ®çš„ã€‚ ç‰¹æ„è¯´æ˜ä¸€ä¸‹ï¼š ä»¥åçš„é˜…è¯»ä»£ç çš„éƒ¨åˆ†ï¼Œæˆ‘åŸºæœ¬ä»¥æµ‹è¯•ç±»æ¥å¸¦é¢†å¤§å®¶é˜…è¯»ã€‚ ","date":"2022-07-02 18:32:22","objectID":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/:4:0","tags":["k8s","cloud native","source code"],"title":"å­¦ä¹  k8s æºç çš„å‰ç½®çŸ¥è¯†","uri":"/ooooo-notes/%E5%AD%A6%E4%B9%A0-k8s-%E6%BA%90%E7%A0%81%E7%9A%84%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86/"},{"categories":["éšç¬”"],"content":"1. æ–¹æ³•1ï¼Œåœ¨æœ¬æœºçš„ IDE æ¥è°ƒè¯•æºç  å¦‚æœä½ æ˜¯ linux ç³»ç»Ÿï¼Œå¯ä»¥åœ¨ linux ä¸­æ­å»ºä¸€ä¸ª kubernetes å•æœºçš„é›†ç¾¤ï¼Œåœ¨æ­¤ç³»ç»Ÿä¸­å®‰è£… IDE(Goland) æ¥è°ƒè¯•. å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:0","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"1. ä¸‹è½½æºç  (go çš„ç‰ˆæœ¬è¦æ±‚ 1.18.x) git clone git@github.com:kubernetes/kubernetes.git cd kubernetes git checkout -b origin/release-1.24 go mod download ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:1","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"2. ç”¨ IDE æ‰“å¼€ kubernetes æºç  ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:2","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"3. æ‰¾åˆ°æœåŠ¡çš„å¯åŠ¨å‚æ•°ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ # æ‰§è¡Œå‘½ä»¤ ps aux | grep kube-controller-manager | grep -v grep # å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œè¾“å‡ºå¦‚ä¸‹, kube-controller-manager åé¢çš„å°±æ˜¯ç¨‹åºçš„å‚æ•° root 1584 4.0 0.8 820020 110072 ? Ssl 23:28 0:02 kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf --bind-address=127.0.0.1 --client-ca-file=/etc/kubernetes/pki/ca.crt --cluster-cidr=10.244.0.0/16 --cluster-name=kubernetes --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt --cluster-signing-key-file=/etc/kubernetes/pki/ca.key --controllers=*,bootstrapsigner,tokencleaner --kubeconfig=/etc/kubernetes/controller-manager.conf --leader-elect=true --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --root-ca-file=/etc/kubernetes/pki/ca.crt --service-account-private-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --use-service-account-credentials=true ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:3","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"4. ç§»åŠ¨ kubernetes çš„é™æ€ pod ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ cd /etc/kubernetes mv manifests/kube-controller-manager.yaml ./ ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:4","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"5. ç”¨ IDE å¯åŠ¨æœåŠ¡ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ ç¨‹åºçš„å…¥å£ï¼š cmd/kube-controller-manager/controller-manager.go (å…¶ä»–çš„æœåŠ¡ä¹Ÿæ˜¯ç±»ä¼¼çš„è·¯å¾„) ç‚¹å‡»ï¼Œé…ç½®å¯åŠ¨å‚æ•°ï¼Œå¦‚ä¸‹å›¾ é…ç½®å¯åŠ¨å‚æ•° ç°åœ¨åŸºæœ¬å°±é…ç½®å¥½äº† ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:5","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"6. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨ ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ # æ‰§è¡Œå‘½ä»¤çœ‹æ²¡æœ‰ kube-controller-manager kubectl get pods -A ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:1:6","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"2. æ–¹æ³•2. å€ŸåŠ© dlv æ¥è°ƒè¯•æºç  å¦‚æœä½ æ˜¯ mac/window ç³»ç»Ÿï¼Œå¯ä»¥å€ŸåŠ© dlv æ¥è°ƒè¯•æºç ã€‚ å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:0","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"1. ä¸‹è½½æºç  (go çš„ç‰ˆæœ¬è¦æ±‚ 1.18.x) git clone git@github.com:kubernetes/kubernetes.git cd kubernetes git checkout -b origin/release-1.24 go mod download ä¸Šè¿°ä¸‹è½½æºç ï¼Œéœ€è¦åœ¨ æœ¬åœ°window å’Œ k8sèŠ‚ç‚¹ ä¸Šéƒ½ä¸‹è½½ã€‚ æ³¨æ„ï¼šç”±äºæ˜¯è¿œç«¯è°ƒè¯•ï¼Œæ‰€ä»¥éœ€è¦åœ¨ k8s master èŠ‚ç‚¹ä¸Šï¼Œé‡æ–°ç¼–è¯‘æºç ï¼Œå»æ‰ -N -l. ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:1","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"2. åœ¨ k8s master èŠ‚ç‚¹ä¸Šï¼Œé‡æ–°ç¼–è¯‘æºç  cd kubernetes make DBG=1 # åœ¨ hack/lib/golang.sh ä¸­ ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:2","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"3. ä¸‹è½½å¯èƒ½ç”¨åˆ°çš„å·¥å…·ï¼Œå¦‚ dlv (ä½ å¯èƒ½éœ€è¦æå‰è®¾ç½® GOPATH ç¯å¢ƒå˜é‡) # å¯èƒ½éå¸¸æ…¢ï¼Œéœ€è¦è®¾ç½®ä»£ç† go get -u github.com/cloudflare/cfssl/cmd/cfssl go get -u github.com/cloudflare/cfssl/cmd/cfssljson go get -u github.com/go-delve/delve/cmd/dlv # é…ç½®ç¯å¢ƒå˜é‡ PATH=$PATH:$GOPATH/bin ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:3","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"4. æ‰¾åˆ°æœåŠ¡çš„å¯åŠ¨å‚æ•°ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ # æ‰§è¡Œå‘½ä»¤ ps aux | grep kube-controller-manager | grep -v grep # å‘½ä»¤æ‰§è¡Œä¹‹åï¼Œè¾“å‡ºå¦‚ä¸‹, kube-controller-manager åé¢çš„å°±æ˜¯ç¨‹åºçš„å‚æ•° root 1584 4.0 0.8 820020 110072 ? Ssl 23:28 0:02 kube-controller-manager --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf --bind-address=127.0.0.1 --client-ca-file=/etc/kubernetes/pki/ca.crt --cluster-cidr=10.244.0.0/16 --cluster-name=kubernetes --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt --cluster-signing-key-file=/etc/kubernetes/pki/ca.key --controllers=*,bootstrapsigner,tokencleaner --kubeconfig=/etc/kubernetes/controller-manager.conf --leader-elect=true --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --root-ca-file=/etc/kubernetes/pki/ca.crt --service-account-private-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --use-service-account-credentials=true ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:4","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"5. ç§»åŠ¨ kubernetes çš„é™æ€ pod ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ cd /etc/kubernetes mv manifests/kube-controller-manager.yaml ./ ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:5","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"6. ç”¨ dlv å¯åŠ¨æœåŠ¡ æ³¨æ„: å¯åŠ¨å‚æ•°å’Œç¨‹åºè·¯å¾„ï¼Œé…ç½®æˆä½ è‡ªå·±çš„ï¼Œç›‘å¬çš„ç«¯å£æ˜¯ 2346 dlv åœ¨é…ç½®ç¨‹åºå‚æ•°æ—¶ï¼Œæœ‰ --ï¼Œ å¦‚æœåé¢å‚æ•°æœ‰ç‰¹æ®Šç¬¦å·ï¼Œç”¨ --key=\"value\" å½¢å¼ dlv å¯åŠ¨ä¹‹åï¼Œå¿…é¡»è¦è§¦å‘(IDE go remote)ï¼Œæ‰èƒ½å¯åŠ¨, å¦åˆ™ä¼šä¸€ç›´ç­‰ç€ã€‚ dlv --listen=:2346 --headless=true --api-version=2 --accept-multiclient exec /root/kubernetes/_output/bin/kube-controller-manager -- --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf --bind-address=127.0.0.1 --client-ca-file=/etc/kubernetes/pki/ca.crt --cluster-cidr=10.244.0.0/16 --cluster-name=kubernetes --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt --cluster-signing-key-file=/etc/kubernetes/pki/ca.key --controllers=*,bootstrapsigner,tokencleaner --kubeconfig=/etc/kubernetes/controller-manager.conf --leader-elect=true --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --root-ca-file=/etc/kubernetes/pki/ca.crt --service-account-private-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --use-service-account-credentials=true ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:6","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"7. ç”¨ IDE è¿æ¥ dlv æœåŠ¡ï¼ˆæ¯”å¦‚ kube-controller-managerï¼‰ ç¨‹åºçš„å…¥å£ï¼š cmd/kube-controller-manager/controller-manager.go (å…¶ä»–çš„æœåŠ¡ä¹Ÿæ˜¯ç±»ä¼¼çš„è·¯å¾„) æ·»åŠ  Go Remoteï¼Œ é…ç½® host å’Œ portã€‚ ç‚¹å‡» okï¼Œç„¶åå¯åŠ¨æœåŠ¡ã€‚ è¿æ¥dlv ç°åœ¨åŸºæœ¬å°±é…ç½®å¥½äº† ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:7","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"8. æä¾›ä¸€ä¸ªè°ƒè¯•çš„è„šæœ¬ ï¼ˆå¯é€‰ï¼‰ ä½ ç°åœ¨ä¼šå‘ç°ï¼Œå¦‚æœæƒ³è¦è°ƒè¯•ï¼Œå°±å¿…é¡»è¦æŠŠ manifests/kube-controller-manager.yaml ç§»å‡ºå»ï¼Œç­‰ä¸éœ€è¦è°ƒè¯•äº†ï¼Œå†æŠŠè¿™ä¸ªæ–‡ä»¶ç§»å›æ¥ï¼Œè¿™æ ·éå¸¸éº»çƒ¦ã€‚æ‰€ä»¥ä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥å®ç°ã€‚ è„šæœ¬å†…å®¹å¦‚ä¸‹(æ³¨æ„æ›´æ”¹ä½ çš„è·¯å¾„)ï¼š cleanup() { mv /etc/kubernetes/kube-controller-manager.yaml /etc/kubernetes/manifests } trap cleanup EXIT mv /etc/kubernetes/manifests/kube-controller-manager.yaml /etc/kubernetes dlv --listen=:2346 --headless=true --api-version=2 --accept-multiclient exec /root/kubernetes/_output/bin/kube-controller-manager -- --allocate-node-cidrs=true --authentication-kubeconfig=/etc/kubernetes/controller-manager.conf --authorization-kubeconfig=/etc/kubernetes/controller-manager.conf --bind-address=127.0.0.1 --client-ca-file=/etc/kubernetes/pki/ca.crt --cluster-cidr=10.244.0.0/16 --cluster-name=kubernetes --cluster-signing-cert-file=/etc/kubernetes/pki/ca.crt --cluster-signing-key-file=/etc/kubernetes/pki/ca.key --controllers=*,bootstrapsigner,tokencleaner --kubeconfig=/etc/kubernetes/controller-manager.conf --leader-elect=true --requestheader-client-ca-file=/etc/kubernetes/pki/front-proxy-ca.crt --root-ca-file=/etc/kubernetes/pki/ca.crt --service-account-private-key-file=/etc/kubernetes/pki/sa.key --service-cluster-ip-range=10.96.0.0/12 --use-service-account-credentials=true ","date":"2022-06-28 18:32:22","objectID":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/:2:8","tags":["k8s","cloud native","source code"],"title":"æ­å»º k8s 1.24 ç‰ˆæœ¬çš„æºç è°ƒè¯•ç¯å¢ƒ","uri":"/ooooo-notes/%E6%90%AD%E5%BB%BA-k8s-1.24-%E7%89%88%E6%9C%AC%E7%9A%84%E6%BA%90%E7%A0%81%E8%B0%83%E8%AF%95%E7%8E%AF%E5%A2%83/"},{"categories":["éšç¬”"],"content":"1. install logstash refer to logstash document ","date":"2022-06-01 18:32:22","objectID":"/ooooo-notes/logstash-%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/:1:0","tags":["logstash"],"title":"logstash çš„ç®€å•ä½¿ç”¨","uri":"/ooooo-notes/logstash-%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"},{"categories":["éšç¬”"],"content":"2. logstash example config file input { tcp { port =\u003e 12345 codec =\u003e \"json_lines\" } } filter{ grok { match =\u003e [\"message\", \"%{TIMESTAMP_ISO8601:logdate}\"] } date { match =\u003e [\"logdate\", \"yyyy-MM-dd HH:mm:ss.SSS\"] target =\u003e \"@timestamp\" } mutate { remove_field =\u003e [\"logdate\"] } ruby { code =\u003e \"event.set('timestamp', event.get('@timestamp').time.localtime + 8*60*60)\" } ruby { code =\u003e \"event.set('@timestamp',event.get('timestamp'))\" } mutate { remove_field =\u003e [\"timestamp\"] } } output { stdout { codec =\u003e rubydebug { metadata =\u003e true } } file { path =\u003e \"./logs/%{+YYYY-MM-dd-HH}.log\" codec =\u003e line { format =\u003e \"%{message}\"} } } notes: it will serve TCP connection on localhost:12345. uses codec named json_lines, json data format such as { \"message\" : \"xxxx\" }. matche date pattern in the log, then use it as its time. reset the field @timestamp, output to the local file. ","date":"2022-06-01 18:32:22","objectID":"/ooooo-notes/logstash-%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/:1:1","tags":["logstash"],"title":"logstash çš„ç®€å•ä½¿ç”¨","uri":"/ooooo-notes/logstash-%E7%9A%84%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8/"},{"categories":["éšç¬”"],"content":"1. install wsl open Microsoft Store, then search ubuntu and click to install it. open terminal # list all linux subsystem wsl --list # set default linux subsystem, then you can input 'wsl' to inter system wsl --set-default ubuntu # enter default linux subsystem wsl # install cmake, g++, gccï¼Œgdb cd /usr/local wget https://cmake.org/files/v3.22/cmake-3.22.0-linux-x86_64.tar.gz tar xf cmake-3.22.0-linux-x86_64.tar.gz ln -s /usr/local/cmake-3.22.0-linux-x86_64/bin/cmake /usr/bin sudo apt install build-essential ","date":"2022-06-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%8A%E8%B0%83%E8%AF%95-redis/:1:0","tags":["redis"],"title":"åœ¨ windows ä¸Šè°ƒè¯• redis","uri":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%8A%E8%B0%83%E8%AF%95-redis/"},{"categories":["éšç¬”"],"content":"2. setting clion open File | Settings | Build, Execution, Deployment | Toolchains menu. add new toolchains and select wsl. åœ¨ clion ä¸­åˆ›å»ºå·¥å…·é“¾ setting wsl configuration, you maybe install cmake, gcc, g++, gdb. you must execute command git config core.autocrlf input in your terminal, because windows is CRLF, then git clone . select wsl in File | Settings | Build, Execution, Deployment | Makefile, because building redis by using makefile. login wsl and enter redis directory, for example: cd /mnt/c/Users/ooooo/Development/code/Demo/redis execute command make, you maybe need to execute cd src \u0026\u0026 ls | grep .sh | xargs chmod a+x é€‰æ‹©å¯æ‰§è¡Œæ–‡ä»¶ ","date":"2022-06-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%8A%E8%B0%83%E8%AF%95-redis/:2:0","tags":["redis"],"title":"åœ¨ windows ä¸Šè°ƒè¯• redis","uri":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%8A%E8%B0%83%E8%AF%95-redis/"},{"categories":["éšç¬”"],"content":"1. æœºå™¨åˆå§‹åŒ–è®¾ç½® ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:1:0","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"hostname è®¾ç½® hostnamectl ## æŸ¥çœ‹å½“å‰çš„hostname hostnamectl set-hostname node1 ## è®¾ç½®ä¸»æœºåä¸ºnode1 ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:1:1","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"/etc/hosts æ–‡ä»¶ å’Œ DNS é…ç½® # k8s master 192.168.130.131 node1 # æ›´æ”¹dnsé…ç½® vim /etc/systemd/resolved.conf # æ›´æ”¹ä¸‹é¢å†…å®¹ [Resolve] DNS=8.8.8.8 8.8.4.4 # é‡å¯dns systemctl restart systemd-resolved.service refer: ubuntu dns resolver ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:1:2","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"åˆ›å»ºé root ç”¨æˆ·(å¯é€‰) # æ·»åŠ ç”¨æˆ· useradd ooooo -g ooooo # ä¿®æ”¹ç”¨æˆ·å¯†ç  passwd ooooo ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:1:3","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"å®‰è£… containerd å’Œ runc å®‰è£… containerd wget https://github.com/containerd/containerd/releases/download/v1.6.6/containerd-1.6.6-linux-amd64.tar.gz tar Cxzvf /usr/local containerd-1.6.6-linux-amd64.tar.gz mkdir -p /usr/local/lib/systemd/system/ é€šè¿‡ systemd æ¥å¯åŠ¨ containerd å°†ä¸‹é¢çš„å†…å®¹å†™å…¥ /usr/local/lib/systemd/system/containerd.service # Copyright The containerd Authors. # # Licensed under the Apache License, Version 2.0 (the \"License\"); # you may not use this file except in compliance with the License. # You may obtain a copy of the License at # # http://www.apache.org/licenses/LICENSE-2.0 # # Unless required by applicable law or agreed to in writing, software # distributed under the License is distributed on an \"AS IS\" BASIS, # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. # See the License for the specific language governing permissions and # limitations under the License. [Unit] Description=containerd container runtime Documentation=https://containerd.io After=network.target local-fs.target [Service] ExecStartPre=-/sbin/modprobe overlay ExecStart=/usr/local/bin/containerd Type=notify Delegate=yes KillMode=process Restart=always RestartSec=5 # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNPROC=infinity LimitCORE=infinity LimitNOFILE=infinity # Comment TasksMax if your systemd version does not supports it. # Only systemd 226 and above support this version. TasksMax=infinity OOMScoreAdjust=-999 [Install] WantedBy=multi-user.target å¯åŠ¨ containerd systemctl daemon-reload systemctl enable --now containerd é…ç½® containerd mkdir -p /etc/containerd # ç”Ÿæˆé»˜è®¤é…ç½®æ–‡ä»¶ containerd config default | tee /etc/containerd/config.toml # ä¿®æ”¹ /etc/containerd/config.toml é…ç½® # image ä½¿ç”¨é˜¿é‡Œäº‘çš„åœ°å€ï¼Œ SystemdCgroup æ›´æ”¹ä¸º true sandbox_image = \"registry.aliyuncs.com/google_containers/pause:3.6\" ... [plugins.\"io.containerd.grpc.v1.cri\".containerd.runtimes.runc.options] ... SystemdCgroup = true # ä¿®æ”¹å®Œæˆå systemctl restart containerd å®‰è£… runc wget https://github.com/opencontainers/runc/releases/download/v1.1.3/runc.amd64 install -m 755 runc.amd64 /usr/local/sbin/runc å®‰è£… cni æ’ä»¶ wget https://github.com/containernetworking/plugins/releases/download/v1.1.1/cni-plugins-linux-amd64-v1.1.1.tgz mkdir -p /opt/cni/bin tar Cxzvf /opt/cni/bin cni-plugins-linux-amd64-v1.1.1.tgz ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:1:4","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"2. k8s å®‰è£… å®˜æ–¹ k8s å®‰è£…æ–‡æ¡£ # å‚è€ƒæ–‡æ¡£æ£€æŸ¥æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯å¦å¯ä»¥å®‰è£… k8s æœåŠ¡ # ä¸´æ—¶å…³é—­ swap åˆ†åŒº swapoff -a # æŸ¥çœ‹ swap åˆ†åŒºæ˜¯å¦å…³é—­ï¼Œæ˜¾ç¤º 0 è¡¨ç¤ºå·²å…³é—­ free -h # æ°¸ä¹…å…³é—­ swap åˆ†åŒº ç¼–è¾‘ /etc/fstab æ–‡ä»¶, æ³¨é‡Šæœ€åä¸€è¡Œ # æ£€æŸ¥ br_netfilter æ˜¯å¦è¢«åŠ è½½ï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¡¨ç¤ºæ²¡æœ‰åŠ è½½ lsmod | grep br_netfilter # åŠ è½½ br_netfilter æ¨¡å— sudo modprobe br_netfilter ## é…ç½®ç½‘ç»œ cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 net.ipv4.ip_forward = 1 EOF sudo sysctl --system # å®‰è£…è½¯ä»¶ sudo apt-get update sudo apt-get install -y apt-transport-https ca-certificates curl sudo curl -fsSLo /usr/share/keyrings/kubernetes-archive-keyring.gpg https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg echo \"deb [signed-by=/usr/share/keyrings/kubernetes-archive-keyring.gpg] https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\" | sudo tee /etc/apt/sources.list.d/kubernetes.list sudo apt-get update # é»˜è®¤å®‰è£…æœ€æ–°ç‰ˆæœ¬ sudo apt-get install -y kubelet kubeadm kubectl # ä¸è‡ªåŠ¨æ›´æ–° sudo apt-mark hold kubelet kubeadm kubectl # æŸ¥çœ‹é•œåƒåˆ—è¡¨ï¼Œ æŠ¥é”™éœ€è¦æ·»åŠ é…ç½®, crictl æ˜¯å®˜æ–¹æä¾›çš„ crictl images # vim /etc/crictl.yaml æ·»åŠ ä»¥ä¸‹å†…å®¹ runtime-endpoint: unix:///run/containerd/containerd.sock image-endpoint: unix:///run/containerd/containerd.sock timeout: 10 debug: false # è®¾ç½® kubelet å¼€æœºå¯åŠ¨ï¼Œå¹¶ä¸”ç°åœ¨å¯åŠ¨ # å¯åŠ¨ä¹‹åå¯èƒ½ä¼šæŠ¥é”™ï¼Œå¦‚æœåŸå› æ˜¯ æ²¡æœ‰è¯»å–åˆ° kubelet çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨ç®¡ï¼Œç¨åä¼šé‡å¯è¿™ä¸ªæœåŠ¡ sudo systemctl enable --now kubelet # æŸ¥çœ‹ kubelet çš„çŠ¶æ€ sudo systemctl status kubelet # æŸ¥çœ‹ kubelet çš„æ—¥å¿— journalctl -xeu kubelet ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:2:0","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"3. åˆ›å»º k8s é›†ç¾¤ åˆ›å»º k8s é›†ç¾¤å®˜æ–¹æ–‡æ¡£ k8s pod network æ’ä»¶æ–‡æ¡£ # æ‰§è¡Œ kubeadm init å‘½ä»¤ï¼Œ åœ¨ k8s master æœºå™¨ä¸Šæ‰§è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ k8s åˆ›å»º pod ä¸ä¼šåœ¨ master æœºå™¨ä¸Š # é‡ç‚¹æ³¨æ„: --pod-network-cidr=10.244.0.0/16 è¿™ä¸ªå‚æ•°å¿…é¡»è¦æœ‰ï¼Œæ²¡æœ‰çš„è¯å®‰è£… cni ä¼šæŠ¥é”™ # æ³¨æ„ preflight çš„å‰ç½®æ£€æŸ¥è¾“å‡ºï¼Œå¦‚æœæœ‰é—®é¢˜ï¼Œç™¾åº¦è‡ªè¡Œè§£å†³ # æ›¿æ¢ä¸ºä½ è‡ªå·±çš„ ip å’Œ hostname sudo kubeadm init --image-repository registry.aliyuncs.com/google_containers --apiserver-advertise-address=192.168.130.128 --pod-network-cidr=10.244.0.0/16 --control-plane-endpoint=node1 # æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œä¼šæœ‰ kubeadm join è¾“å‡ºè¡Œ # ï¼ˆåˆ†ä¸º master-token å’Œ worker-tokenï¼‰ï¼Œ ç±»ä¼¼äºä¸‹é¢çš„å‘½ä»¤ï¼Œå¯ä»¥åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸Šæ‰§è¡Œ worker-join-token çš„å‘½ä»¤ sudo kubeadm join 192.168.130.128:6443 --token 8auvt0.zfw0ayr45d80q8pb \\ --discovery-token-ca-cert-hash sha256:efe854739efef5fbaf3f6e28c899481c8d7797c1997fc8315b921a9ede400ca8 # å»æ‰æ±¡ç‚¹ï¼Œè®©å•ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥è¿è¡Œ, (æˆ‘è¿™é‡Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹) kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master- ## åœ¨æœºå™¨ä¸Šæ‰§è¡Œ kubeadm join æˆ–è€… kubeadm init å‘½ä»¤ä¹‹åï¼Œé‡å¯ kubelet æœåŠ¡ sudo systemctl restart kubelet sudo systemctl status kubelet # è®¾ç½® kubectl çš„é…ç½®æ–‡ä»¶ï¼Œ ä¸º $HOME/.kube/config mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config # å®‰è£… pod network æ’ä»¶, è¿™é‡Œä½¿ç”¨ calico æ’ä»¶ curl -o calico-operator.yaml https://projectcalico.docs.tigera.io/manifests/tigera-operator.yaml curl -o calico-custom-resources.yaml https://projectcalico.docs.tigera.io/manifests/custom-resources.yaml # é‡ç‚¹ # æ›´æ”¹ calico-custom-resources.yaml çš„ cidr é…ç½®, å€¼ä¸º --pod-network-cidr ï¼ˆåœ¨ kubeadm init æŒ‡å®šäº†ï¼‰ # å¤šä¸ªç½‘å¡ï¼Œä¹Ÿå¯ä»¥æ›´æ”¹ï¼Œå¦åˆ™å¯èƒ½ä¼šæŠ¥é”™ï¼Œæœç´¢ interface kubectl create -f calico-operator.yaml kubectl create -f calico-custom-resources.yaml # æŸ¥çœ‹ calico æ˜¯å¦å·²ç»å¯åŠ¨å®Œæˆ, cni ä¹Ÿå¯åŠ¨æˆåŠŸ kubectl get pods -A # æˆåŠŸä¹‹åä¼šæœ‰ä¸‹é¢çš„æœåŠ¡ï¼Œ éƒ½æ˜¯ running çŠ¶æ€ calico-apiserver calico-apiserver-78c5f69667-gbxbv 1/1 Running 0 88s calico-apiserver calico-apiserver-78c5f69667-h64wk 1/1 Running 0 88s calico-system calico-kube-controllers-68884f975d-q4l8s 1/1 Running 0 40m calico-system calico-node-4d7hs 1/1 Running 0 40m calico-system calico-typha-854c6b9b4b-s8ls7 1/1 Running 0 40m kube-system coredns-74586cf9b6-4pkxf 1/1 Running 0 76m kube-system coredns-74586cf9b6-9hxwl 1/1 Running 0 76m kube-system etcd-node1 1/1 Running 0 76m kube-system kube-apiserver-node1 1/1 Running 0 76m kube-system kube-controller-manager-node1 1/1 Running 0 76m kube-system kube-proxy-mn6fr 1/1 Running 0 76m kube-system kube-scheduler-node1 1/1 Running 0 76m tigera-operator tigera-operator-5fb55776df-gjs7s 1/1 Running 0 64m ","date":"2022-04-01 18:32:22","objectID":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/:3:0","tags":["k8s","cloud native"],"title":"ä½¿ç”¨ ubuntu æ¥å®‰è£… kubernetes 1.24 ç‰ˆæœ¬","uri":"/ooooo-notes/%E4%BD%BF%E7%94%A8-ubuntu-%E6%9D%A5%E5%AE%89%E8%A3%85-kubernetes-1.24-%E7%89%88%E6%9C%AC/"},{"categories":["éšç¬”"],"content":"install nfs in docker ","date":"2022-03-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/:1:0","tags":["docker","nfs"],"title":"åœ¨ docker ä¸Šå®‰è£… nfs","uri":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/"},{"categories":["éšç¬”"],"content":"1. create share directory used by nfs mkdir -p /home/ooooo/shared/nfs ","date":"2022-03-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/:1:1","tags":["docker","nfs"],"title":"åœ¨ docker ä¸Šå®‰è£… nfs","uri":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/"},{"categories":["éšç¬”"],"content":"2. create exports.txt used by nfs This the exports.txt mainly used to mount dir (path in the container ) and permission. for example: It indicates read only for all ip. vim /home/ooooo/exports.txt /home/ooooo/shared/nfs *(ro,no_subtree_check) ","date":"2022-03-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/:1:2","tags":["docker","nfs"],"title":"åœ¨ docker ä¸Šå®‰è£… nfs","uri":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/"},{"categories":["éšç¬”"],"content":"3. execute docker command docker run -d \\ -v /home/ooooo/shared/nfs:/home/ooooo/shared/nfs \\ -v /home/ooooo/exports.txt:/etc/exports:ro \\ --cap-add SYS_ADMIN \\ -p 2049:2049 \\ erichough/nfs-server # check nfs server netstat -nla | grep 2049 # mount nfs dir (check mount.nfs whether is exist ) # 172.17.0.2 is container ip mount 172.17.0.2:/home/ooooo/shared/nfs /home/ooooo/nfs-mount ","date":"2022-03-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/:1:3","tags":["docker","nfs"],"title":"åœ¨ docker ä¸Šå®‰è£… nfs","uri":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/"},{"categories":["éšç¬”"],"content":"5. å‚è€ƒ docker images ","date":"2022-03-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/:1:4","tags":["docker","nfs"],"title":"åœ¨ docker ä¸Šå®‰è£… nfs","uri":"/ooooo-notes/%E5%9C%A8-docker-%E4%B8%8A%E5%AE%89%E8%A3%85-nfs/"},{"categories":["éšç¬”"],"content":" cygwin çš„ç¯å¢ƒå˜é‡è¦æ”¾åœ¨ç¬¬ä¸€ä¸ªï¼Œè¿™æ · rsync å’Œ ssh éƒ½æ˜¯ cygwin çš„. window æ˜¯æ‰§è¡Œå‘½ä»¤ where sshï¼Œ çœ‹çœ‹ ssh æœ‰å‡ ä¸ªå®ç° ï¼ˆæ¯”å¦‚ openssh å’Œ cygwin çš„ ssh ï¼‰ refer: window install cygwin ","date":"2022-01-03 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%AD-rsync-%E9%97%AE%E9%A2%98/:0:0","tags":["resolution"],"title":"åœ¨ windows ä¸­ rsync é—®é¢˜","uri":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%AD-rsync-%E9%97%AE%E9%A2%98/"},{"categories":["éšç¬”"],"content":" win10å®‰è£…wiresharkç»å¸¸æŠ¥â€œKB2999226 å’Œ KB3118401â€ install wireshark open installation directory, manually install vc_redist.x64.exe by double click reinstall wireshark ","date":"2022-01-02 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%AD%E5%AE%89%E8%A3%85-wireshark-%E6%8A%A5%E9%94%99/:0:0","tags":["resolution"],"title":"åœ¨ windows ä¸­å®‰è£… wireshark æŠ¥é”™","uri":"/ooooo-notes/%E5%9C%A8-windows-%E4%B8%AD%E5%AE%89%E8%A3%85-wireshark-%E6%8A%A5%E9%94%99/"},{"categories":["è®¡åˆ’"],"content":"0ã€æŒç»­å­¦ä¹ è€… Talk is cheap. Show me the code. è‹±è¯­æ¯”ç¼–ç¨‹ç®€å•ã€‚ å­¦ä¹ å’Œå®è·µè¦å¹³è¡¡ã€‚ å­¦ä¼šå’Œæ—¶é—´åšæœ‹å‹ã€‚ å­¦ä¼šæŠ•èµ„ï¼Œå­¦ä¼šç†è´¢ã€‚ å­¦ä¼šå…ˆåšå‡æ³•ï¼Œå†åšåŠ æ³•ã€‚ å­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ã€‚ è¯´æ˜ï¼š â­• è¿›è¡Œä¸­ âœ… å·²å®Œæˆ âŒ å·²åºŸå¼ƒ â“ æœ‰å¿…è¦ â— é‡è¦æ€§ ğŸ“ è®°ç¬”è®° ğŸ–Š å†™ä»£ç  ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:1:0","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€å…³äºè‹±è¯­ ã€Šæ–°æ¦‚å¿µè‹±è¯­ã€‹ â­• ã€Šæ¯æ—¥è‹±è¯­å¬åŠ› ~ EnglishPodã€‹ ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:2:0","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€å…³äºæŠ€æœ¯ è®¡åˆ’ ğŸ‰ï¼š åªè®°å½•è‡ªå·±è®¤ä¸ºæœ‰ç”¨çš„ç¬”è®°ã€‚ ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:3:0","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€ä¹¦ç± 0ï¸âƒ£1ï¸âƒ£. ã€ŠJava æ€§èƒ½ä¼˜åŒ–æƒå¨æŒ‡å—ã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰ã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€ŠSpring Cloud å¾®æœåŠ¡ï¼šå…¥é—¨ã€å®æˆ˜ä¸è¿›é˜¶ã€‹ âŒ 0ï¸âƒ£4ï¸âƒ£. ã€Šarthasã€‹ 0ï¸âƒ£5ï¸âƒ£. ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ âœ… 0ï¸âƒ£6ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Kafkaï¼šæ ¸å¿ƒè®¾è®¡ä¸å®è·µåŸç†ã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€Šä»é›¶å¼€å§‹å­¦æ¶æ„ã€‹ âœ… 0ï¸âƒ£8ï¸âƒ£. ã€Šé«˜å¯ç”¨å¯ä¼¸ç¼©å¾®æœåŠ¡æ¶æ„ã€‹ âŒ 0ï¸âƒ£9ï¸âƒ£. ã€Šåˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•å¼€å‘å®æˆ˜ã€‹ 1ï¸âƒ£0ï¸âƒ£. ã€ŠGo Web ç¼–ç¨‹ã€‹ â­• 1ï¸âƒ£2ï¸âƒ£. ã€ŠEffective C++ã€‹ 1ï¸âƒ£3ï¸âƒ£. ã€ŠMore Effective C++ã€‹ 1ï¸âƒ£4ï¸âƒ£. ã€Šæ·±åº¦æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ã€‹ 1ï¸âƒ£5ï¸âƒ£. ã€ŠGoè¯­è¨€è®¾è®¡ä¸å®ç°ã€‹ 1ï¸âƒ£6ï¸âƒ£. ã€Šwiresharkç½‘ç»œåˆ†æçš„è‰ºæœ¯ã€‹ âœ… 1ï¸âƒ£7ï¸âƒ£. ã€ŠVimå®ç”¨æŠ€å·§ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹ â­• 1ï¸âƒ£8ï¸âƒ£. ã€ŠRocketMQæŠ€æœ¯å†…å¹• ç¬¬äºŒç‰ˆã€‹ 1ï¸âƒ£9ï¸âƒ£. ã€ŠKubernetes in Actionä¸­æ–‡ç‰ˆã€‹ âœ… 2ï¸âƒ£1ï¸âƒ£. ã€Šrocketmq æºç ã€‹ â­• 2ï¸âƒ£2ï¸âƒ£. ã€Škubernetes æºç ã€‹ â­• 2ï¸âƒ£3ï¸âƒ£. ã€Šistio æºç ã€‹ 2ï¸âƒ£4ï¸âƒ£. ã€Šetcd æºç ã€‹ 2ï¸âƒ£5ï¸âƒ£. ã€Šdubbo æºç ã€‹ â­• 2ï¸âƒ£6ï¸âƒ£. ã€Špulsar æºç ã€‹ âŒ 2ï¸âƒ£7ï¸âƒ£. ã€Šnsq æºç ã€‹ 2ï¸âƒ£8ï¸âƒ£. ã€Ševenting æºç ã€‹ 2ï¸âƒ£9ï¸âƒ£. ã€Šserving æºç ã€‹ 3ï¸âƒ£0ï¸âƒ£. ã€Šæ·±å…¥æµ…å‡ºIstioï¼šService Meshå¿«é€Ÿå…¥é—¨ä¸å®è·µã€‹ âœ… 3ï¸âƒ£1ï¸âƒ£. ã€ŠIstioæœåŠ¡ç½‘æ ¼æŠ€æœ¯è§£æä¸å®è·µã€‹ âœ… 3ï¸âƒ£2ï¸âƒ£. ã€Šäº‘åŸç”ŸæœåŠ¡ç½‘æ ¼Istioï¼šåŸç†ã€å®è·µã€æ¶æ„ä¸æºç è§£æã€‹ 3ï¸âƒ£3ï¸âƒ£. ã€ŠgRPCä¸äº‘åŸç”Ÿåº”ç”¨å¼€å‘ã€‹ âœ… 3ï¸âƒ£4ï¸âƒ£. ã€ŠQuarkus å®æˆ˜ã€‹ âœ… 3ï¸âƒ£4ï¸âƒ£. ã€Šgin æºç ã€‹ âœ… 3ï¸âƒ£4ï¸âƒ£. ã€Šgrpc-go æºç ã€‹ â­• 3ï¸âƒ£5ï¸âƒ£. ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ Iã€‹ âœ… 3ï¸âƒ£6ï¸âƒ£. ã€ŠGoè¯­è¨€ç²¾è¿›ä¹‹è·¯ IIã€‹ âœ… 3ï¸âƒ£7ï¸âƒ£. ã€ŠWiresharkç½‘ç»œåˆ†æå°±è¿™ä¹ˆç®€å•ã€‹ âœ… 3ï¸âƒ£8ï¸âƒ£. ã€ŠMySQLæŠ€æœ¯å†…å¹•ã€‹ 3ï¸âƒ£9ï¸âƒ£. ã€Šæ·±å…¥è§£æJavaè™šæ‹ŸæœºHotSpotã€‹ 4ï¸âƒ£0ï¸âƒ£. ã€ŠRustæƒå¨æŒ‡å—ã€‹ â­• 4ï¸âƒ£1ï¸âƒ£. ã€Šæ·±å…¥å‰–æKubernetesã€‹ 4ï¸âƒ£2ï¸âƒ£. ã€ŠKubernetesç¼–ç¨‹ã€‹ â­• 4ï¸âƒ£3ï¸âƒ£. ã€ŠKubernetesæºç å‰–æã€‹ âœ… 4ï¸âƒ£4ï¸âƒ£. ã€ŠKubernetesè®¾è®¡æ¨¡å¼ã€‹ 4ï¸âƒ£5ï¸âƒ£. ã€ŠHelmå­¦ä¹ æŒ‡å—ï¼šKubernetesä¸Šçš„åº”ç”¨ç¨‹åºç®¡ç†ã€‹ âœ… 4ï¸âƒ£6ï¸âƒ£. ã€ŠKnativeå®æˆ˜:åŸºäºKubernetesçš„æ— æœåŠ¡å™¨æ¶æ„å®è·µã€‹ âœ… 4ï¸âƒ£7ï¸âƒ£. ã€Šæ·±å…¥å‰–æJavaè™šæ‹Ÿæœºã€‹ 4ï¸âƒ£8ï¸âƒ£. ã€ŠGroovyç¨‹åºè®¾è®¡ã€‹ âœ… ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:3:1","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€æ–‡æ¡£ 0ï¸âƒ£1ï¸âƒ£. ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€ŠHow to write Go codeã€‹ 0ï¸âƒ£3ï¸âƒ£. ã€ŠEffective Goã€‹ 0ï¸âƒ£4ï¸âƒ£. ä» 0 å¼€å§‹å¸¦ä½ æˆä¸ºJVMå®æˆ˜é«˜æ‰‹ â­• 0ï¸âƒ£4ï¸âƒ£. Go è¯­è¨€é¡¹ç›®å¼€å‘å®æˆ˜ â­• 0ï¸âƒ£5ï¸âƒ£. Redis æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ âœ… 0ï¸âƒ£6ï¸âƒ£. Redis æºç å‰–æä¸å®æˆ˜ â­• 0ï¸âƒ£7ï¸âƒ£. æ·±å…¥æ‹†è§£ Tomcat \u0026 Jetty âœ… 0ï¸âƒ£8ï¸âƒ£. æ·±å…¥ C è¯­è¨€å’Œç¨‹åºè¿è¡ŒåŸç† 0ï¸âƒ£9ï¸âƒ£. ç½—å‰‘é”‹çš„ C++ å®æˆ˜ç¬”è®° âœ… ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:3:2","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"3ã€è§†é¢‘ 0ï¸âƒ£1ï¸âƒ£. ã€Šç©è½¬ç®—æ³•ç³»åˆ—â€“å›¾è®ºç²¾è®²ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šç©è½¬ç®—æ³•é¢è¯•ã€‹ â­• 0ï¸âƒ£3ï¸âƒ£. ã€Šçœ‹çš„è§çš„ç®—æ³•ã€‹ 0ï¸âƒ£4ï¸âƒ£. ã€Šæå®¢æ—¶é—´â€“ ç®—æ³•è¿›é˜¶è®­ç»ƒè¥ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€ŠDubbo 3 æ·±åº¦å‰–æ - é€è¿‡æºç è®¤è¯†ä½ ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€ŠGo å¾®æœåŠ¡å®æˆ˜ 38 è®²ã€‹ âœ… 0ï¸âƒ£6ï¸âƒ£. ã€ŠNetty æºç å‰–æä¸å®æˆ˜ã€‹ âœ… ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:3:3","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€ç®—æ³• 0ï¸âƒ£1ï¸âƒ£. æ¯å‘¨è‡³å°‘ 5 é“ Leetcodeã€‚ â­• 0ï¸âƒ£2ï¸âƒ£. leetcode å…¨ç«™æ’å1000ä»¥å†…ã€‚ â­• 0ï¸âƒ£3ï¸âƒ£. leetcode å‘¨èµ›å…¨å›½æ’å2000ä»¥å†…ã€‚ â­• 0ï¸âƒ£4ï¸âƒ£. leetcode å‘¨èµ›å…¨çƒæ’å10000ä»¥å†…ã€‚ â­• ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:3:4","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€å…³äºå…¶ä»– ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:4:0","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€ä¹¦ç± ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€Šèªæ˜çš„æŠ•èµ„è€…ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šä¸€ä¸‡å°æ—¶å¤©æ‰ç†è®ºã€‹ âŒ 0ï¸âƒ£3ï¸âƒ£. ã€Šç•ªèŒ„å·¥ä½œæ³•å›¾è§£ã€‹ âŒ 0ï¸âƒ£4ï¸âƒ£. ã€Šä¸‰ä½“ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€Šä¸‰ä½“â…¡ã€‹ 0ï¸âƒ£6ï¸âƒ£. ã€Šä¸‰ä½“â…¢ã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€Šéæš´åŠ›æ²Ÿé€šã€‹ â­• 0ï¸âƒ£8ï¸âƒ£. ã€Šç®¡ç†ä½ çš„æ¯ä¸€å¤©ã€‹ âŒ 0ï¸âƒ£9ï¸âƒ£. ã€ŠåŸåˆ™ã€‹ 1ï¸âƒ£0ï¸âƒ£. ã€Šæ€è€ƒï¼Œå¿«ä¸æ…¢ã€‹ 1ï¸âƒ£1ï¸âƒ£. ã€Šå…³é”®å¯¹è¯ã€‹ 1ï¸âƒ£2ï¸âƒ£. ã€Šå½“ä¸‹çš„å¯è’™ã€‹ 1ï¸âƒ£3ï¸âƒ£. ã€ŠæŠŠæ—¶é—´å½“ä½œæœ‹å‹ã€‹ âŒ 1ï¸âƒ£4ï¸âƒ£. ã€Šç™½å¤œè¡Œã€‹ âŒ 1ï¸âƒ£5ï¸âƒ£. ã€Šäº²å¯†å…³ç³»ï¼šé€šå¾€çµé­‚çš„æ¡¥æ¢ã€‹ â­• 1ï¸âƒ£6ï¸âƒ£. ã€Šè›¤èŸ†å…ˆç”Ÿå»çœ‹å¿ƒç†åŒ»ç”Ÿã€‹ âœ… 1ï¸âƒ£7ï¸âƒ£. ã€Šåˆ»æ„ç»ƒä¹ ã€‹ â­• 1ï¸âƒ£7ï¸âƒ£. ã€Šå“æœ‰æˆæ•ˆçš„å·¥ç¨‹å¸ˆã€‹ â­• ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:4:1","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€é€‰è¯» ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€Šäººæ€§çš„å¼±ç‚¹ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šç®—æ³• 4ã€‹ 0ï¸âƒ£3ï¸âƒ£. ã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹ 0ï¸âƒ£4ï¸âƒ£. ã€Šå½“æˆ‘è°ˆè·‘æ­¥æ—¶ï¼Œæˆ‘è°ˆäº›ä»€ä¹ˆã€‹ 0ï¸âƒ£5ï¸âƒ£. ã€ŠKafka å®˜ç½‘ã€‹ â“ 0ï¸âƒ£6ï¸âƒ£. ã€ŠMIT é«˜çº§æ•°æ®è¯¾ç¨‹ã€‹ â“ ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:4:2","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"3ã€å°è¯• ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. å­¦ä¼šä½¿ç”¨å°¤å…‹é‡Œé‡Œå¼¹å¥ ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:4:3","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€äº†è§£ ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. æš‚æ—  ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:4:4","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"5ã€å¨±ä¹ 0ï¸âƒ£1ï¸âƒ£. ã€Šè’å²›ä½™ç”Ÿã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€Šæ˜Ÿé™…ç©¿è¶Šã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€Šè¿™ä¸ªæ€æ‰‹ä¸å¤ªå†·ã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€Šç¾ä¸½äººç”Ÿã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€Šé˜¿ç”˜æ­£ä¼ ã€‹ âœ… 0ï¸âƒ£6ï¸âƒ£. ã€Šå¥‡é‡äººç”Ÿ ç¬¬ä¸€å­£ã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€Šä¸€æœ¬å¥½ä¹¦ 1ã€‹ 0ï¸âƒ£8ï¸âƒ£. ã€Šä¸€æœ¬å¥½ä¹¦ 2ã€‹ 0ï¸âƒ£9ï¸âƒ£. ã€Šæ¥šé—¨çš„ä¸–ç•Œã€‹ âœ… 1ï¸âƒ£0ï¸âƒ£. ã€Šç©¿è¶Šæ—¶ç©ºçš„å°‘å¥³ã€‹ âœ… 1ï¸âƒ£1ï¸âƒ£. ã€Šäº”ç­‰åˆ†çš„æ–°å¨˜ å‰§åœºç‰ˆã€‹ âœ… 1ï¸âƒ£2ï¸âƒ£. ã€Šä½ çš„åå­—ã€‹ âœ… 1ï¸âƒ£3ï¸âƒ£. ã€Šå·¥ä½œç»†èƒã€‹ âœ… ","date":"2022-01-01 09:00:00","objectID":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/:4:5","tags":["learning"],"title":"2022å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2022%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["éšç¬”"],"content":" idea gradle project show duplicated file treeï¼ˆproject view and packages viewï¼‰ you must select idea as run test and building idea gradle é¡¹ç›®ç»“æ„æ˜¾ç¤ºé”™è¯¯ ","date":"2022-01-01 08:00:00","objectID":"/ooooo-notes/idea-%E4%B8%AD-gradle-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%98%BE%E7%A4%BA%E9%94%99%E8%AF%AF/:0:0","tags":["resolution"],"title":"idea ä¸­ gradle é¡¹ç›®ç»“æ„æ˜¾ç¤ºé”™è¯¯","uri":"/ooooo-notes/idea-%E4%B8%AD-gradle-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84%E6%98%BE%E7%A4%BA%E9%94%99%E8%AF%AF/"},{"categories":["éšç¬”"],"content":"1. ä¸¤å°æœºå™¨åˆå§‹åŒ–è®¾ç½® ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:1:0","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"1.1 hostname è®¾ç½® hostnamectl ## æŸ¥çœ‹å½“å‰çš„hostname hostnamectl set-hostname centos1 ## è®¾ç½®ä¸»æœºåä¸ºcentos1, åœ¨ 192.168.130.131 ä¸Šæ‰§è¡Œ hostnamectl set-hostname centos2 ## è®¾ç½®ä¸»æœºåä¸ºcentos1, åœ¨ 192.168.130.132 ä¸Šæ‰§è¡Œ ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:1:1","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"1.2 /etc/hosts æ–‡ä»¶ (ä¸¤ä¸ªæœºå™¨éƒ½éœ€è¦) 192.168.1.8 ooooo 192.168.130.131 centos1 ## k8s master 192.168.130.132 centos2 ## k8s worker ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:1:2","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"1.3 åˆ›å»ºé root ç”¨æˆ· (ä¸¤ä¸ªæœºå™¨éƒ½éœ€è¦) useradd ooooo -g ooooo ## æ·»åŠ ç”¨æˆ·ï¼Œä¸¤ä¸ªæœºå™¨éƒ½æ‰§è¡Œ passwd ooooo ## ä¿®æ”¹ç”¨æˆ·å¯†ç ï¼Œä¸¤ä¸ªæœºå™¨éƒ½æ‰§è¡Œ ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:1:3","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"1.4 æ·»åŠ  yum ä»£ç† (ä¸¤ä¸ªæœºå™¨éƒ½éœ€è¦) sudo vim /etc/yum.conf ## ç¼–è¾‘ yum é…ç½®æ–‡ä»¶ proxy=http://ooooo:10800 ## åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸€è¡Œ ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:1:4","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"1.5 å®‰è£… docker æœåŠ¡ (ä¸¤ä¸ªæœºå™¨éƒ½éœ€è¦) å®˜æ–¹ docker å®‰è£…æ–‡æ¡£ å‚è€ƒæ–‡æ¡£å®‰è£… docker sudo vim /etc/docker/daemon.json ## ç¼–è¾‘ docker é…ç½®æ–‡ä»¶ï¼Œ æ·»åŠ ä¸‹é¢ json é…ç½®ï¼Œè¿™æ˜¯å› ä¸º k8s é»˜è®¤ä½¿ç”¨çš„ cgroup driver æ˜¯ systemd { \"exec-opts\": [\"native.cgroupdriver=systemd\"] } sudo systemctl enable --now docker.service ## è®¾ç½® docker æœåŠ¡å¼€æœºå¯åŠ¨ï¼Œå¹¶ä¸”ç°åœ¨å¯åŠ¨ sudo systemctl status docker ## æŸ¥çœ‹ docker æœåŠ¡çš„çŠ¶æ€ï¼Œ å¤±è´¥äº†ï¼Œä½¿ç”¨ä¸‹ä¸€æ¡å‘½ä»¤æŸ¥çœ‹æ—¥å¿— journalctl -xeu docker ## æŸ¥çœ‹ docker æ—¥å¿—æœåŠ¡ ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:1:5","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"2. k8s çš„ kubeadm å®‰è£… (ä¸¤å°éƒ½éœ€è¦) å®˜æ–¹ k8s å®‰è£…æ–‡æ¡£ å‚è€ƒæ–‡æ¡£æ£€æŸ¥æœåŠ¡å™¨çš„çŠ¶æ€æ˜¯å¦å¯ä»¥å®‰è£… k8s æœåŠ¡ ## å…³é—­ swap åˆ†åŒº swapoff -a sudo echo vm.swappiness=0 \u003e\u003e /etc/sysctl.con ## æ°¸ä¹…å…³é—­ swap åˆ†åŒºï¼Œ k8s ä¸èƒ½è¿è¡Œåœ¨æœ‰ swap åˆ†åŒºçš„æœºå™¨ä¸Š free -h ## æŸ¥çœ‹ swap åˆ†åŒºæ˜¯å¦å…³é—­ï¼Œæ˜¾ç¤º 0 è¡¨ç¤ºå·²å…³é—­ ## æ£€æŸ¥ br_netfilter æ˜¯å¦è¢«åŠ è½½ï¼Œæ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œè¡¨ç¤ºæ²¡æœ‰åŠ è½½ lsmod | grep br_netfilter sudo modprobe br_netfilter ## åŠ è½½ br_netfilter æ¨¡å— ## é…ç½®ç½‘ç»œ cat \u003c\u003cEOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat \u003c\u003cEOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system å®‰è£…å®¹å™¨è¿è¡Œæ—¶(runtime),k8s é«˜ç‰ˆæœ¬é‡‡ç”¨è‡ªåŠ¨æ£€æŸ¥æ–¹å¼,ä¸ç”¨åšä»»ä½•å¤„ç† ## æ·»åŠ  k8s é•œåƒä»“åº“ï¼Œåœ¨å‰é¢ä¸­ï¼Œè®¾ç½®äº† yum ä»£ç† ## åœ¨å®˜æ–¹æ–‡æ¡£ä¸­å¤šäº† exclude=kubelet kubeadm kubectl ï¼Œè¿™é‡Œå»æ‰, ç›´æ¥å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„ cat \u003c\u003cEOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=https://packages.cloud.google.com/yum/repos/kubernetes-el7-\\$basearch enabled=1 gpgcheck=1 repo_gpgcheck=1 gpgkey=https://packages.cloud.google.com/yum/doc/yum-key.gpg https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg EOF ## å…³é—­ selinux sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config ## å®‰è£… k8s æœåŠ¡, --disableexcludes=kubernetes è¡¨ç¤ºæ’é™¤ kubernetes ä¹‹å¤–çš„é•œåƒæº sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes ## è®¾ç½® kubelet å¼€æœºå¯åŠ¨ï¼Œå¹¶ä¸”ç°åœ¨å¯åŠ¨ ## å¯åŠ¨ä¹‹åå¯èƒ½ä¼šæŠ¥é”™ï¼Œå¦‚æœåŸå› æ˜¯ æ²¡æœ‰è¯»å–åˆ° kubelet çš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œå¯ä»¥ä¸ç”¨ç®¡ï¼Œç¨åä¼šé‡å¯è¿™ä¸ªæœåŠ¡ sudo systemctl enable --now kubelet sudo systemctl status kubelet ## æŸ¥çœ‹ kubelet çš„çŠ¶æ€ journalctl -xeu kubelet ## æŸ¥çœ‹ kubelet çš„æ—¥å¿— ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:2:0","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"3. åˆ›å»º k8s é›†ç¾¤ (ä¸¤å°éƒ½éœ€è¦) åˆ›å»º k8s é›†ç¾¤å®˜æ–¹æ–‡æ¡£ k8s pod network æ’ä»¶æ–‡æ¡£ ## æ‰§è¡Œ kubeadm init å‘½ä»¤ï¼Œ åœ¨ k8s master æœºå™¨ä¸Šæ‰§è¡Œï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œ k8s åˆ›å»º pod ä¸ä¼šåœ¨ master æœºå™¨ä¸Š ## é‡ç‚¹æ³¨æ„: --pod-network-cidr=10.244.0.0/16 è¿™ä¸ªå‚æ•°å¿…é¡»è¦æœ‰ï¼Œæ²¡æœ‰çš„è¯å®‰è£… cni ä¼šæŠ¥é”™ ## æ³¨æ„ preflight çš„å‰ç½®æ£€æŸ¥è¾“å‡ºï¼Œå¯èƒ½éœ€è¦æ·»åŠ  docker groupï¼Œè¿™ä¸ªä¼šè¾“å‡ºæœ‰æç¤ºçš„å‘½ä»¤ sudo kubeadm init --image-repository registry.aliyuncs.com/google_containers --apiserver-advertise-address=192.168.130.131 --pod-network-cidr=10.244.0.0/16 ## æ‰§è¡Œå‘½ä»¤ä¹‹åï¼Œä¼šæœ‰ kubeadm join è¾“å‡ºè¡Œ ## ï¼ˆåˆ†ä¸º master-token å’Œ worker-tokenï¼‰ï¼Œ ç±»ä¼¼äºä¸‹é¢çš„å‘½ä»¤ï¼Œåœ¨ centos2 ä¸Šæ‰§è¡Œ worker-join-token çš„å‘½ä»¤ sudo kubeadm join 192.168.130.131:6443 --token 8auvt0.zfw0ayr45d80q8pb \\ --discovery-token-ca-cert-hash sha256:efe854739efef5fbaf3f6e28c899481c8d7797c1997fc8315b921a9ede400ca8 ## åœ¨æœºå™¨ä¸Šæ‰§è¡Œ kubeadm join æˆ–è€… kubeadm init å‘½ä»¤ä¹‹åï¼Œé‡å¯ kubelet æœåŠ¡ sudo systemctl restart kubelet sudo systemctl status kubelet ## è®¾ç½® kubectl çš„é…ç½®æ–‡ä»¶ï¼Œ ä¸º $HOME/.kube/config mkdir -p $HOME/.kube sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config sudo chown $(id -u):$(id -g) $HOME/.kube/config ## å®‰è£… pod network æ’ä»¶, è¿™é‡Œä½¿ç”¨ flannel æ’ä»¶ kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml ## æŸ¥çœ‹ flannel æ˜¯å¦å·²ç»å¯åŠ¨å®Œæˆ, cni ä¹Ÿå¯åŠ¨æˆåŠŸ kubectl get pods -A ## æˆåŠŸä¹‹åä¼šæœ‰ä¸‹é¢çš„æœåŠ¡ï¼Œ éƒ½æ˜¯ running çŠ¶æ€ kube-system coredns-7f6cbbb7b8-5hqt5 1/1 Running 15 (76m ago) 26h kube-system coredns-7f6cbbb7b8-lwdrv 1/1 Running 15 (76m ago) 26h kube-system etcd-centos1 1/1 Running 18 (76m ago) 26h kube-system kube-apiserver-centos1 1/1 Running 25 (76m ago) 26h kube-system kube-controller-manager-centos1 1/1 Running 12 (76m ago) 26h kube-system kube-flannel-ds-6lx7s 1/1 Running 6 (76m ago) 21h kube-system kube-flannel-ds-n5tfn 1/1 Running 6 (76m ago) 21h kube-system kube-proxy-78jrm 1/1 Running 8 (76m ago) 26h kube-system kube-proxy-wl5jg 1/1 Running 8 (76m ago) 26h kube-system kube-scheduler-centos1 1/1 Running 16 (76m ago) 26h ","date":"2021-12-01 18:32:22","objectID":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/:3:0","tags":["k8s","cloud native"],"title":"åœ¨ centos ä¸Šå®‰è£… k8s","uri":"/ooooo-notes/%E5%9C%A8-centos-%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%AE%89%E8%A3%85-k8s/"},{"categories":["éšç¬”"],"content":"åœ¨ ~\\.gradle ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶ init.gradle, å†…å®¹å¦‚ä¸‹ allprojects { repositories { mavenLocal() maven { name \"Alibaba\" ; url \"https://maven.aliyun.com/repository/public\" } maven { name \"Bstek\" ; url \"http://nexus.bsdn.org/content/groups/public/\" } } buildscript { repositories { maven { name \"Alibaba\" ; url 'https://maven.aliyun.com/repository/public' } maven { name \"Bstek\" ; url 'https://nexus.bsdn.org/content/groups/public/' } maven { name \"M2\" ; url 'https://plugins.gradle.org/m2/' } } } } ","date":"2021-01-02 08:00:00","objectID":"/ooooo-notes/gradle-%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE%E4%BB%93%E5%BA%93%E9%95%9C%E5%83%8F/:0:0","tags":["resolution"],"title":"gradle å…¨å±€è®¾ç½®ä»“åº“é•œåƒ","uri":"/ooooo-notes/gradle-%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE%E4%BB%93%E5%BA%93%E9%95%9C%E5%83%8F/"},{"categories":["è®¡åˆ’"],"content":"0ã€æŒç»­å­¦ä¹ è€… Talk is cheap. Show me the code. è‹±è¯­æ¯”ç¼–ç¨‹ç®€å•ã€‚ å­¦ä¹ å’Œå®è·µè¦å¹³è¡¡ã€‚ å­¦ä¼šå’Œæ—¶é—´åšæœ‹å‹ã€‚ å­¦ä¼šæŠ•èµ„ï¼Œå­¦ä¼šç†è´¢ã€‚ å­¦ä¼šå…ˆåšå‡æ³•ï¼Œå†åšåŠ æ³•ã€‚ å­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ã€‚ è¯´æ˜ï¼š â­• è¿›è¡Œä¸­ âœ… å·²å®Œæˆ âŒ å·²åºŸå¼ƒ â“ æœ‰å¿…è¦ â— é‡è¦æ€§ ğŸ“ è®°ç¬”è®° ğŸ–Š å†™ä»£ç  ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:1:0","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€å…³äºè‹±è¯­ å¬è¯´è¯»å†™ï¼Œç›®å‰çš„å­¦ä¹ é‡ç‚¹æ˜¯æ—¥å¸¸æ²Ÿé€šï¼Œæ‰€ä»¥æ”¾å¼ƒèƒŒå•è¯ã€‚ è®¡åˆ’ ğŸ‰ï¼š ç›®å‰æˆ‘å·²ç»èƒŒå•è¯ 518 å¤šå¤©ï¼Œæˆ‘å°†ä¼šç»§ç»­èƒŒå•è¯ï¼ˆå¢¨å¢¨èƒŒå•è¯ï¼‰ã€‚ âŒ å­¦ä¹ ã€Šæ–°æ¦‚å¿µè‹±è¯­ä¸€ã€‹ âœ… çœ‹ Spring Frameworkã€‚ å­¦ä¹ ã€Šèµ–ä¸–é›„ç¾è¯­éŸ³æ ‡ã€‹ å­¦ä¹ ã€Šæ–°æ¦‚å¿µè‹±è¯­äºŒã€‹ ç›®å‰çŠ¶æ€: ã€Šæ–°æ¦‚å¿µè‹±è¯­äºŒã€‹ã€‚ ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:2:0","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€å…³äºæŠ€æœ¯ è®¡åˆ’ ğŸ‰ï¼š åªè®°å½•è‡ªå·±è®¤ä¸ºæœ‰ç”¨çš„ç¬”è®°ã€‚ ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:3:0","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€ä¹¦ç± 0ï¸âƒ£1ï¸âƒ£. ã€ŠJava æ€§èƒ½ä¼˜åŒ–æƒå¨æŒ‡å—ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€ŠNetty å®æˆ˜ã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€Šç¨‹åºå‘˜é¢è¯•é‡‘å…¸ï¼ˆç¬¬6ç‰ˆï¼‰ã€‹ â­• 0ï¸âƒ£4ï¸âƒ£. ã€Šå›¾è§£TCP/IPã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€ŠSpring æºç æ·±åº¦è§£æã€‹ âœ… 0ï¸âƒ£6ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºï¼ˆç¬¬3ç‰ˆï¼‰ã€‹ â­• 0ï¸âƒ£7ï¸âƒ£. ã€ŠSpring Cloud å¾®æœåŠ¡ï¼šå…¥é—¨ã€å®æˆ˜ä¸è¿›é˜¶ã€‹ 0ï¸âƒ£8ï¸âƒ£. ã€ŠSpring Cloud Alibaba å¾®æœåŠ¡åŸç†ä¸å®æˆ˜ã€‹ âœ… 0ï¸âƒ£9ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Apache Dubbo ä¸å®æˆ˜ã€‹ âœ… 1ï¸âƒ£0ï¸âƒ£. ã€Šarthasã€‹ 1ï¸âƒ£1ï¸âƒ£. ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ 1ï¸âƒ£2ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Kafkaï¼šæ ¸å¿ƒè®¾è®¡ä¸å®è·µåŸç†ã€‹ 1ï¸âƒ£3ï¸âƒ£. ã€ŠSpring 5æ ¸å¿ƒåŸç†ä¸30ä¸ªç±»æ‰‹å†™å®æˆ˜ã€‹ âŒ 1ï¸âƒ£4ï¸âƒ£. ã€ŠNetty 4æ ¸å¿ƒåŸç†ä¸æ‰‹å†™RPCæ¡†æ¶å®æˆ˜ã€‹ âŒ 1ï¸âƒ£5ï¸âƒ£. ã€Šä»é›¶å¼€å§‹å­¦æ¶æ„ã€‹ 1ï¸âƒ£6ï¸âƒ£. ã€Šé«˜å¯ç”¨å¯ä¼¸ç¼©å¾®æœåŠ¡æ¶æ„ã€‹ 1ï¸âƒ£7ï¸âƒ£. ã€Šå®æˆ˜Javaè™šæ‹Ÿæœºã€‹ â“ 1ï¸âƒ£9ï¸âƒ£. ã€Šåˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•å¼€å‘å®æˆ˜ã€‹ 2ï¸âƒ£0ï¸âƒ£. ã€ŠGo Web ç¼–ç¨‹ã€‹ 2ï¸âƒ£1ï¸âƒ£. ã€Šconsulã€‹ âŒ 2ï¸âƒ£2ï¸âƒ£. ã€ŠJava å¼‚æ­¥ç¼–ç¨‹å®æˆ˜ã€‹ â“ 2ï¸âƒ£3ï¸âƒ£. ã€ŠEffective C++ã€‹ 2ï¸âƒ£4ï¸âƒ£. More Effective C++ 2ï¸âƒ£5ï¸âƒ£. æ·±åº¦æ¢ç´¢C++å¯¹è±¡æ¨¡å‹ 2ï¸âƒ£6ï¸âƒ£. ã€Šæ·±å…¥æµ…å‡º Dockerã€‹ âœ… 2ï¸âƒ£7ï¸âƒ£. ã€Šç å‡ºé«˜æ•ˆï¼šJavaå¼€å‘æ‰‹å†Œã€‹ 2ï¸âƒ£8ï¸âƒ£. ã€ŠGo ä¸“å®¶ç¼–ç¨‹ã€‹ 2ï¸âƒ£9ï¸âƒ£. ã€Šæµç•…çš„ Pythonã€‹ 3ï¸âƒ£0ï¸âƒ£. ã€Šwiresharkç½‘ç»œåˆ†æçš„è‰ºæœ¯ã€‹ 3ï¸âƒ£2ï¸âƒ£. ã€ŠRocketMQæŠ€æœ¯å†…å¹•ã€‹ âœ… 3ï¸âƒ£3ï¸âƒ£. ã€ŠRocketMQåˆ†å¸ƒå¼æ¶ˆæ¯ä¸­é—´ä»¶ï¼šæ ¸å¿ƒåŸç†ä¸æœ€ä½³å®è·µã€‹ âœ… 3ï¸âƒ£4ï¸âƒ£. ã€ŠRocketMQå®æˆ˜ä¸åŸç†è§£æã€‹ âœ… 3ï¸âƒ£5ï¸âƒ£. ã€ŠVimå®ç”¨æŠ€å·§ï¼ˆç¬¬2ç‰ˆï¼‰ã€‹ â­• 3ï¸âƒ£6ï¸âƒ£. ã€ŠRocketMQæŠ€æœ¯å†…å¹• ç¬¬äºŒç‰ˆã€‹ 3ï¸âƒ£7ï¸âƒ£. ã€ŠKubernetes in Actionä¸­æ–‡ç‰ˆã€‹ â­• 3ï¸âƒ£8ï¸âƒ£. ã€Šrocketmqã€‹ â­• 3ï¸âƒ£9ï¸âƒ£. ã€Šspring cloud streamã€‹ âœ… 3ï¸âƒ£9ï¸âƒ£. ã€Šdubboã€‹ â­• 4ï¸âƒ£0ï¸âƒ£. ã€Špulsarã€‹ â­• 4ï¸âƒ£0ï¸âƒ£. ã€Šnsqã€‹ 4ï¸âƒ£0ï¸âƒ£. ã€Ševentingã€‹ 4ï¸âƒ£0ï¸âƒ£. ã€Šservingã€‹ 4ï¸âƒ£1ï¸âƒ£. ã€ŠActivitiã€‹ âœ… ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:3:1","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€æ–‡æ¡£ 0ï¸âƒ£1ï¸âƒ£. ã€Šæ·±å…¥æ‹†è§£ Java è™šæ‹Ÿæœºã€‹ 0ï¸âƒ£2ï¸âƒ£. é€šè¯» Spring å®˜ç½‘ï¼Œ+å®è·µ+ä»£ç +ç¬”è®°ã€‚ 0ï¸âƒ£1ï¸âƒ£ spring-cloud-netflix-eureka-clients 0ï¸âƒ£2ï¸âƒ£ spring-cloud-netflix-eureka-server 0ï¸âƒ£3ï¸âƒ£ spring-cloud-task âœ… 0ï¸âƒ£3ï¸âƒ£. å­¦ä¹  Go è¯­è¨€ï¼Œé€šè¯» Go å®˜ç½‘ï¼Œ+å®è·µ+ä»£ç +ç¬”è®°ã€‚ 0ï¸âƒ£1ï¸âƒ£. ã€ŠA Tour of Goã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€ŠTutorial: Create a moduleã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€ŠWriting Web Applicationsã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€ŠHow to write Go codeã€‹ 0ï¸âƒ£5ï¸âƒ£. ã€ŠEffective Goã€‹ 0ï¸âƒ£4ï¸âƒ£. Protobuf javaTutorial âœ… 0ï¸âƒ£5ï¸âƒ£. Goè¯­è¨€æ ¸å¿ƒ36è®² âœ… 0ï¸âƒ£6ï¸âƒ£. æ¶ˆæ¯é˜Ÿåˆ—é«˜æ‰‹è¯¾ âœ… 0ï¸âƒ£7ï¸âƒ£. ä» 0 å¼€å§‹å¸¦ä½ æˆä¸ºæ¶ˆæ¯ä¸­é—´ä»¶å®æˆ˜é«˜æ‰‹ âœ… 0ï¸âƒ£8ï¸âƒ£. ä» 0 å¼€å§‹å¸¦ä½ æˆä¸ºJVMå®æˆ˜é«˜æ‰‹ â­• ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:3:2","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"3ã€è§†é¢‘ 0ï¸âƒ£1ï¸âƒ£. ã€Šç©è½¬ç®—æ³•ç³»åˆ—â€“å›¾è®ºç²¾è®²ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šç©è½¬ç®—æ³•é¢è¯•ã€‹ â­• 0ï¸âƒ£3ï¸âƒ£. ã€Šåˆ©ç”¨Goä¼˜è¶Šçš„æ€§èƒ½è®¾è®¡ä¸å®ç°é«˜æ€§èƒ½ä¼ä¸šçº§å¾®æœåŠ¡ç½‘å…³ã€‹ â­• 0ï¸âƒ£3ï¸âƒ£. ã€Šçœ‹çš„è§çš„ç®—æ³•ã€‹ 0ï¸âƒ£4ï¸âƒ£. ã€Šæå®¢æ—¶é—´â€“ Java è¿›é˜¶è®­ç»ƒè¥ã€‹ âŒ 0ï¸âƒ£5ï¸âƒ£. ã€Šæå®¢æ—¶é—´â€“ go è¿›é˜¶è®­ç»ƒè¥ã€‹ âŒ 0ï¸âƒ£5ï¸âƒ£. ã€Šæå®¢æ—¶é—´â€“ ç®—æ³•è¿›é˜¶è®­ç»ƒè¥ã€‹ â­• ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:3:3","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€ç®—æ³• 0ï¸âƒ£1ï¸âƒ£. æ¯å‘¨è‡³å°‘ 5 é“ Leetcodeã€‚ â­• 0ï¸âƒ£2ï¸âƒ£. leetcode å…¨ç«™æ’å1000ä»¥å†…ã€‚ â­• 0ï¸âƒ£3ï¸âƒ£. leetcode å‘¨èµ›å…¨å›½æ’å2000ä»¥å†…ã€‚ â­• 0ï¸âƒ£4ï¸âƒ£. leetcode å‘¨èµ›å…¨çƒæ’å10000ä»¥å†…ã€‚ â­• ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:3:4","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€å…³äºå…¶ä»– ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:0","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€ä¹¦ç± ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€Šèªæ˜çš„æŠ•èµ„è€…ã€‹ 0ï¸âƒ£2ï¸âƒ£. ã€Šä¸€ä¸‡å°æ—¶å¤©æ‰ç†è®ºã€‹ â­• 0ï¸âƒ£3ï¸âƒ£. ã€Šç•ªèŒ„å·¥ä½œæ³•å›¾è§£ã€‹ â­• 0ï¸âƒ£4ï¸âƒ£. ã€Šä¸‰ä½“ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€Šä¸‰ä½“â…¡ã€‹ 0ï¸âƒ£6ï¸âƒ£. ã€Šä¸‰ä½“â…¢ã€‹ 0ï¸âƒ£7ï¸âƒ£. ã€Šéæš´åŠ›æ²Ÿé€šã€‹ â­• 0ï¸âƒ£8ï¸âƒ£. ã€Šç®¡ç†ä½ çš„æ¯ä¸€å¤©ã€‹ â­• 0ï¸âƒ£9ï¸âƒ£. ã€ŠåŸåˆ™ã€‹ 1ï¸âƒ£0ï¸âƒ£. ã€Šæ€è€ƒï¼Œå¿«ä¸æ…¢ã€‹ 1ï¸âƒ£1ï¸âƒ£. ã€Šå…³é”®å¯¹è¯ã€‹ 1ï¸âƒ£2ï¸âƒ£. ã€Šå½“ä¸‹çš„å¯è’™ã€‹ 1ï¸âƒ£3ï¸âƒ£. ã€ŠæŠŠæ—¶é—´å½“ä½œæœ‹å‹ã€‹ â­• 1ï¸âƒ£3ï¸âƒ£. ã€Šæ´»ç€ã€‹ âœ… 1ï¸âƒ£4ï¸âƒ£. ã€Šç™½å¤œè¡Œã€‹ â­• 1ï¸âƒ£5ï¸âƒ£. ã€Šäº²å¯†å…³ç³»ï¼šé€šå¾€çµé­‚çš„æ¡¥æ¢ã€‹ â­• ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:1","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€é€‰è¯» ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€ŠC++ Primeï¼ˆç¬¬5ç‰ˆï¼‰ã€‹ âŒ 0ï¸âƒ£2ï¸âƒ£. ã€Šç®—æ³• 4ã€‹ 0ï¸âƒ£3ï¸âƒ£. ã€ŠJMC å·¥å…·(Java Mission Control)ã€‹ 0ï¸âƒ£4ï¸âƒ£. ã€ŠZooKeeperã€‹ 0ï¸âƒ£5ï¸âƒ£. ã€ŠMIT é«˜çº§æ•°æ®è¯¾ç¨‹ã€‹ 0ï¸âƒ£6ï¸âƒ£. ã€ŠResilience4jã€‹ â“ 0ï¸âƒ£7ï¸âƒ£. ã€ŠGoogle Guavaã€‹ â“ 0ï¸âƒ£8ï¸âƒ£. ã€ŠKafka å®˜ç½‘ã€‹ 0ï¸âƒ£9ï¸âƒ£. ã€ŠSpring Security å®æˆ˜ã€‹ âŒ 1ï¸âƒ£0ï¸âƒ£. ã€ŠJvisualvmã€‹ 1ï¸âƒ£1ï¸âƒ£. ã€Šæ·±å…¥ç†è§£ Nginxï¼ˆç¬¬ 2 ç‰ˆï¼‰ã€‹ â“ 1ï¸âƒ£2ï¸âƒ£. ã€Šåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼šåŸç†ä¸å®è·µã€‹ 1ï¸âƒ£3ï¸âƒ£. ã€Šchrome-devtoolsã€‹ âŒ 1ï¸âƒ£4ï¸âƒ£. ã€Šäººæ€§çš„å¼±ç‚¹ã€‹ 1ï¸âƒ£5ï¸âƒ£. ã€Šæ·±å…¥å‰–æ Tomcatã€‹ 1ï¸âƒ£6ï¸âƒ£. ã€ŠJava ç¼–ç¨‹æ–¹æ³•è®ºï¼šå“åº”å¼Spring Reactor 3è®¾è®¡ä¸å®ç°ã€‹ 1ï¸âƒ£7ï¸âƒ£. ã€Šæ•°æ®å¯†é›†å‹åº”ç”¨ç³»ç»Ÿè®¾è®¡ã€‹ 1ï¸âƒ£8ï¸âƒ£. ã€ŠGo ç¨‹åºè®¾è®¡è¯­è¨€ã€‹ âŒ 1ï¸âƒ£9ï¸âƒ£. ã€Šæœºå™¨å­¦ä¹ å®æˆ˜ï¼šåŸºäºScikit-Learnã€Keraså’ŒTensorFlowã€‹ 2ï¸âƒ£0ï¸âƒ£. ã€ŠPythonæ·±åº¦å­¦ä¹ ã€‹ 2ï¸âƒ£1ï¸âƒ£. ã€Šå½“æˆ‘è°ˆè·‘æ­¥æ—¶ï¼Œæˆ‘è°ˆäº›ä»€ä¹ˆã€‹ ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:2","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"3ã€å°è¯• ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. å­¦ä¼šä½¿ç”¨å°¤å…‹é‡Œé‡Œå¼¹å¥ ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:3","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€äº†è§£ ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€Šhugoã€‹ âœ… ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:4","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"5ã€å¨±ä¹ 0ï¸âƒ£1ï¸âƒ£. ã€Šå‚²æ…¢ä¸åè§ã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€Šè‚–ç”³å…‹çš„æ•‘èµã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€Šå¿—æ˜ä¸æ˜¥å¨‡ã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€Šæ˜¥å¨‡ä¸å¿—æ˜ã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€Šæ˜¥å¨‡æ•‘å¿—æ˜ã€‹ âœ… ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:5","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"6. æ€»ç»“ ä»Šå¹´å¤§éƒ¨åˆ†çš„æ—¶é—´éƒ½æ”¾åœ¨é˜…è¯»æºç ä¸Šï¼Œå¯¼è‡´å¾ˆå¤šçš„ä¹¦ç±æ²¡æœ‰çœ‹å®Œï¼Œä¹Ÿæ”¾å¼ƒäº†è‹±è¯­å­¦ä¹ ã€‚ å¹´åˆå®šçš„è®¡åˆ’åœ¨å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸¤æ¬¡æ”¹å˜äº†å­¦ä¹ é‡ç‚¹ï¼Œ 1. mq æºç  2. k8s æºç ã€‚ è®¤çœŸæ€è€ƒæŒ‡å®š 2022 çš„è®¡åˆ’ ","date":"2021-01-01 09:00:00","objectID":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/:4:6","tags":["learning"],"title":"2021å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2021%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["éšç¬”"],"content":"åœ¨ conf/server.xml ä¸­çš„ Hostæ ‡ç­¾æ·»åŠ  \u003cHost name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"\u003e \u003cValve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log\" suffix=\".txt\" pattern=\"%h %l %u %t \u0026quot;%r\u0026quot; %s %b\" /\u003e // è¿™æ˜¯æ–°åŠ çš„ \u003cValve className=\"org.apache.catalina.valves.ErrorReportValve\" errorCode.400=\"webapps/ROOT/error.jsp\" errorCode.0=\"webapps/ROOT/error.jsp\" showReport=\"false\" showServerInfo=\"false\" /\u003e // è¿™æ˜¯æ–°åŠ çš„ \u003c/Host\u003e ä¸Šé¢çš„ error.jsp æ”¾åœ¨ webapps/ROOT/ å‚è€ƒ https://stackoverflow.com/questions/52814582/tomcat-is-not-redirecting-to-400-bad-request-custom-error-page å‚è€ƒ https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html#Error_Report_Valve ","date":"2021-01-01 08:00:00","objectID":"/ooooo-notes/tomcat-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5/:0:0","tags":["resolution"],"title":"tomcat è‡ªå®šä¹‰é”™è¯¯é¡µ","uri":"/ooooo-notes/tomcat-%E8%87%AA%E5%AE%9A%E4%B9%89%E9%94%99%E8%AF%AF%E9%A1%B5/"},{"categories":["éšç¬”"],"content":" é‡å†™æ–¹æ³•XMLHttpRequest.prototype.send XMLHttpRequest.prototype._send = XMLHttpRequest.prototype.send XMLHttpRequest.prototype.send = function (params) { var attached_params = mdcUtil.MDC_DEVICE_ID + \"=\" + mdcUtil.getMdcDeviceId(); if (params) { params += \"\u0026\" + attached_params; } else { params = attached_params; } return this._send(params) } ","date":"2020-01-05 08:00:00","objectID":"/ooooo-notes/%E5%9C%A8-js-%E4%B8%AD%E7%BB%9F%E4%B8%80%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%A6%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95/:0:0","tags":["resolution"],"title":"åœ¨ js ä¸­ç»Ÿä¸€è®¾ç½®è¯·æ±‚å‚æ•°çš„å¦ä¸€ç§æ–¹æ³•","uri":"/ooooo-notes/%E5%9C%A8-js-%E4%B8%AD%E7%BB%9F%E4%B8%80%E8%AE%BE%E7%BD%AE%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E7%9A%84%E5%8F%A6%E4%B8%80%E7%A7%8D%E6%96%B9%E6%B3%95/"},{"categories":["éšç¬”"],"content":" ç¼–è¾‘è¿è¡Œé…ç½®ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ä¸­çš„å·¥ä½œç›®å½•ä¸ºå½“å‰æ¨¡å—ç›®å½•ã€‚ ","date":"2020-01-04 08:00:00","objectID":"/ooooo-notes/idea-%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8webapp-%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0/:0:0","tags":["resolution"],"title":"idea å¤šæ¨¡å—é¡¹ç›®å¯åŠ¨ï¼Œwebapp ç›®å½•ä¸‹æ–‡ä»¶è®¿é—®ä¸åˆ°","uri":"/ooooo-notes/idea-%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E5%90%AF%E5%8A%A8webapp-%E7%9B%AE%E5%BD%95%E4%B8%8B%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0/"},{"categories":["éšç¬”"],"content":" å»æ‰å±æ€§ requiredï¼Œæ·»åŠ  rules è§„åˆ™ { required: true, message: 'è¯·è¾“å…¥å§“å', trigger: 'blur' } ","date":"2020-01-03 08:00:00","objectID":"/ooooo-notes/element-ui-%E4%B8%AD-el-form-item-%E6%A0%A1%E9%AA%8C%E5%87%BA%E7%8E%B0%E8%8B%B1%E6%96%87/:0:0","tags":["resolution"],"title":"element-ui ä¸­ el-form-item æ ¡éªŒå‡ºç°è‹±æ–‡","uri":"/ooooo-notes/element-ui-%E4%B8%AD-el-form-item-%E6%A0%A1%E9%AA%8C%E5%87%BA%E7%8E%B0%E8%8B%B1%E6%96%87/"},{"categories":["éšç¬”"],"content":"é—®é¢˜ If you see that the storm process is getting crashed even though you have enough memory (swap/free) available then you should also check the â€œ/proc/sys/vm/overcommit_memoryâ€ This switch knows 3 different settings: =\u003e 0: The Linux kernel is free to over commit memory(this is the default), a heuristic algorithm is applied to figure out if enough memory is available. =\u003e 1: The Linux kernel will always over commit memory, and never check if enough memory is available. This increases the risk of out-of-memory situations, but also improves memory-intensive workloads. =\u003e 2: The Linux kernel will not over commit memory, and only allocate as much memory as defined in over commit_ratio. As sometimes OS kills /crashes a process due to a system OS setting, the system OS memory overcommit setting was 2 (when it should have been set to 0) - ","date":"2020-01-02 08:00:00","objectID":"/ooooo-notes/java-%E5%87%BA%E7%8E%B0%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%A4%B1%E8%B4%A5/:0:0","tags":["resolution"],"title":"java å‡ºç°å†…å­˜åˆ†é…å¤±è´¥","uri":"/ooooo-notes/java-%E5%87%BA%E7%8E%B0%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%A4%B1%E8%B4%A5/"},{"categories":["è®¡åˆ’"],"content":"0ã€æŒç»­å­¦ä¹ è€… Talk is cheap. Show me the code. è‹±è¯­æ¯”ç¼–ç¨‹ç®€å•ã€‚ å­¦ä¹ å’Œå®è·µè¦å¹³è¡¡ã€‚ å­¦ä¼šå’Œæ—¶é—´åšæœ‹å‹ã€‚ å­¦ä¼šæŠ•èµ„ï¼Œå­¦ä¼šç†è´¢ã€‚ å­¦ä¼šå…ˆåšå‡æ³•ï¼Œå†åšåŠ æ³•ã€‚ å­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ï¼Œå­¦è‹±è¯­å¾ˆé‡è¦ã€‚ è¯´æ˜ï¼š â­• è¿›è¡Œä¸­ âœ… å·²å®Œæˆ âŒ å·²åºŸå¼ƒ â“ æœ‰å¿…è¦ â— é‡è¦ ğŸ“ è®°ç¬”è®°* ğŸ–Š å†™ä»£ç  ","date":"2020-01-01 09:00:00","objectID":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/:1:0","tags":["learning"],"title":"2020å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"1ã€å…³äºè‹±è¯­ å¬è¯´è¯»å†™ï¼Œå…¶ä¸­æœ€å®¹æ˜“çš„åº”è¯¥æ˜¯è¯»ï¼Œç„¶åå†æ˜¯å†™ï¼Œæˆ‘æœ‰å¾ˆå¤§çš„ä¿¡å¿ƒèƒ½åœ¨ä¸¤ä¸‰å¹´ä¹‹å†…ï¼ˆ2022ï¼‰æ­£å¸¸è¯»å†™ã€‚å‰©ä½™å°±æ˜¯å¬å’Œè¯´äº†ï¼Œç›®å‰å¯¹æˆ‘çœŸçš„å¤ªéš¾äº†ã€‚ è®¡åˆ’ ğŸ‰ï¼š ç›®å‰æˆ‘å·²ç»èƒŒå•è¯ 430 å¤šå¤©ï¼Œæˆ‘å°†ä¼šç»§ç»­èƒŒå•è¯ï¼ˆå¢¨å¢¨èƒŒå•è¯ï¼‰ğŸ˜„ ã€‚ çœ‹ YouTube - English with Lucyã€‚ â“ çœ‹ Springã€‚ çœ‹ Friendsã€‚ â“ ç›®å‰çŠ¶æ€: æ‰‡è´é˜…è¯»ã€‚ â— ","date":"2020-01-01 09:00:00","objectID":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/:2:0","tags":["learning"],"title":"2020å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"2ã€å…³äºæŠ€æœ¯ åªè®°å½•è‡ªå·±è®¤ä¸ºæœ‰ç”¨çš„ç¬”è®°ã€‚ è®¡åˆ’ ğŸ‰ï¼š é˜…è¯»ä¹¦ç±ï¼Œ+ç¬”è®°ã€‚ 0ï¸âƒ£1ï¸âƒ£. ã€ŠJava å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€ŠRedis å¼€å‘ä¸è¿ç»´ã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€Šå‰‘æŒ‡ Offerã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€ŠEffective Javaä¸­æ–‡ç‰ˆï¼ˆç¬¬3ç‰ˆï¼‰ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€ŠJava 8 å‡½æ•°å¼ç¼–ç¨‹ ã€‹ âœ… 0ï¸âƒ£6ï¸âƒ£. ã€Šç®—æ³•å›¾è§£ã€‹ âœ… 0ï¸âƒ£7ï¸âƒ£. ã€Šè®¾è®¡æ¨¡å¼ã€‹ â— âœ… 0ï¸âƒ£8ï¸âƒ£. ã€Šå›¾è§£ HTTP ã€‹ âœ… 0ï¸âƒ£9ï¸âƒ£. ã€ŠSpring Bootç¼–ç¨‹æ€æƒ³ï¼ˆæ ¸å¿ƒç¯‡ï¼‰ã€‹ âœ… é˜…è¯»æ–‡æ¡£ï¼Œ+ç¬”è®°ã€‚ 0ï¸âƒ£1ï¸âƒ£. ã€ŠMySQL å®æˆ˜ 45 è®²ã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€ŠKafka æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€ŠJava æ ¸å¿ƒæŠ€æœ¯ 36 è®²ã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€ŠJava å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ âœ… è§‚çœ‹è§†é¢‘ï¼Œ+ä»£ç  0ï¸âƒ£1ï¸âƒ£. ã€Šç®—æ³•é¢è¯•é€šå…³ 40 è®²ã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€Šç©è½¬ç®—æ³•ç³»åˆ—â€“ç©è½¬æ•°æ®ç»“æ„ Java ç‰ˆã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€Šç®—æ³•ä¸æ•°æ®ç»“æ„-ç»¼åˆæå‡ C++ ç‰ˆã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€Šç©è½¬ Spring å…¨å®¶æ¡¶ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€ŠGo è¯­è¨€ä»å…¥é—¨åˆ°å®æˆ˜ã€‹ âœ… é€šè¯» Spring å®˜ç½‘ï¼Œ+å®è·µ+ä»£ç +ç¬”è®°ã€‚ 0ï¸âƒ£1ï¸âƒ£ spring-cloud-stream âœ… 0ï¸âƒ£2ï¸âƒ£ spring-cloud-netflix-zuul âœ… ","date":"2020-01-01 09:00:00","objectID":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/:3:0","tags":["learning"],"title":"2020å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"4ã€å…³äºå…¶ä»– é˜…è¯»ï¼Œ+ç¬”è®° 0ï¸âƒ£1ï¸âƒ£. ã€ŠæŒ‡æ•°åŸºé‡‘æŠ•èµ„æŒ‡å—ã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€Šå¯Œçˆ¸çˆ¸ç©·çˆ¸çˆ¸ã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€Šè§£è¯»åŸºé‡‘ã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€Šå¯Œçˆ¸çˆ¸è´¢åŠ¡è‡ªç”±ä¹‹è·¯ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€Šå…‹è±å› å£¶ã€‹ âœ… ","date":"2020-01-01 09:00:00","objectID":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/:4:0","tags":["learning"],"title":"2020å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["è®¡åˆ’"],"content":"5ã€é€‰è¯» ğŸ‰ 0ï¸âƒ£1ï¸âƒ£. ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ âœ… 0ï¸âƒ£2ï¸âƒ£. ã€ŠSpring å®æˆ˜ï¼ˆç¬¬5ç‰ˆ ï¼‰ã€‹ âœ… 0ï¸âƒ£3ï¸âƒ£. ã€ŠCloud Native Javaã€‹ âœ… 0ï¸âƒ£4ï¸âƒ£. ã€ŠMyBatis æŠ€æœ¯å†…å¹•ã€‹ âœ… 0ï¸âƒ£5ï¸âƒ£. ã€Šçœ‹é€ Spring MVCã€‹ âœ… 0ï¸âƒ£6ï¸âƒ£. ã€ŠRedis æ·±åº¦å†é™©ï¼šæ ¸å¿ƒåŸç†ä¸åº”ç”¨å®è·µã€‹ âœ… 0ï¸âƒ£7ï¸âƒ£. ã€ŠSpring Boot ç¼–ç¨‹æ€æƒ³ã€‹ âœ… 0ï¸âƒ£8ï¸âƒ£. ã€ŠOfferæ¥äº†ï¼šJavaé¢è¯•æ ¸å¿ƒçŸ¥è¯†ç‚¹ç²¾è®²ï¼ˆåŸç†ç¯‡ï¼‰ã€‹ âœ… 0ï¸âƒ£9ï¸âƒ£. ã€ŠOfferæ¥äº†ï¼šJavaé¢è¯•æ ¸å¿ƒçŸ¥è¯†ç‚¹ç²¾è®²ï¼ˆæ¡†æ¶ç¯‡ï¼‰ã€‹ âœ… ","date":"2020-01-01 09:00:00","objectID":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/:5:0","tags":["learning"],"title":"2020å¹´å­¦ä¹ è®¡åˆ’","uri":"/ooooo-notes/2020%E5%B9%B4%E8%AE%A1%E5%88%92/"},{"categories":["éšç¬”"],"content":" æ‰§è¡Œå‘½ä»¤ rm -rf ~/.zcompdump* ","date":"2020-01-01 08:00:00","objectID":"/ooooo-notes/zsh-%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6%E5%90%8E%E4%B8%8D%E7%94%9F%E6%95%88/:0:0","tags":["resolution"],"title":"zsh æ·»åŠ æ’ä»¶åï¼Œä¸ç”Ÿæ•ˆ","uri":"/ooooo-notes/zsh-%E6%B7%BB%E5%8A%A0%E6%8F%92%E4%BB%B6%E5%90%8E%E4%B8%8D%E7%94%9F%E6%95%88/"},{"categories":null,"content":"1ã€Redis ç‰¹æ€§ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"1ã€é€Ÿåº¦å¿« Redis çš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯æ”¾åœ¨å†…å­˜ä¸­çš„ã€‚ Redis æ˜¯ C è¯­è¨€å®ç°çš„ã€‚ Redis ä½¿ç”¨å•çº¿ç¨‹æ¶æ„ï¼Œé¿å…å¤šçº¿ç¨‹ç¯å¢ƒä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"2ã€åŸºäºé”®å€¼å¯¹çš„æ•°æ®ç»“æ„æœåŠ¡å™¨ Redis ä¸»è¦æä¾›äº”ç§åŸºæœ¬æ•°æ®ç»“æ„ï¼šstringï¼ˆå­—ç¬¦ä¸²ï¼‰ã€hashï¼ˆå“ˆå¸Œï¼‰ã€listï¼ˆåˆ—è¡¨ï¼‰ã€setï¼ˆé›†åˆï¼‰ã€zsetï¼ˆæœ‰åºé›†åˆï¼‰ï¼Œè¿˜æä¾› Bitmapsï¼ˆä½å›¾ï¼‰ã€HyperLogLogï¼ˆåŸºæ•°ç»Ÿè®¡ç®—æ³•ï¼‰ã€GEOï¼ˆåœ°ç†ä½ç½®ï¼‰é«˜çº§æ•°æ®ç»“æ„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"3ã€ä¸°å¯Œçš„åŠŸèƒ½ æä¾›äº†é”®è¿‡æœŸåŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥å®ç°ç¼“å­˜ã€‚ æä¾›äº†å‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥å®ç°æ¶ˆæ¯ç³»ç»Ÿã€‚ æ”¯æŒ Lua è„šæœ¬åŠŸèƒ½ï¼Œå¯ä»¥åˆ©ç”¨ Lua åˆ›é€ æ–°çš„ Redis å‘½ä»¤ã€‚ æä¾›äº†ç®€å•äº‹åŠ¡åŠŸèƒ½ã€‚ æä¾›äº† Pipelineï¼ˆæµæ°´çº¿ï¼‰åŠŸèƒ½ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"4ã€ç®€å•ç¨³å®š æ—©æœŸçš„ Redis æºç åªæœ‰ä¸¤ä¸‡è¡Œï¼Œ3.0 ç‰ˆæœ¬åæ·»åŠ äº†é›†ç¾¤ç‰¹æ€§ï¼Œä»£ç å¢åˆ° 5 ä¸‡è¡Œå·¦å³ï¼ŒRedis è‡ªå·±å®ç°äº†äº‹ä»¶å¤„ç†åŠŸèƒ½ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"5ã€å®¢æˆ·ç«¯è¯­è¨€å¤š Redis æä¾›äº†ç®€å•çš„ TCP é€šä¿¡åè®®ï¼Œä¸»æµçš„ç¼–ç¨‹è¯­è¨€éƒ½æœ‰å…¶å®¢æˆ·ç«¯å®ç°ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"6ã€æŒä¹…åŒ– Redis æä¾›äº† AOF ã€ RDB ä¸¤ç§æŒä¹…åŒ–æ–¹å¼ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:6","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"7ã€ä¸»ä»å¤åˆ¶ã€é«˜å¯ç”¨å’Œåˆ†å¸ƒå¼ Redis Sentinel ã€Redis Cluster ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:1:7","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"2ã€Redis ä½¿ç”¨åœºæ™¯ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"Redis å¯ä»¥åšä»€ä¹ˆ ç¼“å­˜ã€‚ï¼ˆ Redis æä¾›äº†é”®è¿‡æœŸæ—¶é—´è®¾ç½®ï¼‰ æ’è¡Œæ¦œç³»ç»Ÿã€‚ï¼ˆ Redis æä¾›äº†åˆ—è¡¨ list å’Œæœ‰åºé›†åˆ set æ•°æ®ç»“æ„ï¼‰ è®¡æ•°å™¨åº”ç”¨ã€‚ï¼ˆ Redis æä¾›äº†è®¡æ•°åŠŸèƒ½ incrã€decr ï¼‰ ç¤¾äº¤ç½‘ç»œã€‚ï¼ˆèµ/è¸©ã€ç²‰ä¸ã€å…±åŒå¥½å‹/å–œå¥½ï¼‰ æ¶ˆæ¯é˜Ÿåˆ—ã€‚ï¼ˆ Redis æä¾›äº†åˆ—è¡¨ list çš„ rpush, blpop å‘½ä»¤ ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"Redis ä¸å¯ä»¥åšä»€ä¹ˆ Redis åŸºäºå†…å­˜ï¼Œä¸èƒ½åšå­˜å‚¨ã€‚ é¿å…ç”¨ Redis æ¥ç¼“å­˜å†·æ•°æ®ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/:2:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/01/"},{"categories":null,"content":"1ã€é¢„å¤‡ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€å…¨å±€å‘½ä»¤ help HELP command æŸ¥çœ‹æ‰€æœ‰çš„key KEYS * é”®æ€»æ•° DBSIZE æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ EXISTS key åˆ é™¤é”® DEL key é”®è¿‡æœŸ EXPIRE key sencond ttl è¿”å›è¿‡æœŸæ—¶é—´ TTL key \u003e0: å‰©ä½™è¿‡æœŸæ—¶é—´ -1: æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ -2: é”®ä¸å­˜åœ¨ keyçš„æ•°æ®ç»“æ„ç±»å‹ TYPE key ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€æ•°æ®ç»“æ„ä¸å†…éƒ¨ç¼–ç  æ¯ç§æ•°æ®ç»“æ„éƒ½æœ‰è‡ªå·±åº•å±‚çš„å†…éƒ¨ç¼–ç å®ç°ï¼Œé€šè¿‡å‘½ä»¤ OBJECT ENCODING key æ¥æŸ¥çœ‹ã€‚ string å†…éƒ¨ç¼–ç ï¼š rawã€intã€embstr hash å†…éƒ¨ç¼–ç ï¼š ziplistã€hashtable list å†…éƒ¨ç¼–ç ï¼š ziplistã€linkedlistã€quicklist set å†…éƒ¨ç¼–ç ï¼š intsetã€hashtable zset å†…éƒ¨ç¼–ç ï¼š ziplistã€skiplist ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€string ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€å¸¸ç”¨å‘½ä»¤ è®¾ç½®å€¼ã€è·å–å€¼ SET key value [expiration EX seconds|PX milliseconds] [NX|XX] GET key è¯´æ˜ï¼š NXï¼šä¸å­˜åœ¨ keyï¼Œæ‰è®¾ç½®æˆåŠŸã€‚åŒå‘½ä»¤ SETNX key value XXï¼šå­˜åœ¨ keyï¼Œæ‰è®¾ç½®æˆåŠŸã€‚ æ‰¹é‡è®¾ç½®ã€æ‰¹é‡è·å– MSET key value [key value ...] MGET key [key ...] è¯´æ˜ï¼š æ‰¹é‡æ“ä½œå¯ä»¥å‡å°‘ç½‘ç»œæ—¶é—´ã€‚ è®¡æ•° INCR key INCRBY key increment INCRBYFLOAT key increment DECR key DECRBY key decrement ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€ä¸å¸¸ç”¨çš„å‘½ä»¤ è¿½åŠ å€¼ APPEND key value å­—ç¬¦ä¸²é•¿åº¦ STRLEN key è®¾ç½®å¹¶è¿”å›åŸå€¼ GETSET key value è®¾ç½®æŒ‡å®šä½ç½®çš„å­—ç¬¦ SETRANGE key offset value è·å–éƒ¨åˆ†å­—ç¬¦ä¸² GETRANGE key start end ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:2:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"3ã€å†…éƒ¨ç¼–ç  å­—ç¬¦ä¸²å†…éƒ¨ç¼–ç æœ‰ä¸‰ç§ï¼š intï¼š8 ä¸ªå­—èŠ‚çš„é•¿æ•´å‹ embstrï¼šå°äºç­‰äº 39 ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸² rawï¼šå¤§äº 39 ä¸ªå­—èŠ‚çš„å­—ç¬¦ä¸² ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:2:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"4ã€ä½¿ç”¨åœºæ™¯ ç¼“å­˜ ï¼ˆç½‘ç«™è¯·æ±‚æ•°æ®ç¼“å­˜ï¼‰ è®¡æ•° ï¼ˆç½‘ç«™çš„æµè§ˆæ•°å’Œæ’­æ”¾æ•°ï¼‰ å…±äº« Session ï¼ˆç”¨æˆ·ç™»å½•ä¿¡æ¯ï¼‰ é™é€Ÿ ï¼ˆéªŒè¯ç æ¥å£ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:2:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"3ã€hash ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€å‘½ä»¤ è®¾ç½®å€¼ã€è·å–å€¼ HSET key field value HGET key field åˆ é™¤ field HDEL key field [field ...] è®¡ç®— field çš„ä¸ªæ•° HLEN key æ‰¹é‡è®¾ç½®ã€æ‰¹é‡è·å– HMSET key field value [field value ...] HMGET key field [field ...] æ˜¯å¦å­˜åœ¨ field HEXISTS key field è·å–æ‰€æœ‰çš„ field HKEYS key è·å–æ‰€æœ‰çš„ value HVALS key è·å–æ‰€æœ‰çš„ field-value HGETALL key è¯´æ˜ï¼š field ä¸ªæ•°æ¯”è¾ƒå¤šæ—¶ï¼Œä¼šé˜»å¡ redisã€‚ è®¡æ•° HINCRBY key field increment HINCRBYFLOAT key field increment è·å– value é•¿åº¦ HSTRLEN key field ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:3:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€å†…éƒ¨ç¼–ç  ziplistï¼ˆå‹ç¼©è¡¨ï¼‰ï¼šå…ƒç´ ä¸ªæ•°å°äº hash-max-ziplist-entries = 512 ï¼ŒåŒæ—¶ value å°äº hash-max-ziplist-value = 64ï¼Œå°±ä½¿ç”¨ ziplistï¼Œ é…ç½®å‚æ•°åœ¨ redis.conf ä¸­ã€‚ hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼šæ— æ³•æ»¡è¶³ ziplist çš„æ¡ä»¶ï¼Œä¼šä½¿ç”¨ hashtableã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:3:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"4ã€list ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€å‘½ä»¤ æ·»åŠ  RPUSH key value [value ...] # å³è¾¹æ·»åŠ  LPUSH key value [value ...] # å·¦è¾¹æ·»åŠ  LINSERT key BEFORE|AFTER pivot value # æŒ‡å®šä½ç½®æ’å…¥ æŸ¥è¯¢ LRANGE key start stop # èŒƒå›´ä¸º[start, stop], æŸ¥è¯¢æ‰€æœ‰æ˜¯ start = 0, stop = -1 LLEN key # åˆ—è¡¨é•¿åº¦ åˆ é™¤ LPOP key # å·¦è¾¹å¼¹å‡º RPOP key # å³è¾¹å¼¹å‡º LREM key count value ## åˆ é™¤ count ä¸ª value å€¼, count \u003e 0,ä»å·¦è¾¹åˆ é™¤ï¼›count \u003c 0,ä»å³è¾¹åˆ é™¤ï¼›count = 0, åˆ é™¤æ‰€æœ‰ LTRIM key start stop # åªä¿ç•™[start, stop]çš„å…ƒç´  ä¿®æ”¹ LSET key index value # è®¾ç½®æŒ‡å®šç´¢å¼•çš„å€¼ é˜»å¡ BLPOP key [key ...] timeout # ä»å·¦è¾¹å¼¹å‡ºå…ƒç´ ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™é˜»å¡ BRPOP key [key ...] timeout # ä»å³è¾¹å¼¹å‡ºå…ƒç´ ï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™é˜»å¡ # timeoutï¼šé˜»å¡æ—¶é—´ã€‚å¤šä¸ª key, ä»å·¦æ‰«æã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:4:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€å†…éƒ¨ç¼–ç  ziplistï¼ˆå‹ç¼©è¡¨ï¼‰ï¼šå…ƒç´ ä¸ªæ•°å°äº list-max-ziplist-entries = 512 ï¼ŒåŒæ—¶ value å°äº list-max-ziplist-value = 64ï¼Œå°±ä½¿ç”¨ ziplistï¼Œ é…ç½®å‚æ•°åœ¨ redis.conf ä¸­ã€‚ linkedlistï¼ˆé“¾è¡¨ï¼‰ï¼šæ— æ³•æ»¡è¶³ ziplist çš„æ¡ä»¶ï¼Œä¼šä½¿ç”¨ linkedlistã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:4:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"5ã€set ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:5:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€é›†åˆå†…æ“ä½œ æ·»åŠ  SADD key member [member ...] åˆ é™¤ SREM key member [member ...] è®¡ç®—å…ƒç´ ä¸ªæ•° SCARD key æ˜¯å¦åœ¨é›†åˆä¸­ SISMEMBER key member # éšæœºè¿”å› count ä¸ªå…ƒç´ ï¼Œä¸ä¼šåˆ é™¤å…ƒç´  SRANDMEMBER key [count] éšæœºå¼¹å‡º count ä¸ªå…ƒç´ ï¼Œä¼šåˆ é™¤å…ƒç´  SPOP key [count] è·å–æ‰€æœ‰å…ƒç´  SMEMBERS key ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:5:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€é›†åˆé—´æ“ä½œ å¤šä¸ªé›†åˆçš„äº¤é›† SINTER key [key ...] å¤šä¸ªé›†åˆçš„å¹¶é›† SUNION key [key ...] å¤šä¸ªé›†åˆçš„å·®é›† SDIFF key [key ...] å°†äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„ç»“æœä¿å­˜ SINTERSTORE destination key [key ...] SUNIONSTORE destination key [key ...] SDIFFSTORE destination key [key ...] è¯´æ˜ï¼š destination è¡¨ç¤ºç›®æ ‡ keyã€‚ key è¡¨ç¤ºéœ€è¦æ“ä½œçš„ keyã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:5:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"3ã€å†…éƒ¨ç¼–ç  intsetï¼ˆæ•´æ•°é›†åˆï¼‰ï¼švalue å€¼ä¸ºæ•´å‹ï¼Œä¸ªæ•°å°äº set-max-intset-entries = 512 æ—¶ï¼Œä½¿ç”¨ intsetã€‚é…ç½®å‚æ•°åœ¨ redis.conf ä¸­ã€‚ hashtableï¼ˆå“ˆå¸Œè¡¨ï¼‰ï¼šä¸æ»¡è¶³ intset æ¡ä»¶æ—¶ï¼Œä½¿ç”¨ hashtableã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:5:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"4ã€ä½¿ç”¨åœºæ™¯ æ ‡ç­¾ç³»ç»Ÿï¼šè®¡ç®—ä¸åŒäººç›¸åŒå–œå¥½çš„æ ‡ç­¾ (SINTERå‘½ä»¤)ã€‚ SADD user1:tags tag1 tag2 SADD user2:tags tag2 tag3 SINTER user1:tags user2:tags ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:5:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"6ã€zset ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:6:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€é›†åˆå†…æ“ä½œ æ·»åŠ  ZADD key [NX|XX] [CH] [INCR] score member [score member ...] # NX: ä¸å­˜åœ¨ keyï¼Œæ‰è®¾ç½®æˆåŠŸ # XX: å­˜åœ¨ å¯ä»¥ï¼Œæ‰è®¾ç½®æˆåŠŸ è®¡ç®—æˆå‘˜ä¸ªæ•° ZCARD key è·å–æŸä¸ªæˆå‘˜çš„åˆ†æ•° ZSCORE key member è·å–æŸä¸ªæˆå‘˜çš„æ’å ZRANK key member # ä»ä½åˆ°é«˜ ZREVRANK key member # ä»é«˜åˆ°ä½ åˆ é™¤ ZREM key member [member ...] # åˆ é™¤æˆå‘˜ ZREMRANGEBYRANK key start stop # åˆ é™¤æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜ ZREMRANGEBYSCORE key min max # åˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜ å¢åŠ æˆå‘˜çš„åˆ†æ•° ZINCRBY key increment member è·å–æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜ ZRANGE key start stop [WITHSCORES] # ä»ä½åˆ°é«˜ ZREVRANGE key start stop [WITHSCORES] # ä»é«˜åˆ°åº• è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜ ZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count] # WITHSCORESï¼šç»“æœè¿”å›åˆ†æ•° # LIMIT offset countï¼šé™åˆ¶è¿”å›ä¸ªæ•° è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜ä¸ªæ•° ZCOUNT key min max ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:6:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€é›†åˆé—´æ“ä½œ äº¤é›† ZINTERSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX] # destinationï¼šè®¡ç®—ç»“æœä¿å­˜çš„é”® # numkeysï¼šå‚ä¸çš„é”®ï¼Œä¹Ÿå°±æ˜¯ key çš„æ€»æ•° # weightï¼šæ¯ä¸€ä¸ª key å‚ä¸çš„æƒé‡ï¼Œé»˜è®¤ä¸º 1 # AGGREGATEï¼šèšåˆæ“ä½œï¼Œé»˜è®¤ä¸º sum å¹¶é›† ZUNIONSTORE destination numkeys key [key ...] [WEIGHTS weight] [AGGREGATE SUM|MIN|MAX] # å‚æ•°åŒ ZINTERSTORE ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:6:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"3ã€å†…éƒ¨ç¼–ç  ziplistï¼ˆå‹ç¼©åˆ—è¡¨ï¼‰ï¼šä¸ªæ•°å°äº zset-max-ziplist-entries = 128 æ—¶ï¼Œvalue å°äº zet-max-ziplist-value = 64 ä½¿ç”¨ ziplistã€‚é…ç½®å‚æ•°åœ¨ redis.conf ä¸­ã€‚ skiplistï¼ˆè·³è·ƒè¡¨ï¼‰ï¼šä¸æ»¡è¶³ ziplist æ¡ä»¶æ—¶ï¼Œä½¿ç”¨ skiplistã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:6:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"6ã€é”®ç®¡ç† ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:7:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€å•ä¸ªé”®ç®¡ç† é”®é‡å‘½å RENAME key newkey # å­˜åœ¨ keyï¼Œä¼šè¦†ç›– RENAMENX key newkey # ä¸å­˜åœ¨ keyï¼Œæ‰é‡å‘½åæˆåŠŸ éšæœºè¿”å›ä¸€ä¸ªé”® RANDOMKEY é”®è¿‡æœŸ EXPIRE key seconds # \u003e0: å‰©ä½™è¿‡æœŸæ—¶é—´ # -1: æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼› # -2: é”®ä¸å­˜åœ¨ Redis ä¸æ”¯æŒäºŒçº§æ•°æ®ç»“æ„ï¼ˆå“ˆå¸Œè¡¨ã€åˆ—è¡¨ï¼‰è¿‡æœŸ setex åŸå­å‘½ä»¤è®¾ç½® value å’Œ expire è¿ç§»é”® MOVE key db # è¿ç§»åˆ°å¦ä¸€ä¸ªdb, ä¸å»ºè®®ä½¿ç”¨ï¼Œå› ä¸ºé›†ç¾¤ç¯å¢ƒåªèƒ½ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ DUMP key; RESTORE key ttl serialized-value [REPLACE] # æ“ä½œéº»çƒ¦ï¼Œä¸å»ºè®®ä½¿ç”¨ MIGRATE host port key| destination-db timeout [COPY] [REPLACE] [KEYS key] # å¯ä»¥ä½¿ç”¨ # COPY: è¿ç§»åä¸ä¼šåˆ é™¤æºé”® # REPLACE: è¿ç§»åä¼šè¦†ç›–ç›®æ ‡åº“çš„é”® ç¤ºä¾‹ï¼š è¿ç§»åˆ° localhost:6380 çš„ db0 åº“ä¸Šï¼Œtimeoutä¸º 1000msï¼Œå‘½ä»¤ä¸º MIGRATE localhost 6380 hello 0 1000ã€‚ è¿ç§»å¤šä¸ªé”® k1, k2, k3ï¼Œå‘½ä»¤ä¸º MIGRATE localhost 6380 \"\" 0 1000 KEYS k1 k2 k3ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:7:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"2ã€éå†é”® å…¨é‡éå†é”® KEYS pattern # é”®å¾ˆå¤šæ—¶ï¼Œä¼šé˜»å¡ Redis æ¸è¿›å¼éå†å»º SCAN cursor [MATCH pattern] [COUNT count] # count: æ¯æ¬¡æŸ¥è¯¢ key çš„ä¸ªæ•°ã€‚ # pattern: åŒå‘½ä»¤ scanã€‚ è¯´æ˜ï¼š ç¬¬ä¸€æ¬¡æŸ¥è¯¢è®¾ç½® cursor ä¸º 0ï¼Œç»“æœä¼šè¿”å› cursorï¼Œå¦‚æœ cursor ä¸º 0ï¼Œè¡¨ç¤ºéå†ç»“æŸï¼Œå¦åˆ™è®¾ç½® cursor ä¸ºå½“å‰è¿”å›å€¼ï¼Œå†æ¬¡æŸ¥è¯¢ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:7:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"3ã€æ•°æ®åº“ç®¡ç† æ— ï¼Œå› ä¸ºé›†ç¾¤æ¨¡å¼ä¸‹ï¼Œåªèƒ½ä½¿ç”¨ä¸€ä¸ªæ•°æ®åº“ï¼Œç”Ÿäº§ç¯å¢ƒä¹Ÿæ˜¯å¦‚æ­¤ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/:7:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/02/"},{"categories":null,"content":"1ã€æ…¢æŸ¥è¯¢ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"1ã€æ…¢æŸ¥è¯¢é…ç½® slowlog-log-slower-than: 10000 (é»˜è®¤å€¼ï¼Œå•ä½å¾®ç§’)ï¼Œè¶…è¿‡ 10 æ¯«ç§’çš„è¯­å¥å°±ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚ slowlog-max-len: 128ï¼ˆé»˜è®¤å€¼ï¼‰ï¼ŒRedis å†…éƒ¨ä½¿ç”¨åˆ—è¡¨æ¥ä¿å­˜æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚ lowlog-log-slower-than = 0, ä¼šè®°å½•æ‰€æœ‰å‘½ä»¤ã€‚ lowlog-log-slower-than \u003c 0, ä¸ä¼šè®°å½•ä»»ä½•å‘½ä»¤ã€‚ é…ç½®æ–¹å¼ï¼š ä¿®æ”¹é…ç½®æ–‡ä»¶ redis.confã€‚ åŠ¨æ€ä¿®æ”¹ config set lowlog-log-slower-than 20000 # è®¾ç½®æ…¢æŸ¥è¯¢æ—¶é—´ config set slowlog-max-len 1000 # è®¾ç½®æ…¢æŸ¥è¯¢æ—¥å¿—å¤§å° config rewrite # æŒä¹…åŒ–åˆ°é…ç½®æ–‡ä»¶ æ…¢æŸ¥è¯¢å‘½ä»¤ SLOWLOG GET 10 # è·å–æœ€è¿‘ 10 æ¡æ—¥å¿— SLOWLOG LEN # è·å–æ—¥å¿—æ¡æ•° SLOWLOG RESET # æ…¢æŸ¥è¯¢æ—¥å¿—é‡ç½® ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"2ã€æœ€ä½³å®è·µ å‚æ•° slowlog-max-lenï¼Œå»ºè®®è°ƒå¤§æ—¥å¿—åˆ—è¡¨ï¼Œæ¯”å¦‚ 1000ä»¥ä¸Šï¼›å‚æ•° slowlog-log-slower-thanï¼Œé»˜è®¤è¶…è¿‡ 10ms å°±åˆ¤æ–­ä¸ºæ…¢æŸ¥è¯¢ï¼Œå¦‚æœæ¯æ¡å‘½ä»¤æ‰§è¡Œæ—¶é—´åœ¨ 1ms ä»¥ä¸Šï¼Œåˆ™ 1s çš„å¹¶å‘é‡ä¸è¶³ 1000ï¼Œæ‰€ä»¥å¯¹äºé«˜ OPS åœºæ™¯è®¾ç½®ä¸º 1msã€‚ æ…¢æŸ¥è¯¢åªè®°å½•å‘½ä»¤æ‰§è¡Œæ—¶é—´ï¼Œä¸åŒ…æ‹¬å‘½ä»¤æ’é˜Ÿå’Œç½‘ç»œä¼ è¾“æ—¶é—´ã€‚ æ…¢æŸ¥è¯¢æ—¥å¿—åªæ˜¯ä¸€ä¸ªå…ˆè¿›å…ˆå‡ºçš„é˜Ÿåˆ—ï¼Œå¦‚æœæŸ¥è¯¢è¾ƒå¤šï¼Œå¯èƒ½ä¼šä¸¢å¤±æ—¥å¿—æ•°æ®ï¼Œå¯ä»¥åˆ©ç”¨ SLOWLOG GET å‘½ä»¤å°†æ—¥å¿—å­˜å…¥ mysql ä¸­ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å¼€æºå·¥å…· CacheCloudã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"2ã€Redis shell ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"1ã€redis-cli å‘½ä»¤ -x å‚æ•° echo \"world\" | redis-cli -x set hello # è®¾ç½®keyä¸º helloï¼Œ valueä¸º world -c å‚æ•° é›†ç¾¤å‚æ•°ï¼Œé˜²æ­¢ moved å’Œ asked å¼‚å¸¸ã€‚ â€“rdb å‚æ•° è¯·æ±‚ Redis å®ä¾‹ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œä¿å­˜åœ¨æœ¬åœ°ã€‚ â€“bigkeys å‚æ•° é€‰å‡ºå¤§ keyï¼Œè¿™äº› key å¯èƒ½æ˜¯ç³»ç»Ÿç“¶é¢ˆã€‚ â€“eval å‚æ•° è¿è¡Œ lua è„šæœ¬ã€‚ latency å‚æ•° â€“latency: å®¢æˆ·ç«¯ä¸ä¸»æœºå»¶è¿Ÿ ã€‚ â€“latency-history: åˆ†æ—¶æ®µå±•ç¤ºå»¶è¿Ÿï¼Œç”¨ -i å‚æ•°æ¥æŒ‡å®šï¼Œé»˜è®¤ä¸º 15sã€‚ â€“latency-dist: ç»Ÿè®¡å›¾è¡¨å½¢å¼å±•ç¤ºå»¶è¿Ÿã€‚ â€“stat å‚æ•° å®æ—¶è·å– Redis é‡è¦ç»Ÿè®¡ä¿¡æ¯ï¼Œä¿¡æ¯æ¯” info å‘½ä»¤å°‘ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"2ã€redis-server å‘½ä»¤ â€“test-memory å‚æ•° redis-server --test-memory 1024 # æ£€æµ‹æ˜¯å¦å¯ä»¥ç»™ Redis åˆ†é… 1G å†…å­˜ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:2:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"3ã€redis-benchmark å‘½ä»¤ ç”¨æ¥åšåŸºå‡†æ€§èƒ½æµ‹è¯•ã€‚ redis-benchmark -c 100 -n 20000 -q -r 10000 -t get,set --csv # -c å®¢æˆ·ç«¯å¹¶å‘æ•° # -n å®¢æˆ·ç«¯è¯·æ±‚æ€»æ•° # -q ä»…ä»…æ˜¾ç¤º requests per second ä¿¡æ¯ # -r éšæœºé”®çš„èŒƒå›´ï¼ˆ0-9999ï¼‰ï¼Œä¸æ˜¯ä¸ªæ•° # -t æŒ‡å®šå‘½ä»¤ # --csv ç»“æœæŒ‰ç…§ csv æ ¼å¼è¾“å‡º ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:2:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"3ã€Pipeline ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"1ã€pipeline æ¦‚å¿µ redis æ‰§è¡Œä¸€æ¡å‘½ä»¤å¯ä»¥åˆ†ä¸ºå››ä¸ªè¿‡ç¨‹ï¼š å‘é€å‘½ä»¤ å‘½ä»¤æ’é˜Ÿ æ‰§è¡Œå‘½ä»¤ è¿”å›ç»“æœ å…¶ä¸­ 1. å’Œ 4. ç§°ä¸º RTT (å¾€è¿”æ—¶é—´)ã€‚ pipeline å¯ä»¥å°†ä¸€ç»„ redis å‘½ä»¤é€šè¿‡ä¸€æ¬¡ RTT å‘ç»™ Redisï¼Œå†æŒ‰ç…§æ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ redis-cli è„šæœ¬çš„ â€“pipe é€‰é¡¹å°±æ˜¯ä½¿ç”¨ pipeline æœºåˆ¶ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:3:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"2ã€æ€§èƒ½æµ‹è¯• pipeline æ‰§è¡Œé€Ÿåº¦ä¸€èˆ¬æ¯”é€æ¡æ‰§è¡Œå¿«ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ç½‘è·¯å»¶æ—¶è¶Šå¤§ï¼Œæ•ˆæœè¶Šæ˜æ˜¾ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:3:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"3ã€åŸç”Ÿæ‰¹é‡å’Œ pipeline åŸç”Ÿæ‰¹é‡å‘½ä»¤æ˜¯åŸå­çš„ï¼Œpipeline ä¸æ˜¯åŸå­çš„ï¼ˆä¸­é—´å¯ä»¥æ‰§è¡Œå…¶ä»–å‘½ä»¤ï¼‰ã€‚ åŸç”Ÿæ‰¹é‡å‘½ä»¤æ˜¯ä¸€ä¸ªå‘½ä»¤å¯¹åº”å¤šä¸ª key, pipeline æ”¯æŒå¤šä¸ªå‘½ä»¤ã€‚ åŸç”Ÿæ‰¹é›¶å‘½ä»¤æ˜¯ Redis æœåŠ¡ç«¯å®ç°çš„ï¼Œpipeline æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å…±åŒå®ç°çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:3:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"4ã€æœ€ä½³å®è·µ pipeline å°è£…çš„æ•°æ®ä¸èƒ½è¿‡å¤šï¼Œå³å¤§æ•°æ®å¯ä»¥æ‹†åˆ†ä¸ºæ‰¹é‡çš„å° pipeline å‘½ä»¤ã€‚ pipeline åªèƒ½æ“ä½œä¸€ä¸ª Redis å®ä¾‹ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:3:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"4ã€äº‹åŠ¡ä¸Lua ä¸ºäº†ä¿è¯å¤šä¸ªå‘½ä»¤ç»„åˆçš„åŸå­æ€§ï¼ŒRedis æä¾›äº†ç®€å•äº‹åŠ¡åŠŸèƒ½å’Œ lua è„šæœ¬ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"1ã€äº‹åŠ¡ MULTI # å¼€å¯äº‹åŠ¡ set a 1 # æ‰§è¡Œå‘½ä»¤ï¼Œå®é™…ä¸ŠæŠŠå‘½ä»¤æ”¾åˆ°é˜Ÿåˆ—ä¸­ set b 1 # æ‰§è¡Œå‘½ä»¤ï¼Œå®é™…ä¸ŠæŠŠå‘½ä»¤æ”¾åˆ°é˜Ÿåˆ—ä¸­ EXEC # çœŸæ­£çš„æ‰§è¡Œå‘½ä»¤ å‘½ä»¤é”™è¯¯ï¼Œä¼šå¯¼è‡´äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œæ¯”å¦‚ set a 1 å†™æˆäº† sett a 1ã€‚ è¿è¡Œæ—¶é”™è¯¯ï¼Œredis ä¸æ”¯æŒå›æ»šï¼Œæ¯”å¦‚ sadd a 1 å†™æˆäº† zadd a 1 bï¼Œå‡è®¾ a è¿™ä¸ª key å·²ç»å­˜åœ¨ï¼Œå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ äº‹åŠ¡ç®€å•ä¸»è¦åŸå› å°±æ˜¯ï¼Œredis ä¸æ”¯æŒå›æ»šã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:4:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"2ã€Lua åœ¨ Redis ä¸­ä½¿ç”¨ Luaï¼Œæœ‰ä¸¤ç§æ–¹å¼ eval å’Œ evalshaã€‚ eval EVAL script numkeys key [key ...] arg [arg ...] eval 'return \"hello \" .. KEYS[1] .. ARGV[1]' 1 world redis # ä¾‹å­ # è¾“å‡º \"hello worldredis\" å¦‚æœ Lua è„šæœ¬è¾ƒé•¿ï¼Œå¯ä»¥ä½¿ç”¨ redis-cli â€“eval é€‰é¡¹æ¥æ‰§è¡Œã€‚ evalsha ä½¿ç”¨ eval å‘½ä»¤ï¼Œæ¯æ¬¡éƒ½éœ€è¦å°†è„šæœ¬å‘é€åˆ°æœåŠ¡ç«¯ï¼Œä½¿ç”¨ evalsha å‘½ä»¤å°±é¿å…äº†å¼€é”€ã€‚ redis-cli script load hello.lua # åŠ è½½ lua è„šæœ¬åˆ°æœåŠ¡ç«¯ï¼Œä¼šè¿”å› sha1 å€¼ã€‚ EVALSHA sha1 numkeys key [key ...] arg [arg ...] # æ‰§è¡Œ lua è„šæœ¬ï¼Œå‚æ•° sha1 å°±æ˜¯è¿”å›çš„ sha1 å€¼ï¼Œå…¶ä»–å‚æ•°åŒ eval å‘½ä»¤ã€‚ lua ä¸­ä½¿ç”¨ redis API redis.call(\"set\", \"a\" , 1) redis.call(\"get\", \"a\" ) ä¹Ÿå¯ä»¥ä½¿ç”¨ redis.pcall å‘½ä»¤ï¼Œä¸¤è€…å·®åˆ«åœ¨äº pcall å‘½ä»¤ä¼šå¿½ç•¥é”™è¯¯ç»§ç»­æ‰§è¡Œï¼Œcall é‡åˆ°é”™è¯¯åœæ­¢ã€‚ lua è„šæœ¬æ‰§è¡Œæ˜¯åŸå­æ€§çš„ï¼Œä¸­é—´ä¸ä¼šæ’å…¥åˆ«çš„å‘½ä»¤ã€‚ ç®¡ç† lua è„šæœ¬å‘½ä»¤ SCRIPT LOAD [script] # åŠ è½½ lua è„šæœ¬ï¼Œè¿”å› sha1 å€¼ SCRIPT EXISTS sha1 [sha1] # æ˜¯å¦å­˜åœ¨ sha1 çš„è„šæœ¬ SCRIPT FLUSH # æ¸…ç©º lua è„šæœ¬ SCRIPT KILL # æ€æ‰ lua è„šæœ¬ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:4:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"5ã€Bitmaps ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:5:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"1ã€æ•°æ®ç»“æ„æ¨¡å‹ Bitmaps ä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šå®ƒæ˜¯å­—ç¬¦ä¸²ï¼Œä½†å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œæ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨ 0 å’Œ1ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:5:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"2ã€å‘½ä»¤ è®¾ç½®å€¼ SETBIT key offset value # offset ä» 0 å¼€å§‹ è·å–å€¼ GETBIT key offset # ç»“æœåªæœ‰ 0 æˆ–è€… 1 BITCOUNT key [start end] # å¯¹[start, end]èŒƒå›´è·å–å€¼ä¸º 1 çš„ä¸ªæ•° Bitmaps é—´çš„è¿ç®— BITOP operation destkey key [key ...] # operation å¯ä»¥æ˜¯ and(äº¤é›†)ã€or(å¹¶é›†)ã€not(é)ã€xor(å¼‚æˆ–) è·å–ç¬¬ä¸€ä¸ªä¸º bit çš„ offset å€¼ BITPOS key bit [start] [end] # [start,end]èŒƒå›´ä¸­ç¬¬ä¸€ä¸ªå‡ºç° bit çš„ offset ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:5:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"3ã€åˆ†æ åˆ©ç”¨ Bitmaps æ¥ç»Ÿè®¡ç½‘ç«™è®¿é—®ç”¨æˆ·ï¼š SETBIT users:2020-03-22 1 1 # 2020-03-22 è¿™ä¸€å¤© 1 å·è®¿é—®äº†ã€‚ SETBIT users:2020-03-23 2 1 # 2020-03-23 è¿™ä¸€å¤© 2 å·è®¿é—®äº†ã€‚ BITCOUNT users:2020-03-23 # 2020-03-23 è¿™ä¸€å¤© è®¿é—®ç”¨æˆ·é‡ BITOP and users:2020-03-22_23 users:2020-03-23 users:2020-03-22 # ä¸¤å¤©éƒ½è®¿é—®çš„ç”¨æˆ·é‡ set å’Œ bitmaps å¯¹æ¯”ï¼š æ•°æ®ç±»å‹ æ¯ä¸ªç”¨æˆ· id å ç”¨ç©ºé—´ éœ€è¦å­˜å‚¨ç”¨æˆ·é‡ å…¨éƒ¨å†…å­˜é‡ set 64 ä½ 5 åƒä¸‡ 64 ä½ * 5 åƒä¸‡ = 400 MB bitmaps 1 ä½ 1 äº¿ 1 ä½ * 1 äº¿ = 12.5 MB ä»è¡¨æ ¼å¯ä»¥çœ‹å‡º bitmaps èŠ‚çœå†…å­˜ã€‚ ä½†å¦‚æœæ¯å¤©çš„æ´»è·ƒç”¨æˆ·å¾ˆå°‘ï¼Œset å¯èƒ½æ¯” bitmaps å¥½ï¼Œå› ä¸º set éœ€è¦å†…å­˜ 64 ä½ * 10 ä¸‡ = 800 KBï¼Œè€Œ bitmap è¿˜æ˜¯éœ€è¦ 12.5 MB å†…å­˜ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:5:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"6ã€HyperLogLog HyperLoglog ä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼Œè€Œæ˜¯ä¸€ç§åŸºæ•°ç®—æ³•ï¼Œå¯ä»¥åˆ©ç”¨æå°çš„å†…å­˜ç©ºé—´å®Œæˆç‹¬ç«‹æ€»æ•°ç»Ÿè®¡ï¼Œæ•°æ®é›†å¯ä»¥ IDã€Emailã€IPã€‚ å‘½ä»¤ PFADD key element [element ...] # æ·»åŠ å…ƒç´  PFCOUNT key [key ...] # è®¡æ•° PFMERGE destkey sourcekey [sourcekey ...] # merge æ³¨æ„ï¼š åªæ˜¯è®¡ç®—ç‹¬ç«‹æ€»æ•°ï¼Œä¸éœ€è¦è·å–å•æ¡æ•°æ® HyperLogLog æœ‰è¯¯å·® ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:6:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"7ã€å‘å¸ƒè®¢é˜… Redis æä¾›å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„æ¶ˆæ¯æœºåˆ¶ã€‚ å‘½ä»¤ PUBLISH channel message # å‘æŒ‡å®šçš„ channel å‘å¸ƒæ¶ˆæ¯ SUBSCRIBE channel [channel ...] # å‘æŒ‡å®šçš„ channel è®¢é˜…æ¶ˆæ¯ PSUBSCRIBE pattern [pattern ...] # æ¨¡å¼è®¢é˜…æ¶ˆæ¯ UNSUBSCRIBE [channel [channel ...]] # å–æ¶ˆè®¢é˜… PUNSUBSCRIBE [pattern [pattern ...]] # æ¨¡å¼å–æ¶ˆè®¢é˜… PUBSUB subcommand [argument [argument ...]] # æŸ¥çœ‹è®¢é˜… # PUBSUB channels [pattern] # é¢‘é“ # PUBSUB numsub [channel ...] # channel è®¢é˜…æ•° # PUBSUB numpat # æ¨¡å¼è®¢é˜…æ•° æ³¨æ„ï¼š Redis æä¾›çš„æ¶ˆæ¯æœºåˆ¶ï¼Œæ— æ³•å®ç°æ¶ˆæ¯å †ç§¯ã€å›æº¯ æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç‚¹ï¼šå¼‚æ­¥ã€è§£è€¦ã€å‰Šå³°ï¼Œç¼ºç‚¹ï¼šå¤æ‚åº¦æé«˜ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:7:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"8ã€GEO Redis æä¾›äº† GEOï¼ˆåœ°å€ä½ç½®ï¼‰åŠŸèƒ½ï¼Œæ”¯æŒå­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯ã€‚ æ·»åŠ ä½ç½®ä¿¡æ¯ GEOADD key longitude latitude member [longitude latitude member ...] è·å–ä½ç½®ä¿¡æ¯ GEOPOS key member [member ...] è·å–ä¸¤ä¸ªåœ°ç†ä½ç½®çš„è·ç¦» GEODIST key member1 member2 [unit] # unit: m(ç±³)ï¼›ï¼ˆkmï¼‰å…¬é‡Œï¼›ï¼ˆmiï¼‰è‹±é‡Œï¼›ï¼ˆflï¼‰å°º è·å–æŒ‡å®šèŒƒå›´å†…çš„åœ°ç†ä½ç½®é›†åˆ GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key] # æ ¹æ®å…·ä½“çš„ç»çº¬åº¦æ¥è·å– GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key] # æ ¹æ®æŸä¸€ä¸ªæˆå‘˜æ¥è·å– è·å– geohash GEOHASH key member [member ...] # Redis å°†äºŒç»´çš„ç»çº¬åº¦è½¬åŒ–ä¸ºä¸€ç»´å­—ç¬¦ä¸² åˆ é™¤åœ°ç†ä½ç½® ZREM key member [member ...] # Redis æ²¡æœ‰æä¾›ä¸“é—¨çš„åˆ é™¤å‘½ä»¤ï¼Œå¯ä»¥å€ŸåŠ© ZREM å‘½ä»¤æ¥åˆ é™¤ # GEO çš„æ•°æ®ç±»å‹ä¸º zset ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/:8:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/03/"},{"categories":null,"content":"1ã€å®¢æˆ·ç«¯é€šä¿¡åè®® Redis åˆ¶å®šäº† RESPï¼ˆredisåºåˆ—åŒ–åè®®ï¼‰å®ç°å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„æ­£å¸¸äº¤äº’ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"1ã€å‘é€å‘½ä»¤æ ¼å¼ CRLF ä¸º â€˜\\r\\nâ€™ *\u003cå‚æ•°æ•°é‡\u003e CRLF $\u003cå‚æ•° 1 çš„å­—èŠ‚æ•°é‡\u003e CRLF \u003cå‚æ•° 1\u003e CRLF ... $\u003cå‚æ•° N çš„å­—èŠ‚æ•°é‡\u003e CRLF \u003cå‚æ•° N\u003e CRLF ä»¥ set hello world å‘½ä»¤ä¸ºä¾‹ï¼š *3 $3 set $5 hello $5 world ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"2ã€è¿”å›ç»“æœæ ¼å¼ çŠ¶æ€å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º â€œ+\"ã€‚å¦‚ set é”™è¯¯å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º â€œ-\"ã€‚å¦‚ é”™è¯¯å‘½ä»¤ æ•´æ•°å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º â€œ:\"ã€‚å¦‚ incr å­—ç¬¦ä¸²å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º â€œ$\"ã€‚å¦‚ get å¤šæ¡å­—ç¬¦ä¸²å›å¤ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º â€œ*\"ã€‚å¦‚ mget ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"2ã€Java å®¢æˆ·ç«¯ Jedis jedis ç”¨çš„å¾ˆå°‘äº†ï¼Œè¯·å‚è€ƒ lettuceã€redisson ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"3ã€Python å®¢æˆ·ç«¯ redis-py ç•¥ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"4ã€å®¢æˆ·ç«¯ç®¡ç† ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"1ã€å®¢æˆ·ç«¯ API 1ã€client list ä¸ Redis æœåŠ¡ç«¯ç›¸è¿çš„æ‰€æœ‰å®¢æˆ·ç«¯è¿æ¥ä¿¡æ¯ è¯´æ˜ï¼š id: å®¢æˆ·ç«¯è¿æ¥å”¯ä¸€æ ‡è¯†ï¼Œé€’å¢ï¼Œä½† Redis é‡å¯åé‡ç½®ä¸º 0ã€‚ addr: å®¢æˆ·ç«¯ IP å’Œ PORTã€‚ fd: socket æ–‡ä»¶æè¿°ç¬¦ï¼Œä¸ lsof å‘½ä»¤ä¸­ fd æ˜¯åŒä¸€ä¸ªã€‚ name: å®¢æˆ·ç«¯åå­—ï¼Œä¸ client setName å’Œ client getName æœ‰å…³ Redis ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…äº†è¾“å…¥ç¼“å†²åŒºï¼Œå®ƒçš„ä½œç”¨å°†å®¢æˆ·ç«¯å‘é€çš„å‘½ä»¤ä¸´æ—¶ä¿å­˜ï¼ŒRedis ä¼šä»è¾“å…¥ç¼“å†²åŒºä¸­æ‹‰å–å‘½ä»¤å¹¶æ‰§è¡Œã€‚ä¸å— maxmemory å‚æ•°å½±å“ã€‚ qbuf: å®¢æˆ·ç«¯çš„è¾“å…¥ç¼“å†²åŒºæ€»å®¹é‡ qbuf-free: å®¢æˆ·ç«¯çš„è¾“å…¥ç¼“å†²åŒºå‰©ä½™å®¹é‡ è¾“å…¥ç¼“å†²åŒºè¿‡å¤§çš„åŸå› ï¼š Redis å¤„ç†é€Ÿåº¦è·Ÿä¸ä¸Šè¾“å…¥ç¼“å†²åŒºçš„è¾“å…¥é€Ÿåº¦ï¼Œå¯èƒ½å­˜åœ¨ bigKeyã€‚ Redis å‘ç”Ÿäº†é˜»å¡ã€‚ Redis ä¸ºæ¯ä¸ªå®¢æˆ·ç«¯åˆ†é…äº†è¾“å‡ºç¼“å†²åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¿å­˜å‘½ä»¤æ‰§è¡Œçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ã€‚é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ client-output-buffer-limit \u003cclass\u003e \u003chard limit\u003e \u003csoft limit\u003e \u003csoft seconds\u003e æ¥é…ç½®ã€‚ä¸å— maxmemory å‚æ•°å½±å“ã€‚ obl: å›ºå®šè¾“å‡ºç¼“å†²åŒºå¤§å° oll: åŠ¨æ€è¾“å‡ºç¼“å†²åŒºå¤§å°ï¼Œå½“å›ºå®šç¼“å†²åŒºæ»¡äº†ï¼Œå°±ä¼šä½¿ç”¨åŠ¨æ€ç¼“å†²åŒº omem: è¾“å‡ºç¼“å†²åŒºæ€»è®¡çš„å­—èŠ‚æ•° å…¶ä»–ä¿¡æ¯ï¼š age: å·²è¿æ¥çš„æ—¶é—´ idle: æœ€è¿‘ä¸€æ¬¡ç©ºé—²æ—¶é—´ flag: S è¡¨ç¤º slave å®¢æˆ·ç«¯ï¼ŒN è¡¨ç¤ºæ™®é€šå®¢æˆ·ç«¯ï¼ŒO è¡¨ç¤ºæ‰§è¡Œ monitor å‘½ä»¤çš„å®¢æˆ·ç«¯ db: æ•°æ®åº“ç´¢å¼•ä¸‹æ ‡ sub/psub: å½“å‰å®¢æˆ·ç«¯è®¢é˜…çš„é¢‘é“ multi: å½“å‰äº‹åŠ¡å·²æ‰§è¡Œå‘½ä»¤ä¸ªæ•° å®¢æˆ·ç«¯é™åˆ¶ maxclients (é»˜è®¤ä¸º 1000) å’Œ timeoutï¼Œé€šè¿‡ config set maxclients 10000 å‘½ä»¤å’Œ config set timeout 30 å‘½ä»¤æ¥è®¾ç½®ã€‚ ç›‘æ§ç¼“å†²åŒºæ–¹æ³•ï¼š å®šæœŸæ‰§è¡Œ client list å‘½ä»¤ï¼Œæ”¶é›† qbuf å’Œ qbuf-freeã€‚ æ‰§è¡Œ info clients å‘½ä»¤ï¼Œæ‰¾åˆ°æœ€å¤§çš„è¾“å…¥ç¼“å†²åŒº client_recent_max_input_buffer 2ã€client getName / setName ç»™å½“å‰å®¢æˆ·ç«¯è®¾ç½®åå­— 3ã€client kill æ€æ‰æŒ‡å®š ip å’Œ port çš„å®¢æˆ·ç«¯ client kill ip:port 4ã€client pause é˜»å¡å®¢æˆ·ç«¯ timeout æ¯«ç§’ client pause timeout(æ¯«ç§’) 5ã€monitor ç›‘æ§ Redis æ­£åœ¨æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¦‚æœå¹¶å‘é‡è¿‡å¤§ï¼Œä¼šé€ æˆè¾“å‡ºç¼“å†²åŒºæš´æ¶¨ã€‚ monitor ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:4:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"2ã€å®¢æˆ·ç«¯ç›¸å…³é…ç½® å®¢æˆ·ç«¯çš„é…ç½®å¦‚ä¸‹ï¼š timeoutï¼š ç©ºé—²è¿æ¥è¶…æ—¶æ—¶é—´ tcp-keepaliveï¼š æ£€æŸ¥æ­»çš„è¿æ¥ tcp-backlog: TCP è¿æ¥è¿‡åï¼Œä¼šå°†æ¥å—çš„è¿æ¥æ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œtcp-backlog å°±æ˜¯è¿™ä¸ªé˜Ÿåˆ—çš„å¤§å°ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:4:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"3ã€å®¢æˆ·ç«¯ç»Ÿè®¡ä¿¡æ¯ 1ã€info clients è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š 2ã€info stats è¿è¡Œå‘½ä»¤å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯ç›¸å…³çš„æŒ‡æ ‡ total_connections_receivedï¼š æ€»å…±æ¥å—çš„è¿æ¥æ•° rejected_connectionsï¼š æ‹’ç»çš„è¿æ¥æ•° ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:4:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"5ã€å®¢æˆ·ç«¯å¸¸è§å¼‚å¸¸ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"1ã€æ— æ³•ä»è¿æ¥æ± ä¸­è·å–è¿æ¥ å¯èƒ½çš„åŸå› ï¼š è¿æ¥æ± è®¾ç½®è¿‡å°ã€‚ æ²¡æœ‰æ­£ç¡®ä½¿ç”¨è¿æ¥æ± ï¼Œç”¨è¿‡åæ²¡æœ‰é‡Šæ”¾ã€‚ å…·ä½“è¿˜æ˜¯è¦çœ‹é€‰ç”¨çš„å®¢æˆ·ç«¯ï¼Œæ²¡æœ‰è¿æ¥äº†æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿï¼ˆæ˜¯ç­‰å¾…è¿˜æ˜¯ç›´æ¥æ‹’æ¥æŠ›å‡ºå¼‚å¸¸ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"2ã€å®¢æˆ·ç«¯è¯»å†™è¶…æ—¶ å¯èƒ½çš„åŸå› ï¼š è¯»å†™è¶…æ—¶æ—¶é—´è®¾ç½®çŸ­ã€‚ å‘½ä»¤æœ¬èº«å°±å¾ˆæ…¢ã€‚ ç½‘ç»œä¸æ­£å¸¸ã€‚ Redis é˜»å¡ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"3ã€å®¢æˆ·ç«¯è¿æ¥è¶…æ—¶ å¯èƒ½çš„åŸå› ï¼š è¿æ¥è¶…æ—¶æ—¶é—´è®¾ç½®çŸ­ã€‚ ç½‘ç»œä¸æ­£å¸¸ã€‚ Redis å‘ç”Ÿé˜»å¡ï¼Œå¯¼è‡´ tcp-backlog å·²æ»¡ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"4ã€å®¢æˆ·ç«¯ç¼“å†²åŒºå¼‚å¸¸ å¯èƒ½çš„åŸå› ï¼š è¾“å‡ºç¼“å†²åŒºæ»¡ï¼Œæ¯”å¦‚ç”¨ get å‘½ä»¤æ¥è·å–ä¸€ä¸ªbigKeyã€‚ é•¿æ—¶é—´ç©ºé—²è¿æ¥è¢«æœåŠ¡ç«¯ä¸»åŠ¨æ–­å¼€ã€‚ ä¸æ­£å¸¸çš„å¹¶å‘è¯»å†™ï¼ŒRedis å¯¹è±¡è¢«å¤šä¸ªçº¿ç¨‹å¹¶å‘æ“ä½œã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"5ã€Lua è„šæœ¬æ‰§è¡Œ å¯èƒ½çš„åŸå› ï¼š lua è„šæœ¬æ‰§è¡Œæ—¶é—´è¶…è¿‡å‚æ•° lua-time-limitã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"6ã€å®¢æˆ·ç«¯è¿æ¥æ•°è¿‡å¤§ å®¢æˆ·ç«¯è¿æ¥æ•°è¶…è¿‡ maxclientsï¼Œæ–°çš„è¿æ¥å°±ä¼šè¢«æ‹’ç»ã€‚ ä»ä¸¤ä¸ªæ–¹é¢æ¥è§£å†³ï¼š å®¢æˆ·ç«¯ï¼šé€šè¿‡ä¸‹çº¿éƒ¨åˆ†åº”ç”¨èŠ‚ç‚¹ï¼Œä½¿ Redis çš„è¿æ¥æ•°é™ä¸‹æ¥ï¼Œä»è€Œç»§ç»­æ‰¾å…¶æ ¹æœ¬åŸå› ï¼Œæˆ–è€…è°ƒæ•´ maxclients å‚æ•°ã€‚ æœåŠ¡ç«¯ï¼šå¦‚æœ Redis æ˜¯é«˜å¯ç”¨æ¨¡å¼ï¼Œå¯ä»¥æŠŠå½“å‰çš„èŠ‚ç‚¹æ•…éšœè½¬ç§»ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:5:6","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"6ã€å®¢æˆ·ç«¯æ¡ˆä¾‹åˆ†æ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:6:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"1ã€Redis å†…å­˜é™¡å¢ ç°è±¡ï¼š æœåŠ¡ç«¯ï¼šRedis ä¸»èŠ‚ç‚¹å†…å­˜é™¡å¢ï¼Œä»èŠ‚ç‚¹å†…å­˜æ— å˜åŒ–ã€‚ å®¢æˆ·ç«¯ï¼šäº§ç”Ÿ OOM å¼‚å¸¸ã€‚ å¯èƒ½çš„åŸå› ï¼š ç¡®å®æœ‰å¤§é‡çš„å†™å…¥ï¼Œé€šè¿‡æ‰§è¡Œå‘½ä»¤ dbsize æ¥è·å–ä¸»ä»èŠ‚ç‚¹çš„é”®ä¸ªæ•°ã€‚ æ’æŸ¥æ˜¯å¦ç”±å®¢æˆ·ç«¯ç¼“å†²åŒºåº”å¼•å‘çš„é—®é¢˜ï¼Œé€šè¿‡æ‰§è¡Œå‘½ä»¤ info clientsæ¥æŸ¥çœ‹ã€‚ å¤„ç†æ–¹æ³•ï¼š é€šè¿‡å‘½ä»¤ redis-cli info list | grep -v \"omemo=0\"ï¼Œ æ‰¾åˆ°éé›¶çš„å®¢æˆ·ç«¯è¿æ¥ï¼Œç„¶å kill æ‰ã€‚ å¯èƒ½å°±æ˜¯è¿è¡Œå‘½ä»¤ monitor é€ æˆçš„ï¼Œä¸€èˆ¬éƒ½å»ºè®®åœ¨ç”Ÿå‚ç¯å¢ƒä¸­ç¦ç”¨ monitorã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:6:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"2ã€å®¢æˆ·ç«¯å‘¨æœŸæ€§è¶…æ—¶ ç°è±¡ï¼š å®¢æˆ·ç«¯ï¼šå®¢æˆ·ç«¯å‘¨æœŸæ€§è¶…æ—¶ æœåŠ¡ç«¯ï¼šæ— æ˜æ˜¾ç°è±¡ï¼Œåªæ˜¯ä¸€äº›æ…¢æŸ¥è¯¢ã€‚ å¯èƒ½çš„åŸå› ï¼š ç½‘ç»œä¸æ­£å¸¸ã€‚ æ‰§è¡Œå‘½ä»¤é€ æˆæ…¢æŸ¥è¯¢å¯¼è‡´çš„å‘¨æœŸæ€§è¶…æ—¶ã€‚ å¤„ç†æ–¹æ³•ï¼š è¿ç»´å±‚é¢ï¼Œç›‘æ§æ…¢æŸ¥è¯¢ï¼Œä¸€æ—¦è¶…å¤šé˜ˆå€¼ï¼Œå°±å‘å‡ºæŠ¥è­¦ã€‚ é¿å…ä¸æ­£ç¡®ä½¿ç”¨å‘½ä»¤ï¼Œå¦‚ KEYS *ã€HGETALL key ç­‰ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/:6:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/04/"},{"categories":null,"content":"1ã€RDB ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"1ã€è§¦å‘æœºåˆ¶ æ‰‹åŠ¨è§¦å‘ï¼Œåˆ†åˆ«æœ‰ save å’Œ bgsave ä¸¤ä¸ªå‘½ä»¤ã€‚ saveï¼š ä¼šé˜»å¡å½“å‰ Redis æœåŠ¡å™¨ï¼Œç›´åˆ° RDB è¿‡ç¨‹å®Œæˆä¸ºæ­¢ï¼Œä¸å»ºè®®ä½¿ç”¨ã€‚ bgsaveï¼š Redis è¿›ç¨‹ä¼š fork å‡ºå­è¿›ç¨‹ï¼Œå­è¿›ç¨‹è¿›è¡Œ RDB æŒä¹…åŒ–ï¼Œé˜»å¡åªä¼šå‘ç”Ÿåœ¨ fork é˜¶æ®µã€‚ è‡ªåŠ¨è§¦å‘çš„åœºæ™¯ï¼š save m n é…ç½®ï¼Œè¡¨ç¤ºåœ¨ m ç§’ä¸­å­˜åœ¨ n æ¬¡æ•°æ®æ”¹å˜ï¼Œæ‰ä¼šè§¦å‘ bgsaveã€‚ ä»èŠ‚ç‚¹å…¨é‡å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œä¸»èŠ‚ç‚¹ä¼šæ‰§è¡Œ bgsave ç”Ÿæˆ RDB æ–‡ä»¶ï¼Œå‘é€å­èŠ‚ç‚¹ã€‚ é»˜è®¤å…³é—­æƒ…å†µä¸‹ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯ AOFï¼Œä¹Ÿä¼šæ‰§è¡Œ bgsaveã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"2ã€è§¦å‘æµç¨‹ bgsave å‘½ä»¤çš„è¿è¡Œæµç¨‹å¦‚ä¸‹å›¾ï¼š è¯´æ˜ï¼› æ‰§è¡Œ bgsave å‘½ä»¤ï¼Œ åˆ¤æ–­æ˜¯å¦æœ‰ AOF/RDB è¿›ç¨‹ã€‚ æ‰§è¡Œ info stats å‘½ä»¤ï¼Œé€‰é¡¹ latest_fork_usec è¡¨ç¤ºæœ€åä¸€æ¬¡ fork ä½¿ç”¨çš„ç§’æ•°ã€‚ bgsave å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œä¼šå‡ºç° Background saving started æç¤ºã€‚ å­è¿›ç¨‹åˆ›å»º RDB æ–‡ä»¶æˆåŠŸåï¼Œå¯¹åŸæœ‰çš„æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢, æ‰§è¡Œ lastsave å‘½ä»¤è·å–æœ€åä¸€æ¬¡ç”Ÿæˆ RDB æ–‡ä»¶çš„æ—¶é—´ï¼Œå¯¹åº” info Persistence å‘½ä»¤ä¸­çš„é€‰é¡¹ rdb_last_save_timeã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"3ã€RDB æ–‡ä»¶çš„å¤„ç† RDB æ–‡ä»¶é€šè¿‡é…ç½®æ–‡ä»¶å‚æ•° dbfilename å’Œ diræ¥é…ç½®ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤ config set dir {dir} å’Œ config set dbfilename {dbfilename} æ¥åŠ¨æ€é…ç½®ã€‚ RDB æ–‡ä»¶é»˜è®¤é‡‡ç”¨ LZF å‹ç¼©ï¼Œé€šå¸¸å»ºè®®å¼€å¯ï¼Œå› ä¸ºä¸»ä»å¤åˆ¶æ—¶ï¼Œéœ€è¦å‘é€ RDB æ–‡ä»¶åˆ°ä»èŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¸¦å®½ã€‚ RDB é»˜è®¤ä¹Ÿå¼€å¯æ ¡éªŒï¼Œå¯ä»¥é€šè¿‡è„šæœ¬ redis-check-rdb æ¥æ ¡éªŒç”Ÿæˆç›¸åº”çš„é”™è¯¯æŠ¥å‘Šã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"4ã€RDB çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š RDB éå¸¸é€‚åˆå¤‡ä»½ã€å…¨é‡å¤åˆ¶ç­‰åœºæ™¯ï¼Œæ¯”å¦‚æ¯ 6 å°æ—¶å®šæ—¶æ‰§è¡Œ bgsaveï¼Œå¯ç”¨äºç¾éš¾æ¢å¤ã€‚ RDB çš„æ¢å¤æ•°æ®è¿œè¿œå¿«äº AOF æ–¹å¼ã€‚ ç¼ºç‚¹ï¼š RDB æ— æ³•åšåˆ°ç§’çº§æŒä¹…åŒ–ï¼Œfork åˆ›å»ºå­è¿›ç¨‹ä¹Ÿå±äºé‡é‡çº§æ“ä½œã€‚ RDB ç”¨ç‰¹å®šçš„äºŒè¿›åˆ¶æ ¼å¼ä¿å­˜ï¼Œå¯èƒ½æœ‰ç‰ˆæœ¬ä¸å…¼å®¹é—®é¢˜ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:1:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"2ã€AOF ä»¥ç‹¬ç«‹çš„æ—¥å¿—è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œé‡å¯æ—¶å†é‡æ–°æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚ AOF è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"1ã€AOF å·¥ä½œæµç¨‹ å¼€å¯ AOF éœ€è¦è®¾ç½®å‚æ•° appendonly yesã€‚ é€šè¿‡å‚æ•° appendfilename æ¥è®¾ç½®æ–‡ä»¶åã€‚ å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾ï¼š è¯´æ˜ï¼š æ‰€æœ‰çš„å†™å…¥å‘½ä»¤ä¼šè¿½åŠ åˆ° aof_buf (ç¼“å†²åŒº)ä¸­ã€‚ AOF ç¼“å†²åŒºä¼šæ ¹æ®åŒæ­¥ç­–ç•¥ï¼ˆå‚æ•°é»˜è®¤è®¾ç½® appendfsync everysecï¼‰æ¥åšåŒæ­¥æ“ä½œã€‚ ä¼šå®šæœŸå¯¹ AOF æ–‡ä»¶è¿›è¡Œ rewriteï¼Œè¾¾åˆ°å‹ç¼©çš„ç›®çš„ï¼Œå› ä¸ºå¯èƒ½æœ‰äº› key è¿‡æœŸäº†ã€‚ æœºå™¨é‡å¯æ—¶ï¼Œå¦‚æœå¼€å¯äº† AOFï¼Œåˆ™ä½¿ç”¨ AOF åŠ è½½æ•°æ®ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"2ã€å‘½ä»¤å†™å…¥ AOF é‡‡ç”¨æ–‡æœ¬åè®®æ ¼å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ AOF æ–‡ä»¶ä¸­å­˜å‚¨å°±æ˜¯å†™å…¥çš„å‘½ä»¤ï¼Œè¿™æ ·å…·æœ‰é˜…è¯»æ€§ã€ä¾¿äºä¿®æ”¹ã€‚ AOF æŠŠå‘½ä»¤å…ˆå†™å…¥ aof_buf ä¸­ï¼Œæ ¹æ®ä¸åŒçš„åŒæ­¥ç­–ç•¥å¯ä»¥åœ¨æ€§èƒ½å’Œå®‰å…¨ä¸Šåšå‡ºå¹³è¡¡ï¼Œæ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå°±è®¾ç½®ä¸º everysecã€‚ ä¸‰ç§ç­–ç•¥ï¼› no: donâ€™t fsync, just let the OS flush the data when it wants. Faster. always: fsync after every write to the append only log. Slow, Safest. everysec: fsync only one time every second. Compromise. ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:2:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"3ã€é‡å†™æœºåˆ¶ AOF æ–‡ä»¶å¯ä»¥å˜å°çš„åŸå› ï¼š è¶…æ—¶çš„æ•°æ®ï¼Œå¯ä»¥ä¸ç”¨å†å†™å…¥æ–‡ä»¶ä¸­ã€‚ key è¿‡æœŸäº†ï¼Œå¯èƒ½å«æœ‰æ— æ•ˆå‘½ä»¤ï¼Œå¦‚ del key1ã€‚ å¤šä¸ªå‘½ä»¤å¯ä»¥åˆå¹¶æˆä¸€ä¸ªï¼Œå¦‚ lpush list a å’Œ lpush list b å¯ä»¥åˆå¹¶ä¸º lpush list a bã€‚ è§¦å‘ AOF é‡å†™æ–¹å¼ï¼š æ‰‹åŠ¨æ‰§è¡Œå‘½ä»¤ bgrewriteaof è‡ªåŠ¨è§¦å‘ï¼Œæ ¹æ®é…ç½®å‚æ•° auto-aof-rewrite-percentage 100 å’Œ auto-aof-rewrite-min-size 64mbã€‚ å‚æ•°è¯´æ˜ï¼š This is how it works: Redis remembers the size of the AOF file after the latest rewrite (if no rewrite has happened since the restart, the size of the AOF at startup is used). This base size is compared to the current size. If the current size is bigger than the specified percentage, the rewrite is triggered. Also you need to specify a minimal size for the AOF file to be rewritten, this is useful to avoid rewriting the AOF file even if the percentage increase is reached but it is still pretty small è‡ªåŠ¨è§¦å‘æ—¶æœº: aof_current_size \u003e auto-aof-rewrite-min-size \u0026\u0026 (aof_current_size - aof_base_size) / aof_base_size \u003e auto-aof-rewrite-percentage AOF é‡å†™æµç¨‹å›¾å¦‚ä¸‹ï¼š è¯´æ˜ï¼š æ‰§è¡Œ AOF é‡å†™è¯·æ±‚ï¼Œå¦‚æœæœ‰å­è¿›ç¨‹åœ¨æ‰§è¡Œ bgsave åˆ™ç­‰å¾…å®Œæˆä¹‹åå†æ“ä½œã€‚ fork å­è¿›ç¨‹è¿›è¡Œé‡å†™ï¼Œçˆ¶è¿›ç¨‹æ¥å—è¯·æ±‚ï¼Œä¿®æ”¹å‘½ä»¤å†™å…¥ aof_buf ä¸­æ ¹æ®ç­–ç•¥åŒæ­¥åˆ°ç£ç›˜ã€‚ fork æ“ä½œè¿ç”¨å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œæ‰€ä»¥å­è¿›ç¨‹åªèƒ½å…±äº«æ“ä½œ fork æ—¶çš„å†…å­˜ï¼Œè¿™æ—¶çˆ¶è¿›ç¨‹å¯èƒ½è¿˜åœ¨å“åº”è¯·æ±‚ï¼Œæ‰€ä»¥æŠŠé‡å†™åçš„æ–°å‘½ä»¤æ”¾å…¥ aof_rewrite_buf ç¼“å†²åŒºä¸­ã€‚ æŠŠ aof_rewrite_buf ä¸­æ•°æ®å†™å…¥æ–°çš„ AOF æ–‡ä»¶ä¸­ï¼Œæ ¹æ®å¼€å¯å‚æ•° aof-rewrite-incremental-fsync yesï¼Œæ¯ 32MB åŒæ­¥åˆ°ç£ç›˜ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:2:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"4ã€é‡å¯åŠ è½½ é‡å¯åŠ è½½å›¾ï¼š ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:2:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"5ã€æ–‡ä»¶æ ¡éªŒ åŠ è½½æŸåçš„ AOF æ–‡ä»¶ä¼šæ‹’ç»å¯åŠ¨ï¼Œå¯ä»¥å…ˆå¤‡ä»½æ–‡ä»¶ï¼Œç„¶åå†æ‰§è¡Œå‘½ä»¤ redis-check-aof [--fix] \u003cfile.aof\u003e æ¥è¿›è¡Œä¿®å¤ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:2:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"3ã€é—®é¢˜å®šä½ä¸ä¼˜åŒ– ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"1ã€fork æ“ä½œ Redis åš RDB æˆ–è€… AOF é‡å†™æ—¶ï¼Œå¿…ä¸å¯å°‘çš„æ“ä½œå°±æ˜¯ forkã€‚fork ç”¨çš„å†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œä¼šå¤åˆ¶çˆ¶è¿›ç¨‹çš„å†…å­˜é¡µè¡¨ã€‚ æ”¹å–„ forkæ“ä½œçš„è€—æ—¶ï¼š ä¼˜å…ˆä½¿ç”¨ç‰©ç†æœºæˆ–è€…é«˜æ•ˆæ”¯æŒ fork æ“ä½œçš„è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚ fork è€—æ—¶å’Œå†…å­˜é‡æˆæ­£æ¯”ï¼Œå•ä¸ª Redis å®ä¾‹å»ºè®®ä¸è¶…è¿‡ 10Gã€‚ linux å†…å­˜åˆ†é…ç­–ç•¥ï¼Œé¿å…ç‰©ç†å†…å­˜ä¸è¶³å¯¼è‡´ fork å¤±è´¥ã€‚ é™ä½ fork æ“ä½œé¢‘ç‡ï¼Œæ¯”å¦‚é¿å…ä¸å¿…è¦çš„å…¨é‡å¤åˆ¶ï¼Œé€‚å½“æ”¾å®½ AOF è‡ªåŠ¨è§¦å‘æ—¶æœºã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:3:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"2ã€å­è¿›ç¨‹å¼€é”€ç›‘æ§å’Œä¼˜åŒ– CPUï¼Œå­è¿›ç¨‹è´Ÿè´£æŠŠå†…å­˜ä¸­çš„æ•°æ®å†™å…¥æ–‡ä»¶ä¸­ï¼Œå±äº IO å¯†é›†å‹æ“ä½œï¼Œä¸è¦å’Œå…¶ä»– IO å¯†é›†å‹æœåŠ¡éƒ¨ç½²åœ¨ä¸€èµ·ã€‚ å†…å­˜ï¼Œå†™æ—¶å¤åˆ¶æŠ€æœ¯ï¼Œé¿å…åœ¨å¤§é‡å†™å…¥æ—¶åšå­è¿›ç¨‹é‡å†™æ“ä½œï¼Œå¯¼è‡´çˆ¶è¿›ç¨‹ç»´æŠ¤å¤§é‡é¡µå‰¯æœ¬ï¼Œé€ æˆå†…å­˜æ¶ˆè€—ï¼Œå¯ä»¥å…³é—­ THPã€‚ ç£ç›˜ï¼ŒAOF é‡å†™ä¼šæ¶ˆè€—å¤§é‡ç£ç›˜ IOï¼Œå¯ä»¥å…³é—­ï¼Œå‚æ•°è®¾ç½®ä¸º no-appendfsync-on-rewrite yesï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼Œä½†æ˜¯å¼€å¯åï¼Œå¯èƒ½ä¸¢å¤±æ•°æ®ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:3:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"3ã€AOF è¿½åŠ é˜»å¡ AOF æŒä¹…åŒ–ï¼Œå¸¸ç”¨çš„åŒæ­¥ç­–ç•¥æ˜¯ everysecï¼Œç”¨äºå¹³è¡¡æ€§èƒ½å’Œå®‰å…¨æ€§ï¼Œå¯¹äºè¿™ç§æ–¹å¼ï¼ŒRedis ä½¿ç”¨å¦ä¸€ä¸ªçº¿ç¨‹æ¯ç§’æ‰§è¡Œ fsync åŒæ­¥ç£ç›˜ï¼Œå½“ç³»ç»Ÿç£ç›˜ç¹å¿™æ—¶ï¼Œå¯èƒ½é€ æˆ Redis ä¸»è¿›ç¨‹é˜»å¡ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:3:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"4ã€å¤šå®ä¾‹éƒ¨ç½² ç•¥ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/05/"},{"categories":null,"content":"1ã€é…ç½® ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"1ã€å»ºç«‹å¤åˆ¶ å»ºç«‹å¤åˆ¶å‰ä¼šåˆ é™¤å…¨éƒ¨æ•°æ®ã€‚ é…ç½®å¤åˆ¶çš„æ–¹å¼æœ‰ä¸‰ç§ï¼› é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ slaveof {masterHost} {masterPort}ã€‚ redis å¯åŠ¨å‘½ä»¤ååŠ å…¥ slaveof {masterHost} {masterPort}ã€‚ ç›´æ¥æ‰§è¡Œå‘½ä»¤ slaveof {masterHost} {masterPort}ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"2ã€æ–­å¼€å¤åˆ¶ åœ¨ä»èŠ‚ç‚¹æ‰§è¡Œå‘½ä»¤ slaveof no one æ¥æ–­å¼€å¤åˆ¶ã€‚æ‰€è°“åˆ‡ä¸»æ“ä½œï¼Œå°±æ˜¯å…ˆæ–­å¼€å¤åˆ¶ï¼Œç„¶åå†å»ºç«‹å¤åˆ¶ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"3ã€å®‰å…¨æ€§ ä¸ºäº†å®‰å…¨æ€§ï¼Œä¸€èˆ¬éƒ½ä¼šåœ¨ä¸»èŠ‚ç‚¹ä¸Šè®¾ç½® requirepass 123456ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯è®¿é—®å¿…é¡»ä½¿ç”¨ auth 123456 éªŒè¯ã€‚å› æ­¤ä»èŠ‚ç‚¹å¼€å¯å¤åˆ¶æ—¶ï¼Œä¹Ÿè¦è®¾ç½® masterauth 123456ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"4ã€åªè¯» é»˜è®¤æƒ…å†µä¸‹ï¼Œä»èŠ‚ç‚¹ä½¿ç”¨ slave-read-only=yes é…ç½®ä¸ºåªè¯»æ¨¡å¼ã€‚ç”±äºå·²ç»å¼€å¯äº†å¤åˆ¶ï¼Œå»ºè®®ä»èŠ‚ç‚¹ä¿æŒåªè¯»æ¨¡å¼ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:1:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"5ã€ä¼ è¾“å»¶è¿Ÿ ä¸»ä»èŠ‚ç‚¹ä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œè‚¯å®šä¼šæœ‰å»¶è¿Ÿã€‚ redis æä¾›äº† repl-disable-tcp-nodelay å‚æ•°ç”¨äºå…³é—­ TCP_NODELAYï¼Œé»˜è®¤å…³é—­ã€‚ å½“å…³é—­æ—¶ï¼Œä¸»èŠ‚ç‚¹çš„æ•°æ®æ— è®ºå¤§å°éƒ½ä¼šå‘é€åˆ°ä»èŠ‚ç‚¹ï¼Œè¿™æ ·å°±é™ä½äº†å»¶è¿Ÿï¼Œä½†å¢åŠ äº†å¸¦å®½ã€‚ å½“å¼€å¯æ—¶ï¼Œä¸»èŠ‚ç‚¹ä¼šåˆå¹¶è¾ƒå°çš„ TCP æ•°æ®åŒ…ï¼Œä»è€ŒèŠ‚çœå¸¦å®½ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:1:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"2ã€æ‹“æ‰‘ ä¸»è¦æœ‰ä¸‰ç§ï¼›ä¸€ä¸»ä¸€ä»ï¼Œä¸€ä¸»å¤šä»ï¼Œæ ‘çŠ¶ä¸»ä»ã€‚ ä¸€ä¸»ä¸€ä»ï¼š æœ€ç®€å•çš„ç»“æ„ï¼Œä¸€èˆ¬åªåœ¨ ä»èŠ‚ç‚¹ä¸Šå¼€å¯ AOF æ“ä½œã€‚ ä¸€ä¸»å¤šä»ï¼š ç”¨äºè¯»å¤šå†™å°‘ã€è¯»å†™åˆ†ç¦»çš„åœºæ™¯ æ ‘çŠ¶ä¸»ä»ï¼š ä»èŠ‚ç‚¹ä¸ä½†å¯ä»¥å¤åˆ¶ä¸»èŠ‚ç‚¹çš„æ•°æ®ï¼Œè¿˜å¯ä»¥ä½œä¸ºå…¶ä»–çš„èŠ‚ç‚¹çš„ä¸»èŠ‚ç‚¹ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"3ã€åŸç† ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"1ã€å¤åˆ¶è¿‡ç¨‹ æ‰§è¡Œ slaveof {masterHost} {masterPort} å‘½ä»¤åï¼Œä¿å­˜ä¸»èŠ‚ç‚¹ä¿¡æ¯ã€‚ ä»èŠ‚ç‚¹æ¯ç§’è¿è¡Œå®šæ—¶ä»»åŠ¡ç»´æŠ¤å¤åˆ¶é€»è¾‘ï¼Œå½“å‘ç°æ–°çš„ä¸»èŠ‚ç‚¹åï¼Œå»ºç«‹è¿æ¥ã€‚ å‘é€ ping å‘½ä»¤ï¼Œä¸»è¦æ˜¯æ£€æŸ¥ç½‘ç»œæ˜¯å¦å¯ç”¨å’Œæ˜¯å¦å¯ä»¥å¤„ç†å‘½ä»¤ï¼ˆå¯èƒ½ä¸»èŠ‚ç‚¹é˜»å¡äº†ï¼‰ã€‚ æƒé™éªŒè¯ï¼Œrequirepass å’Œ masterauth æ˜¯å¦åŒ¹é…ã€‚ åŒæ­¥æ•°æ®é›†ï¼Œåˆ†ä¸ºå…¨é‡åŒæ­¥å’Œéƒ¨åˆ†åŒæ­¥ã€‚ å‘½ä»¤æŒç»­å¤åˆ¶ï¼Œæ–°çš„å‘½ä»¤æŒç»­å‘ç»™ä»èŠ‚ç‚¹ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"2ã€æ•°æ®åŒæ­¥ åŒæ­¥è¿‡ç¨‹åˆ†ä¸ºå…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¤åˆ¶ã€‚ å‚ä¸ä¸»ä»å¤åˆ¶çš„èŠ‚ç‚¹éƒ½ä¼šç»´æŠ¤è‡ªèº«å¤åˆ¶åç§»é‡ã€‚å‘½ä»¤ info ä¸­ master_repl_offset å’Œ slave_repl_offset ã€‚ å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œä¸»èŠ‚ç‚¹æŠŠå‘½ä»¤å‘é€ä»èŠ‚ç‚¹ï¼Œè¿˜ä¼šæŠŠå‘½ä»¤å†™å…¥å¤åˆ¶ç§¯å‹ç¼“å†²åŒºï¼Œè¿™ä¸ªç”¨äºéƒ¨åˆ†å¤åˆ¶å’Œå‘½ä»¤ä¸¢å¤±çš„åœºæ™¯ã€‚å‘½ä»¤ info ä¸­ repl_backlog_*ã€‚ ä¸»èŠ‚ç‚¹è¿è¡Œ IDï¼Œç”¨æ¥å”¯ä¸€è¯†åˆ« Redis èŠ‚ç‚¹ï¼Œå½“è¿è¡Œ ID å˜åŒ–äº†ï¼Œä»èŠ‚ç‚¹å°†åšå…¨é‡å¤åˆ¶äº†ã€‚èŠ‚ç‚¹é‡å¯äº†ï¼Œè¿è¡Œ ID ä¹Ÿä¼šå˜åŒ–ã€‚å¯ä»¥æ‰§è¡Œå‘½ä»¤ debug reload æ¥é‡æ–°åŠ è½½å¹¶ä¿æŒè¿è¡Œ ID ä¸å˜ï¼Œä½†æ˜¯ä¼šé˜»å¡å½“å‰ Redisã€‚ å‘½ä»¤ info ä¸­ run_idã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"3ã€å…¨é‡å¤åˆ¶ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"4ã€éƒ¨åˆ†å¤åˆ¶ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"5ã€å¿ƒè·³ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"6ã€å¼‚æ­¥å¤åˆ¶ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:3:6","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"4ã€å¼€å‘ä¸è¿ç»´ä¸­çš„é—®é¢˜ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/06/"},{"categories":null,"content":"Redis å¼€å‘ä¸è¿ç»´ ç¬¬ä¸€ç«  åˆè¯† Redis ç¬¬äºŒç«  API çš„ç†è§£å’Œä½¿ç”¨ ç¬¬ä¸‰ç«  å°åŠŸèƒ½å¤§ç”¨å¤„ ç¬¬å››ç«  å®¢æˆ·ç«¯ ç¬¬äº”ç«  æŒä¹…åŒ– ç¬¬å…­ç«  å¤åˆ¶ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/readme/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/redis-development-and-operation-and-maintenance/readme/"},{"categories":null,"content":"1ã€ä¸Šä¸‹æ–‡åˆ‡æ¢ CPU é€šè¿‡æ—¶é—´ç‰‡åˆ†é…ç®—æ³•æ¥å¾ªç¯æ‰§è¡Œä»»åŠ¡ï¼Œå½“å‰ä»»åŠ¡æ‰§è¡Œå®Œä¸€ä¸ªæ—¶é—´ç‰‡åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ä½†æ˜¯åœ¨åˆ‡æ¢å‰ä¼šä¿å­˜ä¸Šä¸€ä¸ªä»»åŠ¡çš„çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡åˆ‡æ¢å›è¿™ä¸ªä»»åŠ¡æ—¶ï¼Œå†æ¬¡åŠ è½½è¯¥ä»»åŠ¡çŠ¶æ€ã€‚è¿™å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹ï¼Œä¼šä½¿ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç¹ï¼Œæ‰§è¡Œæ•ˆç‡ä¹Ÿå¯èƒ½ä¸å¦‚å•çº¿ç¨‹ã€‚ ä¸Šå›¾çš„ cs (context switch) è¡¨ç¤ºä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€‚ å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ–¹æ³•ï¼š æ— é”å¹¶å‘ç¼–ç¨‹ï¼Œå¤šçº¿ç¨‹å¤„ç†æ•°æ®æ—¶ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªæ–¹æ³•æ¥é¿å…é”ã€‚å¦‚å°†æ•°æ®çš„ ID æŒ‰ç…§ Hash ç®—æ³•å–ä½™åˆ†æ®µï¼Œä¸åŒçš„çº¿ç¨‹å¤„ç†ä¸åŒæ®µçš„æ•°æ®ã€‚ CAS ç®—æ³•ï¼ŒJava çš„ Atomic åŒ…ã€‚ ä½¿ç”¨æœ€å°‘çº¿ç¨‹ï¼Œé¿å…åˆ›å»ºä¸éœ€è¦çš„çº¿ç¨‹ï¼Œæ¯”å¦‚ä»»åŠ¡å¾ˆå°‘ï¼Œåˆ›å»ºçš„çº¿ç¨‹è¾ƒå¤šã€‚ åç¨‹ï¼Œå•çº¿ç¨‹å®ç°å¤šä»»åŠ¡çš„è°ƒåº¦ï¼Œå¹¶ç»´æŒå¤šä»»åŠ¡çŠ¶æ€åˆ‡æ¢ã€‚ å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ç¤ºä¾‹ jstack å‘½ä»¤æ¥ dump çº¿ç¨‹ jstack 31177 \u003e /home/xxx/dump-31177 ç»Ÿè®¡çº¿ç¨‹éƒ½å¤„äºä»€ä¹ˆçŠ¶æ€ grep java.lang.Thread.State dump-31177 | awk '{print $2$3$4$5}' | sort | uniq -c æŸ¥çœ‹è¿™äº› waiting çš„çº¿ç¨‹ï¼Œæ ¹æ®éœ€è¦åˆç†é…ç½®çº¿ç¨‹æ•°ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/"},{"categories":null,"content":"2ã€æ­»é” æ­»é”ç¤ºä¾‹ï¼š public static void main(String[] args) { Object lockA = new Object(); Object lockB = new Object(); Thread t1 = new Thread(() -\u003e { synchronized (lockA) { System.out.println(\"get lockA\"); timeSleep(2); synchronized (lockB) { System.out.println(\"get lockB\"); } } }); Thread t2 = new Thread(() -\u003e { synchronized (lockB) { System.out.println(\"get lockB\"); synchronized (lockA) { System.out.println(\"get lockA\"); } } }); t1.start(); t2.start(); } é¿å…æ­»é”çš„æ–¹æ³•ï¼š é¿å…ä¸€ä¸ªçº¿ç¨‹åŒæ—¶è·å–å¤šä¸ªé”ï¼Œä¹Ÿå°±æ˜¯åŒæ—¶ç”³è¯·æ‰€æœ‰çš„èµ„æºã€‚ å°è¯•ä½¿ç”¨å®šæ—¶é”ï¼Œå¦‚ lock.tryLock(timeout) æ¥æ›¿æ¢å†…éƒ¨é”ã€‚ å¯¹äºæ•°æ®åº“é”ï¼ŒåŠ é”å’ŒåŠ é”å¿…é¡»åœ¨ä¸€ä¸ªæ•°æ®åº“è¿æ¥é‡Œã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/"},{"categories":null,"content":"3ã€èµ„æºé™åˆ¶çš„æŒ‘æˆ˜ å¸¦å®½ï¼Œæ¯”å¦‚å¸¦å®½åªæœ‰ 20M, ä¸€ä¸ªçº¿ç¨‹æœ€å¤šåªèƒ½ä½¿ç”¨ 10Mï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ•°æœ€å¤§åªèƒ½æ˜¯ 2ï¼Œå¤šä½™çš„çº¿ç¨‹æ²¡æœ‰èµ„æºå¯ä»¥ä½¿ç”¨ã€‚ ç£ç›˜ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/"},{"categories":null,"content":"4ã€æ€»ç»“ å¼ºçƒˆå»ºè®®ä½¿ç”¨ JDK å¹¶å‘åŒ…æä¾›çš„å¹¶å‘å®¹å™¨å’Œå·¥å…·ç±»æ¥è§£å†³å¹¶å‘é—®é¢˜ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/01/"},{"categories":null,"content":"Java å¹¶å‘ç¼–ç¨‹çš„è‰ºæœ¯ ç¬¬ä¸€ç«  å¹¶å‘ç¼–ç¨‹çš„æŒ‘æˆ˜ ç¬¬äºŒç«  Java å¹¶å‘æœºåˆ¶çš„åº•å±‚å®ç°åŸç† ç¬¬ä¸‰ç«  Java å†…å­˜æ¨¡å‹ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/readme/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/books/the-art-of-java-concurrent-programming/readme/"},{"categories":null,"content":"Java å¹¶å‘ç¼–ç¨‹å®æˆ˜ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-con-practice/readme/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-con-practice/readme/"},{"categories":null,"content":"1ã€Javaæœ¬èº«æœ‰ä¸¤ä¸ªæ˜¾è‘—çš„ç‰¹æ€§ JRE å°±æ˜¯ Java è¿è¡Œç¯å¢ƒï¼Œ JDK å°±æ˜¯ Java å¼€å‘å·¥å…·åŒ… è·¨å¹³å°è¿è¡Œï¼ˆä¸€æ¬¡ç¼–å†™ï¼Œåˆ°å¤„è¿è¡Œï¼‰ åƒåœ¾å›æ”¶å™¨ï¼ˆç¨‹åºå‘˜ä¸ç”¨æ‰‹åŠ¨å›æ”¶å†…å­˜ï¼Œä½†ä»ç„¶å¯èƒ½å­˜åœ¨å†…å­˜æ³„æ¼ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/01/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/01/"},{"categories":null,"content":"2ã€Javaæ˜¯è§£ææ‰§è¡Œï¼Ÿï¼ˆä¸å¤ªæ­£ç¡®ï¼‰ æˆ‘ä»¬å¼€å‘çš„ java æºä»£ç ï¼Œç»è¿‡ javac ç¼–è¯‘æˆä¸ºå­—èŠ‚ç ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œé€šè¿‡ JVM å†…ç½®çš„è§£æå™¨å°†å­—èŠ‚ç è£…æ¢ä¸ºæœºå™¨ç ã€‚ å¸¸è§çš„ JVMï¼Œ æ¯”å¦‚ Oracle çš„ Hotspot JVMï¼Œæä¾›äº† JITï¼ˆJust-In-Timeï¼‰åŠ¨æ€ç¼–è¯‘å™¨ã€‚ åœ¨ä¸»æµçš„ Java ç‰ˆæœ¬ä¸­ï¼ŒJava 8 é‡‡ç”¨æ··åˆæ¨¡å¼-Xmixedè¿›è¡Œã€‚ Oracle Hotspot JVM æä¾›äº†ä¸¤ç§ä¸åŒçš„ JIT ç¼–è¯‘å™¨ï¼ŒC1 å¯¹åº” client æ¨¡å¼ï¼Œé€‚ç”¨äºå¯åŠ¨æ•æ„Ÿçš„åº”ç”¨ï¼ŒC2 å¯¹åº” server æ¨¡å¼ï¼Œé€‚ç”¨äºé•¿æ—¶é—´è¿è¡Œçš„æœåŠ¡å™¨ã€‚é»˜è®¤é‡‡ç”¨çš„æ˜¯åˆ†å±‚ç¼–è¯‘ã€‚ JVM å¯åŠ¨æ—¶ï¼Œå¯ä»¥é€šè¿‡æŒ‡å®šä¸åŒçš„å‚æ•°å¯¹è¿è¡Œæ¨¡å¼é€‰æ‹©ã€‚ -Xint JVM åªè¿›è¡Œè§£é‡Šæ‰§è¡Œã€‚ -Xcomp JVM åªè¿›è¡Œç¼–è¯‘æ‰§è¡Œã€‚ é™¤äº†ä¸Šé¢çš„ç¼–è¯‘æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ–°çš„ç¼–è¯‘æ–¹å¼ï¼ˆAOTï¼‰ï¼Œå°±æ˜¯ç›´æ¥æŠŠå­—èŠ‚ç ç¼–è¯‘ä¸ºæœºå™¨ç ã€‚ åˆ©ç”¨ä¸‹é¢çš„å‘½ä»¤æŠŠæŸä¸ªç±»æˆ–è€…æŸä¸ªæ¨¡å—ç¼–è¯‘æˆä¸ºAOTåº“ jaotc --output libHelloWorld.so HelloWorld.class jaotc --output libjava.base.so --module java.base ç„¶ååœ¨å¯åŠ¨æ—¶ç›´æ¥æŒ‡å®š java -XX:AOTLibrary=./libHelloWorld.so,./libjava.base.so HelloWorld ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/01/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/01/"},{"categories":null,"content":"1ã€Exception å’Œ Error Exception å’Œ Error éƒ½ç»§æ‰¿ Throwable ç±»ï¼Œåªæœ‰ Throwable ç±»çš„å®ä¾‹æ‰å¯ä»¥æŠ›å‡ºã€‚ Exception æ˜¯å¯ä»¥é¢„æ–™çš„æ„å¤–æƒ…å†µï¼Œå¯ä»¥è¢«æ•è·è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚è€Œ Error æ˜¯ä¸å¤ªå¯èƒ½å‡ºç°çš„æƒ…å†µï¼Œå¯èƒ½ä¼šé€ æˆç¨‹åºç»ˆæ­¢ï¼Œå¦‚ OutOfMemoryErrorï¼ˆå†…å­˜æº¢å‡ºï¼‰ã€‚ Exception åˆ†ä¸ºå¯æ£€æŸ¥ï¼ˆcheckedï¼‰å¼‚å¸¸å’Œä¸æ£€æŸ¥ï¼ˆuncheckedï¼‰å¼‚å¸¸ï¼Œå¯æ£€æŸ¥å¼‚å¸¸å¿…é¡»æ˜¾å¼æ•è·å¤„ç†ï¼Œä¸æ£€æŸ¥å¼‚å¸¸å°±æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ã€‚å¦‚ NullPointerException ã€‚ å¸¸è§çš„ Exception NullPointerException ï¼ˆç©ºæŒ‡é’ˆå¼‚å¸¸ï¼‰ ArrayIndexOutOfBoundsException ï¼ˆæ•°ç»„è¶Šç•Œå¼‚å¸¸ï¼‰ NoSuchFileException ï¼ˆæ–‡ä»¶æ²¡æœ‰æ‰¾åˆ°å¼‚å¸¸ï¼‰ InterruptedException ï¼ˆçº¿ç¨‹è¢«æ‰“æ–­å¼‚å¸¸ï¼‰ ClassCastException ï¼ˆç±»å‹è½¬æ¢å¼‚å¸¸ï¼‰ å¸¸è§çš„ Error NoClassDefFoundError ï¼ˆç±»æ²¡æœ‰è¢«æ‰¾åˆ°é”™è¯¯ï¼‰ OutOfMemoryError ï¼ˆå †å†…å­˜æº¢å‡ºé”™è¯¯ï¼‰ StackOverflowError ï¼ˆæ ˆå†…å­˜æº¢å‡ºé”™è¯¯ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/02/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/02/"},{"categories":null,"content":"2ã€try-catch-finally try (BuferedReader br = new BuferedReader(...); BuferedWriter writer = new BuferedWriter(...)) { // do something catch ( IOException | XEception e) { // Multiple catch // Handle it } finally { // do something } æ³¨æ„ å°½é‡ä¸è¦æ•è· Exception ç±»å‹çš„å¼‚å¸¸ï¼Œå…·ä½“å¼‚å¸¸å…·ä½“å¤„ç†ã€‚ ä¸è¦ç”Ÿåï¼ˆswallowï¼‰å¼‚å¸¸ï¼Œé¿å…é”™è¯¯åå‡ºç°éš¾ä»¥è¯Šæ–­çš„æƒ…å†µï¼Œå¯ä»¥è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚ Java çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¼šæœ‰é¢å¤–çš„å¼€é”€ try-catch çš„ä»£ç æ®µä¼šå½±å“ JVM çš„ä¼˜åŒ–ï¼Œå°½é‡åªæ•è·æœ‰å¿…è¦çš„ä»£ç æ®µã€‚ Java æ¯å®ä¾‹åŒ–ä¸€ä¸ª Exceptionï¼Œå°±ä¼šå¯¹å½“å‰æ ˆè¿›è¡Œå¿«ç…§ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/02/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/02/"},{"categories":null,"content":"1ã€final final ä¿®é¥°çš„ç±»ï¼Œä¸èƒ½è¢«ç»§æ‰¿ã€‚ final ä¿®é¥°çš„å˜é‡ï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚ final ä¿®é¥°çš„æ–¹æ³•ï¼Œä¸èƒ½è¢«é‡å†™ã€‚ final ä¸æ˜¯ immutableï¼Œå¯¹è±¡çš„å±æ€§è¿˜æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/03/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/03/"},{"categories":null,"content":"2ã€finally finally æ˜¯ Java ä¿è¯ä»£ç ä¸€å®šä¼šè¢«æ‰§è¡Œçš„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨ try-catch-finallyã€try-finally æ¥å…³é—­æ•°æ®åº“è¿æ¥ï¼Œunlock()ç­‰ã€‚ å¦‚æœæ˜¯åˆ©ç”¨ finally æœºåˆ¶æ¥å…³é—­èµ„æºï¼Œæœ€å¥½æ˜¯ç”¨ try-with-resourcesã€‚ ç‰¹ä¾‹ try { // do something Sysem.exit(1); } finally{ Sysem.out.println(â€œPrint from fnallyâ€); } ä¸Šé¢çš„ finally è¯­å¥ä¸ä¼šè¢«æ‰§è¡Œã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/03/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/03/"},{"categories":null,"content":"3ã€finalize finalize æ–¹æ³•æ˜¯ Object ä¸­ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒçš„è®¾è®¡ç›®çš„æ˜¯ä¿è¯å¯¹è±¡åœ¨åƒåœ¾æ”¶é›†å‰å®Œæˆèµ„æºçš„å›æ”¶ï¼Œç°åœ¨å·²ç»ä¸æ¨èä½¿ç”¨ï¼Œåœ¨ Java 9 ä¸­å·²è¢«æ ‡è®°ä¸º @Deprecatedã€‚ ä½¿ç”¨ finalize å¯èƒ½ä¼šä½¿ç¨‹åºæ€§èƒ½é™ä½ï¼Œå› ä¸º JVM ä¼šåšé¢å¤–å¤„ç†ã€‚ Java ç›®å‰ä½¿ç”¨ Cleaner æ¥æ›¿æ¢ finalizeï¼ŒCleanerçš„å®ç°åˆ©ç”¨äº†å¹»è±¡å¼•ç”¨ï¼ˆè™šå¼•ç”¨ï¼‰å’Œå¼•ç”¨é˜Ÿåˆ—ï¼Œæ¯”å¦‚ mysql-connector-java å°±æ˜¯åˆ©ç”¨å¹»è±¡å¼•ç”¨æ¥å›æ”¶èµ„æºã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/03/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/03/"},{"categories":null,"content":"1ã€kafkaæ¦‚å¿µ â€‹ Apache Kafkaæ˜¯ä¸€æ¬¾å¼€æºçš„æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼›æ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ˜¯ä¸€ç»„è§„èŒƒï¼Œä¼ä¸šåˆ©ç”¨è¿™ç»„è§„èŒƒåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’è¯­ä¹‰å‡†ç¡®çš„æ¶ˆæ¯ï¼Œå®ç°æ¾è€¦åˆçš„å¼‚æ­¥å¼æ•°æ®ä¼ è¾“ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"2ã€kafkaç‰¹ç‚¹ ä½¿ç”¨çº¯äºŒè¿›åˆ¶çš„å­—èŠ‚åºåˆ— åŒæ—¶æ”¯æŒä¸¤ç§æ¶ˆæ¯å¼•æ“æ¨¡å‹ï¼ˆç‚¹å¯¹ç‚¹ã€å‘å¸ƒ/è®¢é˜…ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"3ã€kafkaçš„æ¶æ„ Topicï¼šä¸»é¢˜ï¼Œæ‰¿è½½æ¶ˆæ¯çš„é€»è¾‘å®¹å™¨ï¼Œç”¨æ¥åŒºåˆ†ä¸šåŠ¡ï¼› Producerï¼šç”Ÿäº§è€…ï¼Œå‘ä¸»é¢˜å‘å¸ƒæ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºï¼› Consumerï¼šæ¶ˆè´¹è€…ï¼Œå‘ä¸»é¢˜è®¢é˜…æ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºï¼› Partitionï¼šåˆ†åŒºï¼Œæ¯ä¸ªTopicå¯ä»¥è®¾ç½®å¤šä¸ªåˆ†åŒºï¼› Replicaï¼šå‰¯æœ¬ï¼ŒåŒä¸€ä¸ªæ¶ˆæ¯ä»¥æä¾›æ•°æ®å†—ä½™å¯ä»¥æœ‰å¤šä¸ªå‰¯æœ¬ï¼Œåˆ†ä¸ºé¢†å¯¼è€…å‰¯æœ¬ï¼ˆå¯å¯¹å¤–æä¾›æœåŠ¡ï¼‰å’Œè¿½éšè€…å‰¯æœ¬ï¼ˆä¸å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡ï¼‰ï¼›å¯¹äºåˆ†åŒºå®ç°é«˜å¯ç”¨ï¼› Consumer Groupï¼šæ¶ˆè´¹è€…ç»„ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯ç»„æˆä¸€ä¸ªæ¶ˆè´¹è€…ç»„ï¼ŒåŒæ—¶æ¶ˆè´¹å¤šä¸ªåˆ†åŒºå®ç°é«˜ååï¼›åŒä¸€ä¸ªæ¶ˆè´¹è€…ç»„å†…çš„æ¶ˆè´¹è€…ä¸å¯é‡å¤æ¶ˆè´¹åŒä¸€åˆ†åŒºçš„æ¶ˆæ¯ï¼› Rebalanceï¼šé‡å¹³è¡¡ï¼Œæ¶ˆè´¹è€…ç»„å†…çš„æŸä¸ªæ¶ˆè´¹è€…æŒ‚æ‰åï¼Œä¼šé‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒºï¼› Offsetï¼šä½ç§»ï¼Œæœ‰åˆ†åŒºä½ç§»å’Œæ¶ˆè´¹è€…ä½ç§»ä¸¤ä¸ªæ¦‚å¿µï¼›åˆ†åŒºä½ç§»æ˜¯æ¶ˆæ¯çš„ä½ç½®æ ‡è®°ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œæ˜¯å›ºå®šçš„ï¼›æ¶ˆè´¹è€…ä½ç§»æ˜¯æ¶ˆè´¹è€…åœ¨è®¢é˜…æ¶ˆæ¯æ—¶çš„æ¶ˆè´¹è¿›åº¦ï¼Œæ˜¯åŠ¨æ€çš„ï¼› å›¾è§£partitionå’Œreplicationçš„æ¦‚å¿µ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"4ã€å¤šç§Kafkaå¯¹æ¯” Apache Kafkaï¼šç¤¾åŒºç‰ˆkafkaï¼›è¿­ä»£é€Ÿåº¦å¿«ï¼Œç¤¾åŒºå“åº”å¿«ï¼Œä½†æ˜¯ä»…æä¾›æ ¸å¿ƒåŠŸèƒ½ï¼Œç¼ºå°‘é«˜çº§ç‰¹æ€§ï¼› Confluent Kafkaï¼šConfluentå…¬å¸æä¾›çš„Kafkaï¼›é›†æˆäº†å¾ˆå¤šé«˜çº§ç‰¹æ€§ï¼Œåˆ†å…è´¹ç‰ˆå’Œæ”¶è´¹ç‰ˆï¼Œä½†æ˜¯ç›¸å…³èµ„æ–™ä¸å…¨ï¼Œæ™®åŠç‡ä½ï¼› CDH/HDP Kafkaï¼šå¤§æ•°æ®å¹³å°å†…åµŒçš„Apache Kafkaï¼Œæ“ä½œç®€å•ï¼ŒèŠ‚çœè¿ç»´æˆæœ¬ï¼Œä½†æ˜¯æŠŠæ§åº¦ä½ï¼Œæ¼”è¿›é€Ÿåº¦æ…¢ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"5ã€Kafkaç‰ˆæœ¬æ¼”å˜ â€‹ kafkaç‰ˆæœ¬å‘½åè§„èŒƒï¼šä¾‹kafka_2.11-2.1.1.tgzï¼ˆ2.11è¡¨ç¤ºscalaç‰ˆæœ¬ï¼Œ2.1.1è¡¨ç¤ºkafkaç‰ˆæœ¬ï¼‰ kafkaç‰ˆæœ¬å·è§„èŒƒï¼šå¤§ç‰ˆæœ¬å· - å°ç‰ˆæœ¬å· - Patch å·ï¼ˆä¿®è®¢å·ï¼‰ 0.7ç‰ˆæœ¬ï¼šåªæä¾›æœ€åŸºç¡€çš„æ¶ˆæ¯é˜Ÿåˆ—åŠŸèƒ½ï¼› 0.8ç‰ˆæœ¬ï¼šå¼•å…¥äº†å‰¯æœ¬æœºåˆ¶ï¼Œ æˆä¸ºäº†ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šå®Œå¤‡çš„åˆ†å¸ƒå¼é«˜å¯é æ¶ˆæ¯é˜Ÿåˆ—è§£å†³æ–¹æ¡ˆï¼›ï¼ˆä½†æ˜¯ç”Ÿäº§å’Œæ¶ˆè´¹çš„å®¢æˆ·ç«¯è¿˜æ˜¯è€ç‰ˆæœ¬çš„ï¼Œåº”æŒ‡å®šzkåœ°å€è€Œä¸æ˜¯brokeråœ°å€ï¼‰ï¼› 0.8.2.0ç‰ˆæœ¬ï¼šå¼•å…¥äº†æ–°ç‰ˆæœ¬Producer APIï¼ˆä½†æ˜¯bugè¿˜æœ‰ç‚¹å¤šï¼Œä¸å»ºè®®ä½¿ç”¨ï¼‰ï¼› 0.8.2.2ç‰ˆæœ¬ï¼šè€ç‰ˆæœ¬çš„Consumer APIæ¯”è¾ƒç¨³å®šäº†ï¼› 0.9ç‰ˆæœ¬ï¼šå¢åŠ äº†åŸºç¡€çš„å®‰å…¨è®¤è¯/æƒé™åŠŸèƒ½ï¼ŒåŒæ—¶ä½¿ç”¨javaé‡å†™äº†Consumer APIï¼Œè¿˜å¼•å…¥äº†Kafka Connectç»„ä»¶ç”¨äºå®ç°é«˜æ€§èƒ½çš„æ•°æ®æŠ½å–ï¼›å¦å¤–æ–°ç‰ˆæœ¬çš„Producer APIæ¯”è¾ƒç¨³å®šäº†ï¼Œä¸å»ºè®®ä½¿ç”¨æ–°ç‰ˆæœ¬çš„Consumer APIï¼› 0.10ç‰ˆæœ¬ï¼šå¼•å…¥äº†Kafka Streamsï¼Œæ­£å¼å‡çº§ä¸ºåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ï¼› 0.10.2.2ç‰ˆæœ¬ï¼šæ–°ç‰ˆæœ¬çš„Consumer APIæ¯”è¾ƒç¨³å®šäº†ï¼Œè¯¥ç‰ˆæœ¬ä¹Ÿä¿®å¤äº†ä¸€ä¸ªå¯èƒ½å¯¼è‡´Produceræ€§èƒ½é™ä½çš„bugï¼› 0.11ç‰ˆæœ¬ï¼šæä¾›äº†å¹‚ç­‰æ€§Producer APIï¼ˆå¹‚ç­‰æ€§å°±æ˜¯æ¶ˆæ¯å»é‡ï¼Œé»˜è®¤ä¸å¼€å¯ï¼‰å’Œäº‹åŠ¡APIï¼ˆå®ç°æµå¤„ç†ç»“æœæ­£ç¡®æ€§çš„åŸºçŸ³ï¼‰ï¼Œè¿˜å¯¹Kafkaæ¶ˆæ¯æ ¼å¼åšäº†é‡æ„ï¼›ï¼ˆè¯¥ç‰ˆæœ¬ä¹Ÿæ˜¯ä¸»æµç‰ˆæœ¬ï¼‰ï¼› 0.11.0.3ç‰ˆæœ¬ï¼šæ¶ˆæ¯å¼•æ“åŠŸèƒ½éå¸¸å®Œå–„äº†ï¼› 1.1ç‰ˆæœ¬ï¼šå®ç°æ•…éšœè½¬ç§»ï¼ˆå³Failoverï¼‰ï¼› 1.0ç‰ˆæœ¬å’Œ2.0ç‰ˆæœ¬ï¼šåªè¦æ˜¯æ˜¯å¯¹Kafka Streamsçš„æ”¹è¿›ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:5:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"6ã€Kafkaçš„æ ¸å¿ƒå‚æ•° ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:6:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"1ã€é…ç½®æ–‡ä»¶å‚æ•° log.dirsï¼šæŒ‡å®šbrokeréœ€è¦ä½¿ç”¨çš„è‹¥å¹²ä¸ªæ–‡ä»¶ç›®å½•è·¯å¾„ï¼Œæ— é»˜è®¤å€¼ï¼›ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½®ï¼ŒCSVæ ¼å¼ï¼ˆä¾‹å¦‚ï¼š/home/kafka1,/home/kafka2ï¼‰ zookeeper.connectï¼šæŒ‡å®šzkçš„åœ°å€å’Œç«¯å£ï¼ˆä¾‹hadoop01:2181,hadoop02:2181,hadoop03:2181ï¼‰ï¼Œzkä¿å­˜äº†topicã€åˆ†åŒºçš„ä¿¡æ¯ç­‰ç­‰ï¼Œå¦‚æœå¤šä¸ªkafkaé›†ç¾¤å…±æœ‰ä¸€ä¸ªzké›†ç¾¤ï¼ŒåŠ ä¸Šchrootå³å¯ï¼Œchrootæ˜¯åˆ«åï¼Œåˆ™æŒ‡å®šæ ¼å¼ä¸ºhadoop01:2181,hadoop02:2181,hadoop03:2181/kafka1æˆ–hadoop01:2181,hadoop02:2181,hadoop03:2181/kafka2; listenersï¼šç›‘å¬å™¨ï¼ŒæŒ‡å®šåè®®ã€ä¸»æœºåã€ç«¯å£ï¼› advertised.listenersï¼šæŒ‡è¯¥ç›‘å¬å™¨æ˜¯brokerå¯¹å¤–å‘å¸ƒçš„ï¼› host.name/portï¼šè¿‡æœŸå‚æ•°ï¼Œå¯ä»¥ä¸æŒ‡å®šï¼› auto.create.topics.enableï¼šæ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»ºtopicï¼› unclean.leader.election.enableï¼šæ˜¯å¦å…è®¸unclean leaderé€‰ä¸¾ï¼ŒåŸæœ¬æ•°æ®å¤šçš„åˆ†åŒºæ‰æœ‰èµ„æ ¼é€‰ä¸¾leaderï¼Œè¯¥å‚æ•°è®¾ç½®ä¸ºtrueåï¼Œæ•°æ®å°‘çš„ä¹Ÿå¯ä»¥å‚ä¸é€‰ä¸¾ï¼Œä¼šé€ æˆæ•°æ®ä¸¢å¤±ï¼Œå»ºè®®è®¾ç½®ä¸ºfalseï¼› auto.leader.rebalance.enableï¼šæ˜¯å¦å…è®¸å®šæœŸé€‰ä¸¾leaderï¼Œä¸å»ºè®®å¼€å¯ï¼› log.retention.{hour|minutes|ms}ï¼šæ§åˆ¶ä¸€æ¡æ¶ˆæ¯è¢«ä¿å­˜å¤šé•¿æ—¶é—´ï¼Œmsä¼˜å…ˆçº§æœ€é«˜ï¼› log.retention.bytesï¼šæŒ‡å®šbrokerä¸ºæ¶ˆæ¯ä¿å­˜çš„æ€»ç£ç›˜å®¹é‡å¤§å°ï¼Œé»˜è®¤å€¼ä¸º-1ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¸Šé™ï¼› message.max.bytesï¼šæ§åˆ¶brokerèƒ½å¤Ÿæ¥æ”¶çš„æœ€å¤§æ¶ˆæ¯å¤§å°ï¼Œé»˜è®¤å€¼ä¸º1000012ï¼Œå¤ªå°ï¼Œå»ºè®®é‡è®¾ç½®ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:6:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"2ã€Topicçº§åˆ«å‚æ•° retention.msï¼šè§„å®šäº†è¯¥topicæ¶ˆæ¯è¢«ä¿å­˜çš„æ—¶é•¿ï¼› retention.bytesï¼šè§„å®šäº†è¦ä¸ºè¯¥topicé¢„ç•™å¤šå¤§çš„ç£ç›˜ç©ºé—´ï¼ˆé»˜è®¤-1ï¼Œè¡¨ç¤ºæ²¡æœ‰ä¸Šé™ï¼‰ï¼› max.message.bytesï¼šBrokerèƒ½å¤Ÿæ¥æ”¶çš„è¯¥topicçš„æœ€å¤§æ¶ˆæ¯å¤§å°ï¼› ä»¥ä¸Šå‚æ•°å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼è®¾ç½® åˆ›å»ºtopicæ—¶è¿›è¡Œè®¾ç½®ï¼šä¾‹bin/kafka-topics.sh â€“zookeeper hadoop01:2181,hadoop02:2181,hadoop03:2181 â€“create â€“topic my-topic â€“partitions 1 â€“replication-factor 1 â€“config max.message.bytes=64000 â€“config flush.messages=1 ä¿®æ”¹topicæ—¶è®¾ç½®ï¼šä¾‹bin/kafka-topics.sh â€“zookeeper hadoop01:2181,hadoop02:2181,hadoop03:2181 â€“alter â€“topic my-topic â€“config max.message.bytes=128000 ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:6:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"3ã€JVMå‚æ•° KAFKA_HEAP_OPTSï¼šæŒ‡å®šå †å¤§å°ï¼› KAFKA_JVM_PERFORMANCE_OPTSï¼šæŒ‡å®šGCå‚æ•°ï¼› åœ¨å¯åŠ¨kafkaå‰è®¾ç½®è¿™ä¸¤ä¸ªç¯å¢ƒå˜é‡ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:6:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"4ã€æ“ä½œç³»ç»Ÿå‚æ•° ulimit -nï¼šæ‰“å¼€æ–‡ä»¶æè¿°ç¬¦æœ€å¤§å€¼ï¼ˆä¾‹ulimit -n 100000ï¼‰ï¼› æ–‡ä»¶ç³»ç»Ÿç±»å‹ï¼šå»ºè®®é€‰æ‹©XFSï¼› swappniessï¼šswapç©ºé—´å¤§å°ï¼Œå»ºè®®è®¾ç½®ç•¥å¤§äº0çš„å€¼ï¼› æäº¤æ—¶é—´ï¼šå³flushè½ç›˜æ—¶é—´ï¼Œkafkaçš„æ•°æ®ä¼šå…ˆå†™åˆ°æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ä¸Šï¼Œç„¶åä¼šæ ¹æ®LRUç®—æ³•å®šæœŸå°†é¡µç¼“å­˜çš„æ•°æ®è½ç›˜åˆ°ç£ç›˜ï¼Œé»˜è®¤ä¸º5ç§’ï¼Œå¯é€‚å½“å¢å¤§æ—¶é—´é—´éš”ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:6:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"7ã€åˆ†åŒºç­–ç•¥ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:7:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"1ã€ç”Ÿäº§è€…åˆ†åŒºç­–ç•¥ è½®è¯¢ç­–ç•¥ï¼ˆRound-robinï¼‰ï¼škafkaç”Ÿäº§è€…APIé»˜è®¤çš„åˆ†åŒºç­–ç•¥ï¼Œæœ€å¤§é™åº¦è´Ÿè½½å‡è¡¡ï¼› éšæœºç­–ç•¥ï¼ˆRandomnessï¼‰ï¼šå¯è‡ªå®šä¹‰å®ç°è¯¥ç­–ç•¥ï¼› æŒ‰æ¶ˆæ¯é”®ä¿å­˜ç­–ç•¥ï¼ˆKey-orderingï¼‰ï¼škeyå¯ä»¥æ˜¯ä¸šåŠ¡ä¸Šçš„å­—æ®µä¿¡æ¯ï¼ŒæŒ‰ä¸šåŠ¡åœºæ™¯è‡ªå®šä¹‰åˆ†åŒºï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:7:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"2ã€æ¶ˆè´¹è€…åˆ†åŒºç­–ç•¥ æŒ‰èŒƒå›´åˆ†é…ï¼šæŒ‡å®šåˆ†åŒºæ¶ˆè´¹ï¼› è½®è¯¢åˆ†é…ï¼šæŒ‰é¡ºåºåˆ†é…ç»™æ¶ˆè´¹è€…ï¼› è‡ªå®šä¹‰ï¼šè®¾ç½®partition.assignment.strategyä¸ºè‡ªå®šä¹‰çš„ç±»ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:7:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"8ã€å‹ç¼© â€‹ kafkaçš„æ¶ˆæ¯å±‚æ¬¡åˆ†ä¸ºæ¶ˆæ¯é›†åˆå’Œæ¶ˆæ¯ã€‚ä¸€ä¸ªæ¶ˆæ¯é›†åˆåŒ…å«è‹¥å¹²æ¡æ—¥å¿—é¡¹ï¼Œæ—¥å¿—é¡¹å°±æ˜¯è£…æ¶ˆæ¯çš„åœ°æ–¹ï¼›kafkaåº•å±‚çš„æ¶ˆæ¯æ—¥å¿—ç”±ä¸€ç³»åˆ—æ¶ˆæ¯é›†åˆæ—¥å¿—é¡¹ç»„æˆï¼Œkafkaæ˜¯åœ¨æ¶ˆæ¯é›†åˆå±‚é¢ä¸Šè¿›è¡Œå†™å…¥æ“ä½œï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:8:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"1ã€kafkaæ¶ˆæ¯æ ¼å¼ â€‹ kafkaæœ‰ä¸¤å¤§æ¶ˆæ¯æ ¼å¼ï¼šV1å’ŒV2ï¼ˆ0.11.0.0ç‰ˆæœ¬åå¼•å…¥çš„ï¼‰ï¼› â€‹ V1ä¸­æ¯æ¡æ¶ˆæ¯éœ€è¦æ‰§è¡ŒCRCæ ¡éªŒï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹CRCå€¼æ˜¯ä¼šå˜åŒ–çš„ï¼Œä¼šæµªè´¹ç©ºé—´å’Œè€½è¯¯CPUæ—¶é—´ï¼›åœ¨ä¿å­˜å‹ç¼©æ¶ˆæ¯ä¸Šï¼Œæ˜¯æŠŠå¤šæ¡æ¶ˆæ¯è¿›è¡Œå‹ç¼©ç„¶åä¿å­˜åˆ°å¤–å±‚æ¶ˆæ¯çš„æ¶ˆæ¯ä½“å­—æ®µä¸­ã€‚ â€‹ V2å¯¹V1æ”¹è¿›äº†å¾ˆå¤šï¼ŒCRCæ ¡éªŒå·¥ä½œç§»åˆ°äº†æ¶ˆæ¯é›†åˆè¿™ä¸€å±‚ï¼Œè€Œä¸”åœ¨ä¿å­˜å‹ç¼©æ¶ˆæ¯ä¸Šï¼Œæ˜¯å¯¹æ•´ä¸ªæ¶ˆæ¯é›†åˆè¿›è¡Œå‹ç¼©ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:8:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"2ã€ä½•æ—¶å‹ç¼©å’Œè§£å‹ç¼© ç”Ÿäº§è€…ç«¯ï¼šç”Ÿäº§æ¶ˆæ¯æ—¶æŒ‡å®šå‹ç¼©æ–¹æ³•ã€‚ brokerç«¯ï¼šé»˜è®¤çš„å‹ç¼©æ–¹å¼æ˜¯producerï¼Œå¦‚æœæŒ‡å®šäº†è·Ÿproducerä¸åŒçš„å‹ç¼©æ–¹å¼æ—¶ï¼Œä¼šå…ˆè§£å‹ç¼©å†æŒ‰æ–°æŒ‡å®šçš„æ–¹å¼å‹ç¼©ï¼›æˆ–è€…brokerç«¯å‘ç”Ÿäº†æ¶ˆæ¯æ ¼å¼è½¬æ¢ä¹Ÿä¼šé‡å‹ç¼©ã€‚ consumerç«¯ï¼šè§£å‹ç¼©ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:8:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"3ã€å‹ç¼©ç®—æ³• ï¼ˆkafka2.1.0ç‰ˆæœ¬å‰æ”¯æŒçš„ç®—æ³•ï¼šGZIPã€Snappyã€LZ4ï¼›è¯¥ç‰ˆæœ¬å¼€å§‹åæ”¯æŒZstandardç®—æ³•ï¼‰ å‹ç¼©ç®—æ³•çš„ä¼˜åŠ£æœ‰ä¸¤ä¸ªæŒ‡æ ‡ï¼šå‹ç¼©æ¯”å’Œå‹ç¼©/è§£å‹ç¼©ååé‡ï¼› å‹ç¼©æ¯”ï¼šzstd \u003e LZ4 \u003e GZIP \u003e Snappy ååé‡ï¼šLZ4 \u003e Snappy \u003e zstd / GZIP ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:8:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"9ã€æ— æ¶ˆæ¯ä¸¢å¤±é…ç½® kafkaåªå¯¹å·²æäº¤çš„æ¶ˆæ¯åšæœ‰é™åº¦çš„æŒä¹…åŒ–ä¿è¯ã€‚ ä¸è¦ä½¿ç”¨producer.send(msg),è€Œè¦ä½¿ç”¨producer.send(msg,callback); è®¾ç½®acks = allï¼›è¡¨æ˜æ‰€æœ‰å‰¯æœ¬brokeréƒ½è¦æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œä¿è¯æ¶ˆæ¯â€å·²æäº¤â€œï¼› è®¾ç½®retriesä¸ºä¸€ä¸ªè¾ƒå¤§çš„å€¼ï¼› è®¾ç½®unclean.leader.election.enable = falseï¼›è¡¨ç¤ºç¦æ­¢è½åçš„brokerè¢«é€‰ä¸ºleaderã€‚ è®¾ç½®replication.factor \u003e= 3ï¼› è®¾ç½®min.insync.replicas \u003e 1ï¼›æ§åˆ¶æ¶ˆæ¯è‡³å°‘è¢«å†™å…¥å¤šå°‘ä¸ªå‰¯æœ¬æ‰ç®—â€œå·²æäº¤â€ï¼› ç¡®ä¿replication.factor \u003e min.insync.replicasï¼›æ¨èreplication.factor = min.insync.replicas + 1ï¼› è®¾ç½®enable.auto.commit = falseï¼›ç¡®ä¿æ¶ˆæ¯æ¶ˆè´¹å®Œæˆå†æäº¤ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:9:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"10ã€å¹‚ç­‰æ€§å’Œäº‹åŠ¡æ€§ â€‹ å¹‚ç­‰æ€§ï¼šæŒ‡æŸäº›æ“ä½œæ‰§è¡Œä¸€æ¬¡æˆ–å¤šæ¬¡çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œåœ¨kafkaä¸­æ˜¯å¯¹é‡å¤æ¶ˆæ¯å»é‡ã€‚ â€‹ å¼•å…¥äº‹åŠ¡çš„ä½œç”¨ï¼š1ã€ ç”Ÿäº§è€…å¤šæ¬¡å‘é€æ¶ˆæ¯å¯ä»¥å°è£…æˆä¸€ä¸ªåŸå­æ“ä½œï¼Œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼›2ã€ consumer-transform-produceræ¨¡å¼ä¸‹ï¼Œå› ä¸ºæ¶ˆè´¹è€…æäº¤åç§»é‡å‡ºç°é—®é¢˜ï¼Œå¯¼è‡´åœ¨é‡å¤æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œç”Ÿäº§è€…é‡å¤ç”Ÿäº§æ¶ˆæ¯ã€‚éœ€è¦å°†è¿™ä¸ªæ¨¡å¼ä¸‹æ¶ˆè´¹è€…æäº¤åç§»é‡æ“ä½œå’Œç”Ÿäº§è€…ä¸€ç³»åˆ—ç”Ÿæˆæ¶ˆæ¯çš„æ“ä½œå°è£…æˆä¸€ä¸ªåŸå­æ“ä½œã€‚ â€‹ kafkaäº‹åŠ¡ä¸€èˆ¬ä¸ºä¸¤ç§ï¼š1ã€ åªæœ‰Producerç”Ÿäº§æ¶ˆæ¯ ï¼›2ã€ç”Ÿäº§æ¶ˆè´¹å¹¶å­˜ï¼ˆconsumer-transform-producerï¼‰ï¼›3ã€åªæœ‰Consumeræ¶ˆè´¹æ¶ˆæ¯ã€‚ å¹‚ç­‰æ€§Producerï¼šåªèƒ½ä¿è¯å•åˆ†åŒºã€å•ä¼šè¯ä¸Šçš„æ¶ˆæ¯å¹‚ç­‰æ€§ï¼ˆè®¾ç½®å¹‚ç­‰æ€§ï¼šprops.put(â€œenable.idempotenceâ€, true)æˆ–props.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, true)ï¼‰ äº‹åŠ¡æä¾›çš„ACIDç‰¹æ€§ï¼šåŸå­æ€§ï¼ˆAtomicityï¼‰ã€ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€æŒä¹…æ€§ï¼ˆDurabilityï¼‰ éš”ç¦»æ€§ï¼šè¡¨ç¤ºå¹¶å‘æ‰§è¡Œçš„äº‹åŠ¡å½¼æ­¤ç›¸äº’éš”ç¦»ï¼Œäº’ä¸å½±å“ã€‚ äº‹åŠ¡å‹Producerï¼šèƒ½å¤Ÿä¿è¯è·¨åˆ†åŒºã€è·¨ä¼šè¯é—´çš„å¹‚ç­‰æ€§(è®¾ç½®äº‹åŠ¡å‹Producerï¼šå¼€å¯enable.idempotence = trueï¼Œç„¶åè®¾ç½®Producerç«¯å‚æ•°transctional.id,è¿˜è¦è°ƒç”¨ä¸€äº›äº‹åŠ¡APIï¼Œå¦‚ä¸‹åˆ—ä»£ç ï¼›è¡¨ç¤ºrecord1å’Œrecord2è¦ä¹ˆå…¨éƒ¨å†™å…¥æˆåŠŸè¦ä¹ˆå¤±è´¥ã€‚åœ¨consumerç«¯è¦è®¾ç½®isolation.levelï¼Œread_uncommittedæ˜¯é»˜è®¤å€¼ï¼Œè¡¨ç¤ºå¯ä»¥è¯»å–åˆ°kafkaä»»ä½•æ¶ˆæ¯ï¼Œä¸ç®¡äº‹åŠ¡å‹Produceræ˜¯æäº¤äº‹åŠ¡è¿˜æ˜¯ç»ˆæ­¢äº‹åŠ¡ï¼›å»ºè®®ä½¿ç”¨read_committedï¼Œè¡¨ç¤ºåªè¯»å–äº‹åŠ¡å‹æˆåŠŸæäº¤çš„æ¶ˆæ¯ä»¥åŠéäº‹åŠ¡å‹Producerå†™å…¥çš„æ¶ˆæ¯ã€‚) producer.initTransactions(); try{ producer.beginTransaction(); producer.send(record1); producer.send(record2); producer.commitTransaction(); }catch(KafkaException e){ producer.abortTransaction(); } ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:10:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"11ã€Consumer Group ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:11:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"1ã€ç‰¹æ€§ ä¸€ä¸ªConsumer Groupå¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªConsumerï¼› Droup IDæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ ‡è¯†è¿™ä¸€ä¸ªå”¯ä¸€çš„Consumer Groupï¼› åŒä¸€ä¸ªGroupä¸­çš„Consumerä¸èƒ½é‡å¤è®¢é˜…ä¸€ä¸ªåˆ†åŒºï¼› ï¼ˆè€ç‰ˆæœ¬çš„Consumer GroupæŠŠæ¶ˆè´¹è€…ä½ç§»ä¿å­˜åœ¨zkä¸­ï¼Œç”±äºé¢‘ç¹è¯»å†™ä¼šå¯¼è‡´zké›†ç¾¤æ€§èƒ½é™ä½ï¼Œæ–°ç‰ˆæœ¬æŠŠæ¶ˆè´¹è€…ä½ç§»ä¿å­˜åœ¨kafkaçš„_consumer_offsetsçš„topicä¸­ã€‚ï¼‰ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:11:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"2ã€rebalanceçš„è§¦å‘æ¡ä»¶ Consumer Groupä¸­çš„æˆå‘˜æ•°å˜æ›´ï¼› è®¢é˜…çš„topicæ•°å˜æ›´ï¼ˆæ¯”å¦‚è®¢é˜…äº†ç”¨æ­£åˆ™åŒ¹é…çš„topicï¼Œæ–°å¢äº†ä¸€ä¸ªç¬¦åˆçš„topicï¼‰ï¼› è®¢é˜…çš„topicçš„åˆ†åŒºæ•°å˜æ›´ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:11:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"3ã€rebalanceçš„å¼Šç«¯ rebalanceå½±å“Consumerç«¯TPSï¼›ï¼ˆrebalanceæœŸé—´ï¼Œconsumerä¼šåœæ­¢å·¥ä½œï¼‰ rebalanceè¿‡ç¨‹å¾ˆæ…¢ï¼› rebalanceæ•ˆç‡ä¸é«˜ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:11:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"4ã€éå¿…è¦rebalance consumeræœªèƒ½åŠæ—¶ç»™coordinatorå‘é€å¿ƒè·³ï¼Œå¯¼è‡´consumerè¢«è¸¢å‡ºConsumer Groupï¼›éœ€è®¾ç½®åˆç†çš„session.timeout.msï¼ˆé»˜è®¤å€¼æ˜¯10sï¼Œè¡¨ç¤ºcoordinatoråœ¨10så†…æ²¡æ”¶åˆ°consumerçš„å¿ƒè·³æ¶ˆæ¯ï¼Œè¯¥consumerè¢«åˆ¤å®šä¸ºdeadï¼‰å’Œheartbeat.interval.msï¼ˆè¡¨ç¤ºconsumerå‘é€å¿ƒè·³è¯·æ±‚çš„é¢‘ç‡ï¼‰çš„å€¼ ï¼ˆæ¨èsession.timeout.ms=2sï¼Œheartbeat.interval.ms=6sï¼‰ consumeræ¶ˆè´¹æ—¶é—´è¿‡é•¿ï¼›éœ€è®¾ç½®max.poll.interval.msçš„å€¼ï¼Œè¡¨ç¤ºä¸‹æ¸¸å¤„ç†æ•°æ®çš„æ—¶é—´ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:11:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"12ã€ä½ç§»ä¸»é¢˜ï¼ˆ_consumer_offsetsï¼‰ â€‹ _consumer_offsetsçš„ä¸»è¦ä½œç”¨å°±æ˜¯ä¿å­˜Kafkaæ¶ˆè´¹è€…çš„ä½ç§»æ¶ˆæ¯ã€‚æ¶ˆæ¯æ ¼å¼æ˜¯KVå¯¹ï¼ŒKeyä¿å­˜çš„æ˜¯\u003cGroup ID,ä¸»é¢˜åï¼Œåˆ†åŒºå·\u003eï¼›å¦å¤–è¿˜æœ‰ä¸¤ç§æ¶ˆæ¯æ ¼å¼ï¼š1.ç”¨äºä¿å­˜Consumer Groupä¿¡æ¯çš„æ¶ˆæ¯ï¼›2.ç”¨äºåˆ é™¤Groupè¿‡æœŸä½ç§»ç”šè‡³æ˜¯åˆ é™¤Groupçš„æ¶ˆæ¯ã€‚ â€‹ å½“æœ‰ç¬¬ä¸€ä¸ªConsumeræ¶ˆè´¹æ•°æ®æ—¶ï¼ŒKafkaå°±ä¼šè‡ªåŠ¨åˆ›å»º_consumer_offsetsè¿™ä¸ªä¸»é¢˜ï¼Œé»˜è®¤æœ‰50ä¸ªåˆ†åŒºï¼Œ3ä¸ªå‰¯æœ¬ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:12:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"13ã€æäº¤ä½ç§» â€‹ ä»ç”¨æˆ·è§’åº¦ï¼Œåˆ†ä¸ºè‡ªåŠ¨æäº¤å’Œæ‰‹åŠ¨æäº¤ï¼›ä»Consumerè§’åº¦åˆ†ä¸ºåŒæ­¥æäº¤å’Œå¼‚æ­¥æäº¤ã€‚ org.apache.kafka.common.serialization.StringSerializer è‡ªåŠ¨æäº¤ è®¾ç½®ä¸ºè‡ªåŠ¨æäº¤åï¼Œè°ƒç”¨pollæ–¹æ³•æ—¶ï¼Œä¼šæäº¤ä¸Šæ¬¡pollè¿”å›çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œpollæ–¹æ³•çš„é€»è¾‘æ˜¯å…ˆæäº¤ä¸Šä¸€æ‰¹æ¶ˆæ¯çš„ä½ç§»ï¼Œå†å¤„ç†ä¸‹ä¸€æ‰¹æ¶ˆæ¯ï¼Œå¯ä»¥ä¿è¯ä¸å‡ºç°æ¶ˆè´¹ä¸¢å¤±çš„æƒ…å†µï¼Œç¼ºç‚¹æ˜¯å¯èƒ½å‡ºç°é‡å¤æ¶ˆè´¹ã€‚ Properties props = new Properties(); props.put(\"bootstrap.servers\",\"localhost:9092\"); props.put(\"group.id\",\"test\"); props.put(\"enable.auto.commit\",\"true\"); props.put(\"auto.commit.interval.ms\",\"2000\"); props.put(\"key.deserializer\",\"org.apache.kafka.common.serialization.String*Serializer\"); props.put(\"value.deserializer\",\"org.apache.kafka.common.serialization.String*Serializer\"); KafkaConsumer\u003cString,String\u003e consumer = new KafkaConsumer\u003c\u003e(props); consumer.subscribe(Arrays.asList(\"foo\",\"bar\")); while(true){ ConsumerRecords\u003cString,String\u003e records = consumer.poll(100); for(ConsumerRecord\u003cString,String\u003e record : records){ System.out.printf(\"offset = %d, key = %s, value = %s%n\", record.offset(), record.key(), resord.value()); } } åŒæ­¥æäº¤commitSync() æ‰‹åŠ¨æäº¤åœ¨è°ƒç”¨commitSync()æ—¶ï¼ŒConsumerä¼šå¤„äºé˜»å¡çŠ¶æ€ï¼Œç›´åˆ°Brokerç«¯è¿”å›ç»“æœï¼Œå½±å“æ•´ä¸ªç¨‹åºçš„TPSã€‚ while(true){ ConsumerRecords\u003cString,String\u003e records = consumer.poll(Duration.ofSeconds(1)); process(records); //å¤„ç†æ¶ˆæ¯ try{ consumer.commitSync(); }catch (CommitFailedException e){ handle(e); } } å¼‚æ­¥æäº¤commitAsync() åœ¨è°ƒç”¨commitAsync()æ—¶ï¼Œä¼šç«‹å³è¿”å›ç»“æœï¼Œä¸ä¼šé˜»å¡ï¼›ç¼ºç‚¹æ˜¯å‡ºç°é—®é¢˜æ—¶ä¸èƒ½è‡ªåŠ¨é‡è¯•ã€‚ while(true){ ConsumerRecords\u003cString,String\u003e records = consumer.poll(Duration.ofSeconds(1)); process(records); //å¤„ç†æ¶ˆæ¯ consumer.commitAsync((offsets,exception) -\u003e { if(exception != null) handle(exception); }); } åŒæ­¥+å¼‚æ­¥æäº¤ æ‰‹åŠ¨æäº¤ä¸­ï¼ŒcommitSync()å’ŒcommitAsync()ç»“åˆä½¿ç”¨ä¼šæœ‰å¾ˆå¥½çš„æ•ˆæœï¼Œåˆ©ç”¨commitSync()çš„è‡ªåŠ¨é‡è¯•é¿å…ç¬æ—¶é”™è¯¯ï¼Œåˆ©ç”¨commitAsync()ä¸ä¼šé˜»å¡ã€‚ try { while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); process(records); // å¤„ç†æ¶ˆæ¯ commitAysnc(); // ä½¿ç”¨å¼‚æ­¥æäº¤è§„é¿é˜»å¡ } } catch (Exception e) { handle(e); // å¤„ç†å¼‚å¸¸ } finally { try { consumer.commitSync(); // æœ€åä¸€æ¬¡æäº¤ä½¿ç”¨åŒæ­¥é˜»å¡å¼æäº¤ } finally { consumer.close(); } } åŒæ­¥/å¼‚æ­¥çš„ç»†ç²’åº¦æäº¤ é€šå¸¸pollçš„æ•°æ®å…¨éƒ¨å¤„ç†å®Œåå†æäº¤ä½ç§»ï¼Œå¦‚æœpollçš„æ€»æ•°å¾ˆå¤§ï¼Œè€Œå¤„ç†è¿‡ç¨‹ä¸­å‡ºç°å·®é”™äº†ï¼Œä¸‹ä¸€æ¬¡ä¼šé‡å¤æ¶ˆè´¹ï¼Œå°±éœ€è¦è®¾ç½®ç»†ç²’åº¦çš„æäº¤ä½ç§»ã€‚ private Map\u003cTopicPartition, OffsetAndMetadata\u003e offsets = new HashMap\u003c\u003e(); int count = 0; â€¦â€¦ while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); for (ConsumerRecord\u003cString, String\u003e record: records) { process(record); // å¤„ç†æ¶ˆæ¯ offsets.put(new TopicPartition(record.topic(), record.partition()), new OffsetAndMetadata(record.offset() + 1)); ifï¼ˆcount % 100 == 0ï¼‰ consumer.commitAsync(offsets, null); // å›è°ƒå¤„ç†é€»è¾‘æ˜¯ count++; } } ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:13:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"14ã€CommitFailedException â€‹ CommitFailedExceptionæ˜¯æŒ‡Consumerå®¢æˆ·ç«¯åœ¨æäº¤ä½ç§»æ—¶å‡ºç°äº†é”™è¯¯æˆ–å¼‚å¸¸ï¼Œè€Œä¸”ä¸å¯æ¢å¤ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:14:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"1ã€åœºæ™¯ä¸€ â€‹ å½“æ¶ˆæ¯å¤„ç†çš„æ€»æ—¶é—´è¶…è¿‡é¢„è®¾çš„ max.poll.interval.ms å‚æ•°å€¼æ—¶ï¼ŒKafka Consumer ç«¯ä¼šæŠ›å‡º CommitFailedException å¼‚å¸¸ã€‚ è§£å†³æ–¹æ³•å¦‚ä»£ç ï¼š â€¦ Properties props = new Properties(); â€¦ props.put(\"max.poll.interval.ms\", 5000); consumer.subscribe(Arrays.asList(\"test-topic\")); while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); // ä½¿ç”¨ Thread.sleep æ¨¡æ‹ŸçœŸå®çš„æ¶ˆæ¯å¤„ç†é€»è¾‘ Thread.sleep(6000L); consumer.commitSync(); } é˜²æ­¢å‡ºç°è¯¥å¼‚å¸¸çš„åŠæ³•ï¼š ç¼©çŸ­å•æ¡æ¶ˆæ¯å¤„ç†æ—¶é—´ï¼› å¢åŠ Comsumerç«¯å…è®¸ä¸‹æ¸¸ç³»ç»Ÿæ¶ˆè´¹ä¸€æ‰¹æ¶ˆæ¯çš„æœ€å¤§æ—¶é•¿ï¼ˆè®¾ç½®max.poll.interval.msçš„å€¼ï¼Œåœ¨0.10.1.0ç‰ˆæœ¬åæ‰æœ‰è¯¥å‚æ•°ï¼‰ï¼› å‡å°‘ä¸‹æ¸¸ç³»ç»Ÿä¸€æ¬¡æ€§æ¶ˆè´¹çš„æ¶ˆæ¯æ€»æ•°ï¼ˆè®¾ç½®max.poll.recordsçš„å€¼ï¼‰ï¼› ä¸‹æ¸¸ç³»ç»Ÿä½¿ç”¨å¤šçº¿ç¨‹åŠ é€Ÿæ¶ˆè´¹ï¼› ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:14:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"2ã€åœºæ™¯äºŒ â€‹ Standalone Consumeråœ¨æ¶ˆè´¹æ—¶ä¹Ÿéœ€è¦æŒ‡å®šgroud.idï¼Œå¦‚æœå‡ºç°äº†ä¸€ä¸ªç›¸åŒgroup.idçš„Consumer Groupï¼Œkafkaä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ï¼›è¿™ç§æƒ…å†µå¾ˆå°‘è§ï¼Œç›®å‰æ²¡æœ‰è§£å†³åŠæ³•ï¼Œè¦å°½é‡å»é¿å…ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:14:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"15ã€å¤šçº¿ç¨‹ â€‹ kafka 0.10.1.0ç‰ˆæœ¬å¼€å§‹ï¼ŒKafkaConsumerå°±æ˜¯åŒçº¿ç¨‹è®¾è®¡ï¼Œå³ç”¨æˆ·ä¸»çº¿ç¨‹å’Œå¿ƒè·³çº¿ç¨‹ï¼›ç”¨æˆ·ä¸»çº¿ç¨‹å°±æ˜¯å¯åŠ¨Consumeråº”ç”¨ç¨‹åºmainæ–¹æ³•çš„é‚£ä¸ªç¨‹åºï¼Œå¿ƒè·³çº¿ç¨‹åªè´Ÿè´£å®šæœŸç»™å¯¹åº”çš„çš„Brokeræœºå™¨å‘é€å¿ƒè·³è¯·æ±‚ï¼Œä»¥æ ‡è¯†æ¶ˆè´¹è€…åº”ç”¨çš„å­˜æ´»æ€§ã€‚æ‰€ä»¥åœ¨æ¶ˆè´¹å±‚é¢ä¸Šï¼ŒConsumerä¾ç„¶æ˜¯å•çº¿ç¨‹è®¾è®¡ã€‚ å¤šçº¿ç¨‹æ–¹æ¡ˆï¼š æ–¹æ¡ˆä¸€ï¼š â€‹ æ¶ˆè´¹è€…ç¨‹åºå¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸“å±çš„KafkaConsumerå®ä¾‹ï¼Œè´Ÿè´£å®Œæ•´çš„æ¶ˆæ¯è·å–å’Œæ¶ˆæ¯å¤„ç†æµç¨‹ï¼› ä¼˜ç‚¹ï¼š å®ç°èµ·æ¥ç®€å•ï¼› çº¿ç¨‹ä¹‹é—´æ²¡æœ‰äº¤äº’ï¼Œçœå»ä¿éšœçº¿ç¨‹å®‰å…¨çš„å¼€é”€ï¼› ç”±äºæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨ä¸“å±çš„Consumerå®ä¾‹æ‰§è¡Œæ¶ˆæ¯è·å–å’Œæ¶ˆæ¯å¤„ç†ï¼Œå¯ä»¥ä¿è¯åˆ†åŒºå†…çš„æ¶ˆè´¹é¡ºåºï¼› ç¼ºç‚¹ï¼š ç”±äºæ¯ä¸ªçº¿ç¨‹è¦ç»´æŠ¤è‡ªå·±çš„Consumerå®ä¾‹ï¼Œä¼šå ç”¨å¾ˆå¤šç³»ç»Ÿèµ„æºï¼› çº¿ç¨‹æ•°å—é™äºConsumerè®¢é˜…ä¸»é¢˜çš„æ€»åˆ†åŒºæ•°ï¼› å¦‚æœ‰æŸä¸ªçº¿ç¨‹å¤„ç†è¾ƒæ…¢ï¼Œä¼šé€ æˆrebalanceï¼› å®ç°ä»£ç å¦‚ä¸‹ï¼š public class KafkaConsumerRunner implements Runnable { private final AtomicBoolean closed = new AtomicBoolean(false); private final KafkaConsumer consumer; public void run() { try { consumer.subscribe(Arrays.asList(\"topic\")); while (!closed.get()) { ConsumerRecords records = consumer.poll(Duration.ofMillis(10000)); // æ‰§è¡Œæ¶ˆæ¯å¤„ç†é€»è¾‘ ... } } catch (WakeupException e) { // Ignore exception if closing if (!closed.get()) throw e; } finally { consumer.close(); } } // Shutdown hook which can be called from a separate thread public void shutdown() { closed.set(true); consumer.wakeup(); } } æ–¹æ¡ˆäºŒï¼š â€‹ æ¶ˆè´¹è€…ç¨‹åºä½¿ç”¨å•æˆ–å¤šçº¿ç¨‹è·å–æ¶ˆæ¯ï¼ŒåŒæ—¶åˆ›å»ºå¤šä¸ªæ¶ˆè´¹çº¿ç¨‹æ‰§è¡Œæ¶ˆæ¯å¤„ç†é€»è¾‘ï¼› ä¼˜ç‚¹ï¼š é«˜ä¼¸ç¼©æ€§ï¼Œè‡ªç”±è°ƒèŠ‚æ¶ˆæ¯è·å–å’Œæ¶ˆæ¯å¤„ç†çš„çº¿ç¨‹æ•°ï¼› ç¼ºç‚¹ï¼š å®ç°éš¾åº¦å¤§ï¼› ç”±äºæ¶ˆæ¯è·å–å’Œæ¶ˆæ¯å¤„ç†è§£è€¦ï¼Œä¼šç ´åæ¶ˆæ¯åœ¨åˆ†åŒºä¸­çš„é¡ºåºï¼› ä¼šä½¿å¾—æ•´ä¸ªæ¶ˆæ¯æ¶ˆè´¹é“¾è·¯è¢«æ‹‰é•¿ï¼Œä½ç§»æäº¤å¯èƒ½ä¼šå‡ºé”™ï¼Œå¯¼è‡´é‡å¤æ¶ˆè´¹ï¼› private final KafkaConsumer\u003cString, String\u003e consumer; private ExecutorService executors; ... private int workerNum = ...; executors = new ThreadPoolExecutor( workerNum, workerNum, 0L, TimeUnit.MILLISECONDS, new ArrayBlockingQueue\u003c\u003e(1000), new ThreadPoolExecutor.CallerRunsPolicy() ); ... while (true) { ConsumerRecords\u003cString, String\u003e records = consumer.poll(Duration.ofSeconds(1)); for (final ConsumerRecord record : records) { executors.submit(new Worker(record)); } } .. ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/04/:15:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/04/"},{"categories":null,"content":"Java æ ¸å¿ƒæŠ€æœ¯ 36è®² 01ã€è°ˆè°ˆä½ å¯¹ Java çš„ç†è§£ 02ã€Exception å’Œ Error çš„åŒºåˆ« 03ã€finalã€finallyã€finalize çš„åŒºåˆ« ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/java-core-36/readme/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/java-core-36/readme/"},{"categories":null,"content":"1ã€Kafka æ˜¯ä¸€æ¬¾æ¶ˆæ¯å¼•æ“ç³»ç»Ÿ æ¶ˆæ¯å¼•æ“ç³»ç»Ÿæ˜¯ä¸€ç»„è§„èŒƒã€‚ä¼ä¸šåˆ©ç”¨è¿™ç»„è§„èŒƒåœ¨ä¸åŒç³»ç»Ÿä¹‹é—´ä¼ é€’è¯­ä¹‰å‡†ç¡®çš„æ¶ˆæ¯ï¼Œå®ç°æ¾è€¦åˆçš„å¼‚æ­¥å¼æ•°æ®ä¼ é€’ã€‚ Kafka çš„æ¶ˆæ¯ç¼–ç æ ¼å¼æ˜¯ äºŒè¿›åˆ¶çš„å­—èŠ‚åºåˆ— Kafka æ”¯æŒçš„ä¸¤ç§æ¶ˆæ¯æ¨¡å‹ ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼Œç³»ç»Ÿ A å‘é€çš„æ¶ˆæ¯åªèƒ½è¢« B ç³»ç»Ÿæ¶ˆè´¹ï¼Œå…¶ä»–ç³»ç»Ÿä¸èƒ½è¯»å– A ç³»ç»Ÿå‘é€çš„æ¶ˆæ¯ï¼Œä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ å‘å¸ƒ / è®¢é˜…æ¨¡å‹ï¼Œæœ‰ Topicï¼ˆä¸»é¢˜ï¼‰ã€Producerï¼ˆç”Ÿäº§è€…ï¼‰ã€Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰çš„æ¦‚å¿µï¼Œå¯èƒ½ä¼šå­˜åœ¨å¤šä¸ª Producer å‘ Topic å‘é€æ¶ˆæ¯ï¼Œä¹Ÿå¯èƒ½å­˜åœ¨å¤šä¸ª Consumer æ¥æ¶ˆè´¹æ¶ˆæ¯ï¼Œå¤šå¯¹å¤šçš„å…³ç³»ã€‚ æ¶ˆæ¯é˜Ÿåˆ—çš„ä¼˜ç‚¹ï¼šè§£è€¦ã€å¼‚æ­¥ã€å‰Šå³° ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/01/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/01/"},{"categories":null,"content":"1ã€Kafka æœ¯è¯­ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Recordï¼ˆæ¶ˆæ¯ï¼‰ Kafka å¤„ç†çš„ä¸»è¦å¯¹è±¡ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Topicï¼ˆä¸»é¢˜ï¼‰ ä¸»é¢˜æ˜¯æ‰¿è½½æ¶ˆæ¯çš„é€»è¾‘å®¹å™¨ï¼Œåœ¨å®é™…ä½¿ç”¨ä¸­å¤šç”¨æ¥åŒºåˆ†å…·ä½“çš„ä¸šåŠ¡ã€‚ ä½ å¯ä»¥ä¸ºæ¯ä¸ªä¸šåŠ¡ã€æ¯ä¸ªåº”ç”¨ç”šè‡³æ˜¯æ¯ç±»æ•°æ®éƒ½åˆ›å»ºä¸“å±çš„ä¸»é¢˜ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Partitionï¼ˆåˆ†åŒºï¼‰ ä¸€ä¸ªæœ‰åºä¸å˜çš„æ¶ˆæ¯åºåˆ—ã€‚æ¯ä¸ªä¸»é¢˜ä¸‹å¯ä»¥æœ‰å¤šä¸ªåˆ†åŒºã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Offsetï¼ˆæ¶ˆæ¯ä½ç§»ï¼‰ åˆ†åŒºä¸­æ¯æ¡æ¶ˆæ¯çš„ä½ç½®ä¿¡æ¯ï¼Œæ˜¯ä¸€ä¸ªå•è°ƒé€’å¢ä¸”ä¸å˜çš„å€¼ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Producerï¼ˆç”Ÿäº§è€…ï¼‰ å‘ä¸»é¢˜å‘å¸ƒæ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰ ä»ä¸»é¢˜è®¢é˜…æ–°æ¶ˆæ¯çš„åº”ç”¨ç¨‹åºã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:6","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Consumer Offsetï¼ˆæ¶ˆè´¹è€…ä½ç§»ï¼‰ æ¶ˆè´¹è€…æ¶ˆè´¹è¿›åº¦ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½æœ‰è‡ªå·±çš„æ¶ˆè´¹è€…ä½ç§»ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:7","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Consumer Groupï¼ˆæ¶ˆè´¹è€…ç»„ï¼‰ å¤šä¸ªæ¶ˆè´¹è€…å®ä¾‹å…±åŒç»„æˆçš„ä¸€ä¸ªç»„ï¼ŒåŒæ—¶æ¶ˆè´¹å¤šä¸ªåˆ†åŒºä»¥å®ç°é«˜ååã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:8","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"Rebalance ï¼ˆé‡å¹³è¡¡ï¼‰ æ¶ˆè´¹è€…ç»„å†…æŸä¸ªæ¶ˆè´¹è€…å®ä¾‹æŒ‚æ‰åï¼Œå…¶ä»–æ¶ˆè´¹è€…å®ä¾‹è‡ªåŠ¨é‡æ–°åˆ†é…è®¢é˜…ä¸»é¢˜åˆ†åŒºçš„è¿‡ç¨‹ã€‚ Rebalance æ˜¯ Kafka æ¶ˆè´¹è€…ç«¯å®ç°é«˜å¯ç”¨çš„é‡è¦æ‰‹æ®µã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:1:9","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"2ã€Kafka ä¸‰å±‚æ¶ˆæ¯æ¶æ„ ç¬¬ä¸€å±‚æ˜¯ä¸»é¢˜å±‚ï¼Œæ¯ä¸ªä¸»é¢˜å¯ä»¥é…ç½® M ä¸ªåˆ†åŒºï¼Œè€Œæ¯ä¸ªåˆ†åŒºåˆå¯ä»¥é…ç½® N ä¸ªå‰¯æœ¬ã€‚ ç¬¬äºŒå±‚æ˜¯åˆ†åŒºå±‚ï¼Œæ¯ä¸ªåˆ†åŒºçš„ N ä¸ªå‰¯æœ¬ä¸­åªèƒ½æœ‰ä¸€ä¸ªå……å½“é¢†å¯¼è€…è§’è‰²ï¼Œå¯¹å¤–æä¾›æœåŠ¡ï¼›å…¶ä»– N-1 ä¸ªå‰¯æœ¬æ˜¯è¿½éšè€…å‰¯æœ¬ï¼Œåªæ˜¯æä¾›æ•°æ®å†—ä½™ä¹‹ç”¨ã€‚ ç¬¬ä¸‰å±‚æ˜¯æ¶ˆæ¯å±‚ï¼Œåˆ†åŒºä¸­åŒ…å«è‹¥å¹²æ¡æ¶ˆæ¯ï¼Œæ¯æ¡æ¶ˆæ¯çš„ä½ç§»ä» 0 å¼€å§‹ï¼Œä¾æ¬¡é€’å¢ã€‚ æœ€åï¼Œå®¢æˆ·ç«¯ç¨‹åºåªèƒ½ä¸åˆ†åŒºçš„é¢†å¯¼è€…å‰¯æœ¬è¿›è¡Œäº¤äº’ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"3ã€Kafka æŒä¹…åŒ–æ•°æ® Kafka ä½¿ç”¨æ¶ˆæ¯æ—¥å¿—ï¼ˆLogï¼‰æ¥ä¿å­˜æ•°æ®ï¼Œæ¶ˆæ¯æ—¥å¿—åªèƒ½è¿½åŠ å†™å…¥ï¼Œæ‰€ä»¥é¿å…äº†éšæœº I/O æ“ä½œï¼Œæ”¹ä¸ºæ€§èƒ½è¾ƒå¥½çš„é¡ºåº I/O å†™æ“ä½œã€‚ åœ¨ Kafka åº•å±‚ï¼Œä¸€ä¸ªæ—¥å¿—ä¼šç»†åˆ†æˆå¤šä¸ªæ—¥å¿—æ®µï¼Œæ¶ˆæ¯è¢«è¿½åŠ å†™åˆ°å½“å‰æœ€æ–°çš„æ—¥å¿—æ®µä¸­ï¼Œå½“å†™æ»¡äº†ä¸€ä¸ªæ—¥å¿—æ®µåï¼ŒKafka ä¼šè‡ªåŠ¨åˆ‡åˆ†å‡ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ®µï¼Œå¹¶å°†è€çš„æ—¥å¿—æ®µå°å­˜èµ·æ¥ã€‚Kafka åœ¨åå°è¿˜æœ‰å®šæ—¶ä»»åŠ¡ä¼šå®šæœŸåœ°æ£€æŸ¥è€çš„æ—¥å¿—æ®µæ˜¯å¦èƒ½å¤Ÿè¢«åˆ é™¤ï¼Œä»è€Œå®ç°å›æ”¶ç£ç›˜ç©ºé—´çš„ç›®çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/02/"},{"categories":null,"content":"1ã€Kafka æ˜¯åˆ†å¸ƒå¼æµå¤„ç†å¹³å° Apache Kafka æ˜¯æ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æµå¤„ç†å¹³å°ã€‚ Kafka çš„ç‰¹æ€§ï¼š æä¾›ä¸€å¥— API å®ç°ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ã€‚ é™ä½ç½‘ç»œä¼ è¾“å’Œç£ç›˜å­˜å‚¨å¼€é”€ã€‚ å®ç°é«˜ä¼¸ç¼©æ€§æ¶æ„ã€‚ å¯ä»¥å®ç°ç«¯åˆ°ç«¯çš„ç²¾ç¡®ä¸€æ¬¡å¤„ç†è¯­ä¹‰ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/03/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/03/"},{"categories":null,"content":"1ã€Kafka ä¸åŒçš„\"å‘è¡Œç‰ˆ\" ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/"},{"categories":null,"content":"1ã€Apache Kafka åªæä¾›æœ€åŸºç¡€çš„ç»„ä»¶ï¼Œæ²¡æœ‰ä»»ä½•ç›‘æ§æ¡†æ¶æˆ–å·¥å…·ã€‚ å¦‚æœä½ ä»…ä»…éœ€è¦ä¸€ä¸ªæ¶ˆæ¯å¼•æ“ç³»ç»Ÿäº¦æˆ–æ˜¯ç®€å•çš„æµå¤„ç†åº”ç”¨åœºæ™¯ï¼ŒåŒæ—¶éœ€è¦å¯¹ç³»ç»Ÿæœ‰è¾ƒå¤§æŠŠæ§åº¦ï¼Œé‚£ä¹ˆæˆ‘æ¨èä½ ä½¿ç”¨ Apache Kafkaã€‚ ä¼˜åŠ¿åœ¨äºè¿­ä»£é€Ÿåº¦å¿«ï¼Œç¤¾åŒºå“åº”åº¦é«˜ï¼Œä½¿ç”¨å®ƒå¯ä»¥è®©ä½ æœ‰æ›´é«˜çš„æŠŠæ§åº¦ï¼›ç¼ºé™·åœ¨äºä»…æä¾›åŸºç¡€æ ¸å¿ƒç»„ä»¶ï¼Œç¼ºå¤±ä¸€äº›é«˜çº§çš„ç‰¹æ€§ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/"},{"categories":null,"content":"2ã€Confluent Kafka åˆ†ä¸ºå…è´¹ç‰ˆå’Œä¼ä¸šç‰ˆã€‚ å…è´¹ç‰ˆåŒ…å« Schema æ³¨å†Œä¸­å¿ƒå’Œ REST proxy ä¸¤å¤§åŠŸèƒ½ã€‚å‰è€…æ˜¯å¸®åŠ©ä½ é›†ä¸­ç®¡ç† Kafka æ¶ˆæ¯æ ¼å¼ä»¥å®ç°æ•°æ®å‰å‘ / åå‘å…¼å®¹ï¼›åè€…ç”¨å¼€æ”¾ HTTP æ¥å£çš„æ–¹å¼å…è®¸ä½ é€šè¿‡ç½‘ç»œè®¿é—® Kafka çš„å„ç§åŠŸèƒ½ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯ Apache Kafka æ‰€æ²¡æœ‰çš„ã€‚ ä¼ä¸šç‰ˆåŒ…å«è·¨æ•°æ®ä¸­å¿ƒå¤‡ä»½å’Œé›†ç¾¤ç›‘æ§ä¸¤å¤§åŠŸèƒ½ã€‚ ä¼˜åŠ¿åœ¨äºé›†æˆäº†å¾ˆå¤šé«˜çº§ç‰¹æ€§ä¸”ç”± Kafka åŸç­äººé©¬æ‰“é€ ï¼Œè´¨é‡ä¸Šæœ‰ä¿è¯ï¼›ç¼ºé™·åœ¨äºç›¸å…³æ–‡æ¡£èµ„æ–™ä¸å…¨ï¼Œæ™®åŠç‡è¾ƒä½ï¼Œæ²¡æœ‰å¤ªå¤šå¯ä¾›å‚è€ƒçš„èŒƒä¾‹ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/"},{"categories":null,"content":"3ã€Cloudera/Hortonworks Kafka å¤§æ•°æ®äº‘å…¬å¸å‘å¸ƒçš„ Kafkaï¼ˆCDH/HDP Kafkaï¼‰ã€‚è¿™äº›å¤§æ•°æ®å¹³å°å¤©ç„¶é›†æˆäº† Apache Kafkaï¼Œé€šè¿‡ä¾¿æ·åŒ–çš„ç•Œé¢æ“ä½œå°† Kafka çš„å®‰è£…ã€è¿ç»´ã€ç®¡ç†ã€ç›‘æ§å…¨éƒ¨ç»Ÿä¸€åœ¨æ§åˆ¶å°ä¸­ã€‚ å¦‚æœä½ éœ€è¦å¿«é€Ÿåœ°æ­å»ºæ¶ˆæ¯å¼•æ“ç³»ç»Ÿï¼Œæˆ–è€…ä½ éœ€è¦æ­å»ºçš„æ˜¯å¤šæ¡†æ¶æ„æˆçš„æ•°æ®å¹³å°ä¸” Kafka åªæ˜¯å…¶ä¸­ä¸€ä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆæˆ‘æ¨èä½ ä½¿ç”¨è¿™äº›å¤§æ•°æ®äº‘å…¬å¸æä¾›çš„ Kafkaã€‚ ä¼˜åŠ¿åœ¨äºæ“ä½œç®€å•ï¼ŒèŠ‚çœè¿ç»´æˆæœ¬ï¼›ç¼ºé™·åœ¨äºæŠŠæ§åº¦ä½ï¼Œæ¼”è¿›é€Ÿåº¦è¾ƒæ…¢ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/04/"},{"categories":null,"content":"1ã€Kafka çš„ç‰ˆæœ¬ [scala-version] - [kafka-version].tar.gz 0.10.0.0 å¼•è¿› Kafka Stream 0.11.0.0 æ·»åŠ å¹‚ç­‰æ€§ Producer å’Œäº‹åŠ¡ APIï¼Œå¹¶å¯¹ Kafka æ¶ˆæ¯æ ¼å¼è¿›è¡Œé‡æ„ æ€»ç»“ï¼š å¦‚æœåªä½¿ç”¨ Kafka çš„æ¶ˆæ¯å¼•æ“åŠŸèƒ½ï¼Œ æœ€å°‘ 0.10.2.2ï¼Œ å¯ä»¥ä½¿ç”¨æ–°ç‰ˆçš„ Consumer APIã€‚ å¦‚æœä½¿ç”¨ Kafka Streamï¼Œæœ€å°‘ 2.0.0ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/05/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/05/"},{"categories":null,"content":"1ã€æ“ä½œç³»ç»Ÿ ä¸‰ä¸ªæ–¹é¢é€‰æ‹©ï¼š I/O æ¨¡å‹çš„ä½¿ç”¨ æ•°æ®ç½‘ç»œä¼ è¾“æ•ˆç‡ ç¤¾åŒºæ”¯æŒåº¦ äº”ç§ I/O æ¨¡å‹ï¼šé˜»å¡å¼ I/Oã€éé˜»å¡å¼ I/Oã€I/O å¤šè·¯å¤ç”¨ã€ä¿¡å·é©±åŠ¨ I/O å’Œå¼‚æ­¥ I/Oã€‚ Linux ä¸­çš„ç³»ç»Ÿè°ƒç”¨ select å‡½æ•°å°±å±äº I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼›epoll ç³»ç»Ÿè°ƒç”¨åˆ™ä»‹äºç¬¬ä¸‰ç§å’Œç¬¬å››ç§æ¨¡å‹ä¹‹é—´ã€‚ Linux è¿˜å¯ä»¥ä½¿ç”¨ zero copyã€‚ æ€»ç»“ï¼› é«˜æ€§èƒ½åªèƒ½é€‰æ‹© linuxã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/"},{"categories":null,"content":"2ã€ç£ç›˜ æ€»ç»“ï¼š è¿½æ±‚æ€§ä»·æ¯”çš„å…¬å¸å¯ä»¥ä¸æ­å»º RAIDã€‚ ä½¿ç”¨æœºæ¢°ç£ç›˜å®Œå…¨èƒ½å¤Ÿèƒœä»» Kafka çº¿ä¸Šç¯å¢ƒã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/"},{"categories":null,"content":"3ã€ç£ç›˜å®¹é‡ è§„åˆ’ç£ç›˜å®¹é‡çš„æ€è€ƒå› ç´ ï¼š æ–°å¢æ¶ˆæ¯æ•° æ¶ˆæ¯ç•™å­˜æ—¶é—´ å¹³å‡æ¶ˆæ¯å¤§å° å¤‡ä»½æ•° æ˜¯å¦å¯ç”¨å‹ç¼© ä¾‹å¦‚ï¼š æ¯ä¸€å¤© 1 äº¿æ¡ 1KB å¤§å°çš„æ¶ˆæ¯ï¼Œä¿å­˜ä¸¤ä»½ä¸”å­˜ç•™ä¸¤å‘¨çš„æ—¶é—´ã€‚ ä¸€å¤©æ•°æ®å¤§å°ï¼š 1 äº¿ * 1 KB * 2 ä»½ / 1000 / 1000 = 200 GB é¢„ç•™ 10% çš„ç£ç›˜ç©ºé—´ï¼š 200 GB * 1.1 = 220 GB ä¸¤å‘¨æ—¶é—´ï¼š 220 GB * 14 = 3 TB å¼€å¯äº†å‹ç¼©æ¯”ï¼Œæ¯”å¦‚ 0.75ï¼š 3 TB * 0.75 = 2.25 TB ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/"},{"categories":null,"content":"4ã€å¸¦å®½ ä»¥ 1Gbps çš„åƒå…†ç½‘ç»œä¸ºä¾‹ï¼Œ åœ¨ 1 å°æ—¶å†…å¤„ç† 1TB çš„ä¸šåŠ¡æ•°æ®ï¼Œéœ€è¦æœºå™¨æ•°ï¼Ÿ å¸¦å®½æ˜¯ 1Gbpsï¼Œå³æ¯ç§’å¤„ç† 1Gb çš„æ•°æ®ï¼Œé€šå¸¸å‡è®¾ Kafka åªèƒ½ç”¨åˆ° 70% çš„å¸¦å®½èµ„æºï¼Œæ¯•ç«Ÿå…¶ä»–è¿›ç¨‹ä¹Ÿéœ€è¦ä¸€äº›èµ„æºï¼Œä¹Ÿå°±æ˜¯Kafka æœ€å¤§åªèƒ½ä½¿ç”¨ 700MB çš„å¸¦å®½èµ„æºï¼Œå¸¸è§„æ€§ä½¿ç”¨è¦é¢„ç•™ 2/3ï¼Œæ‰€ä»¥å•å° Kafka ä½¿ç”¨çš„å¸¦å®½ä¸º 700 Mb / 3 = 240 Mbpsã€‚ 1 ä¸ªå°æ—¶å¤„ç† 1TB æ•°æ®ï¼Œ 1024 * 1024 / 3600 / (240 / 8) = 9.7 (æ³¨æ„ 240 Mbps æ˜¯å¸¦å®½ï¼Œå˜ä¸º MB å•ä½æ—¶ï¼Œè¦é™¤ä»¥ 8)ã€‚ å¦‚æœæ¶ˆæ¯çš„å‰¯æœ¬æ•°ä¸º 3ï¼Œå¤§çº¦å°±æ˜¯ 30 å°æœºå™¨ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/06/"},{"categories":null,"content":"1ã€Broker ç«¯å‚æ•° ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/"},{"categories":null,"content":"1ã€broker å­˜å‚¨ä¿¡æ¯ log.dirs: æ—¥å¿—ç›®å½•ï¼Œä¾‹å¦‚ /home/kafka1,/home/kafka2,/home/kafka3ã€‚ log.dir: åªéœ€è¦è®¾ç½®å‚æ•°log.dirsï¼Œæ­¤å‚æ•°ä¸éœ€è¦ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/"},{"categories":null,"content":"2ã€zk ä¿¡æ¯ zookeeper.connect: è¿æ¥ zk çš„å‚æ•°ï¼Œä¾‹å¦‚ zk1:2181,zk2:2181,zk3:2181ã€‚ å¦‚æœè®©å¤šä¸ª Kafka é›†ç¾¤ä½¿ç”¨åŒä¸€å¥— zk é›†ç¾¤ï¼Œåˆ©ç”¨ zk çš„ chroot è®¾ç½®ï¼Œä¾‹å¦‚ zookeeper.connect å¯ä»¥è®¾ç½®ä¸º zk1:2181,zk2:2181,zk3:2181/kafka1 å’Œ zk1:2181,zk2:2181,zk3:2181/kafka2ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/"},{"categories":null,"content":"3ã€broker è¿æ¥ä¿¡æ¯ listeners: ç›‘å¬å™¨ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ä»€ä¹ˆåè®®è®¿é—®æŒ‡å®šä¸»æœºåå’Œç«¯å£å¼€æ”¾çš„ Kafka æœåŠ¡ã€‚ advertised.listeners: Broker ç”¨äºå¯¹å¤–å‘å¸ƒçš„ç›‘å¬å™¨ã€‚ ç›‘å¬å™¨é…ç½®ï¼Œç”±ä¸‰å…ƒç»„ \u003cåè®®åç§°ï¼Œä¸»æœºåï¼Œç«¯å£å·\u003e æ„æˆï¼Œä¾‹å¦‚ä½ è‡ªå·±å®šä¹‰çš„åè®®åå­— CONTROLLER://localhost:9092ã€‚ ä¸€æ—¦ä½ è‡ªå·±å®šä¹‰äº†åè®®åç§°ï¼Œä½ å¿…é¡»è¿˜è¦æŒ‡å®š listener.security.protocol.map å‚æ•°å‘Šè¯‰è¿™ä¸ªåè®®åº•å±‚ä½¿ç”¨äº†å“ªç§å®‰å…¨åè®®ï¼Œæ¯”å¦‚æŒ‡å®š listener.security.protocol.map=CONTROLLER:PLAINTEXT è¡¨ç¤º CONTROLLER è¿™ä¸ªè‡ªå®šä¹‰åè®®åº•å±‚ä½¿ç”¨æ˜æ–‡ä¸åŠ å¯†ä¼ è¾“æ•°æ®ã€‚ host.name/port: è¿‡æœŸã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/"},{"categories":null,"content":"4ã€topic ç®¡ç† auto.create.topics.enable: æ˜¯å¦å…è®¸è‡ªåŠ¨åˆ›å»º Topic, å»ºè®®ä¸º falseã€‚ unclean.leader.election.enableï¼š æ˜¯å¦å…è®¸ Unclean Leader é€‰ä¸¾ï¼Œ å»ºè®®ä¸º falseã€‚ Unclean Leader é€‰ä¸¾ï¼ŒæŒ‡çš„æ˜¯è½åå¤ªå¤šçš„å‰¯æœ¬å‚ä¸é€‰ä¸¾ï¼Œå¯èƒ½ä¼šä½¿æ•°æ®ä¸¢å¤±ã€‚ auto.leader.rebalance.enable: æ˜¯å¦å…è®¸å®šæœŸè¿›è¡Œ Leader é€‰ä¸¾ï¼Œå»ºè®®ä¸º falseã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/:1:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/"},{"categories":null,"content":"5ã€æ•°æ®ç•™å­˜ log.retention.{hour|minutes|ms}: æ—¥å¿—ä¿ç•™æ—¶é—´ã€‚ä¾‹å¦‚ log.retention.hour=168 è¡¨ç¤ºé»˜è®¤ä¿å­˜ 7 å¤©çš„æ•°æ®ã€‚ log.retention.bytes: æ¶ˆæ¯ä¿å­˜çš„æ€»ç£ç›˜å®¹é‡å¤§å°ã€‚é»˜è®¤ä¸º -1ï¼Œè¡¨ç¤ºå®¹é‡æ— é™åˆ¶ï¼Œåœ¨äº‘ä¸Šçš„å¤šç§Ÿæˆ·æ‰ç”¨åˆ°æ­¤å‚æ•°ã€‚ message.max.bytes: æœ€å¤§æ¶ˆæ¯å¤§å°ã€‚å®é™…ä¸Šï¼Œ1MB çš„æ¶ˆæ¯å¾ˆå¸¸è§ã€‚ æ³¨æ„ï¼šä¸Šè¿°çš„å‚æ•°éƒ½ä¸èƒ½ä½¿ç”¨é»˜è®¤å€¼ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/:1:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/07/"},{"categories":null,"content":"1ã€Topic çº§åˆ«å‚æ•° å¦‚æœåŒæ—¶è®¾ç½®äº† Topic çº§åˆ«å‚æ•°å’Œå…¨å±€ Broker å‚æ•°ï¼ŒTopic çº§åˆ«å‚æ•°ä¼šè¦†ç›–å…¨å±€ Broker å‚æ•°çš„å€¼ï¼Œè€Œæ¯ä¸ª Topic éƒ½èƒ½è®¾ç½®è‡ªå·±çš„å‚æ•°å€¼ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„ Topic çº§åˆ«å‚æ•°ã€‚ retention.ms: è¯¥ Topic æ¶ˆæ¯è¢«ä¿å­˜çš„æ—¶é•¿ï¼Œä¼šè¦†ç›–æ‰ Broker ç«¯çš„å…¨å±€å‚æ•°å€¼ã€‚ retention.bytes: è¯¥ Topic é¢„ç•™å¤šå¤§çš„ç£ç›˜ç©ºé—´ï¼Œå½“å‰é»˜è®¤å€¼æ˜¯ -1ï¼Œè¡¨ç¤ºå¯ä»¥æ— é™ä½¿ç”¨ç£ç›˜ç©ºé—´ï¼Œåœ¨å¤šç§Ÿæˆ·çš„ Kafka é›†ç¾¤ä¸­ç”¨åˆ°ã€‚ max.message.bytes: Topic çš„æœ€å¤§æ¶ˆæ¯å¤§å°ã€‚ Topic è®¾ç½®æ–¹å¼ï¼ˆğŸ‰Kafkaå®˜æ–¹æ–‡æ¡£ğŸ‰ï¼‰ï¼š åˆ›å»º Topic æ—¶è®¾ç½® â€“config åé¢æŒ‡å®šäº†æƒ³è¦è®¾ç½®çš„ Topic çº§åˆ«å‚æ•°ã€‚ bin/kafka-topics.sh --bootstrap-server localhost:9092 --create --topic my-topic --partitions 1 --replication-factor 1 --config retention.ms=15552000000 --config max.message.bytes=5242880 ä¿®æ”¹ Topic æ—¶è®¾ç½® bin/kafka-configs.sh --zookeeper localhost:2181 --entity-type topics --entity-name my-topic --alter --add-config max.message.bytes=10485760 ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/08/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/08/"},{"categories":null,"content":"2ã€JVM å‚æ•° Java7 ä¸­ï¼Œå¦‚æœ Broker æ‰€åœ¨æœºå™¨çš„ CPU èµ„æºéå¸¸å……è£•ï¼Œåˆ™å»ºè®®å¼€å¯ CMS åƒåœ¾å›æ”¶å™¨, -XX:+UseCurrentMarkSweepGCã€‚å¦åˆ™ï¼Œä½¿ç”¨ååé‡æ”¶é›†å™¨ã€‚å¼€å¯æ–¹æ³•æ˜¯æŒ‡å®š -XX:+UseParallelGCã€‚ Java8 ä¸­ï¼Œå»ºè®®ä½¿ç”¨ G1 åƒåœ¾å›æ”¶å™¨ã€‚ å»ºè®®ä½¿ç”¨ Java8ã€‚ KAFKA_HEAP_OPTS: å †å¤§å°, å»ºè®®ä¸º 6GBï¼Œè¿™æ˜¯æ¯”è¾ƒå…¬è®¤çš„åˆç†å€¼ã€‚ KAFKA_JVM_PERFORMANCE_OPTS: æŒ‡å®š GC å‚æ•°ã€‚ æ¯”å¦‚ä½ å¯ä»¥è¿™æ ·å¯åŠ¨ Kafkaï¼š export KAFKA_HEAP_OPTS=--Xms6g --Xmx6g export KAFKA_JVM_PERFORMANCE_OPTS= -server -XX:+UseG1GC -XX:MaxGCPauseMillis=20 -XX:InitiatingHeapOccupancyPercent=35 -XX:+ExplicitGCInvokesConcurrent -Djava.awt.headless=true bin/kafka-server-start.sh config/server.properties ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/08/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/08/"},{"categories":null,"content":"3ã€æ“ä½œç³»ç»Ÿå‚æ•° ä¸»è¦ç³»ç»Ÿå‚æ•°ï¼š æ–‡ä»¶æè¿°ç¬¦é™åˆ¶ æ‰§è¡Œå‘½ä»¤ ulimit -n 1000000 æ¥è®¾ç½®ã€‚ æ–‡ä»¶ç³»ç»Ÿç±»å‹ XFS çš„æ€§èƒ½è¦å¼ºäº ext4ã€‚ Swappiness å°† swap äº¤æ¢å†…å­˜é…ç½®æˆä¸€ä¸ªæ¥è¿‘ 0 ä½†ä¸ä¸º 0 çš„å€¼ï¼Œæ¯”å¦‚ 1ã€‚ æäº¤æ—¶é—´ å‘ Kafka å‘é€æ•°æ®å¹¶ä¸æ˜¯çœŸè¦ç­‰æ•°æ®è¢«å†™å…¥ç£ç›˜æ‰ä¼šè®¤ä¸ºæˆåŠŸï¼Œè€Œæ˜¯åªè¦æ•°æ®è¢«å†™å…¥åˆ°æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ï¼ˆPage Cacheï¼‰ä¸Šå°±å¯ä»¥äº†ï¼Œéšåæ“ä½œç³»ç»Ÿæ ¹æ® LRU ç®—æ³•ä¼šå®šæœŸå°†é¡µç¼“å­˜ä¸Šçš„\"è„\"æ•°æ®è½ç›˜åˆ°ç‰©ç†ç£ç›˜ä¸Šã€‚è¿™ä¸ªå®šæœŸå°±æ˜¯ç”±æäº¤æ—¶é—´æ¥ç¡®å®šçš„ï¼Œé»˜è®¤æ˜¯ 5 ç§’ã€‚ç”±äº Kafka çš„å¤šå‰¯æœ¬çš„å†—ä½™æœºåˆ¶ï¼Œå¯ä»¥ç¨å¾®æ‹‰å¤§æäº¤é—´éš”æ¥æé«˜æ€§èƒ½ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/08/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/08/"},{"categories":null,"content":"1ã€ä¸ºä»€ä¹ˆåˆ†åŒº Kafka çš„æ¶ˆæ¯ç»„ç»‡æ–¹å¼å®é™…ä¸Šæ˜¯ä¸‰çº§ç»“æ„ï¼šä¸»é¢˜ - åˆ†åŒº - æ¶ˆæ¯ï¼Œä¸»é¢˜ä¸‹çš„æ¯æ¡æ¶ˆæ¯åªä¼šä¿å­˜åœ¨æŸä¸€ä¸ªåˆ†åŒºä¸­ã€‚ Kafka çš„ä¸‰çº§ç»“æ„ï¼š åˆ†åŒºæ˜¯ä¸ºäº†å®ç°ç³»ç»Ÿçš„é«˜ä¼¸ç¼©æ€§ï¼ˆScalabilityï¼‰ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ æ–°çš„èŠ‚ç‚¹æ¥å¢åŠ æ•´ä½“ç³»ç»Ÿçš„ååé‡ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"2ã€åˆ†åŒºç­–ç•¥ æ‰€è°“åˆ†åŒºç­–ç•¥æ˜¯å†³å®šç”Ÿäº§è€…å°†æ¶ˆæ¯å‘é€åˆ°å“ªä¸ªåˆ†åŒºçš„ç®—æ³•ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"1ã€è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥ ä½ éœ€è¦æ˜¾å¼åœ°é…ç½®ç”Ÿäº§è€…ç«¯çš„å‚æ•° partitioner.classï¼Œåœ¨ç¼–å†™ç”Ÿäº§è€…ç¨‹åºæ—¶ï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªå…·ä½“çš„ç±»å®ç° org.apache.kafka.clients.producer.Partitioner æ¥å£ï¼Œå®ç° partition() å’Œ close() æ¥å£ã€‚ æ–¹æ³•ç­¾åï¼š int partition(String topic, Object key, byte[] keyBytes, Object value, byte[] valueBytes, Cluster cluster); ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"2ã€è½®è¯¢ç­–ç•¥ Kafka é»˜è®¤çš„åˆ†åŒºç­–ç•¥å°±æ˜¯è½®è¯¢ç­–ç•¥ï¼Œè½®è¯¢ç­–ç•¥æœ‰éå¸¸ä¼˜ç§€çš„è´Ÿè½½å‡è¡¡è¡¨ç°ï¼Œå®ƒæ€»æ˜¯èƒ½ä¿è¯æ¶ˆæ¯æœ€å¤§é™åº¦åœ°è¢«å¹³å‡åˆ†é…åˆ°æ‰€æœ‰åˆ†åŒºä¸Šã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:2:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"3ã€éšæœºç­–ç•¥ è¦å®ç°éšæœºç­–ç•¥ç‰ˆçš„ partition æ–¹æ³•(è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥)ï¼Œå¦‚ä¸‹ï¼š List\u003cPartitionInfo\u003e partitions = cluster.partitionsForTopic(topic); return ThreadLocalRandom.current().nextInt(partitions.size()); ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:2:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"4ã€æŒ‰æ¶ˆæ¯é”®ä¿åºç­–ç•¥ å®ç°è¿™ä¸ªç­–ç•¥çš„ partition æ–¹æ³•(è‡ªå®šä¹‰åˆ†åŒºç­–ç•¥)ï¼Œå¦‚ä¸‹ï¼š List\u003cPartitionInfo\u003e partitions = cluster.partitionsForTopic(topic); return Math.abs(key.hashCode()) % partitions.size(); Kafka é»˜è®¤åˆ†åŒºç­–ç•¥å®é™…ä¸ŠåŒæ—¶å®ç°äº†ä¸¤ç§ç­–ç•¥ï¼šå¦‚æœæŒ‡å®šäº† Keyï¼Œé‚£ä¹ˆé»˜è®¤å®ç°æŒ‰æ¶ˆæ¯é”®ä¿åºç­–ç•¥ï¼›å¦‚æœæ²¡æœ‰æŒ‡å®š Keyï¼Œåˆ™ä½¿ç”¨è½®è¯¢ç­–ç•¥ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:2:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"5ã€å…¶ä»–åˆ†åŒºç­–ç•¥ æ¯”è¾ƒå¸¸è§çš„ä¸€ç§å°±æ˜¯åŸºäºåœ°ç†ä½ç½®çš„åˆ†åŒºç­–ç•¥ã€‚ æ¯”å¦‚æ ¹æ® Broker æ‰€åœ¨çš„ IP åœ°å€å®ç°å®šåˆ¶åŒ–çš„åˆ†åŒºç­–ç•¥ï¼Œå¦‚ä¸‹ï¼š List\u003cPartitionInfo\u003e partitions = cluster.partitionsForTopic(topic); return partitions.stream().filter(p -\u003e isSouth(p.leader().host())).map(PartitionInfo::partition).findAny().get(); æˆ‘ä»¬å¯ä»¥ä»æ‰€æœ‰åˆ†åŒºä¸­æ‰¾å‡ºé‚£äº› Leader å‰¯æœ¬åœ¨å—æ–¹çš„æ‰€æœ‰åˆ†åŒºï¼Œç„¶åéšæœºæŒ‘é€‰ä¸€ä¸ªè¿›è¡Œæ¶ˆæ¯å‘é€ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/:2:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/09/"},{"categories":null,"content":"1ã€æ¶ˆæ¯æ ¼å¼ Kafka çš„æ¶ˆæ¯æ ¼å¼ç›®å‰æœ‰ä¸¤ç§ï¼šV1 å’Œ V2ã€‚ ä¸è®ºæ˜¯å“ªä¸ªç‰ˆæœ¬ï¼ŒKafka çš„æ¶ˆæ¯å±‚æ¬¡éƒ½åˆ†ä¸ºä¸¤å±‚ï¼šæ¶ˆæ¯é›†åˆ(message set) å’Œ æ¶ˆæ¯(message)ã€‚ä¸€ä¸ªæ¶ˆæ¯é›†åˆåŒ…å«è‹¥å¹²æ¡æ—¥å¿—é¡¹(record item)ï¼Œæ—¥å¿—é¡¹ä¸­åŒ…å«å¤šæ¡æ¶ˆæ¯ã€‚ åœ¨ V1 ç‰ˆæœ¬ä¸­ï¼Œæ¯æ¡æ¶ˆæ¯éƒ½è¦æ‰§è¡Œ CRC æ ¡éªŒï¼Œä½†æœ‰äº›æƒ…å†µä¸‹æ¶ˆæ¯çš„ CRC å€¼æ˜¯ä¼šå‘ç”Ÿå˜åŒ–çš„ã€‚æ¯”å¦‚åœ¨ Broker ç«¯å¯èƒ½ä¼šå¯¹æ¶ˆæ¯æ—¶é—´æˆ³å­—æ®µè¿›è¡Œæ›´æ–°ï¼Œæˆ–è€…åœ¨æ‰§è¡Œæ¶ˆæ¯æ ¼å¼è½¬æ¢ï¼ˆå…¼å®¹è€ç‰ˆæœ¬å®¢æˆ·ç«¯ç¨‹åºï¼‰ã€‚å¯¹äºè¿™äº›æƒ…å†µï¼Œæ¯æ¡æ¶ˆæ¯éƒ½æ‰§è¡Œ CRC æ ¡éªŒå°±æœ‰ç‚¹æ²¡å¿…è¦äº†ã€‚åœ¨ V2 ç‰ˆæœ¬ä¸­ï¼Œæ¶ˆæ¯çš„ CRC æ ¡éªŒå·¥ä½œå°±è¢«ç§»åˆ°äº†æ¶ˆæ¯é›†åˆè¿™ä¸€å±‚ã€‚ åœ¨ V1 ç‰ˆæœ¬ä¸­ï¼Œä¿å­˜å‹ç¼©æ¶ˆæ¯çš„æ–¹æ³•æ˜¯æŠŠå¤šæ¡æ¶ˆæ¯è¿›è¡Œå‹ç¼©ç„¶åä¿å­˜åˆ°å¤–å±‚æ¶ˆæ¯çš„æ¶ˆæ¯ä½“å­—æ®µä¸­ï¼›è€Œåœ¨ V2 ç‰ˆæœ¬ä¸­ï¼Œæ˜¯å¯¹æ•´ä¸ªæ¶ˆæ¯é›†åˆè¿›è¡Œå‹ç¼©ã€‚æ˜¾ç„¶åè€…åº”è¯¥æ¯”å‰è€…æœ‰æ›´å¥½çš„å‹ç¼©æ•ˆæœã€‚ åœ¨ç›¸åŒæ¡ä»¶ä¸‹ï¼Œä¸è®ºæ˜¯å¦å¯ç”¨å‹ç¼©ï¼ŒV2 ç‰ˆæœ¬éƒ½æ¯” V1 ç‰ˆæœ¬èŠ‚çœç£ç›˜ç©ºé—´ã€‚å½“å¯ç”¨å‹ç¼©æ—¶ï¼Œè¿™ç§èŠ‚çœç©ºé—´çš„æ•ˆæœæ›´åŠ æ˜æ˜¾ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/"},{"categories":null,"content":"2ã€ä½•æ—¶å‹ç¼© åœ¨ Kafka ä¸­ï¼Œå‹ç¼©å¯èƒ½å‘ç”Ÿåœ¨ä¸¤ä¸ªåœ°æ–¹ï¼šç”Ÿäº§è€…ç«¯å’Œ Broker ç«¯ã€‚ Properties props = new Properties(); props.put(\"bootstrap.servers\", \"localhost:9092\"); props.put(\"compression.type\", \"gzip\"); Producer\u003cString, String\u003e producer = new KafkaProducer\u003c\u003e(props); ä¸Šè¿°ä»£ç ï¼Œè¡¨æ˜è¯¥ Producer çš„å‹ç¼©ç®—æ³•ä½¿ç”¨çš„æ˜¯ GZIPã€‚ ä½†æœ‰ä¸¤ç§ä¾‹å¤–æƒ…å†µè®© Broker é‡æ–°å‹ç¼©æ¶ˆæ¯ï¼š Broker ç«¯æŒ‡å®šäº†å’Œ Producer ç«¯ä¸åŒçš„å‹ç¼©ç®—æ³•ã€‚ Broker ç«¯å‘ç”Ÿäº†æ¶ˆæ¯æ ¼å¼è½¬æ¢ï¼ˆå…¼å®¹è€çš„å®¢æˆ·ç«¯ç¨‹åºï¼‰ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/"},{"categories":null,"content":"3ã€ä½•æ—¶è§£å‹ç¼© ä¸€å¥è¯ï¼šProducer ç«¯å‹ç¼©ã€Broker ç«¯ä¿æŒã€Consumer ç«¯è§£å‹ç¼©ã€‚ é™¤äº†åœ¨ Consumer ç«¯è§£å‹ç¼©ï¼ŒBroker ç«¯ä¹Ÿä¼šè¿›è¡Œè§£å‹ç¼©ï¼Œç›®çš„æ˜¯ä¸ºäº†å¯¹æ¶ˆæ¯æ‰§è¡Œå„ç§éªŒè¯ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/"},{"categories":null,"content":"4ã€å‹ç¼©ç®—æ³•å¯¹æ¯” åœ¨ Kafka 2.1.0 ç‰ˆæœ¬ä¹‹å‰ï¼ŒKafka æ”¯æŒ 3 ç§å‹ç¼©ç®—æ³•ï¼šGZIPã€Snappy å’Œ LZ4ã€‚ä» 2.1.0 å¼€å§‹ï¼ŒKafka æ­£å¼æ”¯æŒ Zstandard ç®—æ³•ï¼ˆzstdï¼‰ã€‚ å‹ç¼©ç®—æ³•æœ‰ä¸¤ä¸ªé‡è¦æŒ‡æ ‡ï¼šå‹ç¼©æ¯”ã€å‹ç¼©/è§£å‹ç¼©ååé‡ã€‚ ååé‡æ–¹é¢: LZ4 \u003e Snappy \u003e zstd å’Œ GZIPã€‚ å‹ç¼©æ¯”æ–¹é¢ï¼šzstd \u003e LZ4 \u003e GZIP \u003e Snappy æ€»ç»“ï¼š æœºå™¨çš„ CPU èµ„æºä¸å……è¶³ï¼Œä¸å»ºè®®å¼€å¯å‹ç¼©ï¼Œå› ä¸ºå‹ç¼©éœ€è¦æ¶ˆè€—å¤§é‡ CPUã€‚ æœºå™¨çš„ CPU èµ„æºå……è¶³ï¼Œå¼ºçƒˆå»ºè®®ä½ å¼€å¯ zstd å‹ç¼©ï¼Œè¿™æ ·èƒ½æå¤§åœ°èŠ‚çœç½‘ç»œèµ„æºæ¶ˆè€—ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/10/"},{"categories":null,"content":"Kafka æ ¸å¿ƒæŠ€æœ¯ä¸å®æˆ˜ 01ã€æ¶ˆæ¯å¼•æ“ç³»ç»Ÿ 02ã€Kafka æœ¯è¯­ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/kafka-core-tech/readme/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/kafka-core-tech/readme/"},{"categories":null,"content":"1ã€MySQL çš„åŸºæœ¬æ¶æ„ ä¸»è¦åˆ†ä¸ºServerå±‚å’Œå­˜å‚¨å¼•æ“å±‚ã€‚ Serverå±‚åŒ…æ‹¬è¿æ¥å™¨ã€æŸ¥è¯¢ç¼“å­˜ã€åˆ†æå™¨ã€ä¼˜åŒ–å™¨ã€æ‰§è¡Œå™¨ç­‰ï¼Œæ¶µç›–MySQLçš„å¤§å¤šæ•°æ ¸å¿ƒæœåŠ¡åŠŸèƒ½ï¼Œä»¥åŠæ‰€æœ‰çš„å†…ç½®å‡½æ•°ï¼ˆå¦‚æ—¥æœŸã€æ—¶é—´ã€æ•°å­¦å’ŒåŠ å¯†å‡½æ•°ç­‰ï¼‰ï¼Œæ‰€æœ‰è·¨å­˜å‚¨å¼•æ“çš„åŠŸèƒ½éƒ½åœ¨è¿™ä¸€å±‚å®ç°ï¼Œæ¯”å¦‚å­˜å‚¨è¿‡ç¨‹ã€è§¦å‘å™¨ã€è§†å›¾ç­‰ã€‚ å­˜å‚¨å¼•æ“å±‚è´Ÿè´£æ•°æ®çš„å­˜å‚¨å’Œæå–ã€‚å…¶æ¶æ„æ¨¡å¼æ˜¯æ’ä»¶å¼çš„ï¼Œæ”¯æŒ InnoDB ã€ MyISAM ã€ Memory ç­‰å¤šä¸ªå­˜å‚¨å¼•æ“ã€‚ç°åœ¨æœ€å¸¸ç”¨çš„å­˜å‚¨å¼•æ“æ˜¯ InnoDB ï¼Œå®ƒä» MySQL 5.5.5ç‰ˆæœ¬å¼€å§‹æˆä¸ºäº†é»˜è®¤å­˜å‚¨å¼•æ“ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"2ã€æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œæµç¨‹ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"1ã€è¿æ¥å™¨ è¿æ¥å™¨è´Ÿè´£è·Ÿå®¢æˆ·ç«¯å»ºç«‹è¿æ¥ã€è·å–æƒé™ã€ç»´æŒå’Œç®¡ç†è¿æ¥ã€‚ è¿æ¥å‘½ä»¤ï¼š mysql -h$ip -P$port -u$user -p å¦‚æœç”¨æˆ·åå¯†ç è®¤è¯é€šè¿‡ï¼Œè¿æ¥å™¨ä¼šåˆ°æƒé™è¡¨é‡Œé¢æŸ¥å‡ºä½ æ‹¥æœ‰çš„æƒé™ã€‚ è¿æ¥å®Œæˆåï¼Œå¦‚æœä½ æ²¡æœ‰åç»­çš„åŠ¨ä½œï¼Œè¿™ä¸ªè¿æ¥å°±å¤„äºç©ºé—²çŠ¶æ€ï¼ˆSleepï¼‰ï¼Œé€šè¿‡ show processlist å‘½ä»¤æŸ¥çœ‹å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯é•¿æ—¶é—´å¤„äº Sleep çŠ¶æ€ï¼Œè¿æ¥å™¨å°±ä¼šè‡ªåŠ¨å°†å®ƒæ–­å¼€ã€‚ç”±å‚æ•° wait_timeout æ§åˆ¶çš„ï¼Œé»˜è®¤å€¼æ˜¯8å°æ—¶ã€‚ æ•°æ®åº“é‡Œé¢ï¼Œé•¿è¿æ¥æ˜¯æŒ‡è¿æ¥æˆåŠŸåï¼Œå¦‚æœå®¢æˆ·ç«¯æŒç»­æœ‰è¯·æ±‚ï¼Œåˆ™ä¸€ç›´ä½¿ç”¨åŒä¸€ä¸ªè¿æ¥ã€‚çŸ­è¿æ¥åˆ™æ˜¯æŒ‡æ¯æ¬¡æ‰§è¡Œå®Œå¾ˆå°‘çš„å‡ æ¬¡æŸ¥è¯¢å°±æ–­å¼€è¿æ¥ï¼Œä¸‹æ¬¡æŸ¥è¯¢å†é‡æ–°å»ºç«‹ä¸€ä¸ªã€‚å»ºç«‹è¿æ¥çš„è¿‡ç¨‹é€šå¸¸æ˜¯æ¯”è¾ƒå¤æ‚çš„ï¼Œæ‰€ä»¥å°½é‡ä½¿ç”¨é•¿è¿æ¥ã€‚ ä½†å…¨éƒ¨ä½¿ç”¨é•¿è¿æ¥åï¼Œæœ‰äº›æ—¶å€™ MySQL å ç”¨å†…å­˜æ¶¨å¾—ç‰¹åˆ«å¿«ï¼Œè¿™æ˜¯å› ä¸º MySQL åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸´æ—¶ä½¿ç”¨çš„å†…å­˜æ˜¯ç®¡ç†åœ¨è¿æ¥å¯¹è±¡é‡Œé¢çš„ï¼Œè¿™äº›èµ„æºä¼šåœ¨è¿æ¥æ–­å¼€çš„æ—¶å€™æ‰é‡Šæ”¾ã€‚æ‰€ä»¥å¦‚æœé•¿è¿æ¥ç´¯ç§¯ä¸‹æ¥ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜å ç”¨å¤ªå¤§ï¼Œè¢«ç³»ç»Ÿå¼ºè¡Œæ€æ‰ï¼ˆOOMï¼‰ï¼Œä»ç°è±¡çœ‹å°±æ˜¯ MySQL å¼‚å¸¸é‡å¯äº†ã€‚ é•¿è¿æ¥è§£å†³æ–¹æ¡ˆï¼š å®šæœŸæ–­å¼€é•¿è¿æ¥. åœ¨ MySQL 5.7 ç‰ˆæœ¬åï¼Œé€šè¿‡æ‰§è¡Œ mysql_reset_connectionæ¥é‡æ–°åˆå§‹åŒ–è¿æ¥èµ„æºï¼Œ æ— éœ€é‡æ–°è¿æ¥å’Œæƒé™è®¤è¯ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"2ã€æŸ¥è¯¢ç¼“å­˜ åªè¦å¯¹ä¸€ä¸ªè¡¨æ›´æ–°ï¼Œè¿™ä¸ªè¡¨ä¸Šæ‰€æœ‰çš„æŸ¥è¯¢ç¼“å­˜éƒ½ä¼šè¢«æ¸…ç©ºã€‚ MySQL 8.0 ç¼“å­˜åŠŸèƒ½å·²ç»è¢«åˆ é™¤ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:2:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"3ã€åˆ†æå™¨ å¯¹SQLè¯­å¥åšè§£æï¼Œè¯æ³•åˆ†æï¼ˆselectã€insertã€deleteã€updateï¼‰ã€è¯­æ³•åˆ†æï¼ˆè¯­æ³•æ˜¯å¦æ­£ç¡®ï¼‰ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:2:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"4ã€ä¼˜åŒ–å™¨ ä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•ã€‚ ä¾‹å¦‚ï¼Œå¯¹äºä¸‹é¢çš„è¯­å¥ï¼Œæœ‰ä¸¤ç§æŸ¥è¯¢é€»è¾‘ï¼š mysql\u003e select * from t1 join t2 using(ID) where t1.c=10 and t2.d=20; å…ˆä» t1 é‡Œé¢å–å‡º c = 10 çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ° t2ï¼Œå†åˆ¤æ–­ t2 é‡Œé¢ d çš„å€¼æ˜¯å¦ç­‰äº 20ã€‚ å…ˆä» t2 é‡Œé¢å–å‡º d = 20 çš„è®°å½•çš„IDå€¼ï¼Œå†æ ¹æ® ID å€¼å…³è”åˆ° t1ï¼Œå†åˆ¤æ–­ t1 é‡Œé¢ c çš„å€¼æ˜¯å¦ç­‰äº 10ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:2:4","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"5ã€æ‰§è¡Œå™¨ å…ˆåˆ¤æ–­æŸ¥è¯¢æƒé™ï¼Œå¦‚æœæœ‰æƒé™ï¼Œæ‰§è¡Œå™¨å°±ä¼šè°ƒç”¨å­˜å‚¨å¼•æ“æä¾›çš„æ¥å£ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:2:5","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"3ã€é—®é¢˜ å¦‚æœä½ æ‰§è¡Œ select * from T where k=1ï¼ŒæŠ¥ä¸å­˜åœ¨ K è¿™ä¸€åˆ—ã€‚æ˜¯åœ¨å“ªä¸ªé˜¶æ®µæŠ¥å‡ºæ¥çš„ï¼Ÿ åˆ†æå™¨é˜¶æ®µ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/01/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/01/"},{"categories":null,"content":"1ã€æ›´æ–°è¯­å¥çš„æ‰§è¡Œæµç¨‹ åˆ›å»ºè¡¨ T: mysql\u003e create table T(ID int primary key, c int); å°† ID = 2 è¿™ä¸€è¡Œçš„å€¼åŠ  1 çš„ SQL è¯­å¥: mysql\u003e update T set c=c+1 where ID=2; æŸ¥è¯¢è¯­å¥çš„é‚£ä¸€å¥—æµç¨‹ï¼Œæ›´æ–°è¯­å¥ä¹Ÿæ˜¯åŒæ ·ä¼šèµ°ä¸€éã€‚ ç»è¿‡è¿æ¥å™¨å’ŒæŸ¥è¯¢ç¼“å­˜ä¹‹åï¼Œåˆ†æå™¨é€šè¿‡è¯æ³•å’Œè¯­æ³•åˆ†æçŸ¥é“è¿™æ˜¯ä¸€æ¡æ›´æ–°è¯­å¥ï¼Œä¼˜åŒ–å™¨å†³å®šè¦ä½¿ç”¨ ID è¿™ä¸ªç´¢å¼•ï¼Œæ‰§è¡Œå™¨è´Ÿè´£å…·ä½“æ‰§è¡Œï¼Œæ‰¾åˆ°è¿™ä¸€è¡Œï¼Œç„¶åæ›´æ–°ã€‚ ä¸æŸ¥è¯¢æµç¨‹ä¸ä¸€æ ·çš„æ˜¯ï¼Œæ›´æ–°æµç¨‹è¿˜æ¶‰åŠä¸¤ä¸ªé‡è¦çš„æ—¥å¿—æ¨¡å—ï¼š **redo logï¼ˆé‡åšæ—¥å¿—ï¼‰**å’Œ binlogï¼ˆå½’æ¡£æ—¥å¿—ï¼‰ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/02/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/02/"},{"categories":null,"content":"2ã€redo log redo log æ˜¯ InnoDB å¼•æ“ç‰¹æœ‰çš„æ—¥å¿—æ¨¡å—ã€‚ åœ¨ MySQL ä¸­ï¼Œå¦‚æœæ¯ä¸€æ¬¡çš„æ›´æ–°æ“ä½œéƒ½éœ€è¦å†™è¿›ç£ç›˜ï¼Œç„¶åç£ç›˜ä¹Ÿè¦æ‰¾åˆ°å¯¹åº”çš„é‚£æ¡è®°å½•ï¼Œç„¶åå†æ›´æ–°ï¼Œæ•´ä¸ªè¿‡ç¨‹ IO æˆæœ¬ã€æŸ¥æ‰¾æˆæœ¬éƒ½å¾ˆé«˜ã€‚ä¸ºäº†æé«˜æ›´æ–°æ•ˆç‡ï¼ŒMySQL ä½¿ç”¨ WALï¼ˆWrite-Ahead Loggingï¼‰æŠ€æœ¯ï¼Œå®ƒçš„å…³é”®ç‚¹å°±æ˜¯å…ˆå†™æ—¥å¿—ï¼Œå†å†™ç£ç›˜ã€‚ å½“æœ‰è®°å½•éœ€è¦æ›´æ–°æ—¶ï¼ŒInnoDB å¼•æ“å°±ä¼šå…ˆæŠŠè®°å½•å†™åˆ° redo log é‡Œé¢ï¼Œå¹¶æ›´æ–°å†…å­˜ï¼Œè¿™æ—¶æ›´æ–°å°±ç®—å®Œæˆäº†ã€‚åŒæ—¶ï¼ŒInnoDBå¼•æ“ä¼šåœ¨é€‚å½“çš„æ—¶å€™ï¼ˆç³»ç»Ÿæ¯”è¾ƒç©ºé—²ï¼‰ï¼Œå°†è¿™ä¸ªè®°å½•æ›´æ–°åˆ°ç£ç›˜é‡Œé¢ã€‚ InnoDBçš„ redo log æ˜¯å›ºå®šå¤§å°çš„ï¼Œæ¯”å¦‚å¯ä»¥é…ç½®ä¸ºä¸€ç»„ 4 ä¸ªæ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶çš„å¤§å°æ˜¯ 1GBï¼Œé‚£ä¹ˆæ€»å…±å¯ä»¥è®°å½• 4GB çš„æ“ä½œã€‚ä»å¤´å¼€å§‹å†™ï¼Œå†™åˆ°æœ«å°¾åˆå›åˆ°å¼€å¤´å¾ªç¯å†™ã€‚ write pos æ˜¯å½“å‰è®°å½•çš„ä½ç½®ï¼Œä¸€è¾¹å†™ä¸€è¾¹åç§»ã€‚ checkpoint æ˜¯å½“å‰è¦æ“¦é™¤çš„ä½ç½®ï¼Œæ“¦é™¤è®°å½•å‰è¦æŠŠè®°å½•æ›´æ–°åˆ°æ•°æ®æ–‡ä»¶ã€‚ æœ‰äº† redo logï¼ŒInnoDB å°±å¯ä»¥ä¿è¯å³ä½¿æ•°æ®åº“å‘ç”Ÿå¼‚å¸¸é‡å¯ï¼Œä¹‹å‰æäº¤çš„è®°å½•éƒ½ä¸ä¼šä¸¢å¤±ï¼Œè¿™ä¸ªèƒ½åŠ›ç§°ä¸º crash-safeã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/02/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/02/"},{"categories":null,"content":"3ã€binlog binlog æ˜¯ Sever å±‚çš„æ—¥å¿—æ¨¡å—ï¼Œåªèƒ½ç”¨äºå½’æ¡£ï¼Œæ¯”å¦‚ä¸»ä»å¤åˆ¶ã€‚ ä¸¤ç§æ—¥å¿—ä¸åŒï¼š redo log æ˜¯InnoDBå¼•æ“ç‰¹æœ‰çš„ï¼›binlogæ˜¯MySQLçš„Serverå±‚å®ç°çš„ï¼Œæ‰€æœ‰å¼•æ“éƒ½å¯ä»¥ä½¿ç”¨ã€‚ redo log æ˜¯ç‰©ç†æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯â€œåœ¨æŸä¸ªæ•°æ®é¡µä¸Šåšäº†ä»€ä¹ˆä¿®æ”¹â€ï¼›binlog æ˜¯é€»è¾‘æ—¥å¿—ï¼Œè®°å½•çš„æ˜¯è¿™ä¸ªè¯­å¥çš„åŸå§‹é€»è¾‘ï¼Œæ¯”å¦‚â€œç»™ID=2è¿™ä¸€è¡Œçš„cå­—æ®µåŠ 1â€ã€‚ redo log æ˜¯å¾ªç¯å†™ï¼Œå†™åˆ°æœ«å°¾åˆå›åˆ°å¼€å¤´å†™ï¼›binlogæ˜¯è¿½åŠ å†™å…¥ï¼Œå†™åˆ°ä¸€å®šå¤§å°åä¼šåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªï¼Œå¹¶ä¸ä¼šè¦†ç›–ä»¥å‰çš„æ—¥å¿—ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/02/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/02/"},{"categories":null,"content":"4ã€ä¸¤é˜¶æ®µæäº¤ ä¸Šé¢ç®€å•çš„ updata è¯­å¥çš„æ‰§è¡Œæµç¨‹ã€‚ æ‰§è¡Œå™¨å…ˆæ‰¾å¼•æ“å– ID = 2 è¿™ä¸€è¡Œã€‚ID æ˜¯ä¸»é”®ï¼Œå¼•æ“ç›´æ¥ç”¨æ ‘æœç´¢æ‰¾åˆ°è¿™ä¸€è¡Œã€‚å¦‚æœID=2 è¿™ä¸€è¡Œæ‰€åœ¨çš„æ•°æ®é¡µæœ¬æ¥å°±åœ¨å†…å­˜ä¸­ï¼Œå°±ç›´æ¥è¿”å›ç»™æ‰§è¡Œå™¨ï¼›å¦åˆ™ï¼Œéœ€è¦å…ˆä»ç£ç›˜è¯»å…¥å†…å­˜ï¼Œç„¶åå†è¿”å›ã€‚ æ‰§è¡Œå™¨æ‹¿åˆ°å¼•æ“ç»™çš„è¡Œæ•°æ®ï¼ŒæŠŠè¿™ä¸ªå€¼åŠ ä¸Š1ï¼Œæ¯”å¦‚åŸæ¥æ˜¯Nï¼Œç°åœ¨å°±æ˜¯N+1ï¼Œå¾—åˆ°æ–°çš„ä¸€è¡Œæ•°æ®ï¼Œå†è°ƒç”¨å¼•æ“æ¥å£å†™å…¥è¿™è¡Œæ–°æ•°æ®ã€‚ å¼•æ“å°†è¿™è¡Œæ–°æ•°æ®æ›´æ–°åˆ°å†…å­˜ä¸­ï¼ŒåŒæ—¶å°†è¿™ä¸ªæ›´æ–°æ“ä½œè®°å½•åˆ° redo log é‡Œé¢ï¼Œæ­¤æ—¶ redo log å¤„äº prepare çŠ¶æ€ã€‚ç„¶åå‘ŠçŸ¥æ‰§è¡Œå™¨æ‰§è¡Œå®Œæˆäº†ï¼Œéšæ—¶å¯ä»¥æäº¤äº‹åŠ¡ã€‚ æ‰§è¡Œå™¨ç”Ÿæˆè¿™ä¸ªæ“ä½œçš„ binlogï¼Œå¹¶æŠŠ binlog å†™å…¥ç£ç›˜ã€‚ æ‰§è¡Œå™¨è°ƒç”¨å¼•æ“çš„æäº¤äº‹åŠ¡æ¥å£ï¼Œå¼•æ“æŠŠåˆšåˆšå†™å…¥çš„ redo log æ”¹æˆ commit çŠ¶æ€ï¼Œæ›´æ–°å®Œæˆã€‚ å¦‚æœä¸ä½¿ç”¨ä¸¤é˜¶æ®µæäº¤ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ å…ˆå†™ redo log åå†™ binlogã€‚å‡è®¾åœ¨ redo log å†™å®Œï¼Œbinlog è¿˜æ²¡æœ‰å†™å®Œçš„æ—¶å€™ï¼ŒMySQLè¿›ç¨‹å¼‚å¸¸é‡å¯ï¼Œbinlog ä¸­æ²¡æœ‰æ›´æ–°çš„æ•°æ®ã€‚ å…ˆå†™ binlog åå†™ redo logã€‚å¦‚æœåœ¨ binlog å†™å®Œä¹‹å crashï¼Œç”±äº redo log æ²¡æœ‰å†™ï¼Œå´©æºƒæ¢å¤ä»¥åè¿™ä¸ªäº‹åŠ¡æ— æ•ˆï¼Œæ‰€ä»¥è¿™ä¸€è¡Œ c çš„å€¼æ˜¯ 0ï¼Œä½† binlog ä¸­ c = 1 äº†ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/02/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/02/"},{"categories":null,"content":"5ã€é…ç½® åŒ1è®¾ç½®ï¼š innodb_flush_log_at_trx_commit = 1 è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ redo log éƒ½ç›´æ¥æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ ·å¯ä»¥ä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹åæ•°æ®ä¸ä¸¢å¤±ã€‚ sync_binlog = 1 è¡¨ç¤ºæ¯æ¬¡äº‹åŠ¡çš„ binlog éƒ½æŒä¹…åŒ–åˆ°ç£ç›˜ã€‚è¿™æ ·å¯ä»¥ä¿è¯ MySQL å¼‚å¸¸é‡å¯ä¹‹å binlog ä¸ä¸¢å¤±ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/02/:5:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/02/"},{"categories":null,"content":"6ã€é—®é¢˜ åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œä¸€å¤©ä¸€å¤‡ä¼šæ¯”ä¸€å‘¨ä¸€å¤‡æ›´æœ‰ä¼˜åŠ¿å‘¢ï¼Ÿ å¥½å¤„æ˜¯â€œæœ€é•¿æ¢å¤æ—¶é—´â€æ›´çŸ­ã€‚ åœ¨ä¸€å¤©ä¸€å¤‡çš„æ¨¡å¼é‡Œï¼Œæœ€åæƒ…å†µä¸‹éœ€è¦åº”ç”¨ä¸€å¤©çš„ binlogã€‚æ¯”å¦‚ï¼Œä½ æ¯å¤© 0 ç‚¹åšä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼Œè€Œè¦æ¢å¤å‡ºä¸€ä¸ªåˆ°æ˜¨å¤©æ™šä¸Š 23 ç‚¹çš„å¤‡ä»½ã€‚ ä¸€å‘¨ä¸€å¤‡æœ€åæƒ…å†µå°±è¦åº”ç”¨ä¸€å‘¨çš„ binlog äº†ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/02/:6:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/02/"},{"categories":null,"content":"1ã€äº‹åŠ¡éš”ç¦»çº§åˆ« äº‹åŠ¡çš„ ACID ä¸­çš„ I æŒ‡çš„å°±æ˜¯éš”ç¦»æ€§ï¼ˆIsolationï¼‰ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"1ã€éš”ç¦»çº§åˆ« è¯»æœªæäº¤ï¼ˆread-uncommittedï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æäº¤æ—¶ï¼Œå®ƒåšçš„å˜æ›´å°±èƒ½è¢«åˆ«çš„äº‹åŠ¡çœ‹åˆ°ã€‚ è¯»æäº¤ï¼ˆread-committedï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æäº¤ä¹‹åï¼Œå®ƒåšçš„å˜æ›´æ‰ä¼šè¢«å…¶ä»–äº‹åŠ¡çœ‹åˆ°ã€‚ å¯é‡å¤è¯»ï¼ˆrepeatable-readï¼‰ï¼šä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­çœ‹åˆ°çš„æ•°æ®ï¼Œæ€»æ˜¯è·Ÿè¿™ä¸ªäº‹åŠ¡åœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„æ•°æ®æ˜¯ä¸€è‡´çš„ã€‚ ä¸²è¡ŒåŒ–ï¼ˆserializableï¼‰ï¼šå½“å‡ºç°è¯»å†™é”å†²çªçš„æ—¶å€™ï¼Œåæ‰§è¡Œäº‹åŠ¡å¿…é¡»ç­‰å‰ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œå®Œæˆï¼Œæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ MySQL çš„éš”ç¦»çº§åˆ«è®¾ç½®ä¸º\"è¯»æäº¤\"ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"2ã€äº‹åŠ¡éš”ç¦»ä¾‹å­ mysql\u003e create table T(c int) engine=InnoDB; insert into T(c) values(1); åœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹çš„ç»“æœï¼š éš”ç¦»çº§åˆ«ä¸ºè¯»æœªæäº¤ï¼Œv1 = 2, v2 = 2, v3 = 2ã€‚ éš”ç¦»çº§åˆ«ä¸ºè¯»æäº¤ï¼Œv1 = 1, v2 = 2, v3 = 2ã€‚ éš”ç¦»çº§åˆ«ä¸ºå¯é‡å¤è¯»ï¼Œv1 = 1, v2 = 1, v3 = 2ã€‚ éš”ç¦»çº§åˆ«ä¸ºä¸²è¡ŒåŒ–ï¼Œv1 = 1, v2 = 1, v3 = 2ã€‚ åœ¨å®ç°ä¸Šï¼Œæ•°æ®åº“é‡Œé¢ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ï¼Œè®¿é—®çš„æ—¶å€™ä»¥è§†å›¾çš„é€»è¾‘ç»“æœä¸ºå‡†ã€‚ åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨äº‹åŠ¡å¯åŠ¨æ—¶åˆ›å»ºçš„ï¼Œæ•´ä¸ªäº‹åŠ¡å­˜åœ¨æœŸé—´éƒ½ç”¨è¿™ä¸ªè§†å›¾ã€‚ åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œè¿™ä¸ªè§†å›¾æ˜¯åœ¨æ¯ä¸ªSQLè¯­å¥å¼€å§‹æ‰§è¡Œçš„æ—¶å€™åˆ›å»ºçš„ã€‚ åœ¨è¯»æœªæäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œç›´æ¥è¿”å›è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œæ²¡æœ‰è§†å›¾æ¦‚å¿µã€‚ åœ¨ä¸²è¡ŒåŒ–éš”ç¦»çº§åˆ«ä¸‹ï¼Œç›´æ¥ç”¨åŠ é”çš„æ–¹å¼æ¥é¿å…å¹¶è¡Œè®¿é—®ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"3ã€äº‹åŠ¡é…ç½®æ–¹å¼ é€šè¿‡å‘½ä»¤ show variables like 'transaction_isolation'; æ¥æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ«ã€‚é€šè¿‡å‘½ä»¤ set transaction_isolation = 'read-committed'; æ¥è®¾ç½®éš”ç¦»çº§åˆ«ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"2ã€äº‹åŠ¡éš”ç¦»çš„å®ç° åœ¨ MySQL ä¸­ï¼Œå®é™…ä¸Šæ¯æ¡è®°å½•åœ¨æ›´æ–°çš„æ—¶å€™éƒ½ä¼šåŒæ—¶è®°å½•ä¸€æ¡å›æ»šæ“ä½œã€‚è®°å½•ä¸Šçš„æœ€æ–°å€¼ï¼Œé€šè¿‡å›æ»šæ“ä½œï¼Œéƒ½å¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªçŠ¶æ€çš„å€¼ã€‚ å‡è®¾ä¸€ä¸ªå€¼ä» 1 è¢«æŒ‰é¡ºåºæ”¹æˆäº† 2ã€3ã€4ï¼Œåœ¨å›æ»šæ—¥å¿—é‡Œé¢å°±ä¼šæœ‰ç±»ä¼¼ä¸‹é¢çš„è®°å½•ã€‚ é•¿äº‹åŠ¡æ„å‘³ç€ç³»ç»Ÿé‡Œé¢ä¼šå­˜åœ¨å¾ˆè€çš„äº‹åŠ¡è§†å›¾ã€‚ç”±äºè¿™äº›äº‹åŠ¡éšæ—¶å¯èƒ½è®¿é—®æ•°æ®åº“é‡Œé¢çš„ä»»ä½•æ•°æ®ï¼Œæ‰€ä»¥è¿™ä¸ªäº‹åŠ¡æäº¤ä¹‹å‰ï¼Œæ•°æ®åº“é‡Œé¢å®ƒå¯èƒ½ç”¨åˆ°çš„å›æ»šè®°å½•éƒ½å¿…é¡»ä¿ç•™ï¼Œè¿™å°±ä¼šå¯¼è‡´å¤§é‡å ç”¨å­˜å‚¨ç©ºé—´ã€‚é•¿äº‹åŠ¡è¿˜å ç”¨é”èµ„æºï¼Œä¹Ÿå¯èƒ½æ‹–å®æ•´ä¸ªåº“ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"3ã€äº‹åŠ¡çš„å¯åŠ¨æ–¹å¼ å»ºè®®ä½ æ€»æ˜¯ä½¿ç”¨ set autocommit = 1, é€šè¿‡æ˜¾å¼è¯­å¥çš„æ–¹å¼æ¥å¯åŠ¨äº‹åŠ¡ã€‚ åœ¨ autocommit = 1 çš„æƒ…å†µä¸‹ï¼Œç”¨ begin æ˜¾å¼å¯åŠ¨çš„äº‹åŠ¡ï¼Œå¦‚æœæ‰§è¡Œ commit åˆ™æäº¤äº‹åŠ¡ã€‚å¦‚æœæ‰§è¡Œ commit work and chainï¼Œåˆ™æ˜¯æäº¤äº‹åŠ¡å¹¶è‡ªåŠ¨å¯åŠ¨ä¸‹ä¸€ä¸ªäº‹åŠ¡ã€‚ ä½ å¯ä»¥åœ¨ information_schema åº“çš„ innodb_trx è¿™ä¸ªè¡¨ä¸­æŸ¥è¯¢é•¿äº‹åŠ¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªè¯­å¥ï¼Œç”¨äºæŸ¥æ‰¾æŒç»­æ—¶é—´è¶…è¿‡ 60s çš„äº‹åŠ¡ã€‚ mysql\u003e select * from information_schema.innodb_trx where TIME_TO_SEC(timediff(now(),trx_started))\u003e60 ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"4ã€é—®é¢˜ æ€æ ·é¿å…é•¿äº‹åŠ¡ï¼Ÿ åœ¨å¼€å‘ç«¯ï¼š è®¾ç½®set autocommit = 0ã€‚ ç¡®è®¤æ˜¯å¦æœ‰ä¸å¿…è¦çš„åªè¯»äº‹åŠ¡ã€‚ é€šè¿‡ SET MAX_EXECUTION_TIME å‘½ä»¤ï¼Œæ¥æ§åˆ¶æ¯ä¸ªè¯­å¥æ‰§è¡Œçš„æœ€é•¿æ—¶é—´ï¼Œé¿å…å•ä¸ªè¯­å¥æ„å¤–æ‰§è¡Œå¤ªé•¿æ—¶é—´ã€‚ åœ¨æ•°æ®åº“ç«¯ï¼š æ§ information_schema.Innodb_trx è¡¨ï¼Œè®¾ç½®é•¿äº‹åŠ¡é˜ˆå€¼ï¼Œè¶…è¿‡å°±æŠ¥è­¦/æˆ–è€… killã€‚ ercona çš„ pt-kill è¿™ä¸ªå·¥å…·ä¸é”™ï¼Œæ¨èä½¿ç”¨ã€‚ åœ¨ä¸šåŠ¡åŠŸèƒ½æµ‹è¯•é˜¶æ®µè¦æ±‚è¾“å‡ºæ‰€æœ‰çš„ general_logï¼Œåˆ†ææ—¥å¿—è¡Œä¸ºæå‰å‘ç°é—®é¢˜ã€‚ å¦‚æœä½¿ç”¨çš„æ˜¯MySQL 5.6æˆ–è€…æ›´æ–°ç‰ˆæœ¬ï¼ŒæŠŠ innodb_undo_tablespaces è®¾ç½®æˆ2ï¼ˆæˆ–æ›´å¤§çš„å€¼ï¼‰ã€‚å¦‚æœçœŸçš„å‡ºç°å¤§äº‹åŠ¡å¯¼è‡´å›æ»šæ®µè¿‡å¤§ï¼Œè¿™æ ·è®¾ç½®åæ¸…ç†èµ·æ¥æ›´æ–¹ä¾¿ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/03/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/03/"},{"categories":null,"content":"1ã€ç´¢å¼•çš„å¸¸è§æ¨¡å‹ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"1ã€å“ˆå¸Œè¡¨ ä»¥é”®-å€¼ï¼ˆkey-valueï¼‰å­˜å‚¨æ•°æ®çš„ç»“æ„ã€‚åªé€‚ç”¨äºç­‰å€¼æŸ¥è¯¢çš„åœºæ™¯ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:1:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"2ã€æœ‰åºæ•°ç»„ æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œä½†æ›´æ–°æ•°æ®ï¼Œæˆæœ¬é«˜ã€‚åªé€‚ç”¨é™æ€å­˜å‚¨å¼•æ“ã€‚ ä¸Šé¢æ•°ç»„çš„æŒ‰ç…§ ID_card å‡åºæ’åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ¡ä»¶æ˜¯ where ID_card = '?'ï¼Œå¯ä»¥ç”¨äºŒåˆ†æ³•æŸ¥è¯¢ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:1:2","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"3ã€æœç´¢æ ‘ InnoDB å¼•æ“ä¸­ä½¿ç”¨ B+ æ ‘ï¼ˆ N å‰æ ‘ï¼‰ã€‚å¯ä»¥å‡å°‘ç£ç›˜ IOã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:1:3","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"2ã€InnoDBçš„ç´¢å¼•æ¨¡å‹ æˆ‘ä»¬æœ‰ä¸€ä¸ªä¸»é”®åˆ—ä¸º ID çš„è¡¨ï¼Œè¡¨ä¸­æœ‰å­—æ®µ kï¼Œå¹¶ä¸”åœ¨ k ä¸Šæœ‰ç´¢å¼•ï¼Œå»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š mysql\u003e create table T( id int primary key, k int not null, name varchar(16), index (k))engine=InnoDB; è¡¨ä¸­ R1 ~ R5 çš„ (ID,k) å€¼åˆ†åˆ«ä¸º (100,1)ã€(200,2)ã€(300,3)ã€(500,5) å’Œ (600,6)ã€‚ åœ¨ InnoDB å¼•æ“ä¸­ï¼Œæ¯ä¸ªç´¢å¼•å°±æ˜¯ä¸€é¢— B+ æ ‘ã€‚ä¸¤é¢—ç´¢å¼•æ ‘å¦‚ä¸‹ã€‚ æ ¹æ®å¶å­èŠ‚ç‚¹çš„å†…å®¹ï¼Œç´¢å¼•ç±»å‹åˆ†ä¸ºä¸»é”®ç´¢å¼•å’Œéä¸»é”®ç´¢å¼•ã€‚ ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯æ•´è¡Œæ•°æ®ã€‚ éä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹å­˜æ”¾çš„æ˜¯ä¸»é”®çš„å€¼ã€‚ åŸºäºä¸»é”®ç´¢å¼•å’Œæ™®é€šç´¢å¼•çš„æŸ¥è¯¢æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ å¦‚æœè¯­å¥æ˜¯ select * from T where ID=500ï¼Œå³ä¸»é”®æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™åªéœ€è¦æœç´¢ ID è¿™æ£µB+æ ‘ï¼› å¦‚æœè¯­å¥æ˜¯ select * from T where k=5ï¼Œå³æ™®é€šç´¢å¼•æŸ¥è¯¢æ–¹å¼ï¼Œåˆ™éœ€è¦å…ˆæœç´¢ k ç´¢å¼•æ ‘ï¼Œå¾—åˆ° ID çš„å€¼ä¸º 500ï¼Œå†åˆ° ID ç´¢å¼•æ ‘æœç´¢ä¸€æ¬¡ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå›è¡¨ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"3ã€ç´¢å¼•ç»´æŠ¤ B+ æ ‘ä¸ºäº†ç»´æŠ¤ç´¢å¼•æœ‰åºæ€§ï¼Œåœ¨æ’å…¥æ–°å€¼çš„æ—¶å€™éœ€è¦åšå¿…è¦çš„ç»´æŠ¤ã€‚ä»¥ä¸Šé¢è¿™ä¸ªå›¾ä¸ºä¾‹ï¼Œå¦‚æœæ’å…¥æ–°çš„è¡Œ ID å€¼ä¸º 700ï¼Œåˆ™åªéœ€è¦åœ¨ R5 çš„è®°å½•åé¢æ’å…¥ä¸€ä¸ªæ–°è®°å½•ã€‚å¦‚æœæ–°æ’å…¥çš„ ID å€¼ä¸º 400ï¼Œå°±ç›¸å¯¹éº»çƒ¦äº†ï¼Œéœ€è¦é€»è¾‘ä¸ŠæŒªåŠ¨åé¢çš„æ•°æ®ï¼Œç©ºå‡ºä½ç½®ã€‚ è€Œæ›´ç³Ÿçš„æƒ…å†µæ˜¯ï¼Œå¦‚æœ R5 æ‰€åœ¨çš„æ•°æ®é¡µå·²ç»æ»¡äº†ï¼Œæ ¹æ® B+ æ ‘çš„ç®—æ³•ï¼Œè¿™æ—¶å€™éœ€è¦ç”³è¯·ä¸€ä¸ªæ–°çš„æ•°æ®é¡µï¼Œç„¶åæŒªåŠ¨éƒ¨åˆ†æ•°æ®è¿‡å»ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºé¡µåˆ†è£‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ€§èƒ½è‡ªç„¶ä¼šå—å½±å“ã€‚ é™¤äº†æ€§èƒ½å¤–ï¼Œé¡µåˆ†è£‚æ“ä½œè¿˜å½±å“æ•°æ®é¡µçš„åˆ©ç”¨ç‡ã€‚åŸæœ¬æ”¾åœ¨ä¸€ä¸ªé¡µçš„æ•°æ®ï¼Œç°åœ¨åˆ†åˆ°ä¸¤ä¸ªé¡µä¸­ï¼Œæ•´ä½“ç©ºé—´åˆ©ç”¨ç‡é™ä½å¤§çº¦50%ã€‚å½“ç›¸é‚»ä¸¤ä¸ªé¡µç”±äºåˆ é™¤äº†æ•°æ®ï¼Œåˆ©ç”¨ç‡å¾ˆä½ä¹‹åï¼Œä¼šå°†æ•°æ®é¡µåšåˆå¹¶ã€‚ æ€»ç»“ï¼š å¦‚æœä¸»é”®æ˜¯è‡ªå¢çš„ï¼Œæ¯æ¬¡æ’å…¥ä¸€æ¡æ–°çš„æ•°æ®ï¼Œå°±æ˜¯è¿½åŠ æ“ä½œï¼Œå°±ä¸ä¼šè§¦å‘é¡µåˆ†è£‚ã€‚ ä¸»é”®é•¿åº¦è¶Šå°ï¼Œæ™®é€šç´¢å¼•çš„å¶å­èŠ‚ç‚¹å°±è¶Šå°ï¼Œå ç”¨çš„ç©ºé—´ä¹Ÿå°±è¶Šå°ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"4ã€é—®é¢˜ å¯¹äºä¸Šé¢ä¾‹å­ä¸­çš„ InnoDB è¡¨ Tï¼Œå¦‚æœä½ è¦é‡å»ºç´¢å¼• kï¼Œä½ çš„ä¸¤ä¸ª SQL è¯­å¥å¯ä»¥è¿™ä¹ˆå†™ï¼š alter table T drop index k; alter table T add index(k); å¦‚æœä½ è¦é‡å»ºä¸»é”®ç´¢å¼•ï¼Œä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š alter table T drop primary key; alter table T add primary key(id); å¯ä»¥æ‰§è¡Œ alter table T engine=InnoDB; æ¥é‡å»ºç´¢å¼•ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/04/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/04/"},{"categories":null,"content":"1ã€è¦†ç›–ç´¢å¼• åˆ›å»ºè¡¨ T : mysql\u003e create table T ( ID int primary key, k int NOT NULL DEFAULT 0, s varchar(16) NOT NULL DEFAULT '', index k(k)) engine=InnoDB; insert into T values(100,1, 'aa'),(200,2,'bb'),(300,3,'cc'),(500,5,'ee'),(600,6,'ff'),(700,7,'gg'); æ‰§è¡Œè¯­å¥ select ID from T where k between 3 and 5ï¼Œåªéœ€è¦æ‰«æ k ç´¢å¼•æ ‘ã€‚å› ä¸ºç»“æœåªéœ€è¦æŸ¥è¯¢ IDï¼Œè€Œ ID åœ¨ k ç´¢å¼•æ ‘ä¸Šï¼Œå‡å°‘äº†å›è¡¨æ“ä½œã€‚ ç´¢å¼•æ ‘å·²ç»è¦†ç›–äº†æŸ¥è¯¢ç»“æœï¼Œç§°ä¹‹ä¸ºè¦†ç›–ç´¢å¼•ã€‚è¦†ç›–ç´¢å¼•å¯ä»¥å‡å°‘æ ‘çš„æœç´¢æ¬¡æ•°ï¼Œæ˜¾è‘—æå‡æŸ¥è¯¢æ€§èƒ½ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/05/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/05/"},{"categories":null,"content":"2ã€æœ€å·¦å‰ç¼€åŒ¹é… B+ æ ‘è¿™ç§ç´¢å¼•ç»“æ„ï¼Œå¯ä»¥åˆ©ç”¨ç´¢å¼•çš„æœ€å·¦å‰ç¼€ï¼Œæ¥å®šä½è®°å½•ã€‚ åˆ›å»ºè¡¨ tuser ï¼š CREATE TABLE `tuser` ( `id` int(11) NOT NULL, `id_card` varchar(32) DEFAULT NULL, `name` varchar(32) DEFAULT NULL, `age` int(11) DEFAULT NULL, `ismale` tinyint(1) DEFAULT NULL, PRIMARY KEY (`id`), KEY `id_card` (`id_card`), KEY `name_age` (`name`,`age`) ) ENGINE=InnoDB å½“ä½ çš„æŸ¥è¯¢æ¡ä»¶æ˜¯ where name like â€˜å¼ %â€™ï¼Œä¹Ÿæ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•ï¼ˆname,ageï¼‰çš„ã€‚ è”åˆç´¢å¼•å»ºç«‹è§„åˆ™ï¼š é€šè¿‡è°ƒæ•´é¡ºåºï¼Œå¯ä»¥å°‘ç»´æŠ¤ä¸€ä¸ªç´¢å¼•ï¼Œè¿™æ˜¯ä¼˜å…ˆè€ƒè™‘çš„ã€‚ ç´¢å¼•çš„ç©ºé—´ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/05/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/05/"},{"categories":null,"content":"3ã€ç´¢å¼•ä¸‹æ¨ å¯ä»¥å¯¹ç´¢å¼•ä¸­å­˜åœ¨çš„å­—æ®µå…ˆåšåˆ¤æ–­ï¼Œå‡å°‘å›è¡¨æ¬¡æ•°ã€‚ å½“æŸ¥è¯¢æ¡ä»¶æ˜¯ where name like 'å¼ %' and age=10 and ismale=1;ï¼Œä¹Ÿæ˜¯å¯ä»¥ç”¨åˆ°ç´¢å¼•æ ‘ï¼ˆname,ageï¼‰çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/05/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/05/"},{"categories":null,"content":"4ã€é—®é¢˜ æœ‰å¦‚ä¸‹è¡¨ï¼š CREATE TABLE `geek` ( `a` int(11) NOT NULL, `b` int(11) NOT NULL, `c` int(11) NOT NULL, `d` int(11) NOT NULL, PRIMARY KEY (`a`,`b`), KEY `c` (`c`), KEY `ca` (`c`,`a`), KEY `cb` (`c`,`b`) ) ENGINE=InnoDB; ç”±äºå†å²åŸå› ï¼Œè¿™ä¸ªè¡¨éœ€è¦aã€båšè”åˆä¸»é”®ã€‚ æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ï¼š select * from geek where c=N order by a limit 1; select * from geek where c=N order by b limit 1; ç´¢å¼•ï¼ˆc,aï¼‰ã€ï¼ˆc,bï¼‰æ˜¯å¦éƒ½æ˜¯å¿…é¡»çš„? ç´¢å¼• (c,a) ä¸éœ€è¦ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/05/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/05/"},{"categories":null,"content":"1ã€å…¨å±€è¡¨ æ ¹æ®åŠ é”çš„èŒƒå›´ï¼ŒMySQL é‡Œé¢çš„é”å¤§è‡´å¯ä»¥åˆ†æˆå…¨å±€é”ã€è¡¨çº§é”å’Œè¡Œé”ä¸‰ç±»ã€‚ MySQL åŠ å…¨å±€è¯»é”çš„å‘½ä»¤ï¼šflush tables with read lock;ï¼ˆFTWRLï¼‰, è§£é”å‘½ä»¤ï¼šunlock tables;ã€‚è®©æ•´ä¸ªåº“å¤„äºåªè¯»çŠ¶æ€ã€‚ä»»ä½•å¢åˆ æ”¹è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚ å…¨å±€é”çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œåšå…¨åº“é€»è¾‘å¤‡ä»½ï¼Œä¹Ÿå°±æ˜¯ select æ‰€æœ‰çš„æ•°æ®ã€‚ å¯¹äº MyISAM å¼•æ“æ¥è¯´ï¼Œå¤‡ä»½åªèƒ½åŠ å…¨å±€é”ã€‚ å¯¹äº Innodb å¼•æ“æ¥è¯´ï¼Œå¯ä»¥ä½¿ç”¨è„šæœ¬ mysqldumpï¼Œå‚æ•°ä¸º â€“-single-transactionï¼Œæ¥å¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œç¡®ä¿æ‹¿åˆ°ä¸€è‡´æ€§è§†å›¾æ¥å¤‡ä»½æ•°æ®ã€‚MyISAM ä¸æ”¯æŒäº‹åŠ¡ï¼Œæ‰€ä»¥æ— æ³•ç”¨æ­¤è„šæœ¬ã€‚ å…¨åº“åªè¯»ï¼Œä¸ºä»€ä¹ˆä¸ä½¿ç”¨ set global readonly=true çš„æ–¹å¼ï¼Œä¸»è¦åŸå› æœ‰ä¸¤ç‚¹ï¼š åœ¨æœ‰äº›ç³»ç»Ÿä¸­ï¼Œreadonly ä¼šè¢«ç”¨æ¥åšå…¶ä»–é€»è¾‘ï¼Œæ¯”å¦‚åˆ¤æ–­ä¸€ä¸ªåº“æ˜¯ä¸»åº“è¿˜æ˜¯å¤‡åº“ã€‚ å¼‚å¸¸å¤„ç†æœºåˆ¶æœ‰å·®å¼‚ã€‚ æ‰§è¡Œ FTWRL å‘½ä»¤åï¼Œå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸æ–­å¼€ï¼ŒMySQL ä¼šè‡ªåŠ¨é‡Šæ”¾è¿™ä¸ªå…¨å±€é”ã€‚å¦‚æœæ•´åº“å¤„ç† readonly çŠ¶æ€ï¼Œå®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸ï¼Œæ•°æ®åº“ä¼šä¸€ç›´å¤„äº readonly çŠ¶æ€ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/06/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/06/"},{"categories":null,"content":"2ã€è¡¨çº§é” MySQL é‡Œé¢è¡¨çº§åˆ«çš„é”æœ‰ä¸¤ç§ï¼šä¸€ç§æ˜¯è¡¨é”ï¼Œä¸€ç§æ˜¯å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDL)ã€‚ ä¾‹å¦‚ï¼šå¦‚æœåœ¨æŸä¸ªçº¿ç¨‹ A ä¸­æ‰§è¡Œ lock tables t1 read, t2 write; è¿™ä¸ªè¯­å¥ï¼Œåˆ™å…¶ä»–çº¿ç¨‹å†™ t1 ã€è¯»å†™ t2 çš„è¯­å¥éƒ½ä¼šè¢«é˜»å¡ã€‚çº¿ç¨‹ A æ‰§è¡Œ unlock tables; è¯­å¥æ¥è§£é”ã€‚ MDL ä¸éœ€è¦æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€ä¸ªè¡¨çš„æ—¶å€™ä¼šè¢«è‡ªåŠ¨åŠ ä¸Šã€‚MDL çš„ä½œç”¨æ˜¯ï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚ åœ¨ MySQL 5.5 ç‰ˆæœ¬ä¸­å¼•å…¥äº† MDLï¼Œå½“å¯¹ä¸€ä¸ªè¡¨åšå¢åˆ æ”¹æŸ¥æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”ï¼›å½“è¦å¯¹è¡¨åšç»“æ„å˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”ã€‚ ç»™ä¸€ä¸ªå°è¡¨åŠ ä¸ªå­—æ®µï¼Œå¯¼è‡´æ•´ä¸ªåº“æŒ‚äº†ã€‚ session A å’Œ session B éƒ½ä¼šåŠ ä¸Š MDLè¯»é”ã€‚ session C è¦å˜æ›´è¡¨ç»“æ„ï¼Œå¿…è¦è¦åŠ ä¸Š MDLå†™é”ï¼Œæ­¤æ—¶åªèƒ½é˜»å¡ã€‚ session D ç”³è¯· MDLè¯»é” å°±ä¼šè¢« session C é˜»å¡ã€‚ MDL é”å¿…é¡»è¦ç­‰æ•´ä¸ªäº‹åŠ¡æäº¤åå†é‡Šæ”¾ã€‚ å¦‚ä½•å®‰å…¨åœ°ç»™å°è¡¨åŠ å­—æ®µï¼Ÿ é¦–å…ˆè¦è§£å†³é•¿äº‹åŠ¡ï¼Œäº‹åŠ¡ä¸æäº¤ï¼Œå°±ä¼šä¸€ç›´å ç€ MDLé”ã€‚åœ¨ MySQL çš„ information_schema åº“çš„ innodb_trx è¡¨ä¸­ï¼Œä½ å¯ä»¥æŸ¥åˆ°å½“å‰æ‰§è¡Œä¸­çš„äº‹åŠ¡ã€‚å¦‚æœä½ è¦åš DDL å˜æ›´çš„è¡¨åˆšå¥½æœ‰é•¿äº‹åŠ¡åœ¨æ‰§è¡Œï¼Œè¦è€ƒè™‘å…ˆæš‚åœ DDLï¼Œæˆ–è€… kill æ‰è¿™ä¸ªé•¿äº‹åŠ¡ã€‚ å¦‚æœè¦å˜æ›´çš„è¡¨æ˜¯ä¸€ä¸ªçƒ­ç‚¹è¡¨ï¼Œè™½ç„¶æ•°æ®é‡ä¸å¤§ï¼Œä½†æ˜¯ä¸Šé¢çš„è¯·æ±‚å¾ˆé¢‘ç¹ï¼Œè€Œä½ ä¸å¾—ä¸åŠ ä¸ªå­—æ®µ, kill å¯èƒ½æœªå¿…ç®¡ç”¨ï¼Œæ¯”è¾ƒç†æƒ³çš„æœºåˆ¶æ˜¯ï¼Œåœ¨ alter table è¯­å¥é‡Œé¢è®¾å®šç­‰å¾…æ—¶é—´ï¼Œå¦‚æœåœ¨è¿™ä¸ªç­‰å¾…æ—¶é—´é‡Œé¢èƒ½å¤Ÿæ‹¿åˆ° MDLå†™é” æœ€å¥½ï¼Œæ‹¿ä¸åˆ°ä¹Ÿä¸è¦é˜»å¡åé¢çš„ä¸šåŠ¡è¯­å¥ï¼Œå…ˆæ”¾å¼ƒã€‚ä¹‹åå†é€šè¿‡é‡è¯•å‘½ä»¤é‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚ ALTER TABLE tbl_name NOWAIT add column ... ALTER TABLE tbl_name WAIT N add column ... ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/06/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/06/"},{"categories":null,"content":"3ã€é—®é¢˜ å¤‡ä»½ä¸€èˆ¬éƒ½ä¼šåœ¨å¤‡åº“ä¸Šæ‰§è¡Œï¼Œä½ åœ¨ç”¨ â€“-single-transaction æ–¹æ³•åšé€»è¾‘å¤‡ä»½çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸»åº“ä¸Šçš„ä¸€ä¸ªå°è¡¨åšäº†ä¸€ä¸ªDDLï¼Œæ¯”å¦‚ç»™ä¸€ä¸ªè¡¨ä¸ŠåŠ äº†ä¸€åˆ—ã€‚è¿™æ—¶å€™ï¼Œä»å¤‡åº“ä¸Šä¼šçœ‹åˆ°ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿ å‡è®¾è¿™ä¸ª DDL æ˜¯é’ˆå¯¹è¡¨ t1 çš„ï¼Œ è¿™é‡ŒæŠŠå¤‡ä»½è¿‡ç¨‹ä¸­å‡ ä¸ªå…³é”®çš„è¯­å¥åˆ—å‡ºæ¥ï¼š Q1:SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ; Q2:START TRANSACTION WITH CONSISTENT SNAPSHOT; /* other tables */ Q3:SAVEPOINT sp; /* æ—¶åˆ» 1 */ Q4:show create table `t1`; /* æ—¶åˆ» 2 */ Q5:SELECT * FROM `t1`; /* æ—¶åˆ» 3 */ Q6:ROLLBACK TO SAVEPOINT sp; /* æ—¶åˆ» 4 */ /* other tables */ åœ¨å¤‡ä»½å¼€å§‹çš„æ—¶å€™ï¼Œä¸ºäº†ç¡®ä¿RRï¼ˆå¯é‡å¤è¯»ï¼‰éš”ç¦»çº§åˆ«ï¼Œå†è®¾ç½®ä¸€æ¬¡RRéš”ç¦»çº§åˆ«(Q1); å¯åŠ¨äº‹åŠ¡(Q2); è®¾ç½®ä¸€ä¸ªä¿å­˜ç‚¹ï¼Œè¿™ä¸ªå¾ˆé‡è¦(Q3); show create æ˜¯ä¸ºäº†æ‹¿åˆ°è¡¨ç»“æ„(Q4)ï¼Œç„¶åæ­£å¼å¯¼æ•°æ® ï¼ˆQ5ï¼‰ï¼Œå›æ»šåˆ°SAVEPOINT spï¼Œåœ¨è¿™é‡Œçš„ä½œç”¨æ˜¯é‡Šæ”¾ t1 çš„ MDLé”ã€‚ ç­”æ¡ˆå¦‚ä¸‹ï¼š å¦‚æœåœ¨ Q4 è¯­å¥æ‰§è¡Œä¹‹å‰åˆ°è¾¾ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯DDLåçš„è¡¨ç»“æ„ã€‚ å¦‚æœåœ¨\"æ—¶åˆ» 2\"åˆ°è¾¾ï¼Œåˆ™ Q5 æ‰§è¡Œçš„æ—¶å€™è¡¨ç»“æ„è¢«æ”¹è¿‡ï¼ŒæŠ¥ Table definition has changed, please retry transactionï¼Œç°è±¡ï¼šmysqldump ç»ˆæ­¢ï¼› å¦‚æœåœ¨\"æ—¶åˆ»2\"å’Œ\"æ—¶åˆ»3\"ä¹‹é—´åˆ°è¾¾ï¼Œmysqldump å ç€ t1 çš„ MDLè¯»é”ï¼Œbinlog è¢«é˜»å¡ï¼Œç°è±¡ï¼šä¸»ä»å»¶è¿Ÿï¼Œç›´åˆ° Q6 æ‰§è¡Œå®Œæˆã€‚ ä»\"æ—¶åˆ»4\"å¼€å§‹ï¼Œmysqldump é‡Šæ”¾äº† MDLè¯»é”ï¼Œç°è±¡ï¼šæ²¡æœ‰å½±å“ï¼Œå¤‡ä»½æ‹¿åˆ°çš„æ˜¯ DDL å‰çš„è¡¨ç»“æ„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/06/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/06/"},{"categories":null,"content":"1ã€è¡Œé” MySQL çš„è¡Œé”æ˜¯åœ¨å¼•æ“å±‚ç”±å„ä¸ªå¼•æ“è‡ªå·±å®ç°çš„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„å¼•æ“éƒ½æ”¯æŒè¡Œé”ï¼Œæ¯”å¦‚ MyISAM å¼•æ“å°±ä¸æ”¯æŒï¼ŒInnoDB å¼•æ“æ”¯æŒè¡Œé”ã€‚ ä¸¤é˜¶æ®µé”ï¼š å®é™…ä¸Šäº‹åŠ¡Bçš„ update è¯­å¥ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº‹åŠ¡Aæ‰§è¡Œ commit ä¹‹åï¼Œäº‹åŠ¡Bæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ åœ¨ InnoDB äº‹åŠ¡ä¸­ï¼Œè¡Œé”æ˜¯åœ¨éœ€è¦çš„æ—¶å€™æ‰åŠ ä¸Šçš„ï¼Œä½†å¹¶ä¸æ˜¯ä¸éœ€è¦äº†å°±ç«‹åˆ»é‡Šæ”¾ï¼Œè€Œæ˜¯è¦ç­‰åˆ°äº‹åŠ¡ç»“æŸæ—¶æ‰é‡Šæ”¾ã€‚è¿™ä¸ªå°±æ˜¯ä¸¤é˜¶æ®µé”åè®®ã€‚ å¦‚æœä½ çš„äº‹åŠ¡ä¸­éœ€è¦é”å¤šä¸ªè¡Œï¼Œè¦æŠŠæœ€å¯èƒ½é€ æˆé”å†²çªã€æœ€å¯èƒ½å½±å“å¹¶å‘åº¦çš„é”å°½é‡å¾€åæ”¾ã€‚ æ¯”å¦‚ï¼Œç”µå½±ç¥¨åœ¨çº¿äº¤æ˜“ä¸šåŠ¡ï¼š ä»é¡¾å®¢Aè´¦æˆ·ä½™é¢ä¸­æ‰£é™¤ç”µå½±ç¥¨ä»·ã€‚ ç»™å½±é™¢Bçš„è´¦æˆ·ä½™é¢å¢åŠ è¿™å¼ ç”µå½±ç¥¨ä»·ã€‚ è®°å½•ä¸€æ¡äº¤æ˜“æ—¥å¿—ã€‚ è¦ä¿è¯äº¤æ˜“çš„åŸå­æ€§ï¼Œå°±è¦æŠŠè¿™ä¸‰ä¸ªæ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼ŒæŒ‰ç…§ 3 -\u003e 1 -\u003e 2 çš„é¡ºåºæ‰§è¡Œï¼Œå°±å‡å°‘äº†äº‹åŠ¡ä¹‹é—´çš„é”ç­‰å¾…ï¼Œæå‡äº†å¹¶å‘åº¦ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/07/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/07/"},{"categories":null,"content":"2ã€æ­»é”å’Œæ­»é”æ£€æµ‹ æ­»é”ä¾‹å­ï¼š äº‹åŠ¡Aåœ¨ç­‰å¾…äº‹åŠ¡Bé‡Šæ”¾ id=2 çš„è¡Œé”ï¼Œè€Œäº‹åŠ¡Båœ¨ç­‰å¾…äº‹åŠ¡Aé‡Šæ”¾ id=1 çš„è¡Œé”ã€‚ äº‹åŠ¡Aå’Œäº‹åŠ¡Båœ¨äº’ç›¸ç­‰å¾…å¯¹æ–¹çš„èµ„æºé‡Šæ”¾ï¼Œå°±æ˜¯è¿›å…¥äº†æ­»é”çŠ¶æ€ã€‚ å½“å‡ºç°æ­»é”ä»¥åï¼Œæœ‰ä¸¤ç§ç­–ç•¥ ç›´æ¥è¿›å…¥ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´é€šè¿‡å‚æ•° innodb_lock_wait_timeout æ¥è®¾ç½®ã€‚ å‘èµ·æ­»é”æ£€æµ‹ï¼Œå‘ç°æ­»é”åï¼Œä¸»åŠ¨å›æ»šæ­»é”é“¾æ¡ä¸­çš„æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè®©å…¶ä»–äº‹åŠ¡å¾—ä»¥ç»§ç»­æ‰§è¡Œã€‚é€šè¿‡å‚æ•° innodb_deadlock_detect è®¾ç½®ä¸º onã€‚ åœ¨ InnoDB ä¸­ï¼Œinnodb_lock_wait_timeout çš„é»˜è®¤å€¼æ˜¯ 50sï¼Œå½“å‡ºç°æ­»é”ä»¥åï¼Œç¬¬ä¸€ä¸ªè¢«é”ä½çš„çº¿ç¨‹è¦è¿‡ 50s æ‰ä¼šè¶…æ—¶é€€å‡ºï¼Œè¿™ä¸ªç­‰å¾…æ—¶é—´è‚¯å®šæ˜¯æ— æ³•æ¥å—çš„ï¼Œä½†å¦‚æœè®¾ç½®ä¸º 1sï¼Œå¯èƒ½å‡ºç°ä¸æ˜¯æ­»é”çš„æƒ…å†µï¼ˆå¤§äº‹åŠ¡ï¼‰ï¼Œé€ æˆè¯¯ä¼¤ã€‚ æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦é‡‡ç”¨ç¬¬äºŒç§ç­–ç•¥ï¼šä¸»åŠ¨æ­»é”æ£€æµ‹ã€‚innodb_deadlock_detect çš„é»˜è®¤å€¼ä¸º onã€‚ å½“æ›´æ–°åŒä¸€è¡Œæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹æ£€æŸ¥çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n), ä¹Ÿå°±æ˜¯è¯´ 1000 ä¸ªçº¿ç¨‹ï¼Œè¦æ“ä½œ 100w æ¬¡ï¼Œæ‰€ä»¥æ­»é”æ£€æµ‹è¦è€—è´¹å¤§é‡çš„ CPU èµ„æºã€‚ æ€ä¹ˆè§£å†³ç”±è¿™ç§çƒ­ç‚¹è¡Œæ›´æ–°å¯¼è‡´çš„æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿ ä¸€ç§å¤´ç—›åŒ»å¤´çš„æ–¹æ³•ï¼Œå°±æ˜¯å¦‚æœä½ èƒ½ç¡®ä¿è¿™ä¸ªä¸šåŠ¡ä¸€å®šä¸ä¼šå‡ºç°æ­»é”ï¼Œå¯ä»¥ä¸´æ—¶æŠŠæ­»é”æ£€æµ‹å…³æ‰ã€‚ä¸šåŠ¡æœ‰æŸã€‚ æ§åˆ¶å¹¶å‘åº¦ã€‚æ¯”å¦‚åŒä¸€è¡ŒåŒæ—¶æœ€å¤šåªæœ‰ 10 ä¸ªçº¿ç¨‹åœ¨æ›´æ–°ï¼Œé‚£ä¹ˆæ­»é”æ£€æµ‹çš„æˆæœ¬å¾ˆä½ï¼Œå°±ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ å¹¶å‘æ§åˆ¶è¦åšåœ¨æ•°æ®åº“æœåŠ¡ç«¯ï¼Œå¦‚æœä½ æœ‰ä¸­é—´ä»¶ï¼Œå¯ä»¥è€ƒè™‘åœ¨ä¸­é—´ä»¶å®ç°ï¼›å¦‚æœä½ çš„å›¢é˜Ÿæœ‰èƒ½ä¿®æ”¹ MySQL æºç çš„äººï¼Œä¹Ÿå¯ä»¥åšåœ¨ MySQL é‡Œé¢ã€‚åŸºæœ¬æ€è·¯å°±æ˜¯ï¼Œå¯¹äºç›¸åŒè¡Œçš„æ›´æ–°ï¼Œåœ¨è¿›å…¥å¼•æ“ä¹‹å‰æ’é˜Ÿã€‚è¿™æ ·åœ¨ InnoDB å†…éƒ¨å°±ä¸ä¼šæœ‰å¤§é‡çš„æ­»é”æ£€æµ‹å·¥ä½œäº†ã€‚ æ§åˆ¶å¹¶å‘åº¦ä¹Ÿå¯ä»¥ä»ä¸šåŠ¡è®¾è®¡ä¸Šä¼˜åŒ–ã€‚è€ƒè™‘å°†ä¸€è¡Œæ”¹æˆé€»è¾‘ä¸Šçš„å¤šè¡Œæ¥å‡å°‘é”å†²çªã€‚ è¿˜æ˜¯ä»¥å½±é™¢è´¦æˆ·ä¸ºä¾‹ï¼Œå¯ä»¥è€ƒè™‘æ”¾åœ¨å¤šæ¡è®°å½•ä¸Šï¼Œæ¯”å¦‚ 10 ä¸ªè®°å½•ï¼Œå½±é™¢çš„è´¦æˆ·æ€»é¢ç­‰äºè¿™ 10 ä¸ªè®°å½•çš„å€¼çš„æ€»å’Œã€‚è¿™æ ·æ¯æ¬¡è¦ç»™å½±é™¢è´¦æˆ·åŠ é‡‘é¢çš„æ—¶å€™ï¼Œéšæœºé€‰å…¶ä¸­ä¸€æ¡è®°å½•æ¥åŠ ã€‚è¿™æ ·æ¯æ¬¡å†²çªæ¦‚ç‡å˜æˆåŸæ¥çš„ 1/10ï¼Œå¯ä»¥å‡å°‘é”ç­‰å¾…ä¸ªæ•°ï¼Œä¹Ÿå°±å‡å°‘äº†æ­»é”æ£€æµ‹çš„ CPU æ¶ˆè€—ã€‚ å¦‚æœè´¦æˆ·ä½™é¢å¯èƒ½ä¼šå‡å°‘ï¼Œæ¯”å¦‚é€€ç¥¨é€»è¾‘ï¼Œé‚£ä¹ˆè¿™æ—¶å€™å°±éœ€è¦è€ƒè™‘å½“ä¸€éƒ¨åˆ†è¡Œè®°å½•å˜æˆ 0 çš„æ—¶å€™ï¼Œä»£ç è¦æœ‰ç‰¹æ®Šå¤„ç†ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/07/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/07/"},{"categories":null,"content":"3ã€é—®é¢˜ å¦‚æœä½ è¦åˆ é™¤ä¸€ä¸ªè¡¨é‡Œé¢çš„å‰ 10000 è¡Œæ•°æ®ï¼Œæœ‰ä»¥ä¸‹ä¸‰ç§æ–¹æ³•å¯ä»¥åšåˆ°ï¼š ç¬¬ä¸€ç§ï¼Œç›´æ¥æ‰§è¡Œ delete from T limit 10000; ç¬¬äºŒç§ï¼Œåœ¨ä¸€ä¸ªè¿æ¥ä¸­å¾ªç¯æ‰§è¡Œ20æ¬¡ delete from T limit 500; ç¬¬ä¸‰ç§ï¼Œåœ¨ 20 ä¸ªè¿æ¥ä¸­åŒæ—¶æ‰§è¡Œ delete from T limit 500ã€‚ ä½ ä¼šé€‰æ‹©å“ªä¸€ç§æ–¹æ³•å‘¢ï¼Ÿä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ç¬¬äºŒç§æ–¹å¼æ˜¯ç›¸å¯¹è¾ƒå¥½çš„ã€‚ ç¬¬ä¸€ç§æ–¹å¼å•ä¸ªè¯­å¥å ç”¨æ—¶é—´é•¿ï¼Œé”çš„æ—¶é—´ä¹Ÿæ¯”è¾ƒé•¿ï¼›è€Œä¸”å¤§äº‹åŠ¡è¿˜ä¼šå¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚ ç¬¬ä¸‰ç§æ–¹å¼ä¼šäººä¸ºé€ æˆé”å†²çªã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/07/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/07/"},{"categories":null,"content":"1ã€äº‹åŠ¡ åœ¨ç¬¬ 3 ç¯‡æ–‡ç« å’Œä½ è®²äº‹åŠ¡éš”ç¦»çº§åˆ«çš„æ—¶å€™æåˆ°è¿‡ï¼Œå¦‚æœæ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡ T å¯åŠ¨çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªè§†å›¾ read-viewï¼Œä¹‹åäº‹åŠ¡ T æ‰§è¡ŒæœŸé—´ï¼Œå³ä½¿æœ‰å…¶ä»–äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œäº‹åŠ¡ T çœ‹åˆ°çš„ä»ç„¶è·Ÿåœ¨å¯åŠ¨æ—¶çœ‹åˆ°çš„ä¸€æ ·ã€‚ ä¾‹å­ï¼š mysql\u003e CREATE TABLE `t` ( `id` int(11) NOT NULL, `k` int(11) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB; insert into t(id, k) values(1,1),(2,2); åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œbegin/start transaction å¹¶ä¸æ˜¯äº‹åŠ¡çš„èµ·ç‚¹ï¼Œåªæœ‰æ‰§è¡Œåˆ°ç¬¬ä¸€ä¸ªè¯­å¥æ—¶æ‰ä¼šçœŸæ­£å¯åŠ¨äº‹åŠ¡ã€‚å¦‚æœä½ æƒ³è¦é©¬ä¸Šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯ä»¥ä½¿ç”¨ start transaction with consistent snapshot è¿™ä¸ªå‘½ä»¤ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œäº‹åŠ¡ C æ²¡æœ‰æ˜¾å¼åœ°ä½¿ç”¨ begin/commit ï¼Œè¡¨ç¤ºè¿™ä¸ª update è¯­å¥æœ¬èº«å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼Œè¯­å¥å®Œæˆçš„æ—¶å€™ä¼šè‡ªåŠ¨æäº¤ã€‚ ç»“æœæ˜¯äº‹åŠ¡ B çš„ k å€¼ä¸º 3ï¼Œäº‹åŠ¡Açš„ k å€¼ä¸º 1ã€‚ åœ¨ MySQL é‡Œï¼Œæœ‰ä¸¤ä¸ª\"è§†å›¾\"çš„æ¦‚å¿µ: ä¸€ä¸ªæ˜¯ viewï¼Œå®ƒæ˜¯ä¸€ä¸ªç”¨æŸ¥è¯¢è¯­å¥å®šä¹‰çš„è™šæ‹Ÿè¡¨ã€‚ å¦ä¸€ä¸ªæ˜¯ InnoDB åœ¨å®ç° MVCC æ—¶ç”¨åˆ°çš„ä¸€è‡´æ€§è¯»è§†å›¾ï¼Œå³ consistent read viewã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/08/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/08/"},{"categories":null,"content":"2ã€â€œå¿«ç…§\"æ€ä¹ˆå·¥ä½œçš„ åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œäº‹åŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™å°±\"æ‹äº†ä¸ªå¿«ç…§â€ã€‚è¿™ä¸ªå¿«ç…§æ˜¯åŸºäºæ•´åº“çš„ã€‚ InnoDB é‡Œé¢æ¯ä¸ªäº‹åŠ¡æœ‰ä¸€ä¸ªå”¯ä¸€çš„äº‹åŠ¡ IDï¼Œå«ä½œ transaction id ã€‚å®ƒæ˜¯åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™å‘ InnoDB çš„äº‹åŠ¡ç³»ç»Ÿç”³è¯·çš„ï¼Œæ˜¯æŒ‰ç”³è¯·é¡ºåºä¸¥æ ¼é€’å¢çš„ã€‚ è€Œæ¯è¡Œæ•°æ®ä¹Ÿéƒ½æ˜¯æœ‰å¤šä¸ªç‰ˆæœ¬çš„ã€‚æ¯æ¬¡äº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„æ•°æ®ç‰ˆæœ¬ï¼Œå¹¶ä¸”æŠŠtransaction idèµ‹å€¼ç»™è¿™ä¸ªæ•°æ®ç‰ˆæœ¬çš„äº‹åŠ¡ IDï¼Œè®°ä¸º row trx_idã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¡¨ä¸­çš„ä¸€è¡Œè®°å½•ï¼Œå…¶å®å¯èƒ½æœ‰å¤šä¸ªç‰ˆæœ¬(row)ï¼Œæ¯ä¸ªç‰ˆæœ¬æœ‰è‡ªå·±çš„ row trx_idã€‚ ä¸€ä¸ªè®°å½•è¢«å¤šä¸ªäº‹åŠ¡è¿ç»­æ›´æ–°åçš„çŠ¶æ€: å›¾ä¸­è™šçº¿æ¡†é‡Œæ˜¯åŒä¸€è¡Œæ•°æ®çš„4ä¸ªç‰ˆæœ¬ï¼Œå½“å‰æœ€æ–°ç‰ˆæœ¬æ˜¯ V4ï¼Œk çš„å€¼æ˜¯ 22ï¼Œå®ƒæ˜¯è¢«transaction id ä¸º 25 çš„äº‹åŠ¡æ›´æ–°çš„ï¼Œå› æ­¤å®ƒçš„ row trx_id ä¹Ÿæ˜¯ 25ã€‚ å›¾ä¸­ä¸‰ä¸ªè™šçº¿ç®­å¤´ï¼Œå°±æ˜¯ undo logï¼Œè€Œ V1ã€V2ã€V3 å¹¶ä¸æ˜¯ç‰©ç†ä¸ŠçœŸå®å­˜åœ¨çš„ï¼Œè€Œæ˜¯æ¯æ¬¡éœ€è¦çš„æ—¶å€™æ ¹æ®å½“å‰ç‰ˆæœ¬å’Œ undo log è®¡ç®—å‡ºæ¥çš„ã€‚ ä¸€ä¸ªäº‹åŠ¡åªéœ€è¦åœ¨å¯åŠ¨çš„æ—¶å€™å£°æ˜è¯´ï¼Œâ€œä»¥æˆ‘å¯åŠ¨çš„æ—¶åˆ»ä¸ºå‡†ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®ç‰ˆæœ¬æ˜¯åœ¨æˆ‘å¯åŠ¨ä¹‹å‰ç”Ÿæˆçš„ï¼Œå°±è®¤ï¼›å¦‚æœæ˜¯æˆ‘å¯åŠ¨ä»¥åæ‰ç”Ÿæˆçš„ï¼Œæˆ‘å°±ä¸è®¤ï¼Œæˆ‘å¿…é¡»è¦æ‰¾åˆ°å®ƒçš„ä¸Šä¸€ä¸ªç‰ˆæœ¬â€ã€‚å¦‚æœ\"ä¸Šä¸€ä¸ªç‰ˆæœ¬\"ä¹Ÿä¸å¯è§ï¼Œé‚£å°±å¾—ç»§ç»­å¾€å‰æ‰¾ã€‚ åœ¨å®ç°ä¸Šï¼Œ InnoDB ä¸ºæ¯ä¸ªäº‹åŠ¡æ„é€ äº†ä¸€ä¸ªæ•°ç»„ï¼Œç”¨æ¥ä¿å­˜è¿™ä¸ªäº‹åŠ¡å¯åŠ¨ç¬é—´ï¼Œå½“å‰æ­£åœ¨ æ´»è·ƒ (å¯åŠ¨äº†ä½†è¿˜æ²¡æäº¤)çš„æ‰€æœ‰äº‹åŠ¡ IDã€‚ æ•°ç»„é‡Œé¢äº‹åŠ¡ ID çš„æœ€å°å€¼è®°ä¸ºä½æ°´ä½ï¼Œå½“å‰ç³»ç»Ÿé‡Œé¢å·²ç»åˆ›å»ºè¿‡çš„äº‹åŠ¡ ID çš„æœ€å¤§å€¼åŠ 1è®°ä¸ºé«˜æ°´ä½ã€‚ å¯¹äºä¸€ä¸ªæ•°æ®ç‰ˆæœ¬çš„ row trx_id, æœ‰ä»¥ä¸‹å‡ ç§å¯èƒ½ï¼š å¦‚æœè½åœ¨ç»¿è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²æäº¤çš„äº‹åŠ¡æˆ–è€…æ˜¯å½“å‰äº‹åŠ¡è‡ªå·±ç”Ÿæˆçš„ï¼Œè¿™ä¸ªæ•°æ®æ˜¯å¯è§çš„ï¼› å¦‚æœè½åœ¨çº¢è‰²éƒ¨åˆ†ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±å°†æ¥å¯åŠ¨çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œæ˜¯è‚¯å®šä¸å¯è§çš„ï¼› å¦‚æœè½åœ¨é»„è‰²éƒ¨åˆ†ï¼Œé‚£å°±åŒ…æ‹¬ä¸¤ç§æƒ…å†µ a. è‹¥ row trx_id åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯ç”±è¿˜æ²¡æäº¤çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œä¸å¯è§ï¼› b. è‹¥ row trx_id ä¸åœ¨æ•°ç»„ä¸­ï¼Œè¡¨ç¤ºè¿™ä¸ªç‰ˆæœ¬æ˜¯å·²ç»æäº¤äº†çš„äº‹åŠ¡ç”Ÿæˆçš„ï¼Œå¯è§ã€‚ åˆ†æä¸‹å›¾ 1 ä¸­çš„ä¸‰ä¸ªäº‹åŠ¡ï¼Œäº‹åŠ¡ A ä¸ºä»€ä¹ˆæ˜¯ k=1 ï¼Ÿ å‡è®¾ï¼š äº‹åŠ¡Aå¼€å§‹å‰ï¼Œç³»ç»Ÿé‡Œé¢åªæœ‰ä¸€ä¸ªæ´»è·ƒäº‹åŠ¡ ID æ˜¯ 99ï¼› äº‹åŠ¡ Aã€Bã€C çš„ç‰ˆæœ¬å·åˆ†åˆ«æ˜¯ 100ã€101ã€102ï¼Œä¸”å½“å‰ç³»ç»Ÿé‡Œåªæœ‰è¿™å››ä¸ªäº‹åŠ¡ï¼› ä¸‰ä¸ªäº‹åŠ¡å¼€å§‹å‰ï¼Œ(1,1ï¼‰è¿™ä¸€è¡Œæ•°æ®çš„ row trx_idæ˜¯ 90ã€‚ è¿™æ ·ï¼Œäº‹åŠ¡ A çš„è§†å›¾æ•°ç»„å°±æ˜¯ [99,100] , äº‹åŠ¡Bçš„è§†å›¾æ•°ç»„æ˜¯ [99,100,101], äº‹åŠ¡Cçš„è§†å›¾æ•°ç»„æ˜¯ [99,100,101,102]ã€‚ äº‹åŠ¡AæŸ¥è¯¢é€»è¾‘æœ‰å…³çš„æ“ä½œ: æ€»ç»“ï¼š ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š ç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/08/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/08/"},{"categories":null,"content":"3ã€æ›´æ–°é€»è¾‘ æ›´æ–°æ•°æ®éƒ½æ˜¯å…ˆè¯»åå†™çš„ï¼Œè€Œè¿™ä¸ªè¯»ï¼Œåªèƒ½è¯»å½“å‰çš„å€¼ï¼Œç§°ä¸º\"å½“å‰è¯»\"ï¼ˆcurrent readï¼‰ã€‚ åœ¨æ‰§è¡Œäº‹åŠ¡ B è¯­å¥çš„æ—¶å€™ï¼Œupdate è¯­å¥æ˜¯å½“å‰è¯»ï¼Œè¿™æ˜¯ row trx_id ä¸º 101ï¼Œæ‰€ä»¥ select è¯­å¥èƒ½è¯»åˆ° k=3ã€‚ é™¤äº† update è¯­å¥å¤–ï¼Œselect è¯­å¥å¦‚æœåŠ é”ï¼Œä¹Ÿæ˜¯å½“å‰è¯»ã€‚ mysql\u003e select k from t where id=1 lock in share mode; # è¯»é”ï¼ˆSé”ï¼Œå…±äº«é”ï¼‰ mysql\u003e select k from t where id=1 for update; # å†™é”ï¼ˆXé”ï¼Œæ’ä»–é”ï¼‰ å‡è®¾äº‹åŠ¡ C ä¸æ˜¯é©¬ä¸Šæäº¤çš„ï¼Œè€Œæ˜¯å˜æˆäº†ä¸‹é¢çš„äº‹åŠ¡ Câ€™ï¼Œä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿ äº‹åŠ¡ Câ€™ æ²¡æäº¤ï¼Œä¹Ÿå°±æ˜¯è¯´ (1,2) è¿™ä¸ªç‰ˆæœ¬ä¸Šçš„å†™é”è¿˜æ²¡é‡Šæ”¾ã€‚è€Œäº‹åŠ¡B æ˜¯å½“å‰è¯»ï¼Œå¿…é¡»è¦è¯»æœ€æ–°ç‰ˆæœ¬ï¼Œè€Œä¸”å¿…é¡»åŠ é”ï¼Œå› æ­¤å°±è¢«é”ä½äº†ï¼Œå¿…é¡»ç­‰åˆ°äº‹åŠ¡ Câ€™ é‡Šæ”¾è¿™ä¸ªé”ï¼Œæ‰èƒ½ç»§ç»­å®ƒçš„å½“å‰è¯»ã€‚ æ€»ç»“ï¼š å¯é‡å¤è¯»çš„æ ¸å¿ƒå°±æ˜¯ä¸€è‡´æ€§è¯»ï¼ˆconsistent readï¼‰ï¼›è€Œäº‹åŠ¡æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œåªèƒ½ç”¨å½“å‰è¯»ã€‚å¦‚æœå½“å‰çš„è®°å½•çš„è¡Œé”è¢«å…¶ä»–äº‹åŠ¡å ç”¨çš„è¯ï¼Œå°±éœ€è¦è¿›å…¥é”ç­‰å¾…ã€‚ è¯»æäº¤çš„é€»è¾‘å’Œå¯é‡å¤è¯»çš„é€»è¾‘ç±»ä¼¼ï¼Œå®ƒä»¬æœ€ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼š åœ¨å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ä¸‹ï¼Œåªéœ€è¦åœ¨äº‹åŠ¡å¼€å§‹çš„æ—¶å€™åˆ›å»ºä¸€è‡´æ€§è§†å›¾ï¼Œä¹‹åäº‹åŠ¡é‡Œçš„å…¶ä»–æŸ¥è¯¢éƒ½å…±ç”¨è¿™ä¸ªä¸€è‡´æ€§è§†å›¾ï¼› åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ¯ä¸€ä¸ªè¯­å¥æ‰§è¡Œå‰éƒ½ä¼šé‡æ–°ç®—å‡ºä¸€ä¸ªæ–°çš„è§†å›¾ã€‚ æ³¨æ„ï¼Œè¯­å¥ start transaction with consistent snapshot; åœ¨è¯»æäº¤éš”ç¦»çº§åˆ«ä¸‹ï¼Œæ²¡æœ‰æ„ä¹‰ã€‚ è¯»æäº¤æ—¶çš„çŠ¶æ€å›¾ï¼Œæ³¨æ„æ˜¯äº‹åŠ¡ Cã€‚ äº‹åŠ¡ A æŸ¥è¯¢è¯­å¥è¿”å›çš„æ˜¯ k=2ï¼Œäº‹åŠ¡ B æŸ¥è¯¢ç»“æœ k=3ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/08/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/08/"},{"categories":null,"content":"4ã€æœ€é‡è¦çš„æ€»ç»“ ä¸€ä¸ªæ•°æ®ç‰ˆæœ¬ï¼Œå¯¹äºä¸€ä¸ªäº‹åŠ¡è§†å›¾æ¥è¯´ï¼Œé™¤äº†è‡ªå·±çš„æ›´æ–°æ€»æ˜¯å¯è§ä»¥å¤–ï¼Œæœ‰ä¸‰ç§æƒ…å†µï¼š ç‰ˆæœ¬æœªæäº¤ï¼Œä¸å¯è§ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œä½†æ˜¯æ˜¯åœ¨è§†å›¾åˆ›å»ºåæäº¤çš„ï¼Œä¸å¯è§ï¼› ç‰ˆæœ¬å·²æäº¤ï¼Œè€Œä¸”æ˜¯åœ¨è§†å›¾åˆ›å»ºå‰æäº¤çš„ï¼Œå¯è§ã€‚ è¯­å¥ update ã€for update ã€lock in share mode æ˜¯å½“å‰è¯»ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/08/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/08/"},{"categories":null,"content":"5ã€é—®é¢˜ æˆ‘ç”¨ä¸‹é¢çš„è¡¨ç»“æ„å’Œåˆå§‹åŒ–è¯­å¥ä½œä¸ºè¯•éªŒç¯å¢ƒï¼Œäº‹åŠ¡éš”ç¦»çº§åˆ«æ˜¯å¯é‡å¤è¯»ã€‚ç°åœ¨ï¼Œæˆ‘è¦æŠŠæ‰€æœ‰\"å­—æ®µcå’Œidå€¼ç›¸ç­‰çš„è¡Œ\"çš„ c å€¼æ¸…é›¶ï¼Œä½†æ˜¯å´å‘ç°äº†ä¸€ä¸ªâ€œè¯¡å¼‚â€çš„ã€æ”¹ä¸æ‰çš„æƒ…å†µã€‚è¯·ä½ æ„é€ å‡ºè¿™ç§æƒ…å†µï¼Œå¹¶è¯´æ˜å…¶åŸç†ã€‚ mysql\u003e CREATE TABLE `t` ( `id` int(11) NOT NULL, `c` int(11) DEFAULT NULL, PRIMARY KEY (`id`) ) ENGINE=InnoDB; insert into t(id, c) values(1,1),(2,2),(3,3),(4,4); å‡ºç°çš„æƒ…å†µï¼š ç¬¬ä¸€ç§æƒ…å†µ 2. ç¬¬äºŒç§æƒ…å†µ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/08/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/08/"},{"categories":null,"content":"1ã€æŸ¥è¯¢è¿‡ç¨‹ ä¸»é”®ç´¢å¼• ID å’Œ æ™®é€šç´¢å¼• K: å‡è®¾æ‰§è¡ŒæŸ¥è¯¢çš„è¯­å¥æ˜¯ select id from T where k=5, ä½¿ç”¨äºŒåˆ†æ³•æŸ¥è¯¢ï¼š å¯¹äºæ™®é€šç´¢å¼•æ¥è¯´ï¼ŒæŸ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªè®°å½•(5,500)åï¼Œéœ€è¦æŸ¥æ‰¾ä¸‹ä¸€ä¸ªè®°å½•ï¼Œç›´åˆ°ç¢°åˆ°ç¬¬ä¸€ä¸ªä¸æ»¡è¶³ k=5 æ¡ä»¶çš„è®°å½•ã€‚ å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œç”±äºç´¢å¼•å®šä¹‰äº†å”¯ä¸€æ€§ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„è®°å½•åï¼Œå°±ä¼šåœæ­¢ç»§ç»­æ£€ç´¢ã€‚ ä¸¤ä¸ªç´¢å¼•çš„æ€§èƒ½å·®åˆ«ï¼Œå¾®ä¹å…¶å¾®ã€‚ InnoDB çš„æ•°æ®æ˜¯æŒ‰æ•°æ®é¡µä¸ºå•ä½æ¥è¯»å†™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æ‰¾åˆ° k=5 çš„è®°å½•çš„æ—¶å€™ï¼Œå®ƒæ‰€åœ¨çš„æ•°æ®é¡µå°±éƒ½åœ¨å†…å­˜é‡Œäº†ï¼Œæ‰€ä»¥åˆ¤æ–­ä¸‹ä¸€æ¡è®°å½•æ˜¯å¾ˆå¿«çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/09/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/09/"},{"categories":null,"content":"2ã€æ›´æ–°è¿‡ç¨‹ å½“éœ€è¦æ›´æ–°ä¸€ä¸ªæ•°æ®é¡µæ—¶ï¼Œå¦‚æœæ•°æ®é¡µåœ¨å†…å­˜ä¸­å°±ç›´æ¥æ›´æ–°ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µè¿˜æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œåœ¨ä¸å½±å“æ•°æ®ä¸€è‡´æ€§çš„å‰æä¸‹ï¼ŒInooDB ä¼šå°†è¿™äº›æ›´æ–°æ“ä½œç¼“å­˜åœ¨ change buffer ä¸­ï¼Œè¿™æ ·å°±ä¸éœ€è¦ä»ç£ç›˜ä¸­è¯»å…¥è¿™ä¸ªæ•°æ®é¡µäº†ã€‚åœ¨ä¸‹æ¬¡æŸ¥è¯¢éœ€è¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µçš„æ—¶å€™ï¼Œå°†æ•°æ®é¡µè¯»å…¥å†…å­˜ï¼Œç„¶åæ‰§è¡Œ change buffer ä¸­ä¸è¿™ä¸ªé¡µæœ‰å…³çš„æ“ä½œã€‚é€šè¿‡è¿™ç§æ–¹å¼å°±èƒ½ä¿è¯è¿™ä¸ªæ•°æ®é€»è¾‘çš„æ­£ç¡®æ€§ã€‚ å°† change buffer ä¸­çš„æ“ä½œåº”ç”¨åˆ°åŸæ•°æ®é¡µï¼Œå¾—åˆ°æœ€æ–°ç»“æœçš„è¿‡ç¨‹ç§°ä¸º mergeã€‚é™¤äº†è®¿é—®è¿™ä¸ªæ•°æ®é¡µä¼šè§¦å‘ merge å¤–ï¼Œç³»ç»Ÿæœ‰åå°çº¿ç¨‹ä¼šå®šæœŸ merge ã€‚åœ¨æ•°æ®åº“æ­£å¸¸å…³é—­ï¼ˆshutdownï¼‰çš„è¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šæ‰§è¡Œ merge æ“ä½œã€‚ å¯¹äºå”¯ä¸€ç´¢å¼•æ¥è¯´ï¼Œæ‰€æœ‰çš„æ›´æ–°æ“ä½œéƒ½è¦å…ˆåˆ¤æ–­è¿™ä¸ªæ“ä½œæ˜¯å¦è¿åå”¯ä¸€æ€§çº¦æŸï¼Œæ‰€ä»¥å¿…é¡»è¦å°†æ•°æ®é¡µè¯»å…¥å†…å­˜æ‰èƒ½åˆ¤æ–­ï¼Œè¿™æ—¶ change buffer ä¸èƒ½ä½¿ç”¨äº†ã€‚ change buffer ç”¨çš„æ˜¯ buffer pool é‡Œçš„å†…å­˜ï¼Œå› æ­¤ä¸èƒ½æ— é™å¢å¤§ã€‚change buffer çš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡å‚æ•° innodb_change_buffer_max_size æ¥åŠ¨æ€è®¾ç½®ã€‚è¿™ä¸ªå‚æ•°è®¾ç½®ä¸º 50 çš„æ—¶å€™ï¼Œè¡¨ç¤º change buffer çš„å¤§å°æœ€å¤šåªèƒ½å ç”¨ buffer pool çš„ 50%ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/09/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/09/"},{"categories":null,"content":"3ã€change buffer çš„ä½¿ç”¨åœºæ™¯ change buffer çš„ä¸»è¦ç›®çš„å°±æ˜¯å°†è®°å½•çš„å˜æ›´åŠ¨ä½œç¼“å­˜ä¸‹æ¥ï¼Œæ‰€ä»¥åœ¨ä¸€ä¸ªæ•°æ®é¡µåš merge ä¹‹å‰ï¼Œchange buffer è®°å½•çš„å˜æ›´è¶Šå¤šï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªé¡µé¢ä¸Šè¦æ›´æ–°çš„æ¬¡æ•°è¶Šå¤šï¼‰ï¼Œæ”¶ç›Šå°±è¶Šå¤§ã€‚ å¯¹äºå†™å¤šè¯»å°‘çš„ä¸šåŠ¡æ¥è¯´ï¼Œ change buffer çš„ä½¿ç”¨æ•ˆæœæœ€å¥½ã€‚è¿™ç§ä¸šåŠ¡æ¨¡å‹å¸¸è§çš„å°±æ˜¯è´¦å•ç±»ã€æ—¥å¿—ç±»çš„ç³»ç»Ÿã€‚ å‡è®¾ä¸€ä¸ªä¸šåŠ¡çš„æ›´æ–°æ¨¡å¼æ˜¯å†™å…¥ä¹‹åé©¬ä¸Šä¼šåšæŸ¥è¯¢ï¼Œé‚£ä¹ˆå³ä½¿æ»¡è¶³äº†æ¡ä»¶ï¼Œå°†æ›´æ–°å…ˆè®°å½•åœ¨ change bufferï¼Œä½†ä¹‹åç”±äºé©¬ä¸Šè¦è®¿é—®è¿™ä¸ªæ•°æ®é¡µï¼Œä¼šç«‹å³è§¦å‘ merge è¿‡ç¨‹ã€‚è¿™æ ·éšæœºè®¿é—® IO çš„æ¬¡æ•°ä¸ä¼šå‡å°‘ï¼Œåè€Œå¢åŠ äº† change buffer çš„ç»´æŠ¤ä»£ä»·ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/09/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/09/"},{"categories":null,"content":"4ã€ç´¢å¼•é€‰æ‹©å’Œå®è·µ åœ¨ä¸å½±å“ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå»ºè®®ä½ å°½é‡é€‰æ‹©æ™®é€šç´¢å¼•ã€‚ æ™®é€šç´¢å¼•å’Œ change buffer çš„é…åˆä½¿ç”¨ï¼Œå¯¹äºæ•°æ®é‡å¤§çš„è¡¨çš„æ›´æ–°ä¼˜åŒ–è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/09/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/09/"},{"categories":null,"content":"5ã€change buffer å’Œ redo log æ‰§è¡Œæ’å…¥è¯­å¥ï¼š mysql\u003e insert into t(id,k) values(id1,k1),(id2,k2); æˆ‘ä»¬å‡è®¾\u0008å½“å‰ k ç´¢å¼•æ ‘çš„çŠ¶æ€ï¼ŒæŸ¥æ‰¾åˆ°ä½ç½®åï¼Œk1 æ‰€åœ¨çš„æ•°æ®é¡µåœ¨å†…å­˜(InnoDB buffer pool)ä¸­ï¼Œk2 æ‰€åœ¨çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­ã€‚ä¸‹å›¾æ˜¯å¸¦ change buffer çš„æ›´æ–°çŠ¶æ€å›¾ã€‚ è¿™æ¡æ’å…¥è¯­å¥åšäº†å¦‚ä¸‹çš„æ“ä½œ: Page 1 åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æ›´æ–°å†…å­˜ã€‚ Page 2 æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±åœ¨å†…å­˜çš„ change buffer åŒºåŸŸï¼Œè®°å½•ä¸‹\"æˆ‘è¦å¾€ Page 2 æ’å…¥ä¸€è¡Œ\"è¿™ä¸ªä¿¡æ¯ã€‚ å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥ redo log ä¸­ï¼ˆå›¾ä¸­3å’Œ4ï¼‰ã€‚ å›¾ä¸­çš„ä¸¤ä¸ªè™šçº¿ç®­å¤´ï¼Œæ˜¯åå°æ“ä½œï¼Œä¸å½±å“æ›´æ–°çš„å“åº”æ—¶é—´ã€‚ ç°åœ¨è¦æ‰§è¡Œè¯­å¥ select * from t where k in (k1, k2)ï¼Œè¿™ä¸¤ä¸ªè¯»è¯·æ±‚çš„æµç¨‹å›¾ï¼š è¯» Page 1 çš„æ—¶å€™ï¼Œç›´æ¥ä»å†…å­˜è¿”å›ã€‚ è¦è¯» Page 2 çš„æ—¶å€™ï¼Œéœ€è¦æŠŠ Page 2 ä»ç£ç›˜è¯»å…¥å†…å­˜ä¸­ï¼Œç„¶ååº”ç”¨ change buffer é‡Œé¢çš„æ“ä½œæ—¥å¿—ï¼Œç”Ÿæˆä¸€ä¸ªæ­£ç¡®çš„ç‰ˆæœ¬å¹¶è¿”å›ç»“æœã€‚ ä»ä¸Šå›¾å¯çŸ¥ï¼Œredo log ä¸»è¦èŠ‚çœçš„æ˜¯éšæœºå†™ç£ç›˜çš„ IO æ¶ˆè€—ï¼ˆè½¬æˆé¡ºåºå†™ï¼‰ï¼Œè€Œ change buffer ä¸»è¦èŠ‚çœçš„åˆ™æ˜¯éšæœºè¯»ç£ç›˜çš„ IO æ¶ˆè€—ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/09/:5:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/09/"},{"categories":null,"content":"6ã€é—®é¢˜ change buffer ä¸€å¼€å§‹æ˜¯å†™å†…å­˜çš„ï¼Œé‚£ä¹ˆå¦‚æœè¿™ä¸ªæ—¶å€™æœºå™¨æ‰ç”µé‡å¯ï¼Œä¼šä¸ä¼šå¯¼è‡´ change buffer ä¸¢å¤±å‘¢ï¼Ÿchange buffer ä¸¢å¤±å¯ä¸æ˜¯å°äº‹å„¿ï¼Œå†ä»ç£ç›˜è¯»å…¥æ•°æ®å¯å°±æ²¡æœ‰äº† merge è¿‡ç¨‹ï¼Œå°±ç­‰äºæ˜¯æ•°æ®ä¸¢å¤±äº†ã€‚ä¼šä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ ä¸ä¼šä¸¢å¤±ã€‚è™½ç„¶æ˜¯åªæ›´æ–°å†…å­˜ï¼Œä½†æ˜¯åœ¨äº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠ change buffer çš„æ“ä½œä¹Ÿè®°å½•åˆ° redo log é‡Œäº†ï¼Œæ‰€ä»¥å´©æºƒæ¢å¤çš„æ—¶å€™ï¼Œchange buffer ä¹Ÿèƒ½æ‰¾å›æ¥ã€‚ merge çš„æ‰§è¡Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š ä»ç£ç›˜è¯»å…¥æ•°æ®é¡µåˆ°å†…å­˜ï¼ˆè€ç‰ˆæœ¬çš„æ•°æ®é¡µï¼‰ï¼› ä» change buffer é‡Œæ‰¾å‡ºè¿™ä¸ªæ•°æ®é¡µçš„ change buffer è®°å½•(å¯èƒ½æœ‰å¤šä¸ªï¼‰ï¼Œä¾æ¬¡åº”ç”¨ï¼Œå¾—åˆ°æ–°ç‰ˆæ•°æ®é¡µï¼› å†™ redo logã€‚è¿™ä¸ª redo log åŒ…å«äº†æ•°æ®çš„å˜æ›´å’Œ change buffer çš„å˜æ›´ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/09/:6:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/09/"},{"categories":null,"content":"1ã€é€‰é”™ç´¢å¼• ä¸€ä¸ªä¾‹å­ï¼Œå»ºè¡¨è¯­å¥å¦‚ä¸‹ï¼š CREATE TABLE `x` ( `id` int(11) NOT NULL, `a` int(11) DEFAULT NULL, `b` int(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `a` (`a`), KEY `b` (`b`) ) ENGINE=InnoDB; å¾€è¡¨ x ä¸­æ’å…¥ 10 ä¸‡è¡Œè®°å½•ï¼Œå–å€¼æŒ‰æ•´æ•°é€’å¢ï¼Œå³ï¼š(1,1,1)ï¼Œ(2,2,2)ï¼Œ(3,3,3) ç›´åˆ°(100000,100000,100000)ï¼Œå­˜å‚¨è¿‡ç¨‹å¦‚ä¸‹ï¼š delimiter ;; create procedure idata() begin declare i int; set i=1; while(i\u003c=100000)do insert into x values(i, i, i); set i=i+1; end while; end;; delimiter ; call idata(); åˆ†æä¸€æ¡ SQL è¯­å¥ select * from x where a between 10000 and 20000; æˆ‘ä»¬å†åšå¦‚ä¸‹æ“ä½œã€‚ è¿™æ—¶å€™ï¼Œsession B çš„æŸ¥è¯¢è¯­å¥ select * from t where a between 10000 and 20000 å°±ä¸ä¼šå†é€‰æ‹©ç´¢å¼• a äº†ã€‚ æŸ¥çœ‹æ…¢æŸ¥è¯¢ï¼š ä¸´æ—¶å¼€å¯æ…¢æŸ¥è¯¢ï¼š set global slow_query_log='ON'; set global slow_query_log_file='/var/lib/mysql/instance-1-slow.log'; å®éªŒè¿‡ç¨‹å°±æ˜¯è¿™ä¸‰ä¸ªè¯­å¥ï¼š set long_query_time=0; # è®°å½•æ‰€æœ‰çš„æŸ¥è¯¢åˆ°æ…¢æŸ¥è¯¢æ—¥å¿—ä¸­ select * from x where a between 10000 and 20000; # Q1 æŸ¥è¯¢ select * from x force index(a) where a between 10000 and 20000; # Q2 å¼ºåˆ¶ä½¿ç”¨ç´¢å¼• a è¿™ä¸‰æ¡ SQL è¯­å¥æ‰§è¡Œå®Œæˆåçš„æ…¢æŸ¥è¯¢æ—¥å¿—: Q1 æ‰«æäº† 10 ä¸‡è¡Œï¼Œæ˜¾ç„¶æ˜¯èµ°äº†å…¨è¡¨æ‰«æï¼Œæ‰§è¡Œæ—¶é—´æ˜¯ 40 æ¯«ç§’ã€‚Q2 æ‰«æäº† 10001 è¡Œï¼Œæ‰§è¡Œäº†21æ¯«ç§’ï¼Œå¾ˆæ˜¾ç„¶ mysql é€‰é”™äº†ç´¢å¼•ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/10/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/10/"},{"categories":null,"content":"2ã€ä¼˜åŒ–å™¨çš„é€»è¾‘ åœ¨ç¬¬ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æåˆ°è¿‡ï¼Œé€‰æ‹©ç´¢å¼•æ˜¯ä¼˜åŒ–å™¨çš„å·¥ä½œã€‚ ä¼˜åŒ–å™¨é€‰æ‹©ç´¢å¼•ä¼šæ ¹æ®æ‰«æè¡Œæ•°ã€æ˜¯å¦ä½¿ç”¨ä¸´æ—¶è¡¨ã€æ˜¯å¦æ’åºç­‰å› ç´ è¿›è¡Œç»¼åˆåˆ¤æ–­ã€‚ å½“ç„¶ï¼Œè¿™ä¸ªä¾‹å­ä¸­åªæœ‰æ‰«æè¡Œæ•°è¿™ä¸ªå› ç´ ï¼Œå¯¹äºæ‰«æè¡Œæ•°ï¼ŒMySQL æ ¹æ®ç»Ÿè®¡ä¿¡æ¯æ¥ä¼°ç®—è®°å½•æ•°ï¼ŒæŠ½æ ·æ¥å¾—åˆ°ç´¢å¼•çš„åŸºæ•°ä¿¡æ¯ï¼ˆåŒºåˆ«åº¦ï¼‰ï¼Œå¦‚ä¸‹å›¾ã€‚ é‡‡æ ·ç»Ÿè®¡çš„æ—¶å€™ï¼ŒInnoDB é»˜è®¤ä¼šé€‰æ‹© N ä¸ªæ•°æ®é¡µï¼Œç»Ÿè®¡è¿™äº›é¡µé¢ä¸Šçš„ä¸åŒå€¼ï¼Œå¾—åˆ°ä¸€ä¸ªå¹³å‡å€¼ï¼Œç„¶åä¹˜ä»¥è¿™ä¸ªç´¢å¼•çš„é¡µé¢æ•°ï¼Œå°±å¾—åˆ°äº†è¿™ä¸ªç´¢å¼•çš„åŸºæ•°ã€‚ åœ¨ MySQL ä¸­ï¼Œæœ‰ä¸¤ç§å­˜å‚¨ç´¢å¼•ç»Ÿè®¡çš„æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®å‚æ•° innodb_stats_persistent çš„å€¼æ¥é€‰æ‹©ï¼š è®¾ç½®ä¸º onï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯ä¼šæŒä¹…åŒ–å­˜å‚¨ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ N æ˜¯ 20ï¼ŒM æ˜¯ 10ã€‚ è®¾ç½®ä¸º offï¼Œè¡¨ç¤ºç»Ÿè®¡ä¿¡æ¯åªå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚è¿™æ—¶ï¼Œé»˜è®¤çš„ Næ˜¯ 8ï¼ŒM æ˜¯ 16ã€‚ MySQL é€‰é”™ç´¢å¼•ï¼Œæ˜¯å› ä¸ºç´¢å¼•ç»Ÿè®¡ä¿¡æ¯ä¸å‡†ç¡®ï¼Œä¿®æ­£ç»Ÿè®¡ä¿¡æ¯ï¼Œæ‰§è¡Œ analyze table x; å‘½ä»¤ã€‚ å¦å¤–ä¸€ä¸ªè¯­å¥ï¼š mysql\u003e select * from t where (a between 1 and 1000) and (b between 50000 and 100000) order by b limit 1; ä»æ¡ä»¶ä¸Šçœ‹ï¼Œè¿™ä¸ªæŸ¥è¯¢æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•ï¼Œå› æ­¤ä¼šè¿”å›ç©ºé›†åˆã€‚ å¦‚æœä¼˜åŒ–å™¨ä½¿ç”¨ç´¢å¼• a çš„è¯ï¼Œæ‰§è¡Œé€Ÿåº¦æ˜æ˜¾ä¼šå¿«å¾ˆå¤šï¼Œæ‰§è¡Œ explainå‘½ä»¤åï¼š è¿”å›ç»“æœä¸­ key å­—æ®µæ˜¾ç¤ºï¼Œè¿™æ¬¡ä¼˜åŒ–å™¨é€‰æ‹©äº†ç´¢å¼• bã€‚ ä»è¿™ä¸ªç»“æœä¸­ï¼Œä½ å¯ä»¥å¾—åˆ°ä¸¤ä¸ªç»“è®ºï¼š æ‰«æè¡Œæ•°çš„ä¼°è®¡å€¼ä¾ç„¶ä¸å‡†ç¡®ã€‚ è¿™ä¸ªä¾‹å­é‡Œ MySQL åˆé€‰é”™äº†ç´¢å¼•ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/10/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/10/"},{"categories":null,"content":"3ã€ç´¢å¼•é€‰æ‹©å¼‚å¸¸å’Œå¤„ç† ä¸€ç§æ–¹æ³•æ˜¯ï¼Œé‡‡ç”¨ force index å¼ºè¡Œé€‰æ‹©ä¸€ä¸ªç´¢å¼•ã€‚ å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¿®æ”¹è¯­å¥ï¼Œå¼•å¯¼ MySQL ä½¿ç”¨æˆ‘ä»¬æœŸæœ›çš„ç´¢å¼•ã€‚ ä¿®æ”¹è¯­å¥åï¼š ä¹‹å‰ä¼˜åŒ–å™¨é€‰æ‹©ä½¿ç”¨ç´¢å¼• bï¼Œæ˜¯å› ä¸ºå®ƒè®¤ä¸ºä½¿ç”¨ç´¢å¼• b å¯ä»¥é¿å…æ’åºï¼ˆ b æœ¬èº«æ˜¯ç´¢å¼•ï¼Œå·²ç»æ˜¯æœ‰åºçš„äº†ï¼Œå¦‚æœé€‰æ‹©ç´¢å¼• b çš„è¯ï¼Œä¸éœ€è¦å†åšæ’åºï¼Œåªéœ€è¦éå†ï¼‰ï¼Œæ‰€ä»¥å³ä½¿æ‰«æè¡Œæ•°å¤šï¼Œä¹Ÿåˆ¤å®šä¸ºä»£ä»·æ›´å°ã€‚ ç°åœ¨ order by b,a è¿™ç§å†™æ³•ï¼Œè¦æ±‚æŒ‰ç…§ b,a æ’åºï¼Œå°±æ„å‘³ç€ä½¿ç”¨è¿™ä¸¤ä¸ªç´¢å¼•éƒ½éœ€è¦æ’åºã€‚å› æ­¤ï¼Œæ‰«æè¡Œæ•°æˆäº†å½±å“å†³ç­–çš„ä¸»è¦æ¡ä»¶ï¼Œäºæ˜¯æ­¤æ—¶ä¼˜åŒ–å™¨é€‰äº†åªéœ€è¦æ‰«æ 1000 è¡Œçš„ç´¢å¼• aã€‚ è¿™ç§ä¿®æ”¹å¹¶ä¸æ˜¯é€šç”¨çš„ä¼˜åŒ–æ‰‹æ®µï¼Œåªæ˜¯åˆšå¥½åœ¨è¿™ä¸ªè¯­å¥é‡Œé¢æœ‰ limit 1,order by b limit 1 å’Œ order by b,a limit 1 éƒ½ä¼šè¿”å›b æ˜¯æœ€å°çš„é‚£ä¸€è¡Œï¼Œé€»è¾‘ä¸Šä¸€è‡´ï¼Œæ‰å¯ä»¥è¿™ä¹ˆåšã€‚ å¦ä¸€ç§ä¿®æ”¹è¯­å¥ï¼š åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬ç”¨ limit 100 è®©ä¼˜åŒ–å™¨æ„è¯†åˆ°ï¼Œä½¿ç”¨ b ç´¢å¼•ä»£ä»·æ˜¯å¾ˆé«˜çš„ã€‚å…¶å®æ˜¯æˆ‘ä»¬æ ¹æ®æ•°æ®ç‰¹å¾è¯±å¯¼äº†ä¸€ä¸‹ä¼˜åŒ–å™¨ï¼Œä¹Ÿä¸å…·å¤‡é€šç”¨æ€§ã€‚ ç¬¬ä¸‰ç§æ–¹æ³•æ˜¯ï¼Œæœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ›´åˆé€‚çš„ç´¢å¼•ï¼Œæ¥æä¾›ç»™ä¼˜åŒ–å™¨åšé€‰æ‹©ï¼Œæˆ–åˆ æ‰è¯¯ç”¨çš„ç´¢å¼•ã€‚ ç¬¬å››ç§æ–¹æ³•æ˜¯ï¼Œåˆ æ‰ç´¢å¼• bã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/10/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/10/"},{"categories":null,"content":"4ã€é—®é¢˜ å‰é¢æˆ‘ä»¬åœ¨æ„é€ ç¬¬ä¸€ä¸ªä¾‹å­çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ session A çš„é…åˆï¼Œè®© session B åˆ é™¤æ•°æ®ååˆé‡æ–°æ’å…¥äº†ä¸€éæ•°æ®ï¼Œç„¶åå°±å‘ç° explain ç»“æœä¸­ï¼Œrows å­—æ®µä» 10001 å˜æˆ 37000 å¤šã€‚ è€Œå¦‚æœæ²¡æœ‰ session A çš„é…åˆï¼Œåªæ˜¯å•ç‹¬æ‰§è¡Œ delete from t ã€call idata()ã€explain è¿™ä¸‰å¥è¯ï¼Œä¼šçœ‹åˆ° rows å­—æ®µå…¶å®è¿˜æ˜¯10000å·¦å³ã€‚ ç­”æ¡ˆï¼š delete è¯­å¥åˆ æ‰äº†æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åå†é€šè¿‡ call idata() æ’å…¥äº† 10 ä¸‡è¡Œæ•°æ®ï¼Œçœ‹ä¸Šå»æ˜¯è¦†ç›–äº†åŸæ¥çš„ 10 ä¸‡è¡Œã€‚ ä½†æ˜¯ï¼Œsession A å¼€å¯äº†äº‹åŠ¡å¹¶æ²¡æœ‰æäº¤ï¼Œæ‰€ä»¥ä¹‹å‰æ’å…¥çš„ 10 ä¸‡è¡Œæ•°æ®æ˜¯ä¸èƒ½åˆ é™¤çš„ã€‚è¿™æ ·ï¼Œä¹‹å‰çš„æ•°æ®æ¯ä¸€è¡Œæ•°æ®éƒ½æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬æ˜¯ delete ä¹‹å‰çš„æ•°æ®ï¼Œæ–°ç‰ˆæœ¬æ˜¯æ ‡è®°ä¸º deleted çš„æ•°æ®ã€‚ è¿™æ ·ï¼Œç´¢å¼• a ä¸Šçš„æ•°æ®å…¶å®å°±æœ‰ä¸¤ä»½ã€‚ è¡¨çš„è¡Œæ•°ï¼Œä¼˜åŒ–å™¨ç›´æ¥ç”¨çš„æ˜¯ show table status çš„å€¼ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/10/:4:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/10/"},{"categories":null,"content":"1ã€å­—ç¬¦ä¸²ç´¢å¼• å‡è®¾ï¼Œä½ ç°åœ¨ç»´æŠ¤ä¸€ä¸ªæ”¯æŒé‚®ç®±ç™»å½•çš„ç³»ç»Ÿï¼Œç”¨æˆ·è¡¨æ˜¯è¿™ä¹ˆå®šä¹‰çš„ mysql\u003e create table SUser( ID bigint unsigned primary key, email varchar(64), ... )engine=innodb; è¦ä½¿ç”¨é‚®ç®±ç™»å½•ï¼Œä¸€å®šä¼šå‡ºç°ç±»ä¼¼ä¸‹é¢çš„è¯­å¥ï¼š mysql\u003e select f1, f2 from SUser where email='xxx'; email è¿™ä¸ªå­—æ®µä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆè¿™ä¸ªè¯­å¥å°±åªèƒ½åšå…¨è¡¨æ‰«æã€‚ MySQL æ˜¯æ”¯æŒå‰ç¼€ç´¢å¼•çš„ï¼Œä½ å¯ä»¥å®šä¹‰å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ä½œä¸ºç´¢å¼•ï¼Œä¾‹å¦‚ï¼š mysql\u003e alter table SUser add index index1(email); ## æ•´ä¸ªå­—ç¬¦ä¸² mysql\u003e alter table SUser add index index2(email(6)); ## å‰ 6 ä¸ªå­—èŠ‚ ä¸¤ä¸ªç´¢å¼•å›¾å·®åˆ«å¦‚ä¸‹ï¼š ä½¿ç”¨å‰ç¼€ç´¢å¼•çš„ä¼˜åŠ¿ï¼Œå ç”¨çš„ç©ºé—´ä¼šæ›´å°ï¼Œä½†å¯èƒ½ä¼šå¢åŠ é¢å¤–çš„è®°å½•æ‰«ææ¬¡æ•°ã€‚ ä¾‹å¦‚åˆ†ææ‰§è¡Œè¯­å¥ select id,name,email from SUser where email='zhangssxyz@xxx.com'; çš„è¿‡ç¨‹ã€‚ ä½¿ç”¨ index1 (æ•´ä¸ªå­—ç¬¦ä¸²)ï¼š è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œåªéœ€è¦ä» index1 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯ â€™zhangssxyz@xxx.comâ€™ çš„è¿™æ¡è®°å½•ï¼Œå†è¿›è¡Œå›è¡¨æ“ä½œï¼Œå°±å¯ä»¥è¿”å›ç»“æœã€‚ ä½¿ç”¨ index2 (å‰ 6 ä¸ªå­—èŠ‚)ï¼š è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä» index2 ç´¢å¼•æ ‘æ‰¾åˆ°æ»¡è¶³ç´¢å¼•å€¼æ˜¯ â€™zhangsâ€™ çš„å…¨éƒ¨è®°å½•ï¼Œå†è¿›è¡Œå›è¡¨æ“ä½œï¼Œé€ä¸€åˆ¤æ–­ email æ˜¯ â€™zhangssxyz@xxx.comâ€™ï¼Œæœ€åè¿”å›ç»“æœã€‚å¯èƒ½æœ‰å¤§é‡ä»¥ â€™zhangsâ€™ å¼€å¤´çš„è®°å½•ï¼Œ æ‰€ä»¥å¯èƒ½ä¼šå¢åŠ é¢å¤–çš„è®°å½•æ‰«ææ¬¡æ•°ã€‚ ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå®šä¹‰å¥½é•¿åº¦ï¼Œå°±å¯ä»¥åšåˆ°æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¸ç”¨é¢å¤–å¢åŠ å¤ªå¤šçš„æŸ¥è¯¢æˆæœ¬ã€‚ å¦‚æœå»ºç«‹å‰ç¼€ç´¢å¼•ï¼Œå°±è¦å…³æ³¨åŒºåˆ†åº¦ï¼ŒåŒºåˆ†åº¦è¶Šé«˜è¶Šå¥½ã€‚ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­å¥ï¼Œç»Ÿè®¡ä¸åŒç´¢å¼•çš„ä¸ªæ•°ï¼š mysql\u003e select count(distinct email) as L from SUser; ä¾‹å¦‚ï¼Œç»Ÿè®¡ 4~7 ä¸ªå­—èŠ‚çš„å‰ç¼€ç´¢å¼•ï¼š mysql\u003e select count(distinct left(email,4)ï¼‰as L4, count(distinct left(email,5)ï¼‰as L5, count(distinct left(email,6)ï¼‰as L6, count(distinct left(email,7)ï¼‰as L7, from SUser; ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/11/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/11/"},{"categories":null,"content":"2ã€å…¶ä»–æ–¹å¼ å¯¹äºç±»ä¼¼äºé‚®ç®±è¿™æ ·çš„å­—æ®µæ¥è¯´ï¼Œä½¿ç”¨å‰ç¼€ç´¢å¼•çš„æ•ˆæœå¯èƒ½è¿˜ä¸é”™,é‡åˆ°å‰ç¼€çš„åŒºåˆ†åº¦ä¸å¤Ÿå¥½çš„æƒ…å†µæ—¶ï¼Œæˆ‘ä»¬è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ ä¾‹å¦‚å¯¹èº«ä»½è¯å·çš„è§£å†³æ–¹æ³•ã€‚ ç¬¬ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨å€’åºå­˜å‚¨ã€‚ mysql\u003e select field_list from t where id_card = reverse('input_id_card_string'); ç¬¬äºŒç§æ–¹å¼æ˜¯ä½¿ç”¨hashå­—æ®µ ## æ·»åŠ ç´¢å¼•ï¼Œç”¨æ¥å­˜å‚¨ crc32ã€‚ mysql\u003e alter table t add id_card_crc int unsigned, add index(id_card_crc); # æŸ¥è¯¢æ—¶åˆ¤æ–­ crc32 å€¼ mysql\u003e select field_list from t where id_card_crc=crc32('input_id_card_string') and id_card='input_id_card_string' å®ƒä»¬çš„ç›¸åŒç‚¹æ˜¯ï¼Œéƒ½ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/11/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/11/"},{"categories":null,"content":"3ã€é—®é¢˜ å¦‚æœä½ åœ¨ç»´æŠ¤ä¸€ä¸ªå­¦æ ¡çš„å­¦ç”Ÿä¿¡æ¯æ•°æ®åº“ï¼Œå­¦ç”Ÿç™»å½•åçš„ç»Ÿä¸€æ ¼å¼æ˜¯ â€å­¦å·@gmail.com\", è€Œå­¦å·çš„è§„åˆ™æ˜¯ï¼šåäº”ä½çš„æ•°å­—ï¼Œå…¶ä¸­å‰ä¸‰ä½æ˜¯æ‰€åœ¨åŸå¸‚ç¼–å·ã€ç¬¬å››åˆ°ç¬¬å…­ä½æ˜¯å­¦æ ¡ç¼–å·ã€ç¬¬ä¸ƒä½åˆ°ç¬¬åä½æ˜¯å…¥å­¦å¹´ä»½ã€æœ€åäº”ä½æ˜¯é¡ºåºç¼–å·ã€‚ ç³»ç»Ÿç™»å½•çš„æ—¶å€™éƒ½éœ€è¦å­¦ç”Ÿè¾“å…¥ç™»å½•åå’Œå¯†ç ï¼ŒéªŒè¯æ­£ç¡®åæ‰èƒ½ç»§ç»­ä½¿ç”¨ç³»ç»Ÿã€‚å°±åªè€ƒè™‘ç™»å½•éªŒè¯è¿™ä¸ªè¡Œä¸ºçš„è¯ï¼Œä½ ä¼šæ€ä¹ˆè®¾è®¡è¿™ä¸ªç™»å½•åçš„ç´¢å¼•å‘¢ï¼Ÿ ç­”æ¡ˆï¼š å¯ä»¥åªå­˜å…¥å­¦å¹´ä»½åŠ é¡ºåºç¼–å·ï¼Œå®ƒä»¬çš„é•¿åº¦æ˜¯ 9 ä½ã€‚å¦‚æœæ•°å­—ç±»å‹æ¥å­˜è¿™ 9 ä½æ•°å­—ã€‚æ¯”å¦‚ 201100001 ï¼Œè¿™æ ·åªéœ€è¦å  4 ä¸ªå­—èŠ‚ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/11/:3:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/11/"},{"categories":null,"content":"1ã€SQLè¯­å¥ä¸ºä»€ä¹ˆå˜\"æ…¢\"äº† åœ¨å‰é¢ç¬¬ 2 ç¯‡æ–‡ç« ã€Šæ—¥å¿—ç³»ç»Ÿï¼šä¸€æ¡SQLæ›´æ–°è¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿã€‹ä¸­ï¼ŒInnoDB åœ¨å¤„ç†æ›´æ–°è¯­å¥æ—¶ï¼Œåªåšäº†å†™æ—¥å¿—è¿™ä¸€ä¸ªç£ç›˜æ“ä½œï¼Œè¿™ä¸ªæ—¥å¿—å«ä½œ redo logã€‚æ›´æ–°å†…å­˜å†™å®Œ redo log åï¼Œå°±è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæœ¬æ¬¡æ›´æ–°æˆåŠŸã€‚ã€‚ å½“å†…å­˜æ•°æ®é¡µè·Ÿç£ç›˜æ•°æ®é¡µå†…å®¹ä¸ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ‘ä»¬ç§°è¿™ä¸ªå†…å­˜é¡µä¸º\"è„é¡µ\"ã€‚å†…å­˜æ•°æ®å†™å…¥åˆ°ç£ç›˜åï¼Œå†…å­˜å’Œç£ç›˜ä¸Šçš„æ•°æ®é¡µçš„å†…å®¹å°±ä¸€è‡´äº†ï¼Œç§°ä¸º\"å¹²å‡€é¡µ\"ã€‚ MySQL å¶å°”\"æŠ–\"ä¸€ä¸‹çš„é‚£ä¸ªç¬é—´ï¼Œå¯èƒ½å°±æ˜¯åœ¨åˆ·è„é¡µï¼ˆflushï¼‰ã€‚ å¼•å‘æ•°æ®åº“çš„ flush è¿‡ç¨‹çš„å‡ ç§æƒ…å†µï¼š InnoDB çš„ redo log å†™æ»¡äº†ã€‚ ç³»ç»Ÿå†…å­˜ä¸è¶³ã€‚å½“éœ€è¦æ–°çš„å†…å­˜é¡µï¼Œè€Œå†…å­˜ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±è¦æ·˜æ±°ä¸€äº›æ•°æ®é¡µï¼Œç©ºå‡ºå†…å­˜ç»™åˆ«çš„æ•°æ®é¡µä½¿ç”¨ã€‚å¦‚æœæ·˜æ±°çš„æ˜¯\"è„é¡µ\"ï¼Œå°±è¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜ã€‚ MySQL è®¤ä¸ºç³»ç»Ÿ\"ç©ºé—²\"çš„æ—¶å€™ã€‚ MySQL æ­£å¸¸å…³é—­ã€‚ ä¸Šé¢å››ç§åœºæ™¯å¯¹æ€§èƒ½çš„å½±å“ï¼š ç¬¬ 3 ç§æƒ…å†µå’Œç¬¬ 4 ç§åœºæ™¯æ˜¯ MySQL æ­£å¸¸æƒ…å†µï¼Œä¸ç”¨å¤ªå…³å¿ƒæ€§èƒ½ã€‚ ç¬¬ 1 ç§æ˜¯ â€œredo log å†™æ»¡äº†ï¼Œè¦ flush è„é¡µâ€ï¼Œå‡ºç°è¿™ç§æƒ…å†µäº†ï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¸èƒ½å†æ¥å—æ›´æ–°ï¼Œå¦‚æœä½ ä»ç›‘æ§ä¸Šçœ‹ï¼Œè¿™æ—¶å€™æ›´æ–°æ•°ä¼šè·Œä¸º 0ã€‚ ç¬¬ 2 ç§æ˜¯\"å†…å­˜ä¸å¤Ÿç”¨äº†ï¼Œè¦å…ˆå°†è„é¡µå†™åˆ°ç£ç›˜\"ï¼Œè¿™ç§æƒ…å†µå…¶å®æ˜¯å¸¸æ€ã€‚InnoDBç”¨ç¼“å†²æ± ï¼ˆbuffer poolï¼‰ç®¡ç†å†…å­˜ï¼Œç¼“å†²æ± ä¸­çš„å†…å­˜é¡µæœ‰ä¸‰ç§çŠ¶æ€ï¼š ç¬¬ä¸€ç§æ˜¯ï¼Œè¿˜æ²¡æœ‰ä½¿ç”¨çš„ï¼› ç¬¬äºŒç§æ˜¯ï¼Œä½¿ç”¨äº†å¹¶ä¸”æ˜¯å¹²å‡€é¡µï¼› ç¬¬ä¸‰ç§æ˜¯ï¼Œä½¿ç”¨äº†å¹¶ä¸”æ˜¯è„é¡µã€‚ InnoDB çš„ç­–ç•¥æ˜¯å°½é‡ä½¿ç”¨å†…å­˜ï¼Œå› æ­¤å¯¹äºä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„åº“æ¥è¯´ï¼Œæœªè¢«ä½¿ç”¨çš„é¡µé¢å¾ˆå°‘ã€‚åˆ·è„é¡µè™½ç„¶æ˜¯å¸¸æ€ï¼Œä½†æ˜¯å‡ºç°ä»¥ä¸‹è¿™ä¸¤ç§æƒ…å†µï¼Œéƒ½æ˜¯ä¼šæ˜æ˜¾å½±å“æ€§èƒ½çš„ï¼š ä¸€ä¸ªæŸ¥è¯¢è¦æ·˜æ±°çš„è„é¡µä¸ªæ•°å¤ªå¤šï¼Œä¼šå¯¼è‡´æŸ¥è¯¢çš„å“åº”æ—¶é—´æ˜æ˜¾å˜é•¿ã€‚ æ—¥å¿—å†™æ»¡ï¼Œæ›´æ–°å…¨éƒ¨å µä½ï¼Œå†™æ€§èƒ½è·Œä¸º 0ï¼Œè¿™ç§æƒ…å†µå¯¹æ•æ„Ÿä¸šåŠ¡æ¥è¯´ï¼Œæ˜¯ä¸èƒ½æ¥å—çš„ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/12/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/12/"},{"categories":null,"content":"2ã€InnoDB åˆ·è„é¡µçš„æ§åˆ¶ç­–ç•¥ innodb_io_capacity å‚æ•°ï¼šå‘Šè¯‰ InnoDB æ‰€åœ¨ä¸»æœºçš„ IO èƒ½åŠ›ã€‚ å¯ä»¥ä½¿ç”¨ fio è¿™ä¸ªå·¥å…·æ¥æµ‹è¯• IO èƒ½åŠ›ï¼š fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest InnoDB çš„åˆ·ç›˜é€Ÿåº¦å°±æ˜¯è¦å‚è€ƒè¿™ä¸¤ä¸ªå› ç´ ï¼šä¸€ä¸ªæ˜¯è„é¡µæ¯”ä¾‹ï¼Œä¸€ä¸ªæ˜¯redo logå†™ç›˜é€Ÿåº¦ã€‚ å‚æ•° innodb_max_dirty_pages_pct æ˜¯è„é¡µæ¯”ä¾‹ä¸Šé™ï¼Œé»˜è®¤å€¼æ˜¯ 75%ã€‚ è„é¡µæ¯”ä¾‹æ˜¯é€šè¿‡ Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total å¾—åˆ°çš„ï¼Œå…·ä½“çš„å‘½ä»¤å¦‚ä¸‹ï¼š select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_dirty'; select VARIABLE_VALUE into @b from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_total'; select @a/@b; è¦å°½é‡é¿å…åˆ·è„é¡µè¿™ç§æƒ…å†µï¼Œä½ å°±è¦åˆç†åœ°è®¾ç½® innodb_io_capacity çš„å€¼ï¼Œå¹¶ä¸”å¹³æ—¶è¦å¤šå…³æ³¨è„é¡µæ¯”ä¾‹ï¼Œä¸è¦è®©å®ƒç»å¸¸æ¥è¿‘ 75%ã€‚ ä¸€ä¸ªæœ‰è¶£çš„ç­–ç•¥ï¼š ä¸€æ—¦ä¸€ä¸ªæŸ¥è¯¢è¯·æ±‚éœ€è¦åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å…ˆ flush æ‰ä¸€ä¸ªè„é¡µæ—¶ï¼Œè¿™ä¸ªæŸ¥è¯¢å°±å¯èƒ½è¦æ¯”å¹³æ—¶æ…¢äº†ã€‚è€Œ MySQLä¸­ çš„ä¸€ä¸ªæœºåˆ¶ï¼Œå¯èƒ½è®©ä½ çš„æŸ¥è¯¢ä¼šæ›´æ…¢ï¼šåœ¨å‡†å¤‡åˆ·ä¸€ä¸ªè„é¡µçš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªæ•°æ®é¡µæ—è¾¹çš„æ•°æ®é¡µåˆšå¥½æ˜¯è„é¡µï¼Œå°±ä¼šæŠŠè¿™ä¸ª\"é‚»å±…\"ä¹Ÿå¸¦ç€ä¸€èµ·åˆ·æ‰ï¼›è€Œä¸”è¿™ä¸ªæŠŠ\"é‚»å±…\"æ‹–ä¸‹æ°´çš„é€»è¾‘è¿˜å¯ä»¥ç»§ç»­è”“å»¶ï¼Œä¹Ÿå°±æ˜¯å¯¹äºæ¯ä¸ªé‚»å±…æ•°æ®é¡µï¼Œå¦‚æœè·Ÿå®ƒç›¸é‚»çš„æ•°æ®é¡µä¹Ÿè¿˜æ˜¯è„é¡µçš„è¯ï¼Œä¹Ÿä¼šè¢«æ”¾åˆ°ä¸€èµ·åˆ·ã€‚ åœ¨ InnoDB ä¸­ï¼Œinnodb_flush_neighbors å‚æ•°å°±æ˜¯ç”¨æ¥æ§åˆ¶è¿™ä¸ªè¡Œä¸ºçš„ï¼Œå€¼ä¸º 1 çš„æ—¶å€™ä¼šæœ‰ä¸Šè¿°çš„\"è¿å\"æœºåˆ¶ï¼Œå€¼ä¸º 0 æ—¶è¡¨ç¤ºä¸æ‰¾é‚»å±…ï¼Œè‡ªå·±åˆ·è‡ªå·±çš„ã€‚ å¦‚æœæ˜¯ SSD è¿™ç§ï¼Œ å»ºè®® innodb_flush_neighbors = 0ã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/12/:2:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/12/"},{"categories":null,"content":"3ã€é—®é¢˜ ä¸€ä¸ªå†…å­˜é…ç½®ä¸º 128GBã€innodb_io_capacityè®¾ç½®ä¸º 20000 çš„å¤§è§„æ ¼å®ä¾‹ï¼Œæ­£å¸¸ä¼šå»ºè®®ä½ å°†redo log è®¾ç½®æˆ 4 ä¸ª 1GB çš„æ–‡ä»¶ã€‚ ä½†å¦‚æœä½ åœ¨é…ç½®çš„æ—¶å€™ä¸æ…å°† redo log è®¾ç½®æˆäº† 1ä¸ª 100M çš„æ–‡ä»¶ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼Ÿåˆä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„æƒ…å†µå‘¢ï¼Ÿ ç­”æ¡ˆï¼š redo log å¤ªå°ï¼Œå¾ˆå¿«å°±ä¼šè¢«å†™æ»¡ï¼Œå°±å¿…é¡»è¦ flushï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ change buffer çš„ä¼˜åŒ–ä¹Ÿå¤±æ•ˆäº†ï¼Œå› ä¸º flush æ—¶ï¼Œå¿…é¡»è¦è¿›è¡Œ merge æ“ä½œã€‚ä½ çœ‹åˆ°çš„ç°è±¡å°±æ˜¯ç£ç›˜å‹åŠ›å¾ˆå°ï¼Œä½†æ˜¯æ•°æ®åº“å‡ºç°é—´æ­‡æ€§çš„æ€§èƒ½ä¸‹è·Œã€‚ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/12/:2:1","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/12/"},{"categories":null,"content":"MySQL å®æˆ˜ 45 è®² 01ã€SQL æŸ¥è¯¢è¯­å¥çš„æ‰§è¡Œè¿‡ç¨‹ ","date":"0001-01-01 00:00:00","objectID":"/ooooo-notes/old-notes/geektime/mysql-45/readme/:1:0","tags":null,"title":"","uri":"/ooooo-notes/old-notes/geektime/mysql-45/readme/"}]