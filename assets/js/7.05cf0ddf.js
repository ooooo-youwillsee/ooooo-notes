(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{369:function(t,s){t.exports="data:image/png;base64,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"},370:function(t,s,a){t.exports=a.p+"assets/img/09_02.6c630aaf.png"},371:function(t,s,a){t.exports=a.p+"assets/img/09_03.5b50b76e.png"},372:function(t,s,a){t.exports=a.p+"assets/img/09_04.63aba008.png"},457:function(t,s,a){"use strict";a.r(s);var n=a(25),p=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"_1、为什么分区"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、为什么分区"}},[t._v("#")]),t._v(" 1、为什么分区")]),t._v(" "),n("p",[t._v("Kafka 的消息组织方式实际上是三级结构："),n("strong",[t._v("主题 - 分区 - 消息")]),t._v("，主题下的每条消息只会保存在某一个分区中。")]),t._v(" "),n("p",[t._v("Kafka 的三级结构：")]),t._v(" "),n("p",[n("img",{attrs:{src:a(369),alt:"Kafka 的三级结构"}})]),t._v(" "),n("p",[t._v("分区是为了实现系统的高伸缩性（Scalability），可以通过添加新的节点来增加整体系统的吞吐量。")]),t._v(" "),n("h2",{attrs:{id:"_2、分区策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、分区策略"}},[t._v("#")]),t._v(" 2、分区策略")]),t._v(" "),n("blockquote",[n("p",[t._v("所谓分区策略是决定生产者将消息发送到哪个分区的算法。")])]),t._v(" "),n("h3",{attrs:{id:"_1、自定义分区策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1、自定义分区策略"}},[t._v("#")]),t._v(" 1、自定义分区策略")]),t._v(" "),n("p",[t._v("你需要显式地配置生产者端的参数 "),n("code",[t._v("partitioner.class")]),t._v("，在编写生产者程序时，你可以编写一个具体的类实现 "),n("code",[t._v("org.apache.kafka.clients.producer.Partitioner")]),t._v(" 接口，实现 "),n("code",[t._v("partition()")]),t._v(" 和 "),n("code",[t._v("close()")]),t._v(" 接口。")]),t._v(" "),n("p",[t._v("方法签名：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("partition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" keyBytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Object")]),t._v(" value"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" valueBytes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cluster")]),t._v(" cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_2、轮询策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2、轮询策略"}},[t._v("#")]),t._v(" 2、轮询策略")]),t._v(" "),n("p",[n("img",{attrs:{src:a(370),alt:"轮询策略"}})]),t._v(" "),n("p",[n("strong",[t._v("Kafka 默认的分区策略就是轮询策略，轮询策略有非常优秀的负载均衡表现，它总是能保证消息最大限度地被平均分配到所有分区上。")])]),t._v(" "),n("h3",{attrs:{id:"_3、随机策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3、随机策略"}},[t._v("#")]),t._v(" 3、随机策略")]),t._v(" "),n("p",[n("img",{attrs:{src:a(371),alt:"随机策略"}})]),t._v(" "),n("p",[t._v("要实现随机策略版的 partition 方法(自定义分区策略)，如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PartitionInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" partitions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("partitionsForTopic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ThreadLocalRandom")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("current")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextInt")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("partitions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("h3",{attrs:{id:"_4、按消息键保序策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4、按消息键保序策略"}},[t._v("#")]),t._v(" 4、按消息键保序策略")]),t._v(" "),n("p",[n("img",{attrs:{src:a(372),alt:"按消息键保序策略"}})]),t._v(" "),n("p",[t._v("实现这个策略的 partition 方法(自定义分区策略)，如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PartitionInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" partitions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("partitionsForTopic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Math")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("abs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("hashCode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),t._v(" partitions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("strong",[t._v("Kafka 默认分区策略实际上同时实现了两种策略：如果指定了 Key，那么默认实现按消息键保序策略；如果没有指定 Key，则使用轮询策略。")])]),t._v(" "),n("h3",{attrs:{id:"_5、其他分区策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5、其他分区策略"}},[t._v("#")]),t._v(" 5、其他分区策略")]),t._v(" "),n("p",[t._v("比较常见的一种就是"),n("strong",[t._v("基于地理位置的分区策略")]),t._v("。")]),t._v(" "),n("p",[t._v("比如根据 Broker 所在的 IP 地址实现定制化的分区策略，如下：")]),t._v(" "),n("div",{staticClass:"language-java extra-class"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("List")]),n("span",{pre:!0,attrs:{class:"token generics"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PartitionInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" partitions "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" cluster"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("partitionsForTopic")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("topic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" partitions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stream")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isSouth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("p"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("leader")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("PartitionInfo")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("partition")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("findAny")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们可以从所有分区中找出那些 Leader 副本在南方的所有分区，然后随机挑选一个进行消息发送。")])])}),[],!1,null,null,null);s.default=p.exports}}]);