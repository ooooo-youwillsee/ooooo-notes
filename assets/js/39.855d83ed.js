(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{432:function(s,a,t){"use strict";t.r(a);var e=t(25),l=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"_1、预备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、预备"}},[s._v("#")]),s._v(" 1、预备")]),s._v(" "),t("h3",{attrs:{id:"_1、全局命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、全局命令"}},[s._v("#")]),s._v(" 1、全局命令")]),s._v(" "),t("ul",[t("li",[s._v("help")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HELP "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" \n")])])]),t("ul",[t("li",[s._v("查看所有的key")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  KEYS *\n")])])]),t("ul",[t("li",[s._v("键总数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  DBSIZE\n")])])]),t("ul",[t("li",[s._v("检查键是否存在")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  EXISTS key\n")])])]),t("ul",[t("li",[s._v("删除键")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  DEL key\n")])])]),t("ul",[t("li",[s._v("键过期")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  EXPIRE key sencond\n")])])]),t("ul",[t("li",[s._v("ttl 返回过期时间")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  TTL key\n")])])]),t("p",[s._v(">0: 剩余过期时间")]),s._v(" "),t("p",[s._v("-1: 没有设置过期时间")]),s._v(" "),t("p",[s._v("-2: 键不存在")]),s._v(" "),t("ul",[t("li",[s._v("key的数据结构类型")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  TYPE key\n")])])]),t("h3",{attrs:{id:"_2、数据结构与内部编码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、数据结构与内部编码"}},[s._v("#")]),s._v(" 2、数据结构与内部编码")]),s._v(" "),t("p",[s._v("每种数据结构都有自己底层的内部编码实现，通过命令 "),t("code",[s._v("OBJECT ENCODING key")]),s._v(" 来查看。")]),s._v(" "),t("ul",[t("li",[s._v("string 内部编码： "),t("code",[s._v("raw")]),s._v("、"),t("code",[s._v("int")]),s._v("、"),t("code",[s._v("embstr")])]),s._v(" "),t("li",[s._v("hash 内部编码： "),t("code",[s._v("ziplist")]),s._v("、"),t("code",[s._v("hashtable")])]),s._v(" "),t("li",[s._v("list 内部编码： "),t("code",[s._v("ziplist")]),s._v("、"),t("code",[s._v("linkedlist")]),s._v("、"),t("code",[s._v("quicklist")])]),s._v(" "),t("li",[s._v("set 内部编码： "),t("code",[s._v("intset")]),s._v("、"),t("code",[s._v("hashtable")])]),s._v(" "),t("li",[s._v("zset 内部编码： "),t("code",[s._v("ziplist")]),s._v("、"),t("code",[s._v("skiplist")])])]),s._v(" "),t("h2",{attrs:{id:"_2、string"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、string"}},[s._v("#")]),s._v(" 2、string")]),s._v(" "),t("h3",{attrs:{id:"_1、常用命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、常用命令"}},[s._v("#")]),s._v(" 1、常用命令")]),s._v(" "),t("ul",[t("li",[s._v("设置值、获取值")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SET key value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("expiration EX seconds"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("PX milliseconds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NX"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  GET key\n")])])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("NX：不存在 key，才设置成功。同命令 "),t("code",[s._v("SETNX key value")])]),s._v(" "),t("p",[s._v("XX：存在 key，才设置成功。")]),s._v(" "),t("ul",[t("li",[s._v("批量设置、批量获取")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  MSET key value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  MGET key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("批量操作可以减少网络时间。")]),s._v(" "),t("ul",[t("li",[s._v("计数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  INCR key\n  INCRBY key increment\n  INCRBYFLOAT key increment\n  DECR key\n  DECRBY key decrement\n")])])]),t("h3",{attrs:{id:"_2、不常用的命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、不常用的命令"}},[s._v("#")]),s._v(" 2、不常用的命令")]),s._v(" "),t("ul",[t("li",[s._v("追加值")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  APPEND key value\n")])])]),t("ul",[t("li",[s._v("字符串长度")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  STRLEN key\n")])])]),t("ul",[t("li",[s._v("设置并返回原值")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  GETSET key value\n")])])]),t("ul",[t("li",[s._v("设置指定位置的字符")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SETRANGE key offset value\n")])])]),t("ul",[t("li",[s._v("获取部分字符串")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  GETRANGE key start end\n")])])]),t("h3",{attrs:{id:"_3、内部编码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、内部编码"}},[s._v("#")]),s._v(" 3、内部编码")]),s._v(" "),t("p",[s._v("字符串内部编码有三种：")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("int")]),s._v("：8 个字节的长整型")]),s._v(" "),t("li",[t("code",[s._v("embstr")]),s._v("：小于等于 39 个字节的字符串")]),s._v(" "),t("li",[t("code",[s._v("raw")]),s._v("：大于 39 个字节的字符串")])]),s._v(" "),t("h3",{attrs:{id:"_4、使用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用场景"}},[s._v("#")]),s._v(" 4、使用场景")]),s._v(" "),t("ul",[t("li",[s._v("缓存 （网站请求数据缓存）")]),s._v(" "),t("li",[s._v("计数 （网站的浏览数和播放数）")]),s._v(" "),t("li",[s._v("共享 Session （用户登录信息）")]),s._v(" "),t("li",[s._v("限速 （验证码接口）")])]),s._v(" "),t("h2",{attrs:{id:"_3、hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、hash"}},[s._v("#")]),s._v(" 3、hash")]),s._v(" "),t("h3",{attrs:{id:"_1、命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、命令"}},[s._v("#")]),s._v(" 1、命令")]),s._v(" "),t("ul",[t("li",[s._v("设置值、获取值")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HSET key field value\n  HGET key field\n")])])]),t("ul",[t("li",[s._v("删除 field")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HDEL key field "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("field "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("计算 field 的个数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HLEN key\n")])])]),t("ul",[t("li",[s._v("批量设置、批量获取")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HMSET key field value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("field value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  HMGET key field "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("field "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("是否存在 field")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HEXISTS key field\n")])])]),t("ul",[t("li",[s._v("获取所有的 field")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HKEYS key\n")])])]),t("ul",[t("li",[s._v("获取所有的 value")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HVALS key\n")])])]),t("ul",[t("li",[s._v("获取所有的 field-value")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HGETALL key\n")])])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("field 个数比较多时，会阻塞 redis。")]),s._v(" "),t("ul",[t("li",[s._v("计数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HINCRBY key field increment\n  HINCRBYFLOAT key field increment\n")])])]),t("ul",[t("li",[s._v("获取 value 长度")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  HSTRLEN key field\n")])])]),t("h3",{attrs:{id:"_2、内部编码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、内部编码"}},[s._v("#")]),s._v(" 2、内部编码")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ziplist")]),s._v("（压缩表）：元素个数小于 "),t("code",[s._v("hash-max-ziplist-entries = 512")]),s._v(" ，同时 value 小于 "),t("code",[s._v("hash-max-ziplist-value = 64")]),s._v("，就使用 ziplist， 配置参数在 redis.conf 中。")]),s._v(" "),t("li",[t("code",[s._v("hashtable")]),s._v("（哈希表）：无法满足 ziplist 的条件，会使用 hashtable。")])]),s._v(" "),t("h2",{attrs:{id:"_4、list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、list"}},[s._v("#")]),s._v(" 4、list")]),s._v(" "),t("h3",{attrs:{id:"_1、命令-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、命令-2"}},[s._v("#")]),s._v(" 1、命令")]),s._v(" "),t("ul",[t("li",[s._v("添加")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  RPUSH key value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右边添加")]),s._v("\n  LPUSH key value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 左边添加")]),s._v("\n  LINSERT key BEFORE"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("AFTER pivot value "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定位置插入")]),s._v("\n")])])]),t("ul",[t("li",[s._v("查询")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  LRANGE key start stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 范围为[start, stop], 查询所有是 start = 0, stop = -1")]),s._v("\n  LLEN key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 列表长度")]),s._v("\n")])])]),t("ul",[t("li",[s._v("删除")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  LPOP key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 左边弹出")]),s._v("\n  RPOP key "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 右边弹出")]),s._v("\n  LREM key count value "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## 删除 count 个 value 值, count > 0,从左边删除；count < 0,从右边删除；count = 0, 删除所有")]),s._v("\n  LTRIM key start stop "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 只保留[start, stop]的元素")]),s._v("\n")])])]),t("ul",[t("li",[s._v("修改")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  LSET key index value "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置指定索引的值")]),s._v("\n")])])]),t("ul",[t("li",[s._v("阻塞")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  BLPOP key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从左边弹出元素，如果为空，则阻塞")]),s._v("\n  BRPOP key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从右边弹出元素，如果为空，则阻塞")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# timeout：阻塞时间。多个 key, 从左扫描。")]),s._v("\n")])])]),t("h3",{attrs:{id:"_2、内部编码-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、内部编码-2"}},[s._v("#")]),s._v(" 2、内部编码")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ziplist")]),s._v("（压缩表）：元素个数小于 "),t("code",[s._v("list-max-ziplist-entries = 512")]),s._v(" ，同时 value 小于 "),t("code",[s._v("list-max-ziplist-value = 64")]),s._v("，就使用 ziplist， 配置参数在 redis.conf 中。")]),s._v(" "),t("li",[t("code",[s._v("linkedlist")]),s._v("（链表）：无法满足 ziplist 的条件，会使用 linkedlist。")])]),s._v(" "),t("h2",{attrs:{id:"_5、set"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5、set"}},[s._v("#")]),s._v(" 5、set")]),s._v(" "),t("h3",{attrs:{id:"_1、集合内操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、集合内操作"}},[s._v("#")]),s._v(" 1、集合内操作")]),s._v(" "),t("ul",[t("li",[s._v("添加")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SADD key member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])])]),t("ul",[t("li",[s._v("删除")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SREM key member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])])]),t("ul",[t("li",[s._v("计算元素个数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SCARD key \n")])])]),t("ul",[t("li",[s._v("是否在集合中")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SISMEMBER key member "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])])]),t("ul",[t("li",[s._v("随机返回 count 个元素，不会删除元素")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SRANDMEMBER key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n")])])]),t("ul",[t("li",[s._v("随机弹出 count 个元素，会删除元素")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SPOP key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("获取所有元素")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SMEMBERS key\n")])])]),t("h3",{attrs:{id:"_2、集合间操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、集合间操作"}},[s._v("#")]),s._v(" 2、集合间操作")]),s._v(" "),t("ul",[t("li",[s._v("多个集合的交集")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SINTER key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("多个集合的并集")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SUNION key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("多个集合的差集")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SDIFF key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("ul",[t("li",[s._v("将交集、并集、差集的结果保存")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SINTERSTORE destination key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("    \n  SUNIONSTORE destination key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  SDIFFSTORE destination key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),t("p",[s._v("说明：\ndestination 表示目标 key。\nkey 表示需要操作的 key。")]),s._v(" "),t("h3",{attrs:{id:"_3、内部编码-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、内部编码-2"}},[s._v("#")]),s._v(" 3、内部编码")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("intset")]),s._v("（整数集合）：value 值为整型，个数小于 "),t("code",[s._v("set-max-intset-entries = 512")]),s._v(" 时，使用 intset。配置参数在 redis.conf 中。")]),s._v(" "),t("li",[t("code",[s._v("hashtable")]),s._v("（哈希表）：不满足 intset 条件时，使用 hashtable。")])]),s._v(" "),t("h3",{attrs:{id:"_4、使用场景-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4、使用场景-2"}},[s._v("#")]),s._v(" 4、使用场景")]),s._v(" "),t("p",[s._v("标签系统：计算不同人相同喜好的标签 (SINTER命令)。")]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SADD user1:tags tag1 tag2\n  SADD user2:tags tag2 tag3\n  SINTER user1:tags user2:tags\n")])])]),t("h2",{attrs:{id:"_6、zset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、zset"}},[s._v("#")]),s._v(" 6、zset")]),s._v(" "),t("h3",{attrs:{id:"_1、集合内操作-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、集合内操作-2"}},[s._v("#")]),s._v(" 1、集合内操作")]),s._v(" "),t("ul",[t("li",[s._v("添加")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZADD key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("NX"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("XX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("CH"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INCR"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" score member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("score member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NX: 不存在 key，才设置成功")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# XX: 存在 可以，才设置成功")]),s._v("\n")])])]),t("ul",[t("li",[s._v("计算成员个数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZCARD key\n")])])]),t("ul",[t("li",[s._v("获取某个成员的分数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZSCORE key member\n")])])]),t("ul",[t("li",[s._v("获取某个成员的排名")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZRANK key member  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从低到高")]),s._v("\n  ZREVRANK key member "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从高到低")]),s._v("\n")])])]),t("ul",[t("li",[s._v("删除")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZREM key member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("member "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除成员")]),s._v("\n  ZREMRANGEBYRANK key start stop  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定排名范围的成员")]),s._v("\n  ZREMRANGEBYSCORE key min max  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除指定分数范围的成员")]),s._v("\n")])])]),t("ul",[t("li",[s._v("增加成员的分数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZINCRBY key increment member\n")])])]),t("ul",[t("li",[s._v("获取指定排名范围的成员")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZRANGE key start stop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHSCORES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从低到高")]),s._v("\n  ZREVRANGE key start stop "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHSCORES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从高到底")]),s._v("\n")])])]),t("ul",[t("li",[s._v("获取指定分数范围的成员")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZRANGEBYSCORE key min max "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WITHSCORES"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("LIMIT offset count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# WITHSCORES：结果返回分数  ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LIMIT offset count：限制返回个数")]),s._v("\n")])])]),t("ul",[t("li",[s._v("获取指定分数范围的成员个数")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZCOUNT key min max\n")])])]),t("h3",{attrs:{id:"_2、集合间操作-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、集合间操作-2"}},[s._v("#")]),s._v(" 2、集合间操作")]),s._v(" "),t("ul",[t("li",[s._v("交集")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZINTERSTORE destination numkeys key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WEIGHTS weight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AGGREGATE SUM"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MIN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MAX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# destination：计算结果保存的键")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# numkeys：参与的键，也就是 key 的总数")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# weight：每一个 key 参与的权重，默认为 1 ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AGGREGATE：聚合操作，默认为 sum")]),s._v("\n")])])]),t("ul",[t("li",[s._v("并集")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  ZUNIONSTORE destination numkeys key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("key "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WEIGHTS weight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("AGGREGATE SUM"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MIN"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("MAX"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参数同 ZINTERSTORE ")]),s._v("\n")])])]),t("h3",{attrs:{id:"_3、内部编码-3"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、内部编码-3"}},[s._v("#")]),s._v(" 3、内部编码")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("ziplist")]),s._v("（压缩列表）：个数小于 "),t("code",[s._v("zset-max-ziplist-entries = 128")]),s._v(" 时，value 小于 "),t("code",[s._v("zet-max-ziplist-value = 64")]),s._v(" 使用 ziplist。配置参数在 redis.conf 中。")]),s._v(" "),t("li",[t("code",[s._v("skiplist")]),s._v("（跳跃表）：不满足 ziplist 条件时，使用 skiplist。")])]),s._v(" "),t("h2",{attrs:{id:"_6、键管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6、键管理"}},[s._v("#")]),s._v(" 6、键管理")]),s._v(" "),t("h3",{attrs:{id:"_1、单个键管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、单个键管理"}},[s._v("#")]),s._v(" 1、单个键管理")]),s._v(" "),t("ul",[t("li",[s._v("键重命名")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  RENAME key newkey    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 存在 key，会覆盖")]),s._v("\n  RENAMENX key newkey  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不存在 key，才重命名成功")]),s._v("\n")])])]),t("ul",[t("li",[s._v("随机返回一个键")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  RANDOMKEY\n")])])]),t("ul",[t("li",[s._v("键过期")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  EXPIRE key seconds\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# >0: 剩余过期时间")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -1: 没有设置过期时间；")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# -2: 键不存在")]),s._v("\n")])])]),t("p",[t("strong",[s._v("Redis 不支持二级数据结构（哈希表、列表）过期")]),s._v(" "),t("strong",[s._v("setex 原子命令设置 value 和 expire")])]),s._v(" "),t("ul",[t("li",[s._v("迁移键")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  MOVE key db "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 迁移到另一个db, 不建议使用，因为集群环境只能使用一个数据库")]),s._v("\n  DUMP key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" RESTORE key ttl serialized-value "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPLACE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 操作麻烦，不建议使用")]),s._v("\n  MIGRATE "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v(" port key"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" destination-db "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("timeout")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COPY"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("REPLACE"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("KEYS key"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以使用")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# COPY: 迁移后不会删除源键")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# REPLACE: 迁移后会覆盖目标库的键")]),s._v("\n")])])]),t("p",[s._v("示例：")]),s._v(" "),t("p",[s._v("迁移到 localhost:6380 的 db0 库上，timeout为 1000ms，命令为 "),t("code",[s._v("MIGRATE localhost 6380 hello 0 1000")]),s._v("。")]),s._v(" "),t("p",[s._v("迁移多个键 k1, k2, k3，命令为 "),t("code",[s._v('MIGRATE localhost 6380 "" 0 1000 KEYS k1 k2 k3')]),s._v("。")]),s._v(" "),t("h3",{attrs:{id:"_2、遍历键"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、遍历键"}},[s._v("#")]),s._v(" 2、遍历键")]),s._v(" "),t("ul",[t("li",[s._v("全量遍历键")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  KEYS pattern "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 键很多时，会阻塞 Redis")]),s._v("\n")])])]),t("ul",[t("li",[s._v("渐进式遍历建")])]),s._v(" "),t("div",{staticClass:"language-shell script extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("  SCAN cursor "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("MATCH pattern"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("COUNT count"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# count: 每次查询 key 的个数。")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pattern: 同命令 scan。")]),s._v("\n")])])]),t("p",[s._v("说明：")]),s._v(" "),t("p",[s._v("第一次查询设置 cursor 为 0，结果会返回 cursor，如果 cursor 为 0，表示遍历结束，否则设置 cursor 为当前返回值，再次查询。")]),s._v(" "),t("h3",{attrs:{id:"_3、数据库管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、数据库管理"}},[s._v("#")]),s._v(" 3、数据库管理")]),s._v(" "),t("p",[s._v("无，因为集群模式下，只能使用一个数据库，生产环境也是如此。")])])}),[],!1,null,null,null);a.default=l.exports}}]);