<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1„ÄÅRDB | ooooo-notes</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="ooooo-notes">
    
    <link rel="preload" href="/ooooo-notes/assets/css/0.styles.b7d09f6b.css" as="style"><link rel="preload" href="/ooooo-notes/assets/js/app.e96e47bb.js" as="script"><link rel="preload" href="/ooooo-notes/assets/js/2.1848d571.js" as="script"><link rel="preload" href="/ooooo-notes/assets/js/5.f574e460.js" as="script"><link rel="prefetch" href="/ooooo-notes/assets/js/10.08389c6b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/11.0e1b2b37.js"><link rel="prefetch" href="/ooooo-notes/assets/js/12.a2258fbe.js"><link rel="prefetch" href="/ooooo-notes/assets/js/13.1e4ee57a.js"><link rel="prefetch" href="/ooooo-notes/assets/js/14.60b8fec0.js"><link rel="prefetch" href="/ooooo-notes/assets/js/15.eb22b4c9.js"><link rel="prefetch" href="/ooooo-notes/assets/js/16.3d6ad174.js"><link rel="prefetch" href="/ooooo-notes/assets/js/17.e3fc4fc3.js"><link rel="prefetch" href="/ooooo-notes/assets/js/18.675ee039.js"><link rel="prefetch" href="/ooooo-notes/assets/js/19.1502d657.js"><link rel="prefetch" href="/ooooo-notes/assets/js/20.a6429c00.js"><link rel="prefetch" href="/ooooo-notes/assets/js/21.6d09741f.js"><link rel="prefetch" href="/ooooo-notes/assets/js/22.690375f9.js"><link rel="prefetch" href="/ooooo-notes/assets/js/23.bf78907f.js"><link rel="prefetch" href="/ooooo-notes/assets/js/24.4db09c1b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/25.904e1bf5.js"><link rel="prefetch" href="/ooooo-notes/assets/js/26.a3dbe71d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/27.76193125.js"><link rel="prefetch" href="/ooooo-notes/assets/js/28.16440e67.js"><link rel="prefetch" href="/ooooo-notes/assets/js/29.2f0cdfd2.js"><link rel="prefetch" href="/ooooo-notes/assets/js/3.3dcdd5f3.js"><link rel="prefetch" href="/ooooo-notes/assets/js/30.32b0ae0b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/31.6752363b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/32.b025f5ae.js"><link rel="prefetch" href="/ooooo-notes/assets/js/33.21af3c2d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/34.b09c1375.js"><link rel="prefetch" href="/ooooo-notes/assets/js/35.59b3ab85.js"><link rel="prefetch" href="/ooooo-notes/assets/js/36.17a64086.js"><link rel="prefetch" href="/ooooo-notes/assets/js/37.a0d0511d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/38.d62c65d0.js"><link rel="prefetch" href="/ooooo-notes/assets/js/39.0314b4e2.js"><link rel="prefetch" href="/ooooo-notes/assets/js/4.f1bbbe88.js"><link rel="prefetch" href="/ooooo-notes/assets/js/40.99c6edea.js"><link rel="prefetch" href="/ooooo-notes/assets/js/41.56a34b1b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/42.7a240573.js"><link rel="prefetch" href="/ooooo-notes/assets/js/43.6f46d3ba.js"><link rel="prefetch" href="/ooooo-notes/assets/js/44.53ba585b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/45.45c5fe4b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/46.194c0dfc.js"><link rel="prefetch" href="/ooooo-notes/assets/js/47.a60babdb.js"><link rel="prefetch" href="/ooooo-notes/assets/js/48.c89cd44a.js"><link rel="prefetch" href="/ooooo-notes/assets/js/49.26aa8749.js"><link rel="prefetch" href="/ooooo-notes/assets/js/50.4f6f7d82.js"><link rel="prefetch" href="/ooooo-notes/assets/js/51.bc38a3de.js"><link rel="prefetch" href="/ooooo-notes/assets/js/52.54e8cf0b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/53.0da0eb33.js"><link rel="prefetch" href="/ooooo-notes/assets/js/54.580eb5c7.js"><link rel="prefetch" href="/ooooo-notes/assets/js/55.4d511916.js"><link rel="prefetch" href="/ooooo-notes/assets/js/56.56125107.js"><link rel="prefetch" href="/ooooo-notes/assets/js/57.20535e45.js"><link rel="prefetch" href="/ooooo-notes/assets/js/58.d52495e4.js"><link rel="prefetch" href="/ooooo-notes/assets/js/59.77419eff.js"><link rel="prefetch" href="/ooooo-notes/assets/js/6.6a5b4ddd.js"><link rel="prefetch" href="/ooooo-notes/assets/js/60.e77a42ac.js"><link rel="prefetch" href="/ooooo-notes/assets/js/61.0376adf8.js"><link rel="prefetch" href="/ooooo-notes/assets/js/62.71d21f45.js"><link rel="prefetch" href="/ooooo-notes/assets/js/63.4a58c497.js"><link rel="prefetch" href="/ooooo-notes/assets/js/64.90a51dec.js"><link rel="prefetch" href="/ooooo-notes/assets/js/65.87feb687.js"><link rel="prefetch" href="/ooooo-notes/assets/js/66.01a37f61.js"><link rel="prefetch" href="/ooooo-notes/assets/js/67.941b43d7.js"><link rel="prefetch" href="/ooooo-notes/assets/js/68.c6e51dc9.js"><link rel="prefetch" href="/ooooo-notes/assets/js/69.b93a2b39.js"><link rel="prefetch" href="/ooooo-notes/assets/js/7.7c62861d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/70.20b6b48c.js"><link rel="prefetch" href="/ooooo-notes/assets/js/71.07567aab.js"><link rel="prefetch" href="/ooooo-notes/assets/js/72.a83e2d09.js"><link rel="prefetch" href="/ooooo-notes/assets/js/73.994eb59a.js"><link rel="prefetch" href="/ooooo-notes/assets/js/74.ceff7435.js"><link rel="prefetch" href="/ooooo-notes/assets/js/75.b44105ea.js"><link rel="prefetch" href="/ooooo-notes/assets/js/8.da612232.js"><link rel="prefetch" href="/ooooo-notes/assets/js/9.e4f96b5e.js">
    <link rel="stylesheet" href="/ooooo-notes/assets/css/0.styles.b7d09f6b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ooooo-notes/" class="home-link router-link-active"><!----> <span class="site-name">ooooo-notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tours" class="dropdown-title"><span class="title">Tours</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tours" class="mobile-dropdown-title"><span class="title">Tours</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/tours/kubernetes/" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/tours/wechat/" class="nav-link">
  wechat
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Me" class="dropdown-title"><span class="title">Me</span> <span class="arrow down"></span></button> <button type="button" aria-label="Me" class="mobile-dropdown-title"><span class="title">Me</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/plan/2022.html" class="nav-link">
  Plan
</a></li><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/resolution/2022.html" class="nav-link">
  Resolution
</a></li></ul></div></div><div class="nav-item"><a href="/ooooo-notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/ooooo-youwillsee/leetcode" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ooooo-youwillsee/ooooo-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Tours" class="dropdown-title"><span class="title">Tours</span> <span class="arrow down"></span></button> <button type="button" aria-label="Tours" class="mobile-dropdown-title"><span class="title">Tours</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/tours/kubernetes/" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/tours/wechat/" class="nav-link">
  wechat
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Me" class="dropdown-title"><span class="title">Me</span> <span class="arrow down"></span></button> <button type="button" aria-label="Me" class="mobile-dropdown-title"><span class="title">Me</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/plan/2022.html" class="nav-link">
  Plan
</a></li><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/resolution/2022.html" class="nav-link">
  Resolution
</a></li></ul></div></div><div class="nav-item"><a href="/ooooo-notes/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="https://github.com/ooooo-youwillsee/leetcode" target="_blank" rel="noopener noreferrer" class="nav-link external">
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/ooooo-youwillsee/ooooo-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/ooooo-notes/" aria-current="page" class="sidebar-link">Home</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1„ÄÅrdb"><a href="#_1„ÄÅrdb" class="header-anchor">#</a> 1„ÄÅRDB</h2> <h3 id="_1„ÄÅËß¶ÂèëÊú∫Âà∂"><a href="#_1„ÄÅËß¶ÂèëÊú∫Âà∂" class="header-anchor">#</a> 1„ÄÅËß¶ÂèëÊú∫Âà∂</h3> <p>ÊâãÂä®Ëß¶ÂèëÔºåÂàÜÂà´Êúâ <code>save</code> Âíå <code>bgsave</code> ‰∏§‰∏™ÂëΩ‰ª§„ÄÇ</p> <ul><li><code>save</code>Ôºö ‰ºöÈòªÂ°ûÂΩìÂâç Redis ÊúçÂä°Âô®ÔºåÁõ¥Âà∞ RDB ËøáÁ®ãÂÆåÊàê‰∏∫Ê≠¢Ôºå‰∏çÂª∫ËÆÆ‰ΩøÁî®„ÄÇ</li> <li><code>bgsave</code>Ôºö Redis ËøõÁ®ã‰ºö <strong>fork</strong> Âá∫Â≠êËøõÁ®ãÔºåÂ≠êËøõÁ®ãËøõË°å RDB ÊåÅ‰πÖÂåñÔºåÈòªÂ°ûÂè™‰ºöÂèëÁîüÂú® <strong>fork</strong> Èò∂ÊÆµ„ÄÇ</li></ul> <p>Ëá™Âä®Ëß¶ÂèëÁöÑÂú∫ÊôØÔºö</p> <ul><li><code>save m n</code> ÈÖçÁΩÆÔºåË°®Á§∫Âú® m Áßí‰∏≠Â≠òÂú® n Ê¨°Êï∞ÊçÆÊîπÂèòÔºåÊâç‰ºöËß¶Âèë <code>bgsave</code>„ÄÇ</li> <li>‰ªéËäÇÁÇπÂÖ®ÈáèÂ§çÂà∂ËøáÁ®ã‰∏≠Ôºå‰∏ªËäÇÁÇπ‰ºöÊâßË°å <code>bgsave</code> ÁîüÊàê RDB Êñá‰ª∂ÔºåÂèëÈÄÅÂ≠êËäÇÁÇπ„ÄÇ</li> <li>ÈªòËÆ§ÂÖ≥Èó≠ÊÉÖÂÜµ‰∏ãÔºåÂ¶ÇÊûúÊ≤°ÊúâÂºÄÂêØ AOFÔºå‰πü‰ºöÊâßË°å <code>bgsave</code>„ÄÇ</li></ul> <h3 id="_2„ÄÅËß¶ÂèëÊµÅÁ®ã"><a href="#_2„ÄÅËß¶ÂèëÊµÅÁ®ã" class="header-anchor">#</a> 2„ÄÅËß¶ÂèëÊµÅÁ®ã</h3> <p><code>bgsave</code> ÂëΩ‰ª§ÁöÑËøêË°åÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÔºö
<img src="/ooooo-notes/assets/img/05_01.8af5c142.png" alt="bgsave ÊâßË°åÊµÅÁ®ã"></p> <p>ËØ¥ÊòéÔºõ</p> <ol><li>ÊâßË°å <code>bgsave</code> ÂëΩ‰ª§Ôºå Âà§Êñ≠ÊòØÂê¶Êúâ AOF/RDB ËøõÁ®ã„ÄÇ</li> <li>ÊâßË°å <code>info stats</code> ÂëΩ‰ª§ÔºåÈÄâÈ°π <code>latest_fork_usec</code> Ë°®Á§∫ÊúÄÂêé‰∏ÄÊ¨° fork ‰ΩøÁî®ÁöÑÁßíÊï∞„ÄÇ</li> <li><code>bgsave</code> ÂëΩ‰ª§ÊâßË°åÂÆåÊàêÂêéÔºå‰ºöÂá∫Áé∞ <strong>Background saving started</strong> ÊèêÁ§∫„ÄÇ</li> <li>Â≠êËøõÁ®ãÂàõÂª∫ RDB Êñá‰ª∂ÊàêÂäüÂêéÔºåÂØπÂéüÊúâÁöÑÊñá‰ª∂ËøõË°åÂéüÂ≠êÊõøÊç¢, ÊâßË°å <code>lastsave</code> ÂëΩ‰ª§Ëé∑ÂèñÊúÄÂêé‰∏ÄÊ¨°ÁîüÊàê RDB Êñá‰ª∂ÁöÑÊó∂Èó¥ÔºåÂØπÂ∫î <code>info Persistence</code> ÂëΩ‰ª§‰∏≠ÁöÑÈÄâÈ°π <code>rdb_last_save_time</code>„ÄÇ</li></ol> <h3 id="_3„ÄÅrdb-Êñá‰ª∂ÁöÑÂ§ÑÁêÜ"><a href="#_3„ÄÅrdb-Êñá‰ª∂ÁöÑÂ§ÑÁêÜ" class="header-anchor">#</a> 3„ÄÅRDB Êñá‰ª∂ÁöÑÂ§ÑÁêÜ</h3> <p><img src="/ooooo-notes/assets/img/05_02.22c52c3e.png" alt="RDB ÈÖçÁΩÆ"></p> <ul><li>RDB Êñá‰ª∂ÈÄöËøáÈÖçÁΩÆÊñá‰ª∂ÂèÇÊï∞ <code>dbfilename</code> Âíå <code>dir</code>Êù•ÈÖçÁΩÆÔºå‰πüÂèØ‰ª•ÈÄöËøáÂëΩ‰ª§ <code>config set dir {dir}</code> Âíå <code>config set dbfilename {dbfilename}</code> Êù•Âä®ÊÄÅÈÖçÁΩÆ„ÄÇ</li> <li>RDB Êñá‰ª∂ÈªòËÆ§ÈááÁî® <strong>LZF</strong> ÂéãÁº©ÔºåÈÄöÂ∏∏Âª∫ËÆÆÂºÄÂêØÔºåÂõ†‰∏∫‰∏ª‰ªéÂ§çÂà∂Êó∂ÔºåÈúÄË¶ÅÂèëÈÄÅ RDB Êñá‰ª∂Âà∞‰ªéËäÇÁÇπÔºåËøôÊ†∑ÂèØ‰ª•ËäÇÁúÅÂ∏¶ÂÆΩ„ÄÇ</li> <li>RDB ÈªòËÆ§‰πüÂºÄÂêØÊ†°È™åÔºåÂèØ‰ª•ÈÄöËøáËÑöÊú¨ <code>redis-check-rdb</code> Êù•Ê†°È™åÁîüÊàêÁõ∏Â∫îÁöÑÈîôËØØÊä•Âëä„ÄÇ</li></ul> <h3 id="_4„ÄÅrdb-ÁöÑ‰ºòÁº∫ÁÇπ"><a href="#_4„ÄÅrdb-ÁöÑ‰ºòÁº∫ÁÇπ" class="header-anchor">#</a> 4„ÄÅRDB ÁöÑ‰ºòÁº∫ÁÇπ</h3> <p>‰ºòÁÇπÔºö</p> <ul><li>RDB ÈùûÂ∏∏ÈÄÇÂêàÂ§á‰ªΩ„ÄÅÂÖ®ÈáèÂ§çÂà∂Á≠âÂú∫ÊôØÔºåÊØîÂ¶ÇÊØè 6 Â∞èÊó∂ÂÆöÊó∂ÊâßË°å <code>bgsave</code>ÔºåÂèØÁî®‰∫éÁÅæÈöæÊÅ¢Â§ç„ÄÇ</li> <li>RDB ÁöÑÊÅ¢Â§çÊï∞ÊçÆËøúËøúÂø´‰∫é AOF ÊñπÂºè„ÄÇ</li></ul> <p>Áº∫ÁÇπÔºö</p> <ul><li>RDB Êó†Ê≥ïÂÅöÂà∞ÁßíÁ∫ßÊåÅ‰πÖÂåñÔºåfork ÂàõÂª∫Â≠êËøõÁ®ã‰πüÂ±û‰∫éÈáçÈáèÁ∫ßÊìç‰Ωú„ÄÇ</li> <li>RDB Áî®ÁâπÂÆöÁöÑ‰∫åËøõÂà∂Ê†ºÂºè‰øùÂ≠òÔºåÂèØËÉΩÊúâÁâàÊú¨‰∏çÂÖºÂÆπÈóÆÈ¢ò„ÄÇ</li></ul> <h2 id="_2„ÄÅaof"><a href="#_2„ÄÅaof" class="header-anchor">#</a> 2„ÄÅAOF</h2> <blockquote><p>‰ª•Áã¨Á´ãÁöÑÊó•ÂøóËÆ∞ÂΩïÊØèÊ¨°ÂÜôÂëΩ‰ª§ÔºåÈáçÂêØÊó∂ÂÜçÈáçÊñ∞ÊâßË°å AOF Êñá‰ª∂‰∏≠ÁöÑÂëΩ‰ª§ËææÂà∞ÊÅ¢Â§çÊï∞ÊçÆÁöÑÁõÆÁöÑ„ÄÇ
AOF Ëß£ÂÜ≥‰∫ÜÊï∞ÊçÆÊåÅ‰πÖÂåñÁöÑÂÆûÊó∂ÊÄß„ÄÇ</p></blockquote> <h3 id="_1„ÄÅaof-Â∑•‰ΩúÊµÅÁ®ã"><a href="#_1„ÄÅaof-Â∑•‰ΩúÊµÅÁ®ã" class="header-anchor">#</a> 1„ÄÅAOF Â∑•‰ΩúÊµÅÁ®ã</h3> <ul><li>ÂºÄÂêØ AOF ÈúÄË¶ÅËÆæÁΩÆÂèÇÊï∞ <code>appendonly yes</code>„ÄÇ</li> <li>ÈÄöËøáÂèÇÊï∞ <code>appendfilename</code> Êù•ËÆæÁΩÆÊñá‰ª∂Âêç„ÄÇ</li></ul> <p><img src="/ooooo-notes/assets/img/05_04.67faeb21.png" alt="AOF ÈÖçÁΩÆ"></p> <p>Â∑•‰ΩúÊµÅÁ®ãÂ¶Ç‰∏ãÂõæÔºö
<img src="/ooooo-notes/assets/img/05_03.a62cbfe1.png" alt="AOF Â∑•‰ΩúÊµÅÁ®ã"></p> <p>ËØ¥ÊòéÔºö</p> <ol><li>ÊâÄÊúâÁöÑÂÜôÂÖ•ÂëΩ‰ª§‰ºöËøΩÂä†Âà∞ aof_buf (ÁºìÂÜ≤Âå∫)‰∏≠„ÄÇ</li> <li>AOF ÁºìÂÜ≤Âå∫‰ºöÊ†πÊçÆÂêåÊ≠•Á≠ñÁï•ÔºàÂèÇÊï∞ÈªòËÆ§ËÆæÁΩÆ <code>appendfsync everysec</code>ÔºâÊù•ÂÅöÂêåÊ≠•Êìç‰Ωú„ÄÇ</li> <li>‰ºöÂÆöÊúüÂØπ AOF Êñá‰ª∂ËøõË°å <strong>rewrite</strong>ÔºåËææÂà∞ÂéãÁº©ÁöÑÁõÆÁöÑÔºåÂõ†‰∏∫ÂèØËÉΩÊúâ‰∫õ key ËøáÊúü‰∫Ü„ÄÇ</li> <li>Êú∫Âô®ÈáçÂêØÊó∂ÔºåÂ¶ÇÊûúÂºÄÂêØ‰∫Ü AOFÔºåÂàô‰ΩøÁî® AOF Âä†ËΩΩÊï∞ÊçÆ„ÄÇ</li></ol> <h3 id="_2„ÄÅÂëΩ‰ª§ÂÜôÂÖ•"><a href="#_2„ÄÅÂëΩ‰ª§ÂÜôÂÖ•" class="header-anchor">#</a> 2„ÄÅÂëΩ‰ª§ÂÜôÂÖ•</h3> <ul><li>AOF ÈááÁî®ÊñáÊú¨ÂçèËÆÆÊ†ºÂºèÔºå‰πüÂ∞±ÊòØËØ¥ AOF Êñá‰ª∂‰∏≠Â≠òÂÇ®Â∞±ÊòØÂÜôÂÖ•ÁöÑÂëΩ‰ª§ÔºåËøôÊ†∑ÂÖ∑ÊúâÈòÖËØªÊÄß„ÄÅ‰æø‰∫é‰øÆÊîπ„ÄÇ</li> <li>AOF ÊääÂëΩ‰ª§ÂÖàÂÜôÂÖ• aof_buf ‰∏≠ÔºåÊ†πÊçÆ‰∏çÂêåÁöÑÂêåÊ≠•Á≠ñÁï•ÂèØ‰ª•Âú®ÊÄßËÉΩÂíåÂÆâÂÖ®‰∏äÂÅöÂá∫Âπ≥Ë°°ÔºåÊ≤°ÊúâÁâπÊÆäË¶ÅÊ±ÇÔºåÂ∞±ËÆæÁΩÆ‰∏∫ <code>everysec</code>„ÄÇ</li></ul> <blockquote><p>‰∏âÁßçÁ≠ñÁï•Ôºõ</p> <ol><li>no: don't fsync, just let the OS flush the data when it wants. Faster.</li> <li>always: fsync after every write to the append only log. Slow, Safest.</li> <li>everysec: fsync only one time every second. Compromise.</li></ol></blockquote> <h3 id="_3„ÄÅÈáçÂÜôÊú∫Âà∂"><a href="#_3„ÄÅÈáçÂÜôÊú∫Âà∂" class="header-anchor">#</a> 3„ÄÅÈáçÂÜôÊú∫Âà∂</h3> <p>AOF Êñá‰ª∂ÂèØ‰ª•ÂèòÂ∞èÁöÑÂéüÂõ†Ôºö</p> <ul><li>Ë∂ÖÊó∂ÁöÑÊï∞ÊçÆÔºåÂèØ‰ª•‰∏çÁî®ÂÜçÂÜôÂÖ•Êñá‰ª∂‰∏≠„ÄÇ</li> <li>key ËøáÊúü‰∫ÜÔºåÂèØËÉΩÂê´ÊúâÊó†ÊïàÂëΩ‰ª§ÔºåÂ¶Ç <code>del key1</code>„ÄÇ</li> <li>Â§ö‰∏™ÂëΩ‰ª§ÂèØ‰ª•ÂêàÂπ∂Êàê‰∏Ä‰∏™ÔºåÂ¶Ç <code>lpush list a</code> Âíå <code>lpush list b</code> ÂèØ‰ª•ÂêàÂπ∂‰∏∫ <code>lpush list a b</code>„ÄÇ</li></ul> <p>Ëß¶Âèë AOF ÈáçÂÜôÊñπÂºèÔºö</p> <ul><li>ÊâãÂä®ÊâßË°åÂëΩ‰ª§ <code>bgrewriteaof</code></li> <li>Ëá™Âä®Ëß¶ÂèëÔºåÊ†πÊçÆÈÖçÁΩÆÂèÇÊï∞ <code>auto-aof-rewrite-percentage 100</code> Âíå <code>auto-aof-rewrite-min-size 64mb</code>„ÄÇ</li></ul> <blockquote><p>ÂèÇÊï∞ËØ¥ÊòéÔºö</p> <ol><li>This is how it works: Redis remembers the size of the AOF file after the
latest rewrite (if no rewrite has happened since the restart, the size of
the AOF at startup is used).</li> <li>This base size is compared to the current size. If the current size is
bigger than the specified percentage, the rewrite is triggered. Also
you need to specify a minimal size for the AOF file to be rewritten, this
is useful to avoid rewriting the AOF file even if the percentage increase
is reached but it is still pretty small</li></ol></blockquote> <p><strong>Ëá™Âä®Ëß¶ÂèëÊó∂Êú∫: aof_current_size &gt; auto-aof-rewrite-min-size &amp;&amp; (aof_current_size - aof_base_size) / aof_base_size &gt; auto-aof-rewrite-percentage</strong></p> <p>AOF ÈáçÂÜôÊµÅÁ®ãÂõæÂ¶Ç‰∏ãÔºö
<img src="/ooooo-notes/assets/img/05_05.51f3b984.png" alt="AOF ÈáçÂÜôÊµÅÁ®ã"></p> <p>ËØ¥ÊòéÔºö</p> <ol><li>ÊâßË°å AOF ÈáçÂÜôËØ∑Ê±ÇÔºåÂ¶ÇÊûúÊúâÂ≠êËøõÁ®ãÂú®ÊâßË°å <code>bgsave</code> ÂàôÁ≠âÂæÖÂÆåÊàê‰πãÂêéÂÜçÊìç‰Ωú„ÄÇ</li> <li>fork Â≠êËøõÁ®ãËøõË°åÈáçÂÜôÔºåÁà∂ËøõÁ®ãÊé•ÂèóËØ∑Ê±ÇÔºå‰øÆÊîπÂëΩ‰ª§ÂÜôÂÖ• aof_buf ‰∏≠Ê†πÊçÆÁ≠ñÁï•ÂêåÊ≠•Âà∞Á£ÅÁõò„ÄÇ</li> <li>fork Êìç‰ΩúËøêÁî®ÂÜôÊó∂Â§çÂà∂ÊäÄÊúØÔºåÊâÄ‰ª•Â≠êËøõÁ®ãÂè™ËÉΩÂÖ±‰∫´Êìç‰Ωú fork Êó∂ÁöÑÂÜÖÂ≠òÔºåËøôÊó∂Áà∂ËøõÁ®ãÂèØËÉΩËøòÂú®ÂìçÂ∫îËØ∑Ê±ÇÔºåÊâÄ‰ª•ÊääÈáçÂÜôÂêéÁöÑÊñ∞ÂëΩ‰ª§ÊîæÂÖ• <code>aof_rewrite_buf</code> ÁºìÂÜ≤Âå∫‰∏≠„ÄÇ</li> <li>Êää <code>aof_rewrite_buf</code> ‰∏≠Êï∞ÊçÆÂÜôÂÖ•Êñ∞ÁöÑ AOF Êñá‰ª∂‰∏≠ÔºåÊ†πÊçÆÂºÄÂêØÂèÇÊï∞ <code>aof-rewrite-incremental-fsync yes</code>ÔºåÊØè 32MB ÂêåÊ≠•Âà∞Á£ÅÁõò„ÄÇ</li></ol> <h3 id="_4„ÄÅÈáçÂêØÂä†ËΩΩ"><a href="#_4„ÄÅÈáçÂêØÂä†ËΩΩ" class="header-anchor">#</a> 4„ÄÅÈáçÂêØÂä†ËΩΩ</h3> <p>ÈáçÂêØÂä†ËΩΩÂõæÔºö
<img src="/ooooo-notes/assets/img/05_06.71d7585a.png" alt="ÈáçÂêØÂä†ËΩΩÂõæ"></p> <h3 id="_5„ÄÅÊñá‰ª∂Ê†°È™å"><a href="#_5„ÄÅÊñá‰ª∂Ê†°È™å" class="header-anchor">#</a> 5„ÄÅÊñá‰ª∂Ê†°È™å</h3> <p>Âä†ËΩΩÊçüÂùèÁöÑ AOF Êñá‰ª∂‰ºöÊãíÁªùÂêØÂä®ÔºåÂèØ‰ª•ÂÖà<strong>Â§á‰ªΩÊñá‰ª∂</strong>ÔºåÁÑ∂ÂêéÂÜçÊâßË°åÂëΩ‰ª§ <code>redis-check-aof [--fix] &lt;file.aof&gt;</code> Êù•ËøõË°å‰øÆÂ§ç„ÄÇ</p> <h2 id="_3„ÄÅÈóÆÈ¢òÂÆö‰Ωç‰∏é‰ºòÂåñ"><a href="#_3„ÄÅÈóÆÈ¢òÂÆö‰Ωç‰∏é‰ºòÂåñ" class="header-anchor">#</a> 3„ÄÅÈóÆÈ¢òÂÆö‰Ωç‰∏é‰ºòÂåñ</h2> <h3 id="_1„ÄÅfork-Êìç‰Ωú"><a href="#_1„ÄÅfork-Êìç‰Ωú" class="header-anchor">#</a> 1„ÄÅfork Êìç‰Ωú</h3> <p>Redis ÂÅö RDB ÊàñËÄÖ AOF ÈáçÂÜôÊó∂ÔºåÂøÖ‰∏çÂèØÂ∞ëÁöÑÊìç‰ΩúÂ∞±ÊòØ fork„ÄÇfork Áî®ÁöÑÂÜôÊó∂Â§çÂà∂ÊäÄÊúØÔºå‰ºöÂ§çÂà∂Áà∂ËøõÁ®ãÁöÑÂÜÖÂ≠òÈ°µË°®„ÄÇ</p> <p>ÊîπÂñÑ forkÊìç‰ΩúÁöÑËÄóÊó∂Ôºö</p> <ol><li>‰ºòÂÖà‰ΩøÁî®Áâ©ÁêÜÊú∫ÊàñËÄÖÈ´òÊïàÊîØÊåÅ fork Êìç‰ΩúÁöÑËôöÊãüÂåñÊäÄÊúØ„ÄÇ</li> <li>fork ËÄóÊó∂ÂíåÂÜÖÂ≠òÈáèÊàêÊ≠£ÊØîÔºåÂçï‰∏™ Redis ÂÆû‰æãÂª∫ËÆÆ‰∏çË∂ÖËøá 10G„ÄÇ</li> <li>linux ÂÜÖÂ≠òÂàÜÈÖçÁ≠ñÁï•ÔºåÈÅøÂÖçÁâ©ÁêÜÂÜÖÂ≠ò‰∏çË∂≥ÂØºËá¥ fork Â§±Ë¥•„ÄÇ</li> <li>Èôç‰Ωé fork Êìç‰ΩúÈ¢ëÁéáÔºåÊØîÂ¶ÇÈÅøÂÖç‰∏çÂøÖË¶ÅÁöÑÂÖ®ÈáèÂ§çÂà∂ÔºåÈÄÇÂΩìÊîæÂÆΩ AOF Ëá™Âä®Ëß¶ÂèëÊó∂Êú∫„ÄÇ</li></ol> <h3 id="_2„ÄÅÂ≠êËøõÁ®ãÂºÄÈîÄÁõëÊéßÂíå‰ºòÂåñ"><a href="#_2„ÄÅÂ≠êËøõÁ®ãÂºÄÈîÄÁõëÊéßÂíå‰ºòÂåñ" class="header-anchor">#</a> 2„ÄÅÂ≠êËøõÁ®ãÂºÄÈîÄÁõëÊéßÂíå‰ºòÂåñ</h3> <ol><li>CPUÔºåÂ≠êËøõÁ®ãË¥üË¥£ÊääÂÜÖÂ≠ò‰∏≠ÁöÑÊï∞ÊçÆÂÜôÂÖ•Êñá‰ª∂‰∏≠ÔºåÂ±û‰∫é IO ÂØÜÈõÜÂûãÊìç‰ΩúÔºå‰∏çË¶ÅÂíåÂÖ∂‰ªñ IO ÂØÜÈõÜÂûãÊúçÂä°ÈÉ®ÁΩ≤Âú®‰∏ÄËµ∑„ÄÇ</li> <li>ÂÜÖÂ≠òÔºåÂÜôÊó∂Â§çÂà∂ÊäÄÊúØÔºåÈÅøÂÖçÂú®Â§ßÈáèÂÜôÂÖ•Êó∂ÂÅöÂ≠êËøõÁ®ãÈáçÂÜôÊìç‰ΩúÔºåÂØºËá¥Áà∂ËøõÁ®ãÁª¥Êä§Â§ßÈáèÈ°µÂâØÊú¨ÔºåÈÄ†ÊàêÂÜÖÂ≠òÊ∂àËÄóÔºåÂèØ‰ª•ÂÖ≥Èó≠ <strong>THP</strong>„ÄÇ</li> <li>Á£ÅÁõòÔºåAOF ÈáçÂÜô‰ºöÊ∂àËÄóÂ§ßÈáèÁ£ÅÁõò IOÔºåÂèØ‰ª•ÂÖ≥Èó≠ÔºåÂèÇÊï∞ËÆæÁΩÆ‰∏∫ <code>no-appendfsync-on-rewrite yes</code>ÔºåÈªòËÆ§ÊòØÂÖ≥Èó≠ÁöÑÔºå‰ΩÜÊòØÂºÄÂêØÂêéÔºåÂèØËÉΩ‰∏¢Â§±Êï∞ÊçÆ„ÄÇ</li></ol> <h3 id="_3„ÄÅaof-ËøΩÂä†ÈòªÂ°û"><a href="#_3„ÄÅaof-ËøΩÂä†ÈòªÂ°û" class="header-anchor">#</a> 3„ÄÅAOF ËøΩÂä†ÈòªÂ°û</h3> <p>AOF ÊåÅ‰πÖÂåñÔºåÂ∏∏Áî®ÁöÑÂêåÊ≠•Á≠ñÁï•ÊòØ <code>everysec</code>ÔºåÁî®‰∫éÂπ≥Ë°°ÊÄßËÉΩÂíåÂÆâÂÖ®ÊÄßÔºåÂØπ‰∫éËøôÁßçÊñπÂºèÔºåRedis ‰ΩøÁî®Âè¶‰∏Ä‰∏™Á∫øÁ®ãÊØèÁßíÊâßË°å fsync ÂêåÊ≠•Á£ÅÁõòÔºåÂΩìÁ≥ªÁªüÁ£ÅÁõòÁπÅÂøôÊó∂ÔºåÂèØËÉΩÈÄ†Êàê Redis ‰∏ªËøõÁ®ãÈòªÂ°û„ÄÇ</p> <p><img src="/ooooo-notes/assets/img/05_07.7fd14057.png" alt="AOF ËøΩÂä†ÈòªÂ°û"></p> <h2 id="_4„ÄÅÂ§öÂÆû‰æãÈÉ®ÁΩ≤"><a href="#_4„ÄÅÂ§öÂÆû‰æãÈÉ®ÁΩ≤" class="header-anchor">#</a> 4„ÄÅÂ§öÂÆû‰æãÈÉ®ÁΩ≤</h2> <p>Áï•</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ooooo-youwillsee/ooooo-notes/edit/master/docs/pages/notes/books/redis-development-and-operation-and-maintenance/05.md" target="_blank" rel="noopener noreferrer">Âú® GitHub ‰∏äÁºñËæëÊ≠§È°µ</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">9/3/2022, 3:22:50 AM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/ooooo-notes/assets/js/app.e96e47bb.js" defer></script><script src="/ooooo-notes/assets/js/2.1848d571.js" defer></script><script src="/ooooo-notes/assets/js/5.f574e460.js" defer></script>
  </body>
</html>
