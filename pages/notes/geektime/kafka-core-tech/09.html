<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>1、为什么分区 | ooooo-notes</title>
    <meta name="generator" content="VuePress 1.6.0">
    
    <meta name="description" content="ooooo-notes">
    <link rel="preload" href="/ooooo-notes/assets/css/0.styles.ff653fc7.css" as="style"><link rel="preload" href="/ooooo-notes/assets/js/app.aa5000dc.js" as="script"><link rel="preload" href="/ooooo-notes/assets/js/2.deca84dc.js" as="script"><link rel="preload" href="/ooooo-notes/assets/js/8.8bf56eb7.js" as="script"><link rel="prefetch" href="/ooooo-notes/assets/js/10.14708035.js"><link rel="prefetch" href="/ooooo-notes/assets/js/11.27194cf4.js"><link rel="prefetch" href="/ooooo-notes/assets/js/12.20b8a006.js"><link rel="prefetch" href="/ooooo-notes/assets/js/13.a15d0c7b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/14.6ac7be49.js"><link rel="prefetch" href="/ooooo-notes/assets/js/15.a8ad078b.js"><link rel="prefetch" href="/ooooo-notes/assets/js/16.6c81e7f7.js"><link rel="prefetch" href="/ooooo-notes/assets/js/17.5d5a41e8.js"><link rel="prefetch" href="/ooooo-notes/assets/js/18.e904b721.js"><link rel="prefetch" href="/ooooo-notes/assets/js/19.eb183c98.js"><link rel="prefetch" href="/ooooo-notes/assets/js/20.d2adea1a.js"><link rel="prefetch" href="/ooooo-notes/assets/js/21.7c072df7.js"><link rel="prefetch" href="/ooooo-notes/assets/js/22.c0e94b42.js"><link rel="prefetch" href="/ooooo-notes/assets/js/23.1431900e.js"><link rel="prefetch" href="/ooooo-notes/assets/js/24.1d8d731d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/25.5f00d3f8.js"><link rel="prefetch" href="/ooooo-notes/assets/js/26.780dcf91.js"><link rel="prefetch" href="/ooooo-notes/assets/js/27.38711f1c.js"><link rel="prefetch" href="/ooooo-notes/assets/js/28.2ca3c756.js"><link rel="prefetch" href="/ooooo-notes/assets/js/29.4ee36c80.js"><link rel="prefetch" href="/ooooo-notes/assets/js/3.4e981b02.js"><link rel="prefetch" href="/ooooo-notes/assets/js/30.731bbcb7.js"><link rel="prefetch" href="/ooooo-notes/assets/js/31.90399ea4.js"><link rel="prefetch" href="/ooooo-notes/assets/js/32.24328725.js"><link rel="prefetch" href="/ooooo-notes/assets/js/33.ed867e3f.js"><link rel="prefetch" href="/ooooo-notes/assets/js/34.292f8c00.js"><link rel="prefetch" href="/ooooo-notes/assets/js/35.944708b8.js"><link rel="prefetch" href="/ooooo-notes/assets/js/36.ed05ecf3.js"><link rel="prefetch" href="/ooooo-notes/assets/js/37.41de7a0e.js"><link rel="prefetch" href="/ooooo-notes/assets/js/38.90aa88b4.js"><link rel="prefetch" href="/ooooo-notes/assets/js/39.f1472ce8.js"><link rel="prefetch" href="/ooooo-notes/assets/js/4.5825bb91.js"><link rel="prefetch" href="/ooooo-notes/assets/js/40.f198e69c.js"><link rel="prefetch" href="/ooooo-notes/assets/js/41.6edef69d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/42.d69e0b9d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/43.4cf4756d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/44.d9f72d6d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/45.0ee1f363.js"><link rel="prefetch" href="/ooooo-notes/assets/js/46.8d8f3e17.js"><link rel="prefetch" href="/ooooo-notes/assets/js/47.bc13b9a0.js"><link rel="prefetch" href="/ooooo-notes/assets/js/48.d7fcb173.js"><link rel="prefetch" href="/ooooo-notes/assets/js/49.ef32becb.js"><link rel="prefetch" href="/ooooo-notes/assets/js/5.000e2493.js"><link rel="prefetch" href="/ooooo-notes/assets/js/50.ead24c24.js"><link rel="prefetch" href="/ooooo-notes/assets/js/51.0dd4962a.js"><link rel="prefetch" href="/ooooo-notes/assets/js/52.f4ad8033.js"><link rel="prefetch" href="/ooooo-notes/assets/js/53.4b800346.js"><link rel="prefetch" href="/ooooo-notes/assets/js/54.2f5be54d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/55.3ab7412a.js"><link rel="prefetch" href="/ooooo-notes/assets/js/56.5c20f247.js"><link rel="prefetch" href="/ooooo-notes/assets/js/57.9965fb29.js"><link rel="prefetch" href="/ooooo-notes/assets/js/58.433774e5.js"><link rel="prefetch" href="/ooooo-notes/assets/js/59.8cfdaf21.js"><link rel="prefetch" href="/ooooo-notes/assets/js/6.bb557ff2.js"><link rel="prefetch" href="/ooooo-notes/assets/js/7.def3995d.js"><link rel="prefetch" href="/ooooo-notes/assets/js/9.da21af34.js">
    <link rel="stylesheet" href="/ooooo-notes/assets/css/0.styles.ff653fc7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ooooo-notes/" class="home-link router-link-active"><!----> <span class="site-name">ooooo-notes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="English" class="dropdown-title"><span class="title">English</span> <span class="arrow down"></span></button> <button type="button" aria-label="English" class="mobile-dropdown-title"><span class="title">English</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/english/friends/01.html" class="nav-link">
  Friends
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Me" class="dropdown-title"><span class="title">Me</span> <span class="arrow down"></span></button> <button type="button" aria-label="Me" class="mobile-dropdown-title"><span class="title">Me</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/plan/2020.html" class="nav-link">
  Plan
</a></li><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/resolution/2020.html" class="nav-link">
  Resolution
</a></li></ul></div></div><div class="nav-item"><a href="/ooooo-notes/" class="nav-link">
  Home
</a></div> <a href="https://github.com/ooooo-youwillsee/ooooo-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="English" class="dropdown-title"><span class="title">English</span> <span class="arrow down"></span></button> <button type="button" aria-label="English" class="mobile-dropdown-title"><span class="title">English</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/english/friends/01.html" class="nav-link">
  Friends
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Me" class="dropdown-title"><span class="title">Me</span> <span class="arrow down"></span></button> <button type="button" aria-label="Me" class="mobile-dropdown-title"><span class="title">Me</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/plan/2020.html" class="nav-link">
  Plan
</a></li><li class="dropdown-item"><!----> <a href="/ooooo-notes/pages/me/resolution/2020.html" class="nav-link">
  Resolution
</a></li></ul></div></div><div class="nav-item"><a href="/ooooo-notes/" class="nav-link">
  Home
</a></div> <a href="https://github.com/ooooo-youwillsee/ooooo-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/ooooo-notes/" aria-current="page" class="sidebar-link">Home</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_1、为什么分区"><a href="#_1、为什么分区" class="header-anchor">#</a> 1、为什么分区</h2> <p>Kafka 的消息组织方式实际上是三级结构：<strong>主题 - 分区 - 消息</strong>，主题下的每条消息只会保存在某一个分区中。</p> <p>Kafka 的三级结构：</p> <p><img src="data:image/png;base64,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" alt="Kafka 的三级结构"></p> <p>分区是为了实现系统的高伸缩性（Scalability），可以通过添加新的节点来增加整体系统的吞吐量。</p> <h2 id="_2、分区策略"><a href="#_2、分区策略" class="header-anchor">#</a> 2、分区策略</h2> <blockquote><p>所谓分区策略是决定生产者将消息发送到哪个分区的算法。</p></blockquote> <h3 id="_1、自定义分区策略"><a href="#_1、自定义分区策略" class="header-anchor">#</a> 1、自定义分区策略</h3> <p>你需要显式地配置生产者端的参数 <code>partitioner.class</code>，在编写生产者程序时，你可以编写一个具体的类实现 <code>org.apache.kafka.clients.producer.Partitioner</code> 接口，实现 <code>partition()</code> 和 <code>close()</code> 接口。</p> <p>方法签名：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> <span class="token function">partition</span><span class="token punctuation">(</span><span class="token class-name">String</span> topic<span class="token punctuation">,</span> <span class="token class-name">Object</span> key<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keyBytes<span class="token punctuation">,</span> <span class="token class-name">Object</span> value<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> valueBytes<span class="token punctuation">,</span> <span class="token class-name">Cluster</span> cluster<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2、轮询策略"><a href="#_2、轮询策略" class="header-anchor">#</a> 2、轮询策略</h3> <p><img src="/ooooo-notes/assets/img/09_02.6c630aaf.png" alt="轮询策略"></p> <p><strong>Kafka 默认的分区策略就是轮询策略，轮询策略有非常优秀的负载均衡表现，它总是能保证消息最大限度地被平均分配到所有分区上。</strong></p> <h3 id="_3、随机策略"><a href="#_3、随机策略" class="header-anchor">#</a> 3、随机策略</h3> <p><img src="/ooooo-notes/assets/img/09_03.5b50b76e.png" alt="随机策略"></p> <p>要实现随机策略版的 partition 方法(自定义分区策略)，如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionInfo</span><span class="token punctuation">&gt;</span></span> partitions <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">partitionsForTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token class-name">ThreadLocalRandom</span><span class="token punctuation">.</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>partitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_4、按消息键保序策略"><a href="#_4、按消息键保序策略" class="header-anchor">#</a> 4、按消息键保序策略</h3> <p><img src="/ooooo-notes/assets/img/09_04.63aba008.png" alt="按消息键保序策略"></p> <p>实现这个策略的 partition 方法(自定义分区策略)，如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionInfo</span><span class="token punctuation">&gt;</span></span> partitions <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">partitionsForTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>key<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> partitions<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>Kafka 默认分区策略实际上同时实现了两种策略：如果指定了 Key，那么默认实现按消息键保序策略；如果没有指定 Key，则使用轮询策略。</strong></p> <h3 id="_5、其他分区策略"><a href="#_5、其他分区策略" class="header-anchor">#</a> 5、其他分区策略</h3> <p>比较常见的一种就是<strong>基于地理位置的分区策略</strong>。</p> <p>比如根据 Broker 所在的 IP 地址实现定制化的分区策略，如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartitionInfo</span><span class="token punctuation">&gt;</span></span> partitions <span class="token operator">=</span> cluster<span class="token punctuation">.</span><span class="token function">partitionsForTopic</span><span class="token punctuation">(</span>topic<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> partitions<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>p <span class="token operator">-&gt;</span> <span class="token function">isSouth</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">leader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">host</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">PartitionInfo</span><span class="token operator">::</span><span class="token function">partition</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findAny</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>我们可以从所有分区中找出那些 Leader 副本在南方的所有分区，然后随机挑选一个进行消息发送。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ooooo-youwillsee/ooooo-notes/edit/master/docs/pages/notes/geektime/kafka-core-tech/09.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">10/6/2020, 3:26:55 AM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/ooooo-notes/assets/js/app.aa5000dc.js" defer></script><script src="/ooooo-notes/assets/js/2.deca84dc.js" defer></script><script src="/ooooo-notes/assets/js/8.8bf56eb7.js" defer></script>
  </body>
</html>
