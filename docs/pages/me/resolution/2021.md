## 1. tomcat 自定义错误页

在 `conf/server.xml` 中的 **Host**标签添加

```
<Host name="localhost"  appBase="webapps"
      unpackWARs="true" autoDeploy="true">
  <Valve className="org.apache.catalina.valves.AccessLogValve" directory="logs"
         prefix="localhost_access_log" suffix=".txt"
         pattern="%h %l %u %t &quot;%r&quot; %s %b" />

    // 这是新加的
    <Valve className="org.apache.catalina.valves.ErrorReportValve"
              errorCode.400="webapps/ROOT/error.jsp"
              errorCode.0="webapps/ROOT/error.jsp"
              showReport="false"
              showServerInfo="false" />
    // 这是新加的
</Host>
```

上面的 **error.jsp** 放在 `webapps/ROOT/`

- 参考 https://stackoverflow.com/questions/52814582/tomcat-is-not-redirecting-to-400-bad-request-custom-error-page
- 参考 https://tomcat.apache.org/tomcat-9.0-doc/config/valve.html#Error_Report_Valve

## 2. gradle 全局设置仓库镜像

在 `~\.gradle` 目录下新建文件 `init.gradle`, 内容如下

```
allprojects {
    repositories {
        mavenLocal()
			maven { name "Alibaba" ; url "https://maven.aliyun.com/repository/public" }
			maven { name "Bstek" ; url "http://nexus.bsdn.org/content/groups/public/" }
    }

	buildscript {
		repositories {
			maven { name "Alibaba" ; url 'https://maven.aliyun.com/repository/public' }
			maven { name "Bstek" ; url 'http://nexus.bsdn.org/content/groups/public/' }
			maven { name "M2" ; url 'https://plugins.gradle.org/m2/' }
		}
	}
}
```

## 3. \*.apache.org 等网站无法访问

运行命令 `ping apache.org` 显示 IP 地址为 127.0.0.1

原因就是 DNS 出问题了，解决方法就是 **配置网卡的 DNS 为 114.114.114.114**

## 4. InetAddress#getHostName 超时

解决方法，设置 hosts 文件

比如 InetAddress 显示的是 **192.168.130.1**， 所以就在 hosts 文件中添加一条记录 (反解析)

```
192.168.130.1 192.168.130.1
```

## 5. nacos 在 tomcat 中无法注册服务

```java
@Component
public class NacosAutoServiceRegistrationWithTomcat implements ApplicationRunner {

	@Autowired(required = false)
	private NacosAutoServiceRegistration nacosAutoServiceRegistration;

	@Autowired
	private Environment environment;

	@Override
	public void run(ApplicationArguments args) throws Exception {
		if (nacosAutoServiceRegistration != null) {
		    // 重新设置端口
			nacosAutoServiceRegistration.setPort(Integer.parseInt(environment.getProperty("server.port")));
		    l// 重新注册
			nacosAutoServiceRegistration.start();
		}
	}
}
```

## 6. mysql8.0 第一次安装后，重置密码

1. 查看临时密码： `cat /var/log/mysqld.log | grep password`
2. 登录 mysql, `mysql -uroot -p`, 输入临时密码
3. 设置简单密码，执行下面的命令

```shell
# 设置密码长度
set global validate_password.length=4;
# 设置可以和登录用户名一样
set global validate_password.check_user_name=off;
# 简单密码策略
set global validate_password.policy=0;
```

4. 执行命令 `ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';` 重置密码
5. 创建用户， `CREATE USER 'root'@'%' IDENTIFIED BY 'root';`
6. 授权，`GRANT ALL ON *.* TO 'root'@'%'`

## 7. win10，默认没有创建软链接的权限

1. 在调试**pulsar**，程序需要创建**软链接**
2. 系统必须要为**专业版**，才会有**策略组**权限设置

参考

1. [百度经验](https://jingyan.baidu.com/article/e52e361588a3b501c60c5184.html)
2. [win10 软连接权限设置](https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-vista/cc766301(v=ws.10))

## 8. 搭建 mysql8.0 主从， 在同一个机器上

### 1. 安装 mysql, 运行 `systemctl start mysqld.service`

### 2. 创建 master mysql 的配置文件

#### 1./etc/my3307.cnf 文件配置

```shell
[mysql]
port=3307
socket=/var/lib/mysql3307/mysql.sock

[mysqld]

datadir=/var/lib/mysql3307
socket=/var/lib/mysql3307/mysql.sock

log-error=/var/log/mysqld3307.log
pid-file=/var/run/mysqld/mysqld3307.pid

default-time_zone = '+8:00'
max_connect_errors = 10000

port=3307
# diable MySQL X plugin
mysqlx=0

# location where binlog is stored 
log-bin=/var/lib/mysql/binlog3307

# server unique id
server-id=1

# each write is synchronized with the hard disk
sync-binlog=1

# which database is synchronized
binlog-do-db=master_slave_test

# expire days for binlog
expire-logs-days=7

# which database is ignored for binlog
binlog-ignore-db=information_schema
binlog-ignore-db=performation_schema
binlog-ignore-db=sys

# skip dns resolve
# skip-name-resolve


```

#### 2. master 服务器初始化

```shell
# 初始化, 会创建 dataDir [/var/lib/mysql3307]
mysqld --defaults-file=/etc/my3307.cnf --initialize
#  以root用户启动mysql -D表示以守护进程启动
mysqld --defaults-file=/etc/my3307.cnf --user=root -D
# 登录，密码在 cat /var/log/mysqld3307.log | grep password 中
mysql --defaults-file=/etc/my3307.cnf  -uroot -p
# 重置密码
ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';
# 创建用户` （可选）
CREATE USER 'root'@'%' IDENTIFIED BY 'root';
# 授权 (可选 )
GRANT ALL ON *.* TO 'root'@'%'

# 创建同步 binlog 的用户
CREATE USER 'replicate_user'@'%' IDENTIFIED BY 'root';
grant replication slave,replication client on *.* to 'replicate_user'@'%';
flush privileges;
```

### 3. 创建 slave mysql 的配置文件

#### 1. /etc/my3308.cnf 文件配置

```shell
[mysql]
port=3308
socket=/var/lib/mysql3308/mysql.sock

[mysqld]

datadir=/var/lib/mysql3308
socket=/var/lib/mysql3308/mysql.sock

log-error=/var/log/mysqld3308.log
pid-file=/var/run/mysqld/mysqld3308.pid

default-time_zone = '+8:00'
max_connect_errors = 10000

port=3308
# diable MySQL X plugin
mysqlx=0

# location where binlog is stored 
log-bin=/var/lib/mysql/binlog3308

relay-log=slave-relay-bin

# server unique id
server-id=2

read_only = 1

# slave sync data to binlog
log_slave_updates = 1

# each write is synchronized with the hard disk
sync-binlog=1

# which database is synchronized
replicate-do-db=master_slave_test

# expire days for binlog
expire-logs-days=7

# which database is ignored for binlog
binlog-ignore-db=information_schema
binlog-ignore-db=performation_schema
binlog-ignore-db=sys

# skip dns resolve
# skip-name-resolve
```

#### 2. slave 服务器初始化

```shell
# 初始化, 会创建 dataDir [/var/lib/mysql3308]
mysqld --defaults-file=/etc/my3308.cnf --initialize
#  以root用户启动mysql -D表示以守护进程启动
mysqld --defaults-file=/etc/my3308.cnf --user=root -D
# 登录，密码在 cat /var/log/mysqld3308.log | grep password 中
mysql --defaults-file=/etc/my3308.cnf  -uroot -p
# 重置密码
ALTER USER 'root'@'localhost' IDENTIFIED BY 'root';

# 设置master地址， ip, port, user, password, binlogFile, binlogPosition

# 获取 binlogFile, binlogPosition，在 master 服务器上执行
show master status; 

# 设置复制位置
change master to master_host='192.168.0.119', master_port=3307, master_user='replicate_user',  master_password='root', master_log_file='binlog3307.000010', master_log_pos=3788;
# 开启复制
start slave;
# 查询 slave 的状态, 如果显示 Slave_IO_Running: Yes, Slave_SQL_Running: Yes, 就是正常的
show slave status\G;

# 如有问题，先停掉 slave, 然后重新设置 master 的复制位置
stop slave;

```

### 4. 问题
在从库上执行 show slave status\G
显示报错：
Authentication plugin 'caching_sha2_password' reported error
考虑到我的MySQL8 ，

查看主库：
`SELECT plugin FROM `user` where user = 'replicate_user';`
原来是主库repl的plugin是caching_sha2_password 导致连接不上，修改为mysql_native_password即可解决。

`ALTER USER 'replicate_user'@'%' IDENTIFIED WITH mysql_native_password BY 'root';`


## 8. oracle RAC 集群 url 设置

spring 的 applicaton.yml:

```yaml
  datasource:
    driver-class-name: oracle.jdbc.driver.OracleDriver
    type: com.zaxxer.hikari.HikariDataSource
    url: jdbc:oracle:thin:@(DESCRIPTION=(ADDRESS_LIST=(ADDRESS=(PROTOCOL=TCP)(HOST=host1)(PORT=1521))(ADDRESS=(PROTOCOL=TCP)(HOST=host2)(PORT=1521))(FAILOVER=on)(LOAD_BALANCE=on))(CONNECT_DATA=(SERVICE_NAME=orcl)))
    username: system
    password: system
```
